{"version":3,"file":"synclist.js","sources":["../src/synclist.ts"],"sourcesContent":["import { deepClone, isPositiveInteger, validatePageSize } from './utils/sanitize';\nimport { UriBuilder } from './utils/uri';\nimport { SyncError } from './utils/syncerror';\nimport log from './utils/logger';\n\nimport { SyncEntity, EntityServices, RemovalHandler } from './entity';\nimport { SyncListItem } from './synclistitem';\nimport { Paginator } from './paginator';\nimport { ItemsCache } from './itemsCache';\n\nimport { Mutator } from './interfaces/mutator';\nimport { NamespacedMergingQueue } from './mergingqueue';\nimport Closeable from './closeable';\nimport { custom, nonNegativeInteger, objectSchema, pureObject, validateTypesAsync } from '@twilio/declarative-type-validator';\nimport { reverse, last, head } from 'lodash';\n\ninterface SyncListServices extends EntityServices {\n}\n\ninterface SyncListDescriptor {\n  sid: string;\n  url: string;\n  revision: string;\n  last_event_id: number;\n  links: any;\n  unique_name: string;\n  date_updated: Date;\n  date_expires: string;\n}\n\n/**\n * List item metadata.\n */\ninterface SyncListItemMetadata {\n  /**\n   * Specifies the time-to-live in seconds after which the list item is subject to automatic deletion.\n   * The value 0 means infinity.\n   */\n  ttl?: number;\n}\n\n/**\n * List item query options.\n */\ninterface SyncListItemQueryOptions {\n  index?: number;\n\n  /**\n   * Item index, which should be used as the offset.\n   * If undefined, starts from the beginning or end depending on queryOptions.order.\n   */\n  from?: number;\n\n  /**\n   * Results page size. Default is 50.\n   */\n  pageSize?: number;\n\n  /**\n   * Numeric order of results. Default is \"asc\".\n   */\n  order?: 'asc' | 'desc';\n\n  /**\n   * Query limit.\n   */\n  limit?: number;\n}\n\nclass SyncListImpl extends SyncEntity {\n  private descriptor: SyncListDescriptor;\n  private updateMergingQueue: NamespacedMergingQueue<number, SyncListItemMetadata, SyncListItem>;\n  private cache: ItemsCache<number, SyncListItem>;\n  private context: Object;\n  private contextEventId: number;\n\n  /**\n   * @private\n   */\n  constructor(services: SyncListServices, descriptor: SyncListDescriptor, removalHandler: RemovalHandler) {\n    super(services, removalHandler);\n\n    const updateRequestReducer = (acc, input) => (typeof input.ttl === 'number') ? {ttl: input.ttl}\n      : acc;\n    this.updateMergingQueue = new NamespacedMergingQueue<number, SyncListItemMetadata, SyncListItem>(updateRequestReducer);\n    this.cache = new ItemsCache<number, SyncListItem>();\n    this.descriptor = descriptor;\n    this.descriptor.date_updated = new Date(this.descriptor.date_updated);\n  }\n\n  // private props\n  get uri(): string {\n    return this.descriptor.url;\n  }\n\n  get revision(): string {\n    return this.descriptor.revision;\n  }\n\n  get lastEventId(): number {\n    return this.descriptor.last_event_id;\n  }\n\n  get links() {\n    return this.descriptor.links;\n  }\n\n  get dateExpires() {\n    return this.descriptor.date_expires;\n  }\n\n  static get type() {\n    return 'list';\n  }\n\n  get type() {\n    return 'list';\n  }\n\n  // below properties are specific to Insights only\n  get indexName(): string {\n    return undefined;\n  }\n\n  get queryString(): string {\n    return undefined;\n  }\n\n  // public props, documented along with class description\n  get sid(): string {\n    return this.descriptor.sid;\n  }\n\n  get uniqueName(): string {\n    return this.descriptor.unique_name || null;\n  }\n\n  get dateUpdated(): Date {\n    return this.descriptor.date_updated;\n  }\n\n  private async _addOrUpdateItemOnServer(url: string, data: Record<string, unknown>, ifMatch: string, ttl: number) {\n    const requestBody: any = {data};\n\n    if (ttl !== undefined) {\n      requestBody.ttl = ttl;\n    }\n\n    const response = await this.services.network.post(url, requestBody, ifMatch);\n    response.body.data = data;\n    response.body.date_updated = new Date(response.body.date_updated);\n\n    return response.body;\n  }\n\n  public async push(value, itemMetadata?: SyncListItemMetadata): Promise<SyncListItem> {\n    let ttl = (itemMetadata || {}).ttl;\n    let item = await this._addOrUpdateItemOnServer(this.links.items, value, undefined, ttl);\n    let index = Number(item.index);\n    this._handleItemMutated(index, item.url, item.last_event_id, item.revision, value, item.date_updated, item.date_expires, true, false);\n    return this.cache.getValue(index);\n  }\n\n  public async set(index: number, value: Record<string, unknown>, itemMetadataUpdates?: SyncListItemMetadata) {\n    const input: SyncListItemMetadata = itemMetadataUpdates || {};\n    return this.updateMergingQueue.squashAndAdd(index, input, (input) => this._updateItemUnconditionally(index, value, input.ttl));\n  }\n\n  private async _updateItemUnconditionally(index: number, data: Record<string, unknown>, ttl?: number): Promise<SyncListItem> {\n    let existingItem = await this.get(index);\n    const itemDescriptor = await this._addOrUpdateItemOnServer(existingItem.url, data, undefined, ttl);\n    this._handleItemMutated(index, itemDescriptor.url, itemDescriptor.last_event_id, itemDescriptor.revision,\n      itemDescriptor.data, itemDescriptor.date_updated, itemDescriptor.date_expires, false, false);\n    return this.cache.getValue(index);\n  }\n\n  private async _updateItemWithIfMatch(index: number, mutatorFunction: Mutator, ttl?: number): Promise<SyncListItem> {\n    const existingItem = await this.get(index);\n    const data = mutatorFunction(deepClone(existingItem.data)) as Record<string, unknown>;\n    if (data) {\n      const ifMatch = existingItem.revision;\n      try {\n        const itemDescriptor = await this._addOrUpdateItemOnServer(existingItem.url, data, ifMatch, ttl);\n        this._handleItemMutated(index, itemDescriptor.url, itemDescriptor.last_event_id, itemDescriptor.revision,\n          itemDescriptor.data, itemDescriptor.date_updated, itemDescriptor.date_expires, false, false);\n        return this.cache.getValue(index);\n      } catch (error) {\n        if (error.status === 412) {\n          await this._getItemFromServer(index);\n          return this._updateItemWithIfMatch(index, mutatorFunction, ttl);\n        } else {\n          throw error;\n        }\n      }\n    } else {\n      return existingItem;\n    }\n  }\n\n  public async mutate(index: number, mutator: Mutator, itemMetadataUpdates?: SyncListItemMetadata): Promise<SyncListItem> {\n    const input: SyncListItemMetadata = itemMetadataUpdates || {};\n    return this.updateMergingQueue.add(index, input, (input) => this._updateItemWithIfMatch(index, mutator, input.ttl));\n  }\n\n  public async update(index: number, obj: Object, itemMetadataUpdates?: SyncListItemMetadata): Promise<SyncListItem> {\n    return this.mutate(index, remote => Object.assign(remote, obj), itemMetadataUpdates);\n  }\n\n  public async remove(index: number): Promise<void> {\n    const item = await this.get(index);\n    const previousItemData = deepClone(item.data) as Record<string, unknown>;\n    const response = await this.services.network.delete(item.url);\n    this._handleItemRemoved(index, response.body.last_event_id, previousItemData, new Date(response.body.date_updated), false);\n  }\n\n  public async get(index: number): Promise<SyncListItem> {\n    let cachedItem = this.cache.get(index);\n    if (cachedItem) {\n      return cachedItem.value;\n    }\n    return this._getItemFromServer(index);\n  }\n\n  private async _getItemFromServer(index: number): Promise<SyncListItem> {\n    // queryItemsFromServer is used only here!\n    let result = await this._queryItemsFromServer({index});\n    if (result.items.length < 1) {\n      throw new SyncError(`No item with index ${index} found`, 404, 54151);\n    } else {\n      return result.items[0];\n    }\n  }\n\n  /**\n   * Query items from the List\n   * @param args Argument pack for the query.\n   *             May include the following parameters:\n   *\n   *             - index -- Returns the Item with the specified index or an empty items array, if one doesn't exist.\n   *             - from -- Item index offset specifying the starting point of the query (inclusive). If not specified,\n   *                       the query starts from either the first or the last item in the List (by index),\n   *                       depending on the Order query parameter.\n   *             - order -- String(Optional) -- Determines the order of the query. Items are ordered numerically by index.\n   *                                            One of {asc, desc}, defaults to asc.\n   *             - pageSize -- Maximum number of Items in the response (i.e. in this page). Defaults to 50.\n   *                           The max page size is 1000. Note: PageSize between 100 and 1000 returns at most 100 items.\n   *             - pageToken - Direct paging token, for starting from a specific page.\n   *             - Metadata - May have the value list. If specified, returns the state of the List in the list attribute of the response.\n   *             - HideExpired - Determines whether expired List items are filtered out from the result list. By default, is false.\n   *\n   *             Stuff not accepted by the service, internal to SDK:\n   *\n   *             - limit\n   *\n   *   Valid query parameter combinations\n   *   These are the valid query parameter combinations. [x] should be read as “if x is not provided, the default value is assumed”.\n   *   The combinations are in order of precedence - e.g., if both Index and PageToken are provided, PageToken is ignored.\n   *   +-----------------------------------------+------------------------------------------------------------------------------+\n   *   | Index, [Metadata]                       | Returns 0-1 Items with the given Index                                       |\n   *   | PageToken, [Metadata]                   | Returns a page based on the PageToken returned from a previous query,        |\n   *   |                                         | with this and all following pages modified by any provided query parameters. |\n   *   | [From], [Order], [Pagesize], [Metadata] | Performs an initial query from a specified offset.                           |\n   *   |                                         | Returned PageTokens in the meta block should be used for pagination.         |\n   *   +-----------------------------------------+------------------------------------------------------------------------------+\n   * @private\n   */\n  protected async queryItems(args?): Promise<Paginator<SyncListItem>> {\n    // If the index is specified, fetch only a single item.\n    if (args.index) {\n      const cached = this.cache.get(args.index);\n      if (cached) {\n        return this.makePaginator(cached.isValid ? [cached.value] : [], args, false, false);\n      }\n      return this._querySingleItemFromServer(args.index);\n    }\n\n    // If a paginator calls here with nextPageItemId or prevPageItemId it means we are trying to fetch a next or previous\n    // page accordingly. the task is to determine the direction (based on args.order and direction of queried page) and\n    // prefill it from the cache as much as possible.\n\n    const fillingSubsequentPage: boolean = !!args.nextPageItemId || !!args.prevPageItemId;\n\n    const oldArgs = {...args};\n\n    if (fillingSubsequentPage) {\n      args.from = args.nextPageItemId ?? args.prevPageItemId ?? args.from;\n    }\n\n    const goingBackwards = !!args.prevPageItemId;\n\n    // If from and order are specified, fetch page of items.\n    let cacheIterator = args.order === 'desc'\n        ? (goingBackwards\n            ? this.cache.getIterator(args.prevPageItemId ?? args.from ?? null)\n            : this.cache.getReverseIterator(args.nextPageItemId ?? args.from ?? null))\n        : (goingBackwards\n            ? this.cache.getReverseIterator(args.prevPageItemId ?? args.from ?? null)\n            : this.cache.getIterator(args.nextPageItemId ?? args.from ?? null));\n    let cachedItems: SyncListItem[] = [];\n\n    const itemsCountToGet = fillingSubsequentPage ? args.limit + 1 : args.limit;\n\n    for (let item of cacheIterator) {\n      if (fillingSubsequentPage && item.value.index == args.from) {\n        continue;\n      }\n\n      cachedItems.push(item.value);\n\n      if (cachedItems.length >= args.limit) {\n        if (goingBackwards) {\n          reverse(cachedItems);\n        }\n        // We've got a full page of items, so we can easily generate prev/next page navigation\n        // However, the first item in the page cannot be collectionBegin, and the last item cannot be collectionEnd\n        return this.makePaginator(cachedItems, args\n            , this._prevPageAllowed(cachedItems, args.order)\n            , this._nextPageAllowed(cachedItems, args.order));\n      }\n    }\n\n    // cache was not enough, so continue fetching from the server in the same direction\n    // whatever the last fetched item was, it will be the next `from`\n    if (cachedItems.length > 0) {\n      args.from = last(cachedItems).index;\n    }\n\n    // Maximum sync page size is 100 items, 10 is simply 1/10th of that.\n    const getLimit = Math.max(itemsCountToGet - cachedItems.length, 10);\n\n    if (goingBackwards) {\n      args.order = args.order === 'desc' ? 'asc' : 'desc';\n    }\n\n    const doFetch = args.from !== (oldArgs.order === 'desc'\n        ? (goingBackwards ? this.cache.collectionEnd : this.cache.collectionBegin)\n        : (goingBackwards ? this.cache.collectionBegin : this.cache.collectionEnd));\n\n    if (doFetch) {\n      const fetchedItems = await this._queryItemsFromServer({...args, limit: getLimit});\n      const items = fetchedItems.items;\n\n      this.cache.populate(items, !fetchedItems.hasPrevPage, !fetchedItems.hasNextPage);\n\n      for (let item of items) {\n        if ((cachedItems.length > 0 || fillingSubsequentPage) && item.index == args.from) {\n          // Skip the key we already have in cachedItems\n          continue;\n        }\n\n        if (goingBackwards) {\n          cachedItems.unshift(item);\n        } else {\n          cachedItems.push(item);\n        }\n\n        if (cachedItems.length >= args.limit) {\n          break;\n        }\n      }\n    } else {\n      if (goingBackwards) {\n        reverse(cachedItems);\n      }\n    }\n\n    return this.makePaginator(cachedItems, oldArgs\n        , this._prevPageAllowed(cachedItems, oldArgs.order)\n        , this._nextPageAllowed(cachedItems, oldArgs.order));\n  }\n\n  private _prevPageAllowed(items: SyncListItem[], order: string): boolean {\n    return items.length > 0 && head(items).index !== (order === 'desc' ? this.cache.collectionEnd : this.cache.collectionBegin);\n  }\n\n  private _nextPageAllowed(items: SyncListItem[], order: string): boolean {\n    return items.length > 0 && last(items).index !== (order === 'desc' ? this.cache.collectionBegin : this.cache.collectionEnd);\n  }\n\n  // Paginator depends on:\n  // - items listed\n  // - was there a previous token (prevPage)\n  // - was there a next token (nextPage)\n  // - order of items asc/desc\n  private makePaginator(items: SyncListItem[], args, prevPage: boolean, nextPage: boolean) {\n    args.nextPageItemId = args.prevPageItemId = null;\n    const hasPrevPage = prevPage && this._prevPageAllowed(items, args.order);\n    const hasNextPage = nextPage && this._nextPageAllowed(items, args.order);\n    return new Paginator<SyncListItem>(items\n        , (adds) => this.queryItems({...args, ...adds })\n        , hasPrevPage ? head(items).index : null\n        , hasNextPage ? last(items).index : null);\n  }\n\n  protected async _querySingleItemFromServer(index: number): Promise<Paginator<SyncListItem>> {\n    const fetchedItems = await this._queryItemsFromServer({index});\n\n    if (fetchedItems.items.length === 0) {\n      // Successfully failed to fetch by key, mark it as a tombstone.\n      this.cache.delete(index, null);\n    }\n\n    return fetchedItems;\n  }\n\n  protected async _queryItemsFromServer(args): Promise<Paginator<SyncListItem>> {\n    const uri = new UriBuilder(this.links.items)\n        .queryParam('HideExpired', true)\n        // either\n        .queryParam('Index', args.index)\n        // or\n        .queryParam('PageToken', args.pageToken)\n        // or\n        .queryParam('From', args.from)\n        .queryParam('PageSize', args.limit) // @fixme use pageSize not limit?\n        .queryParam('Order', args.order)\n        .build();\n\n    let response = await this.services.network.get(uri);\n    let items = (response.body?.items ?? []).map(el => {\n      el.date_updated = new Date(el.date_updated);\n      // FIXME: handleItem mutated inserts items into the cache, so populate call later only updates the bounds? Split it.\n      this._handleItemMutated(el.index, el.url, el.last_event_id, el.revision, el.data, el.date_updated, el.date_expires, false, true);\n      return this.cache.getValue(el.index);\n    });\n    const meta = response.body.meta;\n    return this.makePaginator(items, args, !!meta.previous_token, !!meta.next_token);\n  }\n\n  async getItems(args?: any): Promise<Paginator<SyncListItem>> {\n    args = args || {};\n    validatePageSize(args.pageSize);\n    args.limit = args.pageSize || args.limit || 50;\n    args.order = args.order || 'asc';\n    return this.queryItems(args);\n  }\n\n  /**\n   * @return {Promise<Object>} Context of List\n   * @private\n   */\n  async getContext(): Promise<Object> {\n    if (!this.context) {\n      let response = await this.services.network.get(this.links.context);\n      // store fetched context if we have't received any newer update\n      this._updateContextIfRequired(response.body.data, response.body.last_event_id);\n    }\n    return this.context;\n  }\n\n  public async setTtl(ttl: number): Promise<void> {\n    try {\n      const requestBody = {ttl};\n      const response = await this.services.network.post(this.uri, requestBody);\n      this.descriptor.date_expires = response.body.date_expires;\n    } catch (error) {\n      if (error.status === 404) {\n        this.onRemoved(false);\n      }\n      throw error;\n    }\n  }\n\n  public async setItemTtl(index: number, ttl: number): Promise<void> {\n    let existingItem = await this.get(index);\n    const requestBody = {ttl};\n    const response = await this.services.network.post(existingItem.url, requestBody);\n    existingItem.updateDateExpires(response.body.date_expires);\n  }\n\n  async removeList() {\n    await this.services.network.delete(this.uri);\n    this.onRemoved(true);\n  }\n\n  protected onRemoved(locally: boolean) {\n    this._unsubscribe();\n    this.removalHandler(this.type, this.sid, this.uniqueName);\n\n    this.broadcastEventToListeners('removed', {isLocal: locally});\n  }\n\n  private shouldIgnoreEvent(key: number, last_event_id: number) {\n    return this.cache.isKnown(key, last_event_id);\n  }\n\n  /**\n   * Handle update, which came from the server.\n   * @private\n   */\n  _update(update, isStrictlyOrdered: boolean): void {\n    const itemIndex = Number(update.item_index);\n    update.date_created = new Date(update.date_created);\n    // update.date_expires = new Date(update.date_expires);\n    switch (update.type) {\n      case 'list_item_added':\n      case 'list_item_updated': {\n        this._handleItemMutated(\n          itemIndex,\n          update.item_url,\n          update.id,\n          update.item_revision,\n          update.item_data,\n          update.date_created,\n          update.date_expires, // orchestration events include date_expires since June 2020, SP-386\n          update.type === 'list_item_added',\n          true);\n      }\n        break;\n      case 'list_item_removed': {\n        this._handleItemRemoved(itemIndex, update.id, update.item_data, update.date_created, true);\n      }\n        break;\n      case 'list_context_updated': {\n        this._handleContextUpdate(update.context_data, update.id, update.date_created);\n      }\n        break;\n      case 'list_removed': {\n        this.onRemoved(false);\n      }\n        break;\n    }\n\n    if (isStrictlyOrdered) {\n      this._advanceLastEventId(update.id, update.list_revision);\n    }\n  }\n\n  _advanceLastEventId(eventId: number, revision?: string): void {\n    if (this.lastEventId < eventId) {\n      this.descriptor.last_event_id = eventId;\n      if (revision) {\n        this.descriptor.revision = revision;\n      }\n    }\n  }\n\n  private _updateRootDateUpdated(dateUpdated: Date) {\n    if (!this.descriptor.date_updated || dateUpdated.getTime() > this.descriptor.date_updated.getTime()) {\n      this.descriptor.date_updated = dateUpdated;\n      this.services.storage.update(this.type, this.sid, this.uniqueName, {date_updated: dateUpdated});\n    }\n  }\n\n  private _handleItemMutated(\n    index: number,\n    url: string,\n    lastEventId: number,\n    revision: string,\n    data: Record<string, unknown>,\n    dateUpdated: Date,\n    dateExpires: string,\n    added: boolean,\n    remote: boolean\n  ): void {\n    if (this.shouldIgnoreEvent(index, lastEventId)) {\n      log.trace(`Item ${index} update skipped, current: ${this.lastEventId}, remote: ${lastEventId}`);\n      return;\n    }\n\n    this._updateRootDateUpdated(dateUpdated);\n    const item = this.cache.getValue(index);\n\n    if (!item) {\n      const newItem = new SyncListItem({index, url, lastEventId, revision, data, dateUpdated, dateExpires});\n\n      this.cache.store(index, newItem, lastEventId);\n      this.emitItemMutationEvent(newItem, remote, added);\n\n      return;\n    }\n\n    const previousItemData = deepClone(item.data) as Record<string, unknown>;\n    item.update(lastEventId, revision, data, dateUpdated);\n    this.cache.store(index, item, lastEventId);\n\n    if (dateExpires !== undefined) {\n      item.updateDateExpires(dateExpires);\n    }\n\n    this.emitItemMutationEvent(item, remote, false, previousItemData);\n  }\n\n  /**\n   * @private\n   */\n  private emitItemMutationEvent(item: SyncListItem, remote: boolean, added: boolean, previousItemData: null | Record<string, unknown> = null): void {\n    const eventName = added ? 'itemAdded' : 'itemUpdated';\n    const args: any = {item, isLocal: !remote};\n\n    if (!added) {\n      args.previousItemData = previousItemData;\n    }\n\n    this.broadcastEventToListeners(eventName as any, args);\n  }\n\n  /**\n   * @private\n   */\n  private _handleItemRemoved(index: number, lastEventId: number, oldData: Record<string, unknown>, dateUpdated: Date, remote: boolean): void {\n    this._updateRootDateUpdated(dateUpdated);\n    this.cache.delete(index, lastEventId);\n    this.broadcastEventToListeners('itemRemoved', {index: index, isLocal: !remote, previousItemData: oldData});\n  }\n\n  /**\n   * @private\n   */\n  private _handleContextUpdate(data: Record<string, unknown>, eventId: number, dateUpdated: Date): void {\n    this._updateRootDateUpdated(dateUpdated);\n    if (this._updateContextIfRequired(data, eventId)) {\n      this.broadcastEventToListeners('contextUpdated', {context: data, isLocal: false});\n    }\n  }\n\n  /**\n   * @private\n   */\n  private _updateContextIfRequired(data: Record<string, unknown>, eventId: number): boolean {\n    if (!this.contextEventId || eventId > this.contextEventId) {\n      this.context = data;\n      this.contextEventId = eventId;\n      return true;\n    } else {\n      log.trace('Context update skipped, current:', this.lastEventId, ', remote:', eventId);\n      return false;\n    }\n  }\n}\n\n/**\n * Represents a Sync list, which stores an ordered list of values.\n * Use the {@link SyncClient.list} method to obtain a reference to a Sync list.\n * Information about rate limits can be found [here](https://www.twilio.com/docs/sync/limits).\n */\nclass SyncList extends Closeable {\n  private readonly syncListImpl: SyncListImpl;\n\n  // private props\n  get uri(): string {\n    return this.syncListImpl.uri;\n  }\n\n  get revision(): string {\n    return this.syncListImpl.revision;\n  }\n\n  get lastEventId(): number {\n    return this.syncListImpl.lastEventId;\n  }\n\n  get links() {\n    return this.syncListImpl.links;\n  }\n\n  get dateExpires() {\n    return this.syncListImpl.dateExpires;\n  }\n\n  static get type() {\n    return SyncListImpl.type;\n  }\n\n  get type() {\n    return SyncListImpl.type;\n  }\n\n  /**\n   * Unique ID of the list, immutable identifier assigned by the system.\n   */\n  get sid(): string {\n    return this.syncListImpl.sid;\n  }\n\n  /**\n   * Unique name of the list, immutable identifier that can be assigned to the list during creation.\n   */\n  get uniqueName(): string {\n    return this.syncListImpl.uniqueName;\n  }\n\n  /**\n   * Date when the list was last updated, given in UTC ISO 8601 format (e.g., '2018-04-26T15:23:19.732Z').\n   */\n  get dateUpdated(): Date {\n    return this.syncListImpl.dateUpdated;\n  }\n\n  /**\n   * @internal\n   */\n  constructor(syncListImpl: SyncListImpl) {\n    super();\n    this.syncListImpl = syncListImpl;\n    this.syncListImpl.attach(this);\n  }\n\n  /**\n   * Fired when a new item appears in the list, regardless of whether its creator was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * {@link SyncListItem} `item` - added item\n   *     * boolean `isLocal` - equals true if the item was added by a local actor, false otherwise\n   * @example\n   * ```typescript\n   * list.on('itemAdded', (args) => {\n   *   console.log(`List item ${args.item.index} was added`);\n   *   console.log('args.item.data:', args.item.data);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemAdded = 'itemAdded';\n\n  /**\n   * Fired when a list item is updated (not added or removed, but changed), regardless of whether the updater was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * {@link SyncListItem} `item` - updated item\n   *     * boolean `isLocal` - equals true if the item was updated by a local actor, false otherwise\n   *     * object `previousItemData` - contains a snapshot of the item data before the update\n   * @example\n   * ```typescript\n   * list.on('itemUpdated', (args) => {\n   *   console.log(`List item ${args.item.index} was updated`);\n   *   console.log('args.item.data:', args.item.data);\n   *   console.log('args.isLocal:', args.isLocal);\n   *   console.log('args.previousItemData:', args.previousItemData);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemUpdated = 'itemUpdated';\n\n  /**\n   * Fired when a list item is removed, regardless of whether the remover was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * number `index` - index of the removed item\n   *     * boolean `isLocal` - equals true if the item was removed by a local actor, false otherwise\n   *     * object `previousItemData` - contains a snapshot of the item data before the removal\n   * @example\n   * ```typescript\n   * list.on('itemRemoved', (args) => {\n   *   console.log(`List item ${args.index} was removed`);\n   *   console.log('args.previousItemData:', args.previousItemData);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemRemoved = 'itemRemoved';\n\n  /**\n   * Fired when a list is deleted entirely, by any actor local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * boolean `isLocal` - equals true if the list was removed by a local actor, false otherwise\n   * @example\n   * ```typescript\n   * list.on('removed', (args) => {\n   *   console.log(`List ${list.sid} was removed`);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly removed = 'removed';\n\n  /**\n   * Add a new item to the list.\n   * @param data Data to be added.\n   * @param itemMetadata Item metadata.\n   * @return The newly added item.\n   * @example\n   * ```typescript\n   * list.push({ name: 'John Smith' }, { ttl: 86400 })\n   *   .then((item) => {\n   *     console.log(`List Item push() successful, item index: ${item.index}, data:`, item.data)\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item push() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    pureObject,\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n\n  public async push(data, itemMetadata?: SyncListItemMetadata): Promise<SyncListItem> {\n    this.ensureNotClosed();\n    return this.syncListImpl.push(data, itemMetadata) as Promise<SyncListItem>;\n  }\n\n  /**\n   * Assign new data to an existing item, given its index.\n   * @param index Index of the item to be updated.\n   * @param value New data to be assigned to an item.\n   * @param itemMetadataUpdates New item metadata.\n   * @return A promise with the updated item containing latest known data.\n   * The promise will be rejected if the item does not exist.\n   * @example\n   * ```typescript\n   * list.set(42, { name: 'John Smith' }, { ttl: 86400 })\n   *   .then((item) => {\n   *     console.log('List Item set() successful, item data:', item.data)\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item set() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    nonNegativeInteger,\n    pureObject,\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n\n  public async set(index: number, value: Record<string, unknown>, itemMetadataUpdates?: SyncListItemMetadata): Promise<SyncListItem> {\n    this.ensureNotClosed();\n    return this.syncListImpl.set(index, value, itemMetadataUpdates);\n  }\n\n  /**\n   * Modify an existing item by applying a mutation function to it.\n   * @param index Index of the item to be changed.\n   * @param mutator A function that outputs a new data based on the existing data.\n   * @param itemMetadataUpdates New item metadata.\n   * @return Resolves with the most recent item state, the output of a successful\n   * mutation or a state that prompted graceful cancellation (mutator returned `null`). This promise\n   * will be rejected if the indicated item does not already exist.\n   * @example\n   * ```typescript\n   * const mutatorFunction = (currentValue) => {\n   *     currentValue.viewCount = (currentValue.viewCount || 0) + 1;\n   *     return currentValue;\n   * };\n   * list.mutate(42, mutatorFunction, { ttl: 86400 })\n   *   .then((item) => {\n   *     console.log('List Item mutate() successful, new data:', item.data)\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item mutate() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    nonNegativeInteger,\n    'function',\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n\n  public async mutate(index: number, mutator: Mutator, itemMetadataUpdates?: SyncListItemMetadata): Promise<SyncListItem> {\n    this.ensureNotClosed();\n    return this.syncListImpl.mutate(index, mutator, itemMetadataUpdates);\n  }\n\n  /**\n   * Modify an existing item by appending new fields (or overwriting existing ones) with the values from the object.\n   * This is equivalent to\n   * ```typescript\n   * list.mutate(42, (currentValue) => Object.assign(currentValue, obj));\n   * ```\n   * @param index Index of an item to be changed.\n   * @param obj Set of fields to update.\n   * @param itemMetadataUpdates New item metadata.\n   * @return A promise with a modified item containing latest known data.\n   * The promise will be rejected if the item was not found.\n   * @example\n   * ```typescript\n   * // Say, the List Item (index: 42) data is `{ name: 'John Smith' }`\n   * list.update(42, { age: 34 }, { ttl: 86400 })\n   *   .then((item) => {\n   *     // Now the List Item data is `{ name: 'John Smith', age: 34 }`\n   *     console.log('List Item update() successful, new data:', item.data);\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item update() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    nonNegativeInteger,\n    pureObject,\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n  public async update(index: number, obj: Record<string, unknown>, itemMetadataUpdates?: SyncListItemMetadata): Promise<SyncListItem> {\n    this.ensureNotClosed();\n    return this.syncListImpl.update(index, obj, itemMetadataUpdates);\n  }\n\n  /**\n   * Delete an item given its index.\n   * @param index Index of the item to be removed.\n   * @return A promise to remove the item.\n   * The promise will be rejected if the item was not found.\n   * @example\n   * ```typescript\n   * list.remove(42)\n   *   .then(() => {\n   *     console.log('List Item remove() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item remove() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger)\n  public async remove(index: number): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncListImpl.remove(index);\n  }\n\n  /**\n   * Retrieve an item by List index.\n   * @param index Item index in the list.\n   * @return A promise with the item containing latest known data.\n   * The promise will be rejected if the item was not found.\n   * @example\n   * ```typescript\n   * list.get(42)\n   *   .then((item) => {\n   *     console.log('List Item get() successful, item data:', item.data)\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item get() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger)\n  public async get(index: number): Promise<SyncListItem> {\n    this.ensureNotClosed();\n    return this.syncListImpl.get(index);\n  }\n\n  /**\n   * Retrieve a list context\n   * @return A promise with the list's context\n   * @internal\n   */\n  public async getContext(): Promise<Object> {\n    this.ensureNotClosed();\n    return this.syncListImpl.getContext();\n  }\n\n  /**\n   * Query a list of items from collection.\n   * Information about the query limits can be found {@link https://www.twilio.com/docs/sync/limits|here}.\n   * @param queryOptions Query options.\n   * @example\n   * ```typescript\n   * const pageHandler = (paginator) => {\n   *   paginator.items.forEach((item) => {\n   *     console.log(`Item ${item.index}:`, item.data);\n   *   });\n   *   return paginator.hasNextPage\n   *     ? paginator.nextPage().then(pageHandler)\n   *     : null;\n   * };\n   * list.getItems({ from: 0, order: 'asc' })\n   *   .then(pageHandler)\n   *   .catch((error) => {\n   *     console.error('List getItems() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync([\n    'undefined',\n    objectSchema('query options', {\n      from: [nonNegativeInteger, 'undefined'],\n      pageSize: [custom((value) => [isPositiveInteger(value), 'a positive integer']), 'undefined'],\n      order: [custom((value) => [value === 'asc' || value === 'desc', `either 'asc' or 'desc'`]), 'undefined']\n    })\n  ])\n  async getItems(queryOptions: SyncListItemQueryOptions): Promise<Paginator<SyncListItem>> {\n    this.ensureNotClosed();\n    return this.syncListImpl.getItems(queryOptions);\n  }\n\n  /**\n   * Update the time-to-live of the list.\n   * @param ttl Specifies the TTL in seconds after which the list is subject to automatic deletion. The value 0 means infinity.\n   * @return A promise that resolves after the TTL update was successful.\n   * @example\n   * ```typescript\n   * list.setTtl(3600)\n   *   .then(() => {\n   *     console.log('List setTtl() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('List setTtl() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger)\n  public async setTtl(ttl: number): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncListImpl.setTtl(ttl);\n  }\n\n  /**\n   * Update the time-to-live of a list item.\n   * @param index Item index.\n   * @param ttl Specifies the TTL in seconds after which the list item is subject to automatic deletion. The value 0 means infinity.\n   * @return A promise that resolves after the TTL update was successful.\n   * @example\n   * ```typescript\n   * list.setItemTtl(42, 86400)\n   *   .then(() => {\n   *     console.log('List setItemTtl() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('List setItemTtl() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger, nonNegativeInteger)\n  public async setItemTtl(index: number, ttl: number): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncListImpl.setItemTtl(index, ttl);\n  }\n\n  /**\n   * Delete this list. It will be impossible to restore it.\n   * @return A promise that resolves when the list has been deleted.\n   * @example\n   * list.removeList()\n   *   .then(() => {\n   *     console.log('List removeList() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('List removeList() failed', error);\n   *   });\n   */\n  async removeList(): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncListImpl.removeList();\n  }\n\n  /**\n   * Conclude work with the list instance and remove all event listeners attached to it.\n   * Any subsequent operation on this object will be rejected with error.\n   * Other local copies of this list will continue operating and receiving events normally.\n   * @example\n   * ```typescript\n   * list.close();\n   * ```\n   */\n  public close(): void {\n    super.close();\n    this.syncListImpl.detach(this.listenerUuid);\n  }\n\n}\n\nexport { SyncListItemMetadata, SyncListItemQueryOptions, SyncListServices, SyncListDescriptor, Mutator, SyncList, SyncListImpl };\nexport default SyncList;\n"],"names":["SyncEntity","NamespacedMergingQueue","ItemsCache","deepClone","SyncError","reverse","last","head","Paginator","uri","UriBuilder","validatePageSize","log","SyncListItem","Closeable","__decorate","validateTypesAsync","pureObject","objectSchema","nonNegativeInteger","custom","isPositiveInteger"],"mappings":"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"}