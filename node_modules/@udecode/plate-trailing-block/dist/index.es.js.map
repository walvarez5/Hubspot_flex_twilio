{"version":3,"file":"index.es.js","sources":["../src/createTrailingBlockPlugin.ts"],"sourcesContent":["import {\n  ELEMENT_DEFAULT,\n  getLastNode,\n  insertNodes,\n  queryNode,\n  QueryNodeOptions,\n} from '@udecode/plate-common';\nimport {\n  getPlatePluginType,\n  getPlatePluginWithOverrides,\n  SPEditor,\n  TElement,\n  WithOverride,\n} from '@udecode/plate-core';\nimport { Path } from 'slate';\n\nexport interface WithTrailingBlock extends QueryNodeOptions {\n  /**\n   * Type of the trailing block\n   */\n  type?: string;\n  /**\n   * Level where the trailing node should be, the first level being 0.\n   */\n  level?: number;\n}\n\n/**\n * Add a trailing block when the last node type is not `type` and when the editor has .\n */\nexport const withTrailingBlock = ({\n  type: _type,\n  level = 0,\n  ...query\n}: WithTrailingBlock = {}): WithOverride => (editor) => {\n  const { normalizeNode } = editor;\n\n  const type =\n    _type ?? getPlatePluginType((editor as any) as SPEditor, ELEMENT_DEFAULT);\n\n  editor.normalizeNode = ([currentNode, currentPath]) => {\n    if (!currentPath.length) {\n      const lastChild = getLastNode(editor, level);\n\n      const lastChildNode = lastChild?.[0];\n\n      if (\n        !lastChildNode ||\n        (lastChildNode.type !== type && queryNode(lastChild, query))\n      ) {\n        const at = lastChild ? Path.next(lastChild[1]) : [0];\n\n        insertNodes<TElement>(\n          editor,\n          {\n            type,\n            children: [{ text: '' }],\n          },\n          { at }\n        );\n        return;\n      }\n    }\n\n    return normalizeNode([currentNode, currentPath]);\n  };\n\n  return editor;\n};\n\n/**\n * @see {@link withTrailingNode}\n */\nexport const createTrailingBlockPlugin = getPlatePluginWithOverrides(\n  withTrailingBlock\n);\n"],"names":["withTrailingBlock","type","_type","level","query","editor","normalizeNode","getPlatePluginType","ELEMENT_DEFAULT","currentNode","currentPath","length","lastChild","getLastNode","lastChildNode","queryNode","at","Path","next","insertNodes","children","text","createTrailingBlockPlugin","getPlatePluginWithOverrides"],"mappings":";;;;AA2BA;AACA;AACA;MACaA,iBAAiB,GAAG,CAAC;AAChCC,EAAAA,IAAI,EAAEC,KAD0B;AAEhCC,EAAAA,KAAK,GAAG,CAFwB;AAGhC,KAAGC;AAH6B,IAIX,EAJU,KAIYC,MAAD,IAAY;AACtD,QAAM;AAAEC,IAAAA;AAAF,MAAoBD,MAA1B;AAEA,QAAMJ,IAAI,GACRC,KADQ,aACRA,KADQ,cACRA,KADQ,GACCK,kBAAkB,CAAEF,MAAF,EAA8BG,eAA9B,CAD7B;;AAGAH,EAAAA,MAAM,CAACC,aAAP,GAAuB,CAAC,CAACG,WAAD,EAAcC,WAAd,CAAD,KAAgC;AACrD,QAAI,CAACA,WAAW,CAACC,MAAjB,EAAyB;AACvB,YAAMC,SAAS,GAAGC,WAAW,CAACR,MAAD,EAASF,KAAT,CAA7B;AAEA,YAAMW,aAAa,GAAGF,SAAH,aAAGA,SAAH,uBAAGA,SAAS,CAAG,CAAH,CAA/B;;AAEA,UACE,CAACE,aAAD,IACCA,aAAa,CAACb,IAAd,KAAuBA,IAAvB,IAA+Bc,SAAS,CAACH,SAAD,EAAYR,KAAZ,CAF3C,EAGE;AACA,cAAMY,EAAE,GAAGJ,SAAS,GAAGK,IAAI,CAACC,IAAL,CAAUN,SAAS,CAAC,CAAD,CAAnB,CAAH,GAA6B,CAAC,CAAD,CAAjD;AAEAO,QAAAA,WAAW,CACTd,MADS,EAET;AACEJ,UAAAA,IADF;AAEEmB,UAAAA,QAAQ,EAAE,CAAC;AAAEC,YAAAA,IAAI,EAAE;AAAR,WAAD;AAFZ,SAFS,EAMT;AAAEL,UAAAA;AAAF,SANS,CAAX;AAQA;AACD;AACF;;AAED,WAAOV,aAAa,CAAC,CAACG,WAAD,EAAcC,WAAd,CAAD,CAApB;AACD,GAzBD;;AA2BA,SAAOL,MAAP;AACD;AAED;AACA;AACA;;MACaiB,yBAAyB,GAAGC,2BAA2B,CAClEvB,iBADkE;;;;"}