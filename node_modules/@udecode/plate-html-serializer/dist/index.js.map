{"version":3,"file":"index.js","sources":["../src/serializer/utils/htmlStringToDOMNode.ts","../src/deserializer/utils/deserializeHTMLToBreak.ts","../src/deserializer/utils/deserializeHTMLToElement.ts","../src/deserializer/utils/deserializeHTMLToFragment.ts","../src/deserializer/utils/deserializeHTMLToMarks.ts","../src/deserializer/utils/deserializeHTMLToText.ts","../src/deserializer/utils/deserializeHTMLNode.ts","../src/deserializer/utils/deserializeHTMLElement.ts","../src/deserializer/utils/deserializeHTMLToDocumentFragment.ts","../src/deserializer/createDeserializeHTMLPlugin.ts","../src/serializer/serializeHTMLFromNodes.ts"],"sourcesContent":["/**\n * Convert HTML string into HTML element.\n */\nexport const htmlStringToDOMNode = (\n  rawHtml: string,\n  stripWhitespace = true\n) => {\n  const node = document.createElement('body');\n  node.innerHTML = rawHtml;\n\n  if (stripWhitespace) {\n    node.innerHTML = node.innerHTML.replace(/(\\r\\n|\\n|\\r|\\t)/gm, '');\n  }\n\n  return node;\n};\n","/**\n * Deserialize HTML to break line.\n */\nexport const deserializeHTMLToBreak = (node: HTMLElement | ChildNode) => {\n  if (node.nodeName === 'BR') {\n    return '\\n';\n  }\n};\n","import {\n  PlatePlugin,\n  SPEditor,\n  TDescendant,\n  TElement,\n} from '@udecode/plate-core';\nimport { jsx } from 'slate-hyperscript';\nimport { DeserializeHTMLChildren } from '../types';\n\njsx;\n\n/**\n * Deserialize HTML to Element.\n */\nexport const deserializeHTMLToElement = <T extends SPEditor = SPEditor>(\n  editor: T,\n  {\n    plugins,\n    element,\n    children,\n  }: {\n    plugins: PlatePlugin<T>[];\n    element: HTMLElement;\n    children: DeserializeHTMLChildren[];\n  }\n): TElement | undefined => {\n  let slateElement: any;\n  let withoutChildren: boolean | undefined;\n\n  plugins.some(({ deserialize: pluginDeserializers }) => {\n    const elementDeserializers = pluginDeserializers?.(editor).element;\n    if (!elementDeserializers) return;\n\n    return elementDeserializers.some((deserializer) => {\n      const deserialized = deserializer.deserialize(element);\n      if (!deserialized) return;\n\n      slateElement = deserialized;\n      withoutChildren = deserializer.withoutChildren;\n      return true;\n    });\n  });\n\n  if (slateElement) {\n    let descendants = children as TDescendant[];\n    if (!descendants.length || withoutChildren) {\n      descendants = [{ text: '' }];\n    }\n\n    return jsx('element', slateElement, descendants) as TElement;\n  }\n};\n","import { TDescendant } from '@udecode/plate-core';\nimport { jsx } from 'slate-hyperscript';\nimport { DeserializeHTMLChildren } from '../types';\n\njsx;\n\n/**\n * Deserialize HTML body element to Fragment.\n */\nexport const deserializeHTMLToFragment = ({\n  element,\n  children,\n}: {\n  element: HTMLElement;\n  children: DeserializeHTMLChildren[];\n}): TDescendant[] | undefined => {\n  if (element.nodeName === 'BODY') {\n    return jsx('fragment', {}, children);\n  }\n};\n","import { mergeDeepToNodes } from '@udecode/plate-common';\nimport {\n  isElement,\n  PlatePlugin,\n  SPEditor,\n  TDescendant,\n} from '@udecode/plate-core';\nimport { Text } from 'slate';\nimport { jsx } from 'slate-hyperscript';\nimport { DeserializeHTMLChildren } from '../types';\n\njsx;\n\nexport interface DeserializeMarksProps<T extends SPEditor = SPEditor> {\n  plugins: PlatePlugin<T>[];\n  element: HTMLElement;\n  children: DeserializeHTMLChildren[];\n}\n\n/**\n * Deserialize HTML to TDescendant[] with marks on Text.\n * Build the leaf from the leaf deserializers of each plugin.\n */\nexport const deserializeHTMLToMarks = <T extends SPEditor = SPEditor>(\n  editor: T,\n  { plugins, element, children }: DeserializeMarksProps<T>\n) => {\n  let leaf = {};\n\n  plugins.forEach(({ deserialize: pluginDeserializers }) => {\n    const leafDeserializers = pluginDeserializers?.(editor).leaf;\n    if (!leafDeserializers) return;\n\n    leafDeserializers.forEach((deserializer) => {\n      const leafPart = deserializer.deserialize(element);\n\n      if (!leafPart) return;\n\n      leaf = { ...leaf, ...leafPart };\n    });\n  });\n\n  return children.reduce((arr: TDescendant[], child) => {\n    if (!child) return arr;\n\n    if (isElement(child)) {\n      if (Object.keys(leaf).length) {\n        mergeDeepToNodes({\n          node: child,\n          source: leaf,\n          query: {\n            filter: ([n]) => Text.isText(n),\n          },\n        });\n      }\n      arr.push(child);\n    } else {\n      arr.push(jsx('text', leaf, child));\n    }\n\n    return arr;\n  }, []);\n};\n","/**\n * Deserialize HTML text node to text.\n */\nexport const deserializeHTMLToText = (node: HTMLElement | ChildNode) => {\n  if (node.nodeType === Node.TEXT_NODE) {\n    return node.nodeValue === '\\n' ? null : node.textContent;\n  }\n};\n","import { PlatePlugin, SPEditor } from '@udecode/plate-core';\nimport { DeserializeHTMLChildren, DeserializeHTMLReturn } from '../types';\nimport { deserializeHTMLToBreak } from './deserializeHTMLToBreak';\nimport { deserializeHTMLToElement } from './deserializeHTMLToElement';\nimport { deserializeHTMLToFragment } from './deserializeHTMLToFragment';\nimport { deserializeHTMLToMarks } from './deserializeHTMLToMarks';\nimport { deserializeHTMLToText } from './deserializeHTMLToText';\n\n/**\n * Deserialize HTML element or child node.\n */\nexport const deserializeHTMLNode = <T extends SPEditor = SPEditor>(\n  editor: T,\n  plugins: PlatePlugin<T>[]\n) => (node: HTMLElement | ChildNode): DeserializeHTMLReturn => {\n  // text node\n  const textNode = deserializeHTMLToText(node);\n  if (textNode) return textNode;\n\n  // if not an element node\n  if (node.nodeType !== Node.ELEMENT_NODE) return null;\n\n  const htmlElement = node as HTMLElement;\n\n  // break line\n  const breakLine = deserializeHTMLToBreak(node);\n  if (breakLine) return breakLine;\n\n  const { nodeName } = node;\n  let parent = node;\n\n  // blockquote\n  if (nodeName === 'PRE' && node.childNodes[0]?.nodeName === 'CODE') {\n    [parent] = node.childNodes;\n  }\n\n  const children: DeserializeHTMLChildren[] = Array.from(parent.childNodes)\n    .map(deserializeHTMLNode(editor, plugins))\n    .flat();\n\n  // body\n  const fragment = deserializeHTMLToFragment({\n    element: htmlElement,\n    children,\n  });\n  if (fragment) return fragment;\n\n  // element\n  const element = deserializeHTMLToElement(editor, {\n    plugins,\n    element: htmlElement,\n    children,\n  });\n  if (element) return element;\n\n  // mark\n  return deserializeHTMLToMarks(editor, {\n    plugins,\n    element: htmlElement,\n    children,\n  });\n};\n","import { PlatePlugin, SPEditor } from '@udecode/plate-core';\nimport { DeserializeHTMLReturn } from '../types';\nimport { deserializeHTMLNode } from './deserializeHTMLNode';\n\n/**\n * Deserialize HTML element.\n */\nexport const deserializeHTMLElement = <T extends SPEditor = SPEditor>(\n  editor: T,\n  {\n    plugins,\n    element,\n  }: {\n    plugins: PlatePlugin<T>[];\n    element: HTMLElement;\n  }\n): DeserializeHTMLReturn => {\n  return deserializeHTMLNode(editor, plugins)(element);\n};\n","import { normalizeDescendantsToDocumentFragment } from '@udecode/plate-common';\nimport { PlatePlugin, SPEditor, TDescendant } from '@udecode/plate-core';\nimport { htmlStringToDOMNode } from '../../serializer/utils/htmlStringToDOMNode';\nimport { deserializeHTMLElement } from './deserializeHTMLElement';\n\n/**\n * Deserialize HTML element to a valid document fragment.\n */\nexport const deserializeHTMLToDocumentFragment = <\n  T extends SPEditor = SPEditor\n>(\n  editor: T,\n  {\n    plugins,\n    element,\n    stripWhitespace = true,\n  }: {\n    plugins: PlatePlugin<T>[];\n    element: HTMLElement | string;\n    stripWhitespace?: boolean;\n  }\n): TDescendant[] => {\n  if (typeof element === 'string') {\n    element = htmlStringToDOMNode(element, stripWhitespace);\n  }\n\n  const fragment = deserializeHTMLElement(editor, {\n    plugins,\n    element,\n  }) as TDescendant[];\n\n  return normalizeDescendantsToDocumentFragment(editor, {\n    descendants: fragment,\n  });\n};\n","import {\n  getPlatePluginWithOverrides,\n  PlatePlugin,\n  SPEditor,\n  WithOverride,\n} from '@udecode/plate-core';\nimport { insertDeserializedFragment } from '@udecode/plate-serializer';\nimport { ReactEditor } from 'slate-react';\nimport { deserializeHTMLToDocumentFragment } from './utils/deserializeHTMLToDocumentFragment';\n\nexport interface WithDeserializeHTMLOptions<\n  T extends SPEditor = SPEditor & ReactEditor\n> {\n  plugins?: PlatePlugin<T>[];\n}\n\n/**\n * Enables support for deserializing inserted content from HTML format to Slate format.\n */\nexport const withDeserializeHTML = <\n  T extends ReactEditor & SPEditor = ReactEditor & SPEditor\n>({ plugins = [] }: WithDeserializeHTMLOptions<T> = {}): WithOverride<T> => (\n  editor\n) => {\n  const { insertData } = editor;\n\n  editor.insertData = (data: DataTransfer) => {\n    const html = data.getData('text/html');\n\n    if (html) {\n      const { body } = new DOMParser().parseFromString(html, 'text/html');\n\n      const fragment = deserializeHTMLToDocumentFragment(editor, {\n        plugins,\n        element: body,\n      });\n\n      if (fragment.length) {\n        return insertDeserializedFragment(editor, { fragment, plugins });\n      }\n    }\n\n    insertData(data);\n  };\n\n  return editor;\n};\n\n/**\n * @see {@link withDeserializeHTML}\n */\nexport const createDeserializeHTMLPlugin = getPlatePluginWithOverrides(\n  withDeserializeHTML\n);\n","import { renderToStaticMarkup } from 'react-dom/server';\nimport { createElementWithSlate } from '@udecode/plate-common';\nimport {\n  PlatePlugin,\n  SlateProps,\n  SPEditor,\n  SPRenderElementProps,\n  TDescendant,\n} from '@udecode/plate-core';\nimport { Text } from 'slate';\nimport { RenderLeafProps } from 'slate-react';\n\n// Remove extra whitespace generated by ReactDOMServer\nconst trimWhitespace = (rawHtml: string): string =>\n  rawHtml.replace(/(\\r\\n|\\n|\\r|\\t)/gm, '');\n\n// Remove redundant data attributes\nconst stripSlateDataAttributes = (rawHtml: string): string =>\n  rawHtml\n    .replace(/( data-slate)(-node|-type|-leaf)=\"[^\"]+\"/gm, '')\n    .replace(/( data-testid)=\"[^\"]+\"/gm, '');\n\n/**\n * Remove all class names that do not start with one of preserveClassNames (`slate-` by default)\n */\nconst stripClassNames = (\n  html: string,\n  { preserveClassNames = ['slate-'] }: { preserveClassNames?: string[] }\n) => {\n  const allClasses = html.split(/(class=\"[^\"]*\")/g);\n\n  let filteredHtml = '';\n  allClasses.forEach((item, index) => {\n    if (index % 2 === 0) {\n      return (filteredHtml += item);\n    }\n    const preserveRegExp = new RegExp(\n      preserveClassNames.map((cn) => `${cn}[^\"\\\\s]*`).join('|'),\n      'g'\n    );\n    const slateClassNames = item.match(preserveRegExp);\n    if (slateClassNames) {\n      filteredHtml += `class=\"${slateClassNames.join(' ')}\"`;\n    }\n  });\n\n  return filteredHtml;\n};\n\nconst getNode = (\n  editor: SPEditor,\n  {\n    plugins,\n    elementProps,\n    slateProps,\n    preserveClassNames,\n  }: {\n    plugins: PlatePlugin[];\n    elementProps: SPRenderElementProps;\n    slateProps?: Partial<SlateProps>;\n    preserveClassNames?: string[];\n  }\n) => {\n  // If no type provided we wrap children with div tag\n  if (!elementProps.element.type) {\n    return `<div>${elementProps.children}</div>`;\n  }\n\n  let html: string | undefined;\n\n  // Search for matching plugin based on element type\n  plugins.some((plugin) => {\n    if (!plugin.serialize?.element && !plugin.renderElement) return false;\n\n    if (\n      !plugin\n        .deserialize?.(editor)\n        .element?.some(\n          (item) => item.type === String(elementProps.element.type)\n        )\n    ) {\n      html = `<div>${elementProps.children}</div>`;\n      return false;\n    }\n\n    // Render element using picked plugins renderElement function and ReactDOM\n    html = renderToStaticMarkup(\n      createElementWithSlate({\n        ...slateProps,\n        children:\n          plugin.serialize?.element?.(elementProps) ??\n          plugin.renderElement?.(editor)(elementProps),\n      })\n    );\n\n    html = stripClassNames(html, { preserveClassNames });\n\n    return true;\n  });\n\n  return html;\n};\n\nconst getLeaf = (\n  editor: SPEditor,\n  {\n    plugins,\n    leafProps,\n    slateProps,\n    preserveClassNames,\n  }: {\n    plugins: PlatePlugin[];\n    leafProps: RenderLeafProps;\n    slateProps?: Partial<SlateProps>;\n    preserveClassNames?: string[];\n  }\n) => {\n  const { children } = leafProps;\n\n  return plugins.reduce((result, plugin) => {\n    if (!plugin.serialize?.leaf && !plugin.renderLeaf) return result;\n    if (\n      (plugin.serialize?.leaf?.(leafProps) ??\n        plugin.renderLeaf?.(editor)(leafProps)) === children\n    )\n      return result;\n\n    const newLeafProps = {\n      ...leafProps,\n      children: encodeURIComponent(result),\n    };\n\n    let html = decodeURIComponent(\n      renderToStaticMarkup(\n        createElementWithSlate({\n          ...slateProps,\n          children:\n            plugin.serialize?.leaf?.(newLeafProps) ??\n            plugin.renderLeaf?.(editor)(newLeafProps),\n        })\n      )\n    );\n\n    html = stripClassNames(html, { preserveClassNames });\n\n    return html;\n  }, children);\n};\n\nconst isEncoded = (str = '') => {\n  try {\n    return str !== decodeURIComponent(str);\n  } catch (error) {\n    return false;\n  }\n};\n\n/**\n * Convert Slate Nodes into HTML string\n */\nexport const serializeHTMLFromNodes = (\n  editor: SPEditor,\n  {\n    plugins,\n    nodes,\n    slateProps,\n    stripDataAttributes = true,\n    preserveClassNames,\n    stripWhitespace = true,\n  }: {\n    /**\n     * Plugins with renderElement or renderLeaf.\n     */\n    plugins: PlatePlugin[];\n\n    /**\n     * Slate nodes to convert to HTML.\n     */\n    nodes: TDescendant[];\n\n    /**\n     * Enable stripping data attributes\n     */\n    stripDataAttributes?: boolean;\n\n    /**\n     * List of className prefixes to preserve from being stripped out\n     */\n    preserveClassNames?: string[];\n\n    /**\n     * Slate props to provide if the rendering depends on slate hooks\n     */\n    slateProps?: Partial<SlateProps>;\n\n    /**\n     * Whether stripping whitespaces from serialized HTML\n     * @default true\n     */\n    stripWhitespace?: boolean;\n  }\n): string => {\n  let result = nodes\n    .map((node) => {\n      if (Text.isText(node)) {\n        return getLeaf(editor, {\n          plugins,\n          leafProps: {\n            leaf: node,\n            text: node,\n            children: isEncoded(node.text)\n              ? node.text\n              : encodeURIComponent(node.text),\n            attributes: { 'data-slate-leaf': true },\n          },\n          slateProps,\n          preserveClassNames,\n        });\n      }\n\n      return getNode(editor, {\n        plugins,\n        elementProps: {\n          element: node,\n          children: encodeURIComponent(\n            serializeHTMLFromNodes(editor, {\n              plugins,\n              nodes: node.children,\n              preserveClassNames,\n              stripWhitespace,\n            })\n          ) as any,\n          attributes: { 'data-slate-node': 'element', ref: null },\n        },\n        slateProps,\n        preserveClassNames,\n      });\n    })\n    .join('');\n\n  if (isEncoded(result)) {\n    result = decodeURIComponent(result);\n  }\n\n  if (stripWhitespace) {\n    result = trimWhitespace(result);\n  }\n\n  if (stripDataAttributes) {\n    result = stripSlateDataAttributes(result);\n  }\n\n  return result;\n};\n"],"names":["htmlStringToDOMNode","rawHtml","stripWhitespace","node","document","createElement","innerHTML","replace","deserializeHTMLToBreak","nodeName","deserializeHTMLToElement","editor","plugins","element","children","slateElement","withoutChildren","some","deserialize","pluginDeserializers","elementDeserializers","deserializer","deserialized","descendants","length","text","jsx","deserializeHTMLToFragment","deserializeHTMLToMarks","leaf","forEach","leafDeserializers","leafPart","reduce","arr","child","isElement","Object","keys","mergeDeepToNodes","source","query","filter","n","Text","isText","push","deserializeHTMLToText","nodeType","Node","TEXT_NODE","nodeValue","textContent","deserializeHTMLNode","textNode","ELEMENT_NODE","htmlElement","breakLine","parent","childNodes","Array","from","map","flat","fragment","deserializeHTMLElement","deserializeHTMLToDocumentFragment","normalizeDescendantsToDocumentFragment","withDeserializeHTML","insertData","data","html","getData","body","DOMParser","parseFromString","insertDeserializedFragment","createDeserializeHTMLPlugin","getPlatePluginWithOverrides","trimWhitespace","stripSlateDataAttributes","stripClassNames","preserveClassNames","allClasses","split","filteredHtml","item","index","preserveRegExp","RegExp","cn","join","slateClassNames","match","getNode","elementProps","slateProps","type","plugin","serialize","renderElement","String","renderToStaticMarkup","createElementWithSlate","getLeaf","leafProps","result","renderLeaf","newLeafProps","encodeURIComponent","decodeURIComponent","isEncoded","str","error","serializeHTMLFromNodes","nodes","stripDataAttributes","attributes","ref"],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;MACaA,mBAAmB,GAAG,CACjCC,OADiC,EAEjCC,eAAe,GAAG,IAFe,KAG9B;AACH,QAAMC,IAAI,GAAGC,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAb;AACAF,EAAAA,IAAI,CAACG,SAAL,GAAiBL,OAAjB;;AAEA,MAAIC,eAAJ,EAAqB;AACnBC,IAAAA,IAAI,CAACG,SAAL,GAAiBH,IAAI,CAACG,SAAL,CAAeC,OAAf,CAAuB,mBAAvB,EAA4C,EAA5C,CAAjB;AACD;;AAED,SAAOJ,IAAP;AACD;;ACfD;AACA;AACA;MACaK,sBAAsB,GAAIL,IAAD,IAAmC;AACvE,MAAIA,IAAI,CAACM,QAAL,KAAkB,IAAtB,EAA4B;AAC1B,WAAO,IAAP;AACD;AACF;;ACID;AACA;AACA;;MACaC,wBAAwB,GAAG,CACtCC,MADsC,EAEtC;AACEC,EAAAA,OADF;AAEEC,EAAAA,OAFF;AAGEC,EAAAA;AAHF,CAFsC,KAWb;AACzB,MAAIC,YAAJ;AACA,MAAIC,eAAJ;AAEAJ,EAAAA,OAAO,CAACK,IAAR,CAAa,CAAC;AAAEC,IAAAA,WAAW,EAAEC;AAAf,GAAD,KAA0C;AACrD,UAAMC,oBAAoB,GAAGD,mBAAH,aAAGA,mBAAH,uBAAGA,mBAAmB,CAAGR,MAAH,CAAnB,CAA8BE,OAA3D;AACA,QAAI,CAACO,oBAAL,EAA2B;AAE3B,WAAOA,oBAAoB,CAACH,IAArB,CAA2BI,YAAD,IAAkB;AACjD,YAAMC,YAAY,GAAGD,YAAY,CAACH,WAAb,CAAyBL,OAAzB,CAArB;AACA,UAAI,CAACS,YAAL,EAAmB;AAEnBP,MAAAA,YAAY,GAAGO,YAAf;AACAN,MAAAA,eAAe,GAAGK,YAAY,CAACL,eAA/B;AACA,aAAO,IAAP;AACD,KAPM,CAAP;AAQD,GAZD;;AAcA,MAAID,YAAJ,EAAkB;AAChB,QAAIQ,WAAW,GAAGT,QAAlB;;AACA,QAAI,CAACS,WAAW,CAACC,MAAb,IAAuBR,eAA3B,EAA4C;AAC1CO,MAAAA,WAAW,GAAG,CAAC;AAAEE,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAd;AACD;;AAED,WAAOC,oBAAG,CAAC,SAAD,EAAYX,YAAZ,EAA0BQ,WAA1B,CAAV;AACD;AACF;;AC7CD;AACA;AACA;;MACaI,yBAAyB,GAAG,CAAC;AACxCd,EAAAA,OADwC;AAExCC,EAAAA;AAFwC,CAAD,KAMR;AAC/B,MAAID,OAAO,CAACJ,QAAR,KAAqB,MAAzB,EAAiC;AAC/B,WAAOiB,oBAAG,CAAC,UAAD,EAAa,EAAb,EAAiBZ,QAAjB,CAAV;AACD;AACF;;ACAD;AACA;AACA;AACA;MACac,sBAAsB,GAAG,CACpCjB,MADoC,EAEpC;AAAEC,EAAAA,OAAF;AAAWC,EAAAA,OAAX;AAAoBC,EAAAA;AAApB,CAFoC,KAGjC;AACH,MAAIe,IAAI,GAAG,EAAX;AAEAjB,EAAAA,OAAO,CAACkB,OAAR,CAAgB,CAAC;AAAEZ,IAAAA,WAAW,EAAEC;AAAf,GAAD,KAA0C;AACxD,UAAMY,iBAAiB,GAAGZ,mBAAH,aAAGA,mBAAH,uBAAGA,mBAAmB,CAAGR,MAAH,CAAnB,CAA8BkB,IAAxD;AACA,QAAI,CAACE,iBAAL,EAAwB;AAExBA,IAAAA,iBAAiB,CAACD,OAAlB,CAA2BT,YAAD,IAAkB;AAC1C,YAAMW,QAAQ,GAAGX,YAAY,CAACH,WAAb,CAAyBL,OAAzB,CAAjB;AAEA,UAAI,CAACmB,QAAL,EAAe;AAEfH,MAAAA,IAAI,GAAG,EAAE,GAAGA,IAAL;AAAW,WAAGG;AAAd,OAAP;AACD,KAND;AAOD,GAXD;AAaA,SAAOlB,QAAQ,CAACmB,MAAT,CAAgB,CAACC,GAAD,EAAqBC,KAArB,KAA+B;AACpD,QAAI,CAACA,KAAL,EAAY,OAAOD,GAAP;;AAEZ,QAAIE,mBAAS,CAACD,KAAD,CAAb,EAAsB;AACpB,UAAIE,MAAM,CAACC,IAAP,CAAYT,IAAZ,EAAkBL,MAAtB,EAA8B;AAC5Be,QAAAA,4BAAgB,CAAC;AACfpC,UAAAA,IAAI,EAAEgC,KADS;AAEfK,UAAAA,MAAM,EAAEX,IAFO;AAGfY,UAAAA,KAAK,EAAE;AACLC,YAAAA,MAAM,EAAE,CAAC,CAACC,CAAD,CAAD,KAASC,UAAI,CAACC,MAAL,CAAYF,CAAZ;AADZ;AAHQ,SAAD,CAAhB;AAOD;;AACDT,MAAAA,GAAG,CAACY,IAAJ,CAASX,KAAT;AACD,KAXD,MAWO;AACLD,MAAAA,GAAG,CAACY,IAAJ,CAASpB,oBAAG,CAAC,MAAD,EAASG,IAAT,EAAeM,KAAf,CAAZ;AACD;;AAED,WAAOD,GAAP;AACD,GAnBM,EAmBJ,EAnBI,CAAP;AAoBD;;AC9DD;AACA;AACA;MACaa,qBAAqB,GAAI5C,IAAD,IAAmC;AACtE,MAAIA,IAAI,CAAC6C,QAAL,KAAkBC,IAAI,CAACC,SAA3B,EAAsC;AACpC,WAAO/C,IAAI,CAACgD,SAAL,KAAmB,IAAnB,GAA0B,IAA1B,GAAiChD,IAAI,CAACiD,WAA7C;AACD;AACF;;ACCD;AACA;AACA;;MACaC,mBAAmB,GAAG,CACjC1C,MADiC,EAEjCC,OAFiC,KAG7BT,IAAD,IAA0D;AAAA;;AAC7D;AACA,QAAMmD,QAAQ,GAAGP,qBAAqB,CAAC5C,IAAD,CAAtC;AACA,MAAImD,QAAJ,EAAc,OAAOA,QAAP,CAH+C;;AAM7D,MAAInD,IAAI,CAAC6C,QAAL,KAAkBC,IAAI,CAACM,YAA3B,EAAyC,OAAO,IAAP;AAEzC,QAAMC,WAAW,GAAGrD,IAApB,CAR6D;;AAW7D,QAAMsD,SAAS,GAAGjD,sBAAsB,CAACL,IAAD,CAAxC;AACA,MAAIsD,SAAJ,EAAe,OAAOA,SAAP;AAEf,QAAM;AAAEhD,IAAAA;AAAF,MAAeN,IAArB;AACA,MAAIuD,MAAM,GAAGvD,IAAb,CAf6D;;AAkB7D,MAAIM,QAAQ,KAAK,KAAb,IAAsB,sBAAAN,IAAI,CAACwD,UAAL,CAAgB,CAAhB,yEAAoBlD,QAApB,MAAiC,MAA3D,EAAmE;AACjE,KAACiD,MAAD,IAAWvD,IAAI,CAACwD,UAAhB;AACD;;AAED,QAAM7C,QAAmC,GAAG8C,KAAK,CAACC,IAAN,CAAWH,MAAM,CAACC,UAAlB,EACzCG,GADyC,CACrCT,mBAAmB,CAAC1C,MAAD,EAASC,OAAT,CADkB,EAEzCmD,IAFyC,EAA5C,CAtB6D;;AA2B7D,QAAMC,QAAQ,GAAGrC,yBAAyB,CAAC;AACzCd,IAAAA,OAAO,EAAE2C,WADgC;AAEzC1C,IAAAA;AAFyC,GAAD,CAA1C;AAIA,MAAIkD,QAAJ,EAAc,OAAOA,QAAP,CA/B+C;;AAkC7D,QAAMnD,OAAO,GAAGH,wBAAwB,CAACC,MAAD,EAAS;AAC/CC,IAAAA,OAD+C;AAE/CC,IAAAA,OAAO,EAAE2C,WAFsC;AAG/C1C,IAAAA;AAH+C,GAAT,CAAxC;AAKA,MAAID,OAAJ,EAAa,OAAOA,OAAP,CAvCgD;;AA0C7D,SAAOe,sBAAsB,CAACjB,MAAD,EAAS;AACpCC,IAAAA,OADoC;AAEpCC,IAAAA,OAAO,EAAE2C,WAF2B;AAGpC1C,IAAAA;AAHoC,GAAT,CAA7B;AAKD;;ACzDD;AACA;AACA;;MACamD,sBAAsB,GAAG,CACpCtD,MADoC,EAEpC;AACEC,EAAAA,OADF;AAEEC,EAAAA;AAFF,CAFoC,KASV;AAC1B,SAAOwC,mBAAmB,CAAC1C,MAAD,EAASC,OAAT,CAAnB,CAAqCC,OAArC,CAAP;AACD;;ACbD;AACA;AACA;;MACaqD,iCAAiC,GAAG,CAG/CvD,MAH+C,EAI/C;AACEC,EAAAA,OADF;AAEEC,EAAAA,OAFF;AAGEX,EAAAA,eAAe,GAAG;AAHpB,CAJ+C,KAa7B;AAClB,MAAI,OAAOW,OAAP,KAAmB,QAAvB,EAAiC;AAC/BA,IAAAA,OAAO,GAAGb,mBAAmB,CAACa,OAAD,EAAUX,eAAV,CAA7B;AACD;;AAED,QAAM8D,QAAQ,GAAGC,sBAAsB,CAACtD,MAAD,EAAS;AAC9CC,IAAAA,OAD8C;AAE9CC,IAAAA;AAF8C,GAAT,CAAvC;AAKA,SAAOsD,kDAAsC,CAACxD,MAAD,EAAS;AACpDY,IAAAA,WAAW,EAAEyC;AADuC,GAAT,CAA7C;AAGD;;AClBD;AACA;AACA;MACaI,mBAAmB,GAAG,CAEjC;AAAExD,EAAAA,OAAO,GAAG;AAAZ,IAAkD,EAFjB,KAGjCD,MAD0E,IAEvE;AACH,QAAM;AAAE0D,IAAAA;AAAF,MAAiB1D,MAAvB;;AAEAA,EAAAA,MAAM,CAAC0D,UAAP,GAAqBC,IAAD,IAAwB;AAC1C,UAAMC,IAAI,GAAGD,IAAI,CAACE,OAAL,CAAa,WAAb,CAAb;;AAEA,QAAID,IAAJ,EAAU;AACR,YAAM;AAAEE,QAAAA;AAAF,UAAW,IAAIC,SAAJ,GAAgBC,eAAhB,CAAgCJ,IAAhC,EAAsC,WAAtC,CAAjB;AAEA,YAAMP,QAAQ,GAAGE,iCAAiC,CAACvD,MAAD,EAAS;AACzDC,QAAAA,OADyD;AAEzDC,QAAAA,OAAO,EAAE4D;AAFgD,OAAT,CAAlD;;AAKA,UAAIT,QAAQ,CAACxC,MAAb,EAAqB;AACnB,eAAOoD,0CAA0B,CAACjE,MAAD,EAAS;AAAEqD,UAAAA,QAAF;AAAYpD,UAAAA;AAAZ,SAAT,CAAjC;AACD;AACF;;AAEDyD,IAAAA,UAAU,CAACC,IAAD,CAAV;AACD,GAjBD;;AAmBA,SAAO3D,MAAP;AACD;AAED;AACA;AACA;;MACakE,2BAA2B,GAAGC,qCAA2B,CACpEV,mBADoE;;ACvCtE;AACA,MAAMW,cAAc,GAAI9E,OAAD,IACrBA,OAAO,CAACM,OAAR,CAAgB,mBAAhB,EAAqC,EAArC,CADF;;;AAIA,MAAMyE,wBAAwB,GAAI/E,OAAD,IAC/BA,OAAO,CACJM,OADH,CACW,4CADX,EACyD,EADzD,EAEGA,OAFH,CAEW,0BAFX,EAEuC,EAFvC,CADF;AAKA;AACA;AACA;;;AACA,MAAM0E,eAAe,GAAG,CACtBV,IADsB,EAEtB;AAAEW,EAAAA,kBAAkB,GAAG,CAAC,QAAD;AAAvB,CAFsB,KAGnB;AACH,QAAMC,UAAU,GAAGZ,IAAI,CAACa,KAAL,CAAW,kBAAX,CAAnB;AAEA,MAAIC,YAAY,GAAG,EAAnB;AACAF,EAAAA,UAAU,CAACrD,OAAX,CAAmB,CAACwD,IAAD,EAAOC,KAAP,KAAiB;AAClC,QAAIA,KAAK,GAAG,CAAR,KAAc,CAAlB,EAAqB;AACnB,aAAQF,YAAY,IAAIC,IAAxB;AACD;;AACD,UAAME,cAAc,GAAG,IAAIC,MAAJ,CACrBP,kBAAkB,CAACpB,GAAnB,CAAwB4B,EAAD,IAAS,GAAEA,EAAG,UAArC,EAAgDC,IAAhD,CAAqD,GAArD,CADqB,EAErB,GAFqB,CAAvB;AAIA,UAAMC,eAAe,GAAGN,IAAI,CAACO,KAAL,CAAWL,cAAX,CAAxB;;AACA,QAAII,eAAJ,EAAqB;AACnBP,MAAAA,YAAY,IAAK,UAASO,eAAe,CAACD,IAAhB,CAAqB,GAArB,CAA0B,GAApD;AACD;AACF,GAZD;AAcA,SAAON,YAAP;AACD,CAtBD;;AAwBA,MAAMS,OAAO,GAAG,CACdnF,MADc,EAEd;AACEC,EAAAA,OADF;AAEEmF,EAAAA,YAFF;AAGEC,EAAAA,UAHF;AAIEd,EAAAA;AAJF,CAFc,KAaX;AACH;AACA,MAAI,CAACa,YAAY,CAAClF,OAAb,CAAqBoF,IAA1B,EAAgC;AAC9B,WAAQ,QAAOF,YAAY,CAACjF,QAAS,QAArC;AACD;;AAED,MAAIyD,IAAJ,CANG;;AASH3D,EAAAA,OAAO,CAACK,IAAR,CAAciF,MAAD,IAAY;AAAA;;AACvB,QAAI,uBAACA,MAAM,CAACC,SAAR,8CAAC,kBAAkBtF,OAAnB,KAA8B,CAACqF,MAAM,CAACE,aAA1C,EAAyD,OAAO,KAAP;;AAEzD,QACE,yBAACF,MAAM,CACJhF,WADH,yEAAC,yBAAAgF,MAAM,EACUvF,MADV,CAAN,CAEEE,OAFH,kDAAC,sBAEWI,IAFX,CAGIqE,IAAD,IAAUA,IAAI,CAACW,IAAL,KAAcI,MAAM,CAACN,YAAY,CAAClF,OAAb,CAAqBoF,IAAtB,CAHjC,CAAD,CADF,EAME;AACA1B,MAAAA,IAAI,GAAI,QAAOwB,YAAY,CAACjF,QAAS,QAArC;AACA,aAAO,KAAP;AACD,KAZsB;;;AAevByD,IAAAA,IAAI,GAAG+B,2BAAoB,CACzBC,kCAAsB,CAAC,EACrB,GAAGP,UADkB;AAErBlF,MAAAA,QAAQ,iDACNoF,MAAM,CAACC,SADD,gFACN,mBAAkBtF,OADZ,0DACN,+CAA4BkF,YAA5B,CADM,kGAENG,MAAM,CAACE,aAFD,0DAEN,2BAAAF,MAAM,EAAiBvF,MAAjB,CAAN,CAA+BoF,YAA/B;AAJmB,KAAD,CADG,CAA3B;AASAxB,IAAAA,IAAI,GAAGU,eAAe,CAACV,IAAD,EAAO;AAAEW,MAAAA;AAAF,KAAP,CAAtB;AAEA,WAAO,IAAP;AACD,GA3BD;AA6BA,SAAOX,IAAP;AACD,CApDD;;AAsDA,MAAMiC,OAAO,GAAG,CACd7F,MADc,EAEd;AACEC,EAAAA,OADF;AAEE6F,EAAAA,SAFF;AAGET,EAAAA,UAHF;AAIEd,EAAAA;AAJF,CAFc,KAaX;AACH,QAAM;AAAEpE,IAAAA;AAAF,MAAe2F,SAArB;AAEA,SAAO7F,OAAO,CAACqB,MAAR,CAAe,CAACyE,MAAD,EAASR,MAAT,KAAoB;AAAA;;AACxC,QAAI,wBAACA,MAAM,CAACC,SAAR,+CAAC,mBAAkBtE,IAAnB,KAA2B,CAACqE,MAAM,CAACS,UAAvC,EAAmD,OAAOD,MAAP;AACnD,QACE,gDAACR,MAAM,CAACC,SAAR,gFAAC,mBAAkBtE,IAAnB,0DAAC,+CAAyB4E,SAAzB,CAAD,+FACEP,MAAM,CAACS,UADT,uDACE,wBAAAT,MAAM,EAAcvF,MAAd,CAAN,CAA4B8F,SAA5B,CADF,MAC8C3F,QAFhD,EAIE,OAAO4F,MAAP;AAEF,UAAME,YAAY,GAAG,EACnB,GAAGH,SADgB;AAEnB3F,MAAAA,QAAQ,EAAE+F,kBAAkB,CAACH,MAAD;AAFT,KAArB;AAKA,QAAInC,IAAI,GAAGuC,kBAAkB,CAC3BR,2BAAoB,CAClBC,kCAAsB,CAAC,EACrB,GAAGP,UADkB;AAErBlF,MAAAA,QAAQ,kDACNoF,MAAM,CAACC,SADD,gFACN,mBAAkBtE,IADZ,0DACN,+CAAyB+E,YAAzB,CADM,kGAENV,MAAM,CAACS,UAFD,wDAEN,yBAAAT,MAAM,EAAcvF,MAAd,CAAN,CAA4BiG,YAA5B;AAJmB,KAAD,CADJ,CADO,CAA7B;AAWArC,IAAAA,IAAI,GAAGU,eAAe,CAACV,IAAD,EAAO;AAAEW,MAAAA;AAAF,KAAP,CAAtB;AAEA,WAAOX,IAAP;AACD,GA3BM,EA2BJzD,QA3BI,CAAP;AA4BD,CA5CD;;AA8CA,MAAMiG,SAAS,GAAG,CAACC,GAAG,GAAG,EAAP,KAAc;AAC9B,MAAI;AACF,WAAOA,GAAG,KAAKF,kBAAkB,CAACE,GAAD,CAAjC;AACD,GAFD,CAEE,OAAOC,KAAP,EAAc;AACd,WAAO,KAAP;AACD;AACF,CAND;AAQA;AACA;AACA;;;MACaC,sBAAsB,GAAG,CACpCvG,MADoC,EAEpC;AACEC,EAAAA,OADF;AAEEuG,EAAAA,KAFF;AAGEnB,EAAAA,UAHF;AAIEoB,EAAAA,mBAAmB,GAAG,IAJxB;AAKElC,EAAAA,kBALF;AAMEhF,EAAAA,eAAe,GAAG;AANpB,CAFoC,KAyCzB;AACX,MAAIwG,MAAM,GAAGS,KAAK,CACfrD,GADU,CACL3D,IAAD,IAAU;AACb,QAAIyC,UAAI,CAACC,MAAL,CAAY1C,IAAZ,CAAJ,EAAuB;AACrB,aAAOqG,OAAO,CAAC7F,MAAD,EAAS;AACrBC,QAAAA,OADqB;AAErB6F,QAAAA,SAAS,EAAE;AACT5E,UAAAA,IAAI,EAAE1B,IADG;AAETsB,UAAAA,IAAI,EAAEtB,IAFG;AAGTW,UAAAA,QAAQ,EAAEiG,SAAS,CAAC5G,IAAI,CAACsB,IAAN,CAAT,GACNtB,IAAI,CAACsB,IADC,GAENoF,kBAAkB,CAAC1G,IAAI,CAACsB,IAAN,CALb;AAMT4F,UAAAA,UAAU,EAAE;AAAE,+BAAmB;AAArB;AANH,SAFU;AAUrBrB,QAAAA,UAVqB;AAWrBd,QAAAA;AAXqB,OAAT,CAAd;AAaD;;AAED,WAAOY,OAAO,CAACnF,MAAD,EAAS;AACrBC,MAAAA,OADqB;AAErBmF,MAAAA,YAAY,EAAE;AACZlF,QAAAA,OAAO,EAAEV,IADG;AAEZW,QAAAA,QAAQ,EAAE+F,kBAAkB,CAC1BK,sBAAsB,CAACvG,MAAD,EAAS;AAC7BC,UAAAA,OAD6B;AAE7BuG,UAAAA,KAAK,EAAEhH,IAAI,CAACW,QAFiB;AAG7BoE,UAAAA,kBAH6B;AAI7BhF,UAAAA;AAJ6B,SAAT,CADI,CAFhB;AAUZmH,QAAAA,UAAU,EAAE;AAAE,6BAAmB,SAArB;AAAgCC,UAAAA,GAAG,EAAE;AAArC;AAVA,OAFO;AAcrBtB,MAAAA,UAdqB;AAerBd,MAAAA;AAfqB,KAAT,CAAd;AAiBD,GAnCU,EAoCVS,IApCU,CAoCL,EApCK,CAAb;;AAsCA,MAAIoB,SAAS,CAACL,MAAD,CAAb,EAAuB;AACrBA,IAAAA,MAAM,GAAGI,kBAAkB,CAACJ,MAAD,CAA3B;AACD;;AAED,MAAIxG,eAAJ,EAAqB;AACnBwG,IAAAA,MAAM,GAAG3B,cAAc,CAAC2B,MAAD,CAAvB;AACD;;AAED,MAAIU,mBAAJ,EAAyB;AACvBV,IAAAA,MAAM,GAAG1B,wBAAwB,CAAC0B,MAAD,CAAjC;AACD;;AAED,SAAOA,MAAP;AACD;;;;;;;;;;;;;;;"}