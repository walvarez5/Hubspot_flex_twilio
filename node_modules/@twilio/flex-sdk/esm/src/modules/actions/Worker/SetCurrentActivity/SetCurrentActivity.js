typeof window<"u"&&(window.global=window);import{__classPrivateFieldSet as f,__classPrivateFieldGet as r}from"../../../../../node_modules/tslib/tslib.es6.js";import{FlexSdkError as w}from"../../../error/FlexSdkError/FlexSdkError.js";import{ErrorCode as g}from"../../../error/ErrorCode/ErrorCodes.js";import"../../../error/ErrorCode/InternalErrorCodes.js";import"../../../error/ErrorCode/ErrorCodeHelper.js";import{ErrorSeverity as h}from"../../../error/ErrorSeverity/ErrorSeverity.js";import"../../../logger/Logger/LogEntry.js";import{LoggerName as S}from"../../../logger/Logger/LoggerName.js";import{getLogger as k}from"../../../logger/LoggerFactory/getLogger.js";import"../../../logger/LoggerFactory/LoggerConfigImpl.js";import{TaskRouterImpl as _}from"../../../../packages/taskrouter/TaskRouterImpl.js";import{sendTrackingEvent as y}from"../../ActionUtils.js";import{EVENTS as p}from"../../../analytics/Analytics.js";import{AnalyticsImpl as E}from"../../../analytics/AnalyticsImpl.js";var i,c;class P{constructor(a,o){i.set(this,void 0),c.set(this,void 0),f(this,i,a,"f"),f(this,c,o,"f")}async run(a){var o;const v=a,A=(o=r(this,c,"f"))===null||o===void 0?void 0:o.activityUpdateOptions,C=v.getInstanceOf(_),n=k(v)(S.Actions),e=C.worker,d=v.getInstanceOf(E);if(n.debug("setCurrentActivity called with activitySid: ",r(this,i,"f")),!e){const t="setCurrentActivity: worker is not initialized";return n.error(t),Promise.reject(new w(g.SDK,{severity:h.Error},t))}const m=e.activities.get(r(this,i,"f")),l=e.activity;if(r(this,i,"f")===l?.sid){const t=`setCurrentActivity: Activity with sid ${r(this,i,"f")} is already set`;return n.warn(t),y(p.SetCurrentActivityCompleted,d,e,t),Promise.resolve()}try{return await m?.setAsCurrent(A),y(p.SetCurrentActivityCompleted,d,e),Promise.resolve()}catch(t){const u=t?.message;let s;return u&&u.match(/Worker WK.* cannot have its activity updated while it has .* pending reservations/)?s=`setCurrentActivity: Failed to set current activity to activity ${r(this,i,"f")} due to pending reservations`:s=`setCurrentActivity: Failed to set current activity to activity ${r(this,i,"f")}`,y(p.SetCurrentActivityCompleted,d,e,s),n.error(s),Promise.reject(new w(g.SDK,{severity:h.Error},s))}}}i=new WeakMap,c=new WeakMap;export{P as SetCurrentActivity};
//# sourceMappingURL=SetCurrentActivity.js.map
