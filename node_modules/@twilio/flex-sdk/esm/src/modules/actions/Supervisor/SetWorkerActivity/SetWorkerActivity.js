typeof window<"u"&&(window.global=window);import{__classPrivateFieldSet as y,__classPrivateFieldGet as i}from"../../../../../node_modules/tslib/tslib.es6.js";import{FlexSdkError as h}from"../../../error/FlexSdkError/FlexSdkError.js";import{ErrorCode as w}from"../../../error/ErrorCode/ErrorCodes.js";import"../../../error/ErrorCode/InternalErrorCodes.js";import"../../../error/ErrorCode/ErrorCodeHelper.js";import{ErrorSeverity as g}from"../../../error/ErrorSeverity/ErrorSeverity.js";import{sendTrackingEvent as l}from"../../ActionUtils.js";import{EVENTS as f}from"../../../analytics/Analytics.js";import{TaskRouterImpl as u}from"../../../../packages/taskrouter/TaskRouterImpl.js";import"../../../logger/Logger/LogEntry.js";import{LoggerName as A}from"../../../logger/Logger/LoggerName.js";import{getLogger as _}from"../../../logger/LoggerFactory/getLogger.js";import"../../../logger/LoggerFactory/LoggerConfigImpl.js";import{AnalyticsImpl as E}from"../../../analytics/AnalyticsImpl.js";var n,r,v;class M{constructor(d,o,s){n.set(this,void 0),r.set(this,void 0),v.set(this,void 0),y(this,n,d,"f"),y(this,r,o,"f"),y(this,v,s,"f")}async run(d){var o,s;const m=d,W=m.getInstanceOf(u),c=_(m)(A.Client),p=m.getInstanceOf(E),e=W.worker,S=(o=i(this,v,"f"))===null||o===void 0?void 0:o.activityUpdateOptions;if(c.debug(`setWorkerActivity invoked with activitySid: ${i(this,r,"f")} and targetWorkerSid: ${i(this,n,"f")}`),!e){const t="setWorkerActivity: worker is not initialized";throw c.error(t),new h(w.SDK,{severity:g.Error},t)}if(i(this,r,"f")===((s=e.activity)===null||s===void 0?void 0:s.sid)){const t=`setWorkerActivity: Activity with sid ${i(this,r,"f")} is already set`;return l(f.SetWorkerActivityCompleted,p,e,t),c.warn(t),Promise.resolve()}try{return await e.setWorkerActivity(i(this,n,"f"),i(this,r,"f"),S),l(f.SetWorkerActivityCompleted,p,e),Promise.resolve()}catch(t){const k=t?.message;let a;throw k&&k.match(/Worker WK.* cannot have its activity updated while it has .* pending reservations/)?a=`setWorkerActivity: Failed to set current activity to activity ${i(this,r,"f")} due to pending reservations`:a=`setWorkerActivity: Failed to set current activity to activity ${i(this,r,"f")}`,c.error(a),l(f.SetWorkerActivityCompleted,p,e,a),new h(w.SDK,{severity:g.Error},a)}}}n=new WeakMap,r=new WeakMap,v=new WeakMap;export{M as SetWorkerActivity};
//# sourceMappingURL=SetWorkerActivity.js.map
