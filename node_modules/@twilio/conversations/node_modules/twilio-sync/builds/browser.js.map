{"version":3,"file":"browser.js","sources":["../../../node_modules/tslib/tslib.es6.js","../src/utils/uri.ts","../src/utils/syncerror.ts","../src/utils/sanitize.ts","../src/utils/logger.ts","../src/configuration.ts","../src/subscriptions.ts","../src/services/network.ts","../src/services/storage.ts","../src/entity.ts","../src/mergingqueue.ts","../src/closeable.ts","../src/syncdocument.ts","../src/synclistitem.ts","../src/paginator.ts","../src/utils/tree.ts","../src/cache.ts","../src/synclist.ts","../src/syncmapitem.ts","../src/syncmap.ts","../src/streams/syncstream.ts","../src/clientInfo.ts","../src/entitiesCache.ts","../src/livequery.ts","../src/client.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","\n/**\n * Construct URI with query parameters\n */\nclass UriBuilder {\n  base: string;\n  args: string[];\n  paths: string[];\n\n  constructor(base: string) {\n    this.base = base;\n    this.args = new Array<string>();\n    this.paths = new Array<string>();\n  }\n\n  pathSegment(name: string): UriBuilder {\n    this.paths.push(encodeURIComponent(name));\n    return this;\n  }\n\n  queryParam(name: string, value: any): UriBuilder {\n    if (typeof value !== 'undefined') {\n      this.args.push(encodeURIComponent(name) + '=' + encodeURIComponent(value));\n    }\n    return this;\n  }\n\n  build(): string {\n    let result = this.base;\n    if (this.paths.length) {\n      result += '/' + this.paths.join('/');\n    }\n\n    if (this.args.length) {\n      result += '?' + this.args.join('&');\n    }\n\n    return result;\n  }\n}\n\nexport { UriBuilder };\n","/**\n * Generic SyncLibrary error class\n */\nclass SyncError extends Error {\n  name: string;\n  message: string;\n  status: number;\n  code: number;\n\n  constructor(message: string, status: number = 0, code: number = 0) {\n    super();\n\n    this.name = this.constructor.name;\n    this.message = `${message} (status: ${status}, code: ${code})`;\n    this.status = status;\n    this.code = code;\n  }\n}\n\nclass SyncNetworkError extends SyncError {\n  body: any;\n\n  constructor(message: string, status: number = 0, code: number = 0, body: any) {\n    super(message, status, code);\n    this.body = body;\n  }\n}\n\nexport { SyncError, SyncNetworkError };\nexport default SyncError;\n","import SyncError from './syncerror';\n\n/**\n * Deep-clone an object. Note that this does not work on object containing\n * functions.\n * @param {object} obj - the object to deep-clone\n * @return {object}\n */\nfunction deepClone<T>(obj: T): T {\n  return JSON.parse(JSON.stringify(obj)) as T;\n}\n\nfunction validatePageSize(pageSize: number) {\n  const validPageSize = pageSize === undefined || isPositiveInteger(pageSize);\n  if (!validPageSize) {\n    throw new SyncError(`Invalid pageSize parameter. Expected a positive integer, was '${pageSize}'.`, 400, 20007);\n  }\n}\n\nfunction validateMode(mode: string) {\n  if (!['open_or_create', 'open_existing', 'create_new'].includes(mode)) {\n    throw new Error(\"Invalid open mode. Expected one of { 'create_new', 'open_or_create', 'open_existing' }\");\n  }\n}\n\nfunction isInteger(number: any) {\n  return !isNaN(parseInt(number)) && isFinite(number);\n}\n\nfunction isPositiveInteger(number: any) {\n  return isInteger(number) && number > 0;\n}\n\nfunction isNonNegativeInteger(number: any) {\n  return isInteger(number) && number >= 0;\n}\n\nexport { deepClone, validatePageSize, validateMode, isPositiveInteger };\n","import * as loglevelLog from 'loglevel';\n\nconst log: loglevelLog.Logger = loglevelLog.getLogger('twilio-sync'); // twilio-sync is used by Flex SDK. Please DO NOT change\n\nfunction prepareLine(prefix, args) {\n  return [`${new Date().toISOString()} Sync ${prefix}:`].concat(Array.from(args));\n}\n\nexport default {\n  setLevel: function (level: any) {\n    log.setLevel(level);\n  },\n\n  trace: function (...args) {\n    log.trace.apply(null, prepareLine('T', args));\n  },\n  debug: function (...args) {\n    log.debug.apply(null, prepareLine('D', args));\n  },\n  info: function (...args) {\n    log.info.apply(null, prepareLine('I', args));\n  },\n  warn: function (...args) {\n    log.warn.apply(null, prepareLine('W', args));\n  },\n  error: function (...args) {\n    log.error.apply(null, prepareLine('E', args));\n  }\n};\n","const SUBSCRIPTIONS_PATH = '/v4/Subscriptions';\nconst MAPS_PATH = '/v3/Maps';\nconst LISTS_PATH = '/v3/Lists';\nconst DOCUMENTS_PATH = '/v3/Documents';\nconst STREAMS_PATH = '/v3/Streams';\nconst INSIGHTS_PATH = '/v3/Insights';\n\nfunction getWithDefault<T>(container: any, key: string, defaultValue: T): T {\n  if (container && typeof container[key] !== 'undefined') {\n    return container[key];\n  }\n  return defaultValue;\n}\n\n/**\n * Settings container for Sync library\n */\nclass Configuration {\n  private settings: any;\n\n  /**\n   * @param {Object} options\n   */\n  constructor(options: any = {}) {\n    const region = options.region || 'us1';\n    const defaultCdsUrl = `https://cds.${region}.twilio.com`;\n    const baseUri = options.cdsUri || defaultCdsUrl;\n    this.settings = {\n      subscriptionsUri: baseUri + SUBSCRIPTIONS_PATH,\n      documentsUri: baseUri + DOCUMENTS_PATH,\n      listsUri: baseUri + LISTS_PATH,\n      mapsUri: baseUri + MAPS_PATH,\n      streamsUri: baseUri + STREAMS_PATH,\n      insightsUri: baseUri + INSIGHTS_PATH,\n      sessionStorageEnabled: getWithDefault(options.Sync, 'enableSessionStorage', true),\n      productId: options.productId,\n    };\n  }\n\n  get subscriptionsUri(): string {\n    return this.settings.subscriptionsUri;\n  }\n\n  get documentsUri(): string {\n    return this.settings.documentsUri;\n  }\n\n  get listsUri(): string {\n    return this.settings.listsUri;\n  }\n\n  get mapsUri(): string {\n    return this.settings.mapsUri;\n  }\n\n  get streamsUri(): string {\n    return this.settings.streamsUri;\n  }\n\n  get insightsUri(): string {\n    return this.settings.insightsUri;\n  }\n\n  get backoffConfig(): any {\n    return this.settings.backoffConfig || {};\n  }\n\n  get sessionStorageEnabled(): boolean {\n    return this.settings.sessionStorageEnabled;\n  }\n\n  get productId(): string {\n    return this.settings.productId;\n  }\n}\n\nexport { Configuration };\n","import { Backoff } from '@twilio/operation-retrier';\nimport { SyncError } from './utils/syncerror';\nimport log from './utils/logger';\n\nimport { SyncEntity } from './entity';\nimport { Configuration, Network } from './interfaces/services';\n\nimport { TransportUnavailableError } from 'twilsock';\n\n/**\n * A data container used by the Subscriptions class to track subscribed entities' local\n * representations and their state.\n */\nclass SubscribedEntity {\n  private readonly localObject: SyncEntity;\n  pendingCorrelationId: number;\n  pendingAction: string;\n  rejectedWithError: any;\n  retryCount: number;\n\n  private established: boolean;\n\n  constructor(entity: SyncEntity) {\n    this.localObject = entity;\n    this.pendingCorrelationId = null;\n    this.pendingAction = null;\n    this.established = false;\n    this.retryCount = 0;\n  }\n\n  get sid(): string {\n    return this.localObject.sid;\n  }\n\n  get type(): string {\n    return this.localObject.type;\n  }\n\n  get lastEventId(): number {\n    return this.localObject.lastEventId;\n  }\n\n  // below properties are specific to Insights only\n  get indexName(): string {\n    return this.localObject.indexName;\n  }\n\n  get queryString(): string {\n    return this.localObject.queryString;\n  }\n\n  get isEstablished(): boolean {\n    return this.established;\n  }\n\n  update(event, isStrictlyOrdered) {\n    this.localObject._update(event, isStrictlyOrdered);\n  }\n\n  updatePending(action: Action, correlationId: number) {\n    this.pendingAction = action;\n    this.pendingCorrelationId = correlationId;\n  }\n\n  reset() {\n    this.updatePending(null, null);\n    this.retryCount = 0;\n    this.established = false;\n    this.setSubscriptionState('none');\n  }\n\n  markAsFailed(message) {\n    this.rejectedWithError = message.error;\n    this.updatePending(null, null);\n    this.localObject.reportFailure(\n      new SyncError(`Failed to subscribe on service events: ${message.error.message}`, message.error.status, message.error.code));\n  }\n\n  complete(eventId: number): void {\n    this.updatePending(null, null);\n    this.established = true;\n    this.localObject._advanceLastEventId(eventId);\n  }\n\n  setSubscriptionState(newState) {\n    this.localObject._setSubscriptionState(newState);\n  }\n}\n\ninterface SubscriptionsServices {\n  config: Configuration;\n  network: Network;\n}\n\ntype Action = 'establish' | 'cancel' | null;\n\ninterface PokeBatch {\n  action: Action;\n  subscriptions: SubscribedEntity[];\n}\n\ntype PokeReason = 'ttl' | 'reconnect';\n\n/**\n * @class Subscriptions\n * @classdesc A manager which, in batches of varying size, continuously persists the\n *      subscription intent of the caller to the Sync backend until it achieves a\n *      converged state.\n */\nclass Subscriptions {\n  private services: SubscriptionsServices;\n\n  // This is always the full set of subscribables (SubscribedEntity instances) intended by\n  // the client. At any point, whatever the state of these subscriptions on the server, this\n  // is the intent of the user to which the SDK must converge.\n  private subscriptions: Map<string, SubscribedEntity>;\n\n  // This includes the set of subscribables (SubscribedEntity instances) for whom a request\n  // has been dispatched (whether or not this particular request ultimately succeeds) to\n  // establish a live subscription. Entities are removed when the corresponding \"cancel\"\n  // request is dispatched.\n  private persisted: Map<string, SubscribedEntity>;\n\n  private latestPokeResponseArrivalTimestampByCorrelationId: Map<number, number>;\n\n  private backoff: Backoff;\n\n  private isConnected: boolean = false;\n\n  private maxBatchSize: number = 100;\n\n  // If the server includes a `ttl_in_s` attribute in the poke response, subscriptionTtlTimer is started for that duration\n  // such that when it fires, it repokes the entire sync set (i.e., emulates a reconnect). Every reconnect resets the timer.\n  // After the timer has fired, the first poke request includes a `reason: ttl` attribute in the body.\n  private subscriptionTtlTimer: any | null = null;\n  private pendingPokeReason: PokeReason = null;\n\n  /**\n   * @constructor\n   * Prepares a new Subscriptions manager object with zero subscribed or persisted subscriptions.\n   *\n   * @param {object} config may include a key 'backoffConfig', wherein any of the parameters\n   *      of Backoff.exponential (from npm 'backoff') are valid and will override the defaults.\n   *\n   * @param {Network} must be a viable running Sync Network object, useful for routing requests.\n   */\n  constructor(services: SubscriptionsServices) {\n    this.services = services;\n    this.subscriptions = new Map<string, SubscribedEntity>();\n    this.persisted = new Map<string, SubscribedEntity>();\n    this.latestPokeResponseArrivalTimestampByCorrelationId = new Map<number, number>();\n\n    const defaultBackoffConfig = {\n      randomisationFactor: 0.2,\n      initialDelay: 100,\n      maxDelay: 2 * 60 * 1000\n    };\n    this.backoff = Backoff.exponential(Object.assign(defaultBackoffConfig, this.services.config.backoffConfig));\n\n    // This block is triggered by #_persist. Every request is executed in a series of (ideally 1)\n    // backoff 'ready' event, at which point a new subscription set is calculated.\n    this.backoff.on('ready', () => {\n      let {action: action, subscriptions: subscriptionRequests} = this.getSubscriptionUpdateBatch();\n      if (action) {\n        this.applyNewSubscriptionUpdateBatch(action, subscriptionRequests);\n      } else {\n        this.backoff.reset();\n        log.debug('All subscriptions resolved.');\n      }\n    });\n  }\n\n  private getSubscriptionUpdateBatch(): PokeBatch {\n    function subtract(these: Map<string, SubscribedEntity>, those: Map<string, SubscribedEntity>, action: Action, limit) {\n      let result = [];\n      for (let [thisKey, thisValue] of these) {\n        const otherValue = those.get(thisKey);\n        if (!otherValue && action !== thisValue.pendingAction && !thisValue.rejectedWithError) {\n          result.push(thisValue);\n          if (limit && result.length >= limit) {\n            break;\n          }\n        }\n      }\n      return result;\n    }\n\n    let listToAdd = subtract(this.subscriptions, this.persisted, 'establish', this.maxBatchSize);\n    if (listToAdd.length > 0) {\n      return {action: 'establish', subscriptions: listToAdd};\n    }\n\n    let listToRemove = subtract(this.persisted, this.subscriptions, 'cancel', this.maxBatchSize);\n    if (listToRemove.length > 0) {\n      return {action: 'cancel', subscriptions: listToRemove};\n    }\n\n    return {action: null, subscriptions: null};\n  }\n\n  private persist() {\n    this.backoff.backoff();\n  }\n\n  private async applyNewSubscriptionUpdateBatch(action, requests: SubscribedEntity[]) {\n    if (!this.isConnected) {\n      log.debug(`Twilsock connection (required for subscription) not ready; waiting…`);\n      this.backoff.reset();\n      return;\n    }\n\n    // Keeping in mind that events may begin flowing _before_ we receive the response\n    requests = this.processLocalActions(action, requests);\n\n    const correlationId = new Date().getTime();\n    for (const subscribed of requests) {\n      this.recordActionAttemptOn(subscribed, action, correlationId);\n    }\n\n    let reason: PokeReason = this.pendingPokeReason;\n    this.pendingPokeReason = null;\n\n    // Send this batch to the service\n    try {\n      let response = await this.request(action, correlationId, reason, requests);\n\n      let newMaxBatchSize = response.body.max_batch_size;\n      if (!isNaN(parseInt(newMaxBatchSize)) && isFinite(newMaxBatchSize) && newMaxBatchSize > 0) {\n        this.maxBatchSize = newMaxBatchSize;\n      }\n\n      if (!this.subscriptionTtlTimer) {\n        let subscriptionTtlInS = response.body.ttl_in_s;\n        let isNumeric = !isNaN(parseFloat(subscriptionTtlInS)) && isFinite(subscriptionTtlInS);\n        let isValidTtl = isNumeric && subscriptionTtlInS > 0;\n        if (isValidTtl) {\n          this.subscriptionTtlTimer = setTimeout(() => this.onSubscriptionTtlElapsed(), subscriptionTtlInS * 1000);\n        }\n      }\n\n      if (action === 'establish') {\n        const estimatedDeliveryInMs = response.body.estimated_delivery_in_ms;\n        let isNumeric = !isNaN(parseFloat(estimatedDeliveryInMs)) && isFinite(estimatedDeliveryInMs);\n        let isValidTimeout = isNumeric && estimatedDeliveryInMs > 0;\n        if (isValidTimeout) {\n          setTimeout(() => this.verifyPokeDelivery(correlationId, estimatedDeliveryInMs, requests), estimatedDeliveryInMs);\n        } else {\n          log.error(`Invalid timeout: ${estimatedDeliveryInMs}`);\n        }\n        requests.filter(r => r.pendingCorrelationId === correlationId)\n          .forEach(r => r.setSubscriptionState('response_in_flight'));\n      }\n      this.backoff.reset();\n    } catch (e) {\n      for (const attemptedSubscription of requests) {\n        this.recordActionFailureOn(attemptedSubscription, action);\n      }\n\n      if (e instanceof TransportUnavailableError) {\n        log.debug(`Twilsock connection (required for subscription) not ready (c:${correlationId}); waiting…`);\n        this.backoff.reset();\n      } else {\n        log.debug(`Failed an attempt to ${action} subscriptions (c:${correlationId}); retrying`, e);\n        this.persist();\n      }\n    }\n  }\n\n  private verifyPokeDelivery(correlationId: number, estimatedDeliveryInMs: number, requests: SubscribedEntity[]) {\n    const lastReceived = this.latestPokeResponseArrivalTimestampByCorrelationId.get(correlationId);\n    const silencePeriod = lastReceived ? (new Date().getTime() - lastReceived)\n      : estimatedDeliveryInMs;\n    if (silencePeriod >= estimatedDeliveryInMs) {\n      // If we haven't received _any_ responses from that poke request for the duration of estimated_delivery_in_ms, poke again\n      requests\n        .filter(r => r.pendingCorrelationId === correlationId)\n        .forEach(r => {\n          r.updatePending(null, null);\n          r.retryCount++;\n          this.persisted.delete(r.sid);\n        });\n      this.persist();\n      this.latestPokeResponseArrivalTimestampByCorrelationId.delete(correlationId);\n    } else {\n      // Otherwise, the poke responses are probably in transit and we should wait for them\n      const timeoutExtension = estimatedDeliveryInMs - silencePeriod;\n      setTimeout(() => this.verifyPokeDelivery(correlationId, estimatedDeliveryInMs, requests), timeoutExtension);\n    }\n  }\n\n  private processLocalActions(action, requests) {\n    if (action === 'cancel') {\n      return requests.filter(request => !request.rejectedWithError);\n    }\n    return requests;\n  }\n\n  private recordActionAttemptOn(attemptedSubscription: SubscribedEntity, action, correlationId) {\n    attemptedSubscription.setSubscriptionState('request_in_flight');\n    if (action === 'establish') {\n      this.persisted.set(attemptedSubscription.sid, attemptedSubscription);\n      attemptedSubscription.updatePending(action, correlationId);\n    } else { // cancel\n      let persistedSubscription = this.persisted.get(attemptedSubscription.sid);\n      if (persistedSubscription) {\n        persistedSubscription.updatePending(action, correlationId);\n      }\n    }\n  }\n\n  private recordActionFailureOn(attemptedSubscription: SubscribedEntity, action) {\n    attemptedSubscription.setSubscriptionState('none');\n    attemptedSubscription.updatePending(null, null);\n    if (action === 'establish') {\n      this.persisted.delete(attemptedSubscription.sid);\n    }\n  }\n\n  private request(action, correlationId, reason: PokeReason, objects: SubscribedEntity[]) {\n    let requests = objects.map(object => ({\n        object_sid: object.sid,\n        object_type: object.type,\n        last_event_id: action === 'establish' ? object.lastEventId : undefined,\n        index_name: action === 'establish' ? object.indexName : undefined,\n        query_string: action === 'establish' ? object.queryString : undefined,\n      })\n    );\n    let retriedRequests = objects.filter(a => a.retryCount > 0).length;\n\n    log.debug(`Attempting '${action}' request (c:${correlationId}):`, requests);\n    const requestBody: any = {\n      event_protocol_version: 4,\n      action,\n      correlation_id: correlationId,\n      retried_requests: retriedRequests,\n      ttl_in_s: -1,\n      requests\n    };\n    if (reason === 'ttl') {\n      requestBody.reason = reason;\n    }\n\n    return this.services.network.post(this.services.config.subscriptionsUri, requestBody);\n  }\n\n  /**\n   * Establishes intent to be subscribed to this entity. That subscription will be effected\n   * asynchronously.\n   * If subscription to the given sid already exists, it will be overwritten.\n   *\n   * @param {String} sid should be a well-formed SID, uniquely identifying a single instance of a Sync entity.\n   * @param {Object} entity should represent the (singular) local representation of this entity.\n   *      Incoming events and modifications to the entity will be directed at the _update() function\n   *      of this provided reference.\n   *\n   * @return undefined\n   */\n  add(sid: string, entity: SyncEntity): void {\n    log.debug(`Establishing intent to subscribe to ${sid}`);\n    const existingSubscription = this.subscriptions.get(sid);\n    if (existingSubscription && entity && existingSubscription.lastEventId === entity.lastEventId) {\n      // If last event id is the same as before - we're fine\n      return;\n    }\n\n    this.persisted.delete(sid);\n    this.subscriptions.set(sid, new SubscribedEntity(entity));\n    this.persist();\n  }\n\n  /**\n   * Establishes the caller's intent to no longer be subscribed to this entity. Following this\n   * call, no further events shall be routed to the local representation of the entity, even\n   * though a server-side subscription may take more time to actually terminate.\n   *\n   * @param {string} sid should be any well-formed SID, uniquely identifying a Sync entity.\n   *      This call only has meaningful effect if that entity is subscribed at the\n   *      time of call. Otherwise does nothing.\n   *\n   * @return undefined\n   */\n  remove(sid: string): void {\n    log.debug(`Establishing intent to unsubscribe from ${sid}`);\n    const removed = this.subscriptions.delete(sid);\n    if (removed) {\n      this.persist();\n    }\n  }\n\n  /**\n   * The point of ingestion for remote incoming messages (e.g. new data was written to a map\n   * to which we are subscribed).\n   *\n   * @param {object} message is the full, unaltered body of the incoming notification.\n   *\n   * @return undefined\n   */\n  acceptMessage(message: any, isStrictlyOrdered: boolean): void {\n    log.trace('Subscriptions received', message);\n\n    const eventType = message.event_type;\n    const events = typeof message.events !== 'undefined'\n      ? message.events\n      : [message.event];\n    const correlationId = message.correlation_id;\n\n    if (correlationId) {\n      this.latestPokeResponseArrivalTimestampByCorrelationId.set(correlationId, new Date().getTime());\n    }\n\n    for (const event of events) {\n      let matchedEventType;\n      switch (message.event_type) {\n        case 'subscription_established':\n          this.applySubscriptionEstablishedMessage(event, correlationId);\n          break;\n        case 'subscription_canceled':\n          this.applySubscriptionCancelledMessage(event, correlationId);\n          break;\n        case 'subscription_failed':\n          this.applySubscriptionFailedMessage(event, correlationId);\n          break;\n        case (matchedEventType = eventType.match(/^(?:map|list|document|stream|live_query)_/) || {}).input: {\n          let typedSid;\n          switch (matchedEventType[0]) {\n            case 'map_':\n              typedSid = event.map_sid;\n              break;\n            case 'list_':\n              typedSid = event.list_sid;\n              break;\n            case 'document_':\n              typedSid = event.document_sid;\n              break;\n            case 'stream_':\n              typedSid = event.stream_sid;\n              break;\n            case 'live_query_':\n              typedSid = event.query_id;\n              // hack to mark replay events for LiveQuery as strictly ordered, due to lack of special type of notification for them\n              // (normally only replay events would have `twilio.sync.event` type, but LiveQuery non-replay events were also assigned\n              // to this type in legacy clients, which we have to support now; hence a hack)\n              isStrictlyOrdered = false; // explicitly override it due to code in router.ts does not know about LiveQueries\n              if (message.strictly_ordered === true) {\n                isStrictlyOrdered = true;\n              }\n              break;\n            default:\n              typedSid = undefined;\n          }\n\n          this.applyEventToSubscribedEntity(typedSid, event, eventType, isStrictlyOrdered);\n          break;\n        }\n        default:\n          log.debug(`Dropping unknown message type ${eventType}`);\n          break;\n      }\n    }\n  }\n\n  private applySubscriptionEstablishedMessage(message, correlationId) {\n    const sid = message.object_sid;\n    let subscriptionIntent = this.persisted.get(message.object_sid);\n    if (subscriptionIntent && subscriptionIntent.pendingCorrelationId === correlationId) {\n      if (message.replay_status === 'interrupted') {\n        log.debug(`Event Replay for subscription to ${sid} (c:${correlationId}) interrupted; continuing eagerly.`);\n        subscriptionIntent.updatePending(null, null);\n        this.persisted.delete(subscriptionIntent.sid);\n        this.backoff.reset();\n      } else if (message.replay_status === 'completed') {\n        log.debug(`Event Replay for subscription to ${sid} (c:${correlationId}) completed. Subscription is ready.`);\n        subscriptionIntent.complete(message.last_event_id);\n        this.persisted.set(message.object_sid, subscriptionIntent);\n        subscriptionIntent.setSubscriptionState('established');\n        this.backoff.reset();\n      }\n    } else {\n      log.debug(`Late message for ${message.object_sid} (c:${correlationId}) dropped.`);\n    }\n    this.persist();\n  }\n\n  private applySubscriptionCancelledMessage(message, correlationId) {\n    let persistedSubscription = this.persisted.get(message.object_sid);\n    if (persistedSubscription && persistedSubscription.pendingCorrelationId === correlationId) {\n      persistedSubscription.updatePending(null, null);\n      persistedSubscription.setSubscriptionState('none');\n      this.persisted.delete(message.object_sid);\n    } else {\n      log.debug(`Late message for ${message.object_sid} (c:${correlationId}) dropped.`);\n    }\n    this.persist();\n  }\n\n  private applySubscriptionFailedMessage(message, correlationId) {\n    const sid = message.object_sid;\n    let subscriptionIntent = this.subscriptions.get(sid);\n    let subscription = this.persisted.get(sid);\n    if (subscriptionIntent && subscription) {\n      if (subscription.pendingCorrelationId === correlationId) {\n        log.error(`Failed to subscribe on ${subscription.sid}`, message.error);\n        subscription.markAsFailed(message);\n        subscription.setSubscriptionState('none');\n      }\n    } else if (!subscriptionIntent && subscription) {\n      this.persisted.delete(sid);\n      subscription.setSubscriptionState('none');\n    }\n\n    this.persist();\n  }\n\n  private applyEventToSubscribedEntity(sid: string, event: any, eventType: string, isStrictlyOrdered: boolean): void {\n    if (!sid) {\n      return;\n    }\n\n    // Looking for subscription descriptor to check if poke has been completed\n    isStrictlyOrdered = isStrictlyOrdered || (() => {\n      let subscription = this.persisted.get(sid);\n      return subscription && subscription.isEstablished;\n    })();\n\n    // Still searching for subscriptionIntents. User could remove subscription already\n    let subscriptionIntent = this.subscriptions.get(sid);\n    if (subscriptionIntent) {\n      event.type = eventType;\n      subscriptionIntent.update(event, isStrictlyOrdered);\n    } else {\n      log.debug(`Message dropped for SID '${sid}', for which there is no subscription.`);\n    }\n  }\n\n  onConnectionStateChanged(isConnected: boolean) {\n    this.isConnected = isConnected;\n    if (isConnected) {\n      this.poke('reconnect');\n    }\n  }\n\n  private onSubscriptionTtlElapsed() {\n    if (this.isConnected) {\n      this.poke('ttl');\n    }\n  }\n\n  /**\n   * Prompts a playback of any missed changes made to any subscribed object. This method\n   * should be invoked whenever the connectivity layer has experienced cross-cutting\n   * delivery failures that would affect the entire local sync set. Any tangible result\n   * of this operation will result in calls to the _update() function of subscribed\n   * Sync entities.\n   */\n  private poke(reason: PokeReason) {\n    log.debug(`Triggering event replay for all subscriptions, reason=${reason}`);\n    this.pendingPokeReason = reason;\n    if (this.subscriptionTtlTimer) {\n      clearTimeout(this.subscriptionTtlTimer);\n      this.subscriptionTtlTimer = null;\n    }\n\n    let failedSubscriptions = [];\n\n    for (let it of this.persisted.values()) {\n      it.reset();\n      if (it.rejectedWithError) {\n        failedSubscriptions.push(it);\n      }\n    }\n\n    this.persisted.clear();\n    for (let it of failedSubscriptions) {\n      this.persisted.set(it.sid, it);\n    }\n    this.persist();\n  }\n\n  /**\n   * Stops all communication, clears any subscription intent, and returns.\n   */\n  shutdown() {\n    this.backoff.reset();\n    this.subscriptions.clear();\n  }\n}\n\nexport { SubscriptionsServices, Subscriptions };\n","import * as uuid from 'uuid';\n\nimport { SyncError, SyncNetworkError } from '../utils/syncerror';\nimport log from '../utils/logger';\n\nimport { ClientInfo } from '../clientInfo';\nimport { Retrier } from '@twilio/operation-retrier';\nimport { Network } from '../interfaces/services';\n\nimport { TransportUnavailableError } from 'twilsock';\n\nconst MINIMUM_RETRY_DELAY = 4000;\nconst MAXIMUM_RETRY_DELAY = 60000;\nconst MAXIMUM_ATTEMPTS_TIME = 90000;\nconst RETRY_DELAY_RANDOMNESS = 0.2;\n\nfunction messageFromErrorBody(transportError: any): string {\n  if (transportError.body) {\n    if (transportError.body.message) {\n      return transportError.body.message;\n    }\n  }\n  switch (transportError.status) {\n    case 429:\n      return 'Throttled by server';\n    case 404:\n      return 'Not found from server';\n    default:\n      return 'Error from server';\n  }\n}\n\nfunction codeFromErrorBody(trasportError: any): number {\n  if (trasportError.body) {\n    return trasportError.body.code;\n  }\n  return 0;\n}\n\nfunction mapTransportError(transportError: any): Error {\n  if (transportError.status === 409) {\n    return new SyncNetworkError(messageFromErrorBody(transportError),\n      transportError.status,\n      codeFromErrorBody(transportError),\n      transportError.body);\n  } else if (transportError.status) {\n    return new SyncError(messageFromErrorBody(transportError),\n      transportError.status,\n      codeFromErrorBody(transportError));\n  } else if (transportError instanceof TransportUnavailableError) {\n    return transportError;\n  } else {\n    return new SyncError(transportError.message, 0, 0);\n  }\n}\n\n/**\n * @classdesc Incapsulates network operations to make it possible to add some optimization/caching strategies\n */\nclass NetworkService implements Network {\n  clientInfo: ClientInfo;\n  config: any;\n  transport: any;\n\n  constructor(clientInfo: ClientInfo, config: any, transport: any) {\n    this.clientInfo = clientInfo;\n    this.config = config;\n    this.transport = transport;\n  }\n\n  private createHeaders() {\n    return {\n      'Content-Type': 'application/json',\n      'Twilio-Sync-Client-Info': JSON.stringify(this.clientInfo),\n      'Twilio-Request-Id': 'RQ' + uuid.v4().replace(/-/g, '')\n    };\n  }\n\n  private backoffConfig() {\n    return Object.assign({\n      min: MINIMUM_RETRY_DELAY,\n      max: MAXIMUM_RETRY_DELAY,\n      maxAttemptsTime: MAXIMUM_ATTEMPTS_TIME,\n      randomness: RETRY_DELAY_RANDOMNESS\n    }, this.config.backoffConfig);\n  }\n\n  private executeWithRetry<T>(request: () => Promise<T>, retryWhenThrottled = true): Promise<T> {\n    return new Promise((resolve, reject) => {\n      let codesToRetryOn = [502, 503, 504];\n      if (retryWhenThrottled) {\n        codesToRetryOn.push(429);\n      }\n\n      let retrier = new Retrier(this.backoffConfig());\n      retrier.on('attempt', () => {\n        request()\n          .then(result => retrier.succeeded(result))\n          .catch(err => {\n            if (codesToRetryOn.includes(err.status)) {\n              let delayOverride = parseInt(err.headers ? err.headers['Retry-After'] : null);\n              retrier.failed(mapTransportError(err),\n                isNaN(delayOverride) ? null : delayOverride * 1000);\n            } else if (err.message === 'Twilsock disconnected') {\n              // Ugly hack. We must make a proper exceptions for twilsock\n              retrier.failed(mapTransportError(err));\n            } else {\n              // Fatal error\n              retrier.removeAllListeners();\n              retrier.cancel();\n              reject(mapTransportError(err));\n            }\n          });\n      });\n\n      retrier.on('succeeded', result => {\n        resolve(result);\n      });\n      retrier.on('cancelled', err => reject(mapTransportError(err)));\n      retrier.on('failed', err => reject(mapTransportError(err)));\n\n      retrier.start();\n    });\n  }\n\n  /**\n   * Make a GET request by given URI\n   * @Returns Promise<Response> Result of successful get request\n   */\n  get(uri: string): Promise<Response> {\n    let headers = this.createHeaders();\n    log.debug('GET', uri, 'ID:', headers['Twilio-Request-Id']);\n\n    return this.executeWithRetry(() => this.transport.get(uri, headers, this.config.productId), true);\n  }\n\n  post(uri: string, body: Object, revision?: string, retryWhenThrottled: boolean = false): Promise<Response> {\n    let headers = this.createHeaders();\n    if (typeof revision !== 'undefined' && revision !== null) {\n      headers['If-Match'] = revision;\n    }\n\n    log.debug('POST', uri, 'ID:', headers['Twilio-Request-Id']);\n    return this.executeWithRetry(() => this.transport.post(uri, headers, body, this.config.productId), retryWhenThrottled);\n  }\n\n  put(uri: string, body: Object, revision: string): Promise<Response> {\n    let headers = this.createHeaders();\n    if (typeof revision !== 'undefined' && revision !== null) {\n      headers['If-Match'] = revision;\n    }\n\n    log.debug('PUT', uri, 'ID:', headers['Twilio-Request-Id']);\n    return this.executeWithRetry(() => this.transport.put(uri, headers, body, this.config.productId), false);\n  }\n\n  delete(uri: string): Promise<Response> {\n    let headers = this.createHeaders();\n    log.debug('DELETE', uri, 'ID:', headers['Twilio-Request-Id']);\n    return this.executeWithRetry(() => this.transport.delete(uri, headers, this.config.productId), false);\n  }\n}\n\nexport { NetworkService };\n","import { Configuration, Storage } from '../interfaces/services';\n\ninterface StorageBackend {\n  setItem(key: string, value: string): void;\n\n  getItem(key: string): string;\n\n  removeItem(key: string): void;\n}\n\nclass SessionStorage implements Storage {\n  private readonly config: Configuration;\n  private readonly storage: StorageBackend;\n  private storageId: string;\n\n  constructor(config: Configuration, storage?: StorageBackend) {\n    this.config = config;\n    this.storageId = null;\n    try {\n      this.storage = storage || sessionStorage;\n    } catch (e) {\n    }\n  }\n\n  private storageKey(type: string, key: string) {\n    return `${this.storageId}::${type}::${key}`;\n  }\n\n  private get isReady(): boolean {\n    return this.config.sessionStorageEnabled && !!this.storageId;\n  }\n\n  updateStorageId(storageId: string) {\n    this.storageId = storageId;\n  }\n\n  store(type: string, id: string, value: Object) {\n    if (!this.isReady) {\n      return null;\n    }\n    return this._store(this.storageKey(type, id), value);\n  }\n\n  read(type: string, id: string): Object {\n    if (!this.isReady) {\n      return null;\n    }\n    return this._read(this.storageKey(type, id));\n  }\n\n  remove(type: string, sid: string, uniqueName: string): void {\n    if (!this.isReady) {\n      return null;\n    }\n    try {\n      this.storage.removeItem(this.storageKey(type, sid));\n      if (uniqueName) {\n        this.storage.removeItem(this.storageKey(type, uniqueName));\n      }\n    } catch (e) {\n    }\n  }\n\n  update(type: string, sid: string, uniqueName: string, patch: Object): void {\n    if (!this.isReady) {\n      return null;\n    }\n    // Currently cache may have root stored twice - by sid and by uniqueName\n    // Maybe need to create some index if needed\n    this._apply(this.storageKey(type, sid), patch);\n    if (uniqueName) {\n      this._apply(this.storageKey(type, uniqueName), patch);\n    }\n  }\n\n  private _store(key: string, value: Object) {\n    try {\n      this.storage.setItem(key, JSON.stringify(value));\n    } catch (e) {\n    }\n  }\n\n  private _read(key: string): Object {\n    try {\n      let storedData = this.storage.getItem(key);\n      if (storedData) {\n        return JSON.parse(storedData);\n      }\n    } catch (e) {\n    }\n    return null;\n  }\n\n  private _apply(key: string, patch: any): boolean {\n    let value = this._read(key);\n    if (!value) {\n      return false;\n    }\n    this._store(key, Object.assign(value, patch));\n  }\n}\n\nexport { StorageBackend, SessionStorage };\n","\nimport { Services, Network, Router, Storage } from './interfaces/services';\nimport { SyncError } from './utils/syncerror';\nimport { Closeable } from './closeable';\n\ninterface EntityServices {\n  network: Network;\n  router: Router;\n  storage: Storage;\n}\n\ntype RemovalHandler = (type: string, sid: string, uniqueName: string) => void;\nexport type SubscriptionState = 'none' | 'request_in_flight' | 'response_in_flight' | 'established';\n\nabstract class SyncEntity {\n  protected readonly services: EntityServices;\n  protected readonly removalHandler: RemovalHandler;\n  private subscriptionState: SubscriptionState;\n  private readonly _attachedListeners: Map<string, Closeable>;\n\n  protected constructor(services: EntityServices, removalHandler: RemovalHandler) {\n    this.services = services;\n    this.removalHandler = removalHandler;\n    this.subscriptionState = 'none';\n    this._attachedListeners = new Map<string, Closeable>();\n  }\n\n  abstract get sid(): string;\n\n  abstract get uniqueName(): string;\n\n  abstract get type(): string;\n\n  abstract get lastEventId(): number;\n\n  abstract get indexName(): string;\n\n  abstract get queryString(): string;\n\n  abstract _update(update: any, isStrictlyOrdered: boolean): void;\n\n  _advanceLastEventId(eventId: number, revision?: string): void {\n  }\n\n  protected abstract onRemoved(locally: boolean): void;\n\n  reportFailure(err: SyncError): void {\n    if (err.status === 404) {\n      // assume that 404 means that entity has been removed while we were away\n      this.onRemoved(false);\n    } else {\n      this.broadcastEventToListeners('failure', err);\n    }\n  }\n\n  /**\n   * Subscribe to changes of data entity\n   * @private\n   */\n  _subscribe() {\n    this.services.router._subscribe(this.sid, this);\n  }\n\n  /**\n   * Unsubscribe from changes of current data entity\n   * @private\n   */\n  _unsubscribe() {\n    this.services.router._unsubscribe(this.sid);\n  }\n\n  _setSubscriptionState(newState: SubscriptionState): void {\n    this.subscriptionState = newState;\n    this.broadcastEventToListeners('_subscriptionStateChanged', newState);\n  }\n\n  /**\n   * @public\n   */\n  close() {\n    this._unsubscribe();\n    if (this.removalHandler != null) {\n      this.removalHandler(this.type, this.sid, this.uniqueName);\n    }\n  }\n\n  public attach(closeable: Closeable): void {\n    const uuid = closeable.listenerUuid;\n    const existingRecord = this._attachedListeners.get(uuid);\n    if (existingRecord) {\n      return;\n    }\n\n    if (!this._attachedListeners.size) {\n      // the first one to arrive\n      this._subscribe();\n    }\n\n    this._attachedListeners.set(uuid, closeable);\n  }\n\n  public detach(listenerUuid: string): void {\n    this._attachedListeners.delete(listenerUuid);\n    if (!this._attachedListeners.size) {\n      // last one out, turn off lights, shut the door\n      this.close(); // invokes unsubscribe and removal handler\n    }\n  }\n\n  protected broadcastEventToListeners(eventName: string, args: any) {\n    for (let listener of this._attachedListeners.values()) {\n      listener.emit(eventName, args);\n    }\n  }\n}\n\nexport { Services, EntityServices, RemovalHandler, SyncEntity };\nexport default SyncEntity;\n","export type RequestFunction<InputType, ReturnType> = (input: InputType) => Promise<ReturnType>;\nexport type InputReducer<InputType> = (acc: InputType, input: InputType) => InputType;\n\nexport interface QueuedRequest<InputType, ReturnType> {\n  input: InputType;\n  requestFunction: RequestFunction<InputType, ReturnType>;\n  resolve: (result: ReturnType) => any;\n  reject: (error: any) => any;\n}\n\nexport class MergingQueue<InputType, ReturnType> {\n\n  private queuedRequests: QueuedRequest<InputType, ReturnType>[] = [];\n  private inputMergingFunction: InputReducer<InputType>;\n  private isRequestInFlight: boolean = false;\n\n  constructor(inputMergingFunction: InputReducer<InputType>) {\n    this.inputMergingFunction = inputMergingFunction;\n  }\n\n  public add(input: InputType, requestFunction: RequestFunction<InputType, ReturnType>): Promise<ReturnType> {\n    let promise: Promise<ReturnType> = new Promise((resolve, reject) =>\n      this.queuedRequests.push({input, requestFunction, resolve, reject})\n    );\n    this.wakeupQueue();\n\n    return promise;\n  }\n\n  public squashAndAdd(input: InputType, requestFunction: RequestFunction<InputType, ReturnType>): Promise<ReturnType> {\n    let queueToSquash = this.queuedRequests;\n    this.queuedRequests = [];\n\n    let reducedInput;\n    if (queueToSquash.length > 0) {\n      reducedInput = queueToSquash.map(r => r.input).reduce(this.inputMergingFunction);\n      reducedInput = this.inputMergingFunction(reducedInput, input);\n    } else {\n      reducedInput = input;\n    }\n\n    let promise = this.add(reducedInput, requestFunction);\n\n    queueToSquash.forEach(request => promise.then(request.resolve, request.reject));\n    return promise;\n  }\n\n  public isEmpty(): boolean {\n    return this.queuedRequests.length === 0 && !this.isRequestInFlight;\n  }\n\n  private wakeupQueue() {\n    if (this.queuedRequests.length === 0 || this.isRequestInFlight) {\n      return;\n    } else {\n      let requestToExecute = this.queuedRequests.shift();\n      this.isRequestInFlight = true;\n      requestToExecute.requestFunction(requestToExecute.input)\n        .then(requestToExecute.resolve, requestToExecute.reject)\n        .then(__ => {\n          this.isRequestInFlight = false;\n          this.wakeupQueue();\n        });\n    }\n  }\n}\n\nexport class NamespacedMergingQueue<K, InputType, ReturnType> {\n\n  private inputReducer: InputReducer<InputType>;\n  private queueByNamespaceKey: Map<K, MergingQueue<InputType, ReturnType>> = new Map<K, MergingQueue<InputType, ReturnType>>();\n\n  constructor(inputReducer: InputReducer<InputType>) {\n    this.inputReducer = inputReducer;\n  }\n\n  public async add(namespaceKey: K, input: InputType, requestFunction: RequestFunction<InputType, ReturnType>): Promise<ReturnType> {\n    return this.invokeQueueMethod(namespaceKey, queue => queue.add(input, requestFunction));\n  }\n\n  public async squashAndAdd(namespaceKey: K, input: InputType, requestFunction: RequestFunction<InputType, ReturnType>): Promise<ReturnType> {\n    return this.invokeQueueMethod(namespaceKey, queue => queue.squashAndAdd(input, requestFunction));\n  }\n\n  public async invokeQueueMethod(\n    namespaceKey: K,\n    queueMethodInvoker: (queue: MergingQueue<InputType, ReturnType>) => Promise<ReturnType>): Promise<ReturnType> {\n\n    if (!this.queueByNamespaceKey.has(namespaceKey)) {\n      this.queueByNamespaceKey.set(namespaceKey, new MergingQueue<InputType, ReturnType>(this.inputReducer));\n    }\n    const queue = this.queueByNamespaceKey.get(namespaceKey);\n    const result = queueMethodInvoker(queue);\n    if (this.queueByNamespaceKey.get(namespaceKey).isEmpty()) {\n      this.queueByNamespaceKey.delete(namespaceKey);\n    }\n    return result;\n  }\n}\n","import { EventEmitter } from 'events';\nimport { v4 as uuidv4 } from 'uuid';\n\nabstract class Closeable extends EventEmitter {\n\n  private readonly uuid: string;\n  private closed: boolean;\n\n  constructor() {\n    super();\n    this.closed = false;\n    this.uuid = uuidv4();\n  }\n\n  get listenerUuid(): string {\n    return this.uuid;\n  }\n\n  protected close() {\n    this.removeAllListeners();\n    this.closed = true;\n  }\n\n  protected ensureNotClosed() {\n    if (this.closed) {\n      throw new Error('Invalid operation on closed object');\n    }\n  }\n\n}\nexport { Closeable };\nexport default Closeable;","import { SyncError } from './utils/syncerror';\nimport { deepClone } from './utils/sanitize';\nimport log from './utils/logger';\n\nimport { SyncEntity, EntityServices, RemovalHandler } from './entity';\nimport { Mutator } from './interfaces/mutator';\nimport { MergingQueue } from './mergingqueue';\nimport Closeable from './closeable';\nimport { nonNegativeInteger, objectSchema, pureObject, validateTypesAsync } from '@twilio/declarative-type-validator';\n\ninterface DocumentServices extends EntityServices {\n}\n\ninterface DocumentDescriptor {\n  url: string;\n  sid: string;\n  revision: string;\n  last_event_id: number;\n  unique_name: string;\n  data: Object;\n  date_updated: Date;\n  date_expires: string;\n}\n\ninterface DocumentUpdateRequest {\n  data?: Object;\n  ttl?: number;\n  revision?: string;\n}\n\ninterface DocumentUpdateResult {\n  revision: string;\n  data: Object;\n  last_event_id: number;\n  date_updated: Date;\n  date_expires: string | null;\n}\n\n/**\n * Document metadata.\n */\ninterface SyncDocumentMetadata {\n  /**\n   * Specifies the time-to-live in seconds after which the document is subject to automatic deletion.\n   * The value 0 means infinity.\n   */\n  ttl?: number;\n}\n\nclass SyncDocumentImpl extends SyncEntity {\n\n  private readonly updateMergingQueue: MergingQueue<SyncDocumentMetadata, Object>;\n  private readonly descriptor: DocumentDescriptor;\n  private isDeleted: boolean = false;\n\n  /**\n   * @internal\n   */\n  constructor(services: DocumentServices, descriptor: DocumentDescriptor, removalHandler: RemovalHandler) {\n    super(services, removalHandler);\n\n    const updateRequestReducer = (acc, input) => (typeof input.ttl === 'number') ? {ttl: input.ttl}\n      : acc;\n    this.updateMergingQueue = new MergingQueue<SyncDocumentMetadata, Object>(updateRequestReducer);\n    this.descriptor = descriptor;\n    this.descriptor.data = this.descriptor.data || {};\n    this.descriptor.date_updated = new Date(this.descriptor.date_updated);\n  }\n\n  // private props\n  get uri(): string {\n    return this.descriptor.url;\n  }\n\n  get revision(): string {\n    return this.descriptor.revision;\n  }\n\n  get lastEventId(): number {\n    return this.descriptor.last_event_id;\n  }\n\n  get dateExpires(): string {\n    return this.descriptor.date_expires;\n  }\n\n  static get type() {\n    return 'document';\n  }\n\n  get type() {\n    return 'document';\n  }\n\n  // below properties are specific to Insights only\n  get indexName(): string {\n    return undefined;\n  }\n\n  get queryString(): string {\n    return undefined;\n  }\n\n  // public props, documented along with class description\n  get sid(): string {\n    return this.descriptor.sid;\n  }\n\n  get data(): Object {\n    return this.descriptor.data;\n  }\n\n  get dateUpdated(): Date {\n    return this.descriptor.date_updated;\n  }\n\n  get uniqueName(): string {\n    return this.descriptor.unique_name || null;\n  }\n\n  /**\n   * Update data entity with new data\n   * @private\n   */\n  _update(update): void {\n    update.date_created = new Date(update.date_created);\n    switch (update.type) {\n      case 'document_updated':\n        if (update.id <= this.lastEventId) {\n          log.trace('Document update skipped, current:', this.lastEventId, ', remote:', update.id);\n          break;\n        }\n\n        const previousData = this.descriptor.data !== undefined ? deepClone(this.descriptor.data) : null;\n\n        this.descriptor.last_event_id = update.id;\n        this.descriptor.revision = update.document_revision;\n        this.descriptor.date_updated = update.date_created;\n        this.descriptor.data = update.document_data;\n\n        this.broadcastEventToListeners('updated', {data: update.document_data, isLocal: false, previousData});\n        this.services.storage.update(this.type, this.sid, this.uniqueName,\n          {\n            last_event_id: update.id,\n            revision: update.document_revision,\n            date_updated: update.date_created,\n            data: update.document_data\n          });\n        break;\n      case 'document_removed':\n        this.onRemoved(false);\n        break;\n    }\n  }\n\n  public async set(value: Object, metadataUpdates?: SyncDocumentMetadata): Promise<Object> {\n    const input: SyncDocumentMetadata = metadataUpdates || {};\n    return this.updateMergingQueue.squashAndAdd(input, input => this._setUnconditionally(value, input.ttl));\n  }\n\n  public async mutate(mutator: Mutator, metadataUpdates?: SyncDocumentMetadata): Promise<Object> {\n    const input: SyncDocumentMetadata = metadataUpdates || {};\n    return this.updateMergingQueue.add(input, input => this._setWithIfMatch(mutator, input.ttl));\n  }\n\n  public async update(obj: Object, metadataUpdates?: SyncDocumentMetadata): Promise<Object> {\n    return this.mutate(remote => Object.assign(remote, obj), metadataUpdates);\n  }\n\n  public async setTtl(ttl: number): Promise<void> {\n    const response = await this._postUpdateToServer({ttl});\n    this.descriptor.date_expires = response.date_expires;\n  }\n\n  /**\n   * @private\n   */\n  private async _setUnconditionally(value: Object, ttl?: number): Promise<Object> {\n    let result = await this._postUpdateToServer({data: value, revision: undefined, ttl});\n    this._handleSuccessfulUpdateResult(result);\n    return this.descriptor.data;\n  }\n\n  /**\n   * @private\n   */\n  private async _setWithIfMatch(mutatorFunction: Mutator, ttl?: number): Promise<Object> {\n    let data = mutatorFunction(deepClone(this.descriptor.data));\n    if (data) {\n      let revision = this.revision;\n      try {\n        let result = await this._postUpdateToServer({data, revision, ttl});\n        this._handleSuccessfulUpdateResult(result);\n        return this.descriptor.data;\n      } catch (error) {\n        if (error.status === 412) {\n          await this._softSync();\n          return this._setWithIfMatch(mutatorFunction);\n        } else {\n          throw error;\n        }\n      }\n    } else {\n      return this.descriptor.data;\n    }\n  }\n\n  /**\n   * @private\n   */\n  private _handleSuccessfulUpdateResult(result: DocumentUpdateResult) {\n    // Ignore returned value if we already got a newer one\n    if (result.last_event_id <= this.descriptor.last_event_id) {\n      return;\n    }\n\n    const previousData = this.descriptor.data !== undefined ? deepClone(this.descriptor.data) : null;\n\n    this.descriptor.revision = result.revision;\n    this.descriptor.data = result.data;\n    this.descriptor.last_event_id = result.last_event_id;\n    this.descriptor.date_expires = result.date_expires;\n    this.descriptor.date_updated = new Date(result.date_updated);\n\n    this.services.storage.update(this.type, this.sid, this.uniqueName,\n      {\n        last_event_id: result.last_event_id,\n        revision: result.revision,\n        date_updated: result.date_updated,\n        data: result.data\n      });\n    this.broadcastEventToListeners('updated', {data: this.descriptor.data, isLocal: true, previousData});\n  }\n\n  /**\n   * @private\n   */\n  private async _postUpdateToServer(request: DocumentUpdateRequest): Promise<DocumentUpdateResult> {\n    if (!this.isDeleted) {\n      const requestBody: any = {\n        data: request.data\n      };\n\n      if (request.ttl !== undefined) {\n        requestBody.ttl = request.ttl;\n      }\n\n      const ifMatch = request.revision;\n      try {\n        const response = await this.services.network.post(this.uri, requestBody, ifMatch);\n        return {\n          revision: response.body.revision,\n          data: request.data,\n          last_event_id: response.body.last_event_id,\n          date_updated: response.body.date_updated,\n          date_expires: response.body.date_expires\n        };\n      } catch (error) {\n        if (error.status === 404) {\n          this.onRemoved(false);\n        }\n        throw error;\n      }\n    } else {\n      return Promise.reject(new SyncError('The Document has been removed', 404, 54100));\n    }\n  }\n\n  /**\n   * Get new data from server\n   * @private\n   */\n  private async _softSync() {\n    return this.services.network.get(this.uri)\n      .then(response => {\n        const event = {\n          type: 'document_updated',\n          id: response.body.last_event_id,\n          document_revision: response.body.revision,\n          document_data: response.body.data,\n          date_created: response.body.date_updated\n        };\n        this._update(event);\n        return this;\n      })\n      .catch(err => {\n        if (err.status === 404) {\n          this.onRemoved(false);\n        } else {\n          log.error(`Can't get updates for ${this.sid}:`, err);\n        }\n      });\n  }\n\n  protected onRemoved(locally: boolean) {\n    if (this.isDeleted) {\n      return;\n    }\n\n    const previousData = this.descriptor.data !== undefined ? deepClone(this.descriptor.data) : null;\n\n    this.isDeleted = true;\n    this._unsubscribe();\n    this.removalHandler(this.type, this.sid, this.uniqueName);\n    this.broadcastEventToListeners('removed', {isLocal: locally, previousData});\n  }\n\n  public async removeDocument() {\n    if (!this.isDeleted) {\n      await this.services.network.delete(this.uri);\n      this.onRemoved(true);\n    } else {\n      return Promise.reject(new SyncError('The Document has been removed', 404, 54100));\n    }\n  }\n\n}\n\n/**\n * Represents a Sync document, the contents of which is a single JSON object.\n * Use the {@link SyncClient.document} method to obtain a reference to a Sync document.\n * Information about rate limits can be found [here](https://www.twilio.com/docs/sync/limits).\n */\nclass SyncDocument extends Closeable {\n\n  private readonly syncDocumentImpl: SyncDocumentImpl;\n\n  // private props\n  get uri(): string {\n    return this.syncDocumentImpl.uri;\n  }\n\n  get revision(): string {\n    return this.syncDocumentImpl.revision;\n  }\n\n  get lastEventId(): number {\n    return this.syncDocumentImpl.lastEventId;\n  }\n\n  get dateExpires(): string {\n    return this.syncDocumentImpl.dateExpires;\n  }\n\n  static get type() {\n    return SyncDocumentImpl.type;\n  }\n\n  get type() {\n    return SyncDocumentImpl.type;\n  }\n\n  /**\n   * The immutable identifier of this document, assigned by the system.\n   */\n  get sid(): string {\n    return this.syncDocumentImpl.sid;\n  }\n\n  /**\n   * The contents of this document.\n   */\n  get data(): Object {\n    return this.syncDocumentImpl.data;\n  }\n\n  /**\n   * Date when the document was last updated.\n   */\n  get dateUpdated(): Date {\n    return this.syncDocumentImpl.dateUpdated;\n  }\n\n  /**\n   * An optional immutable identifier that may be assigned by the programmer\n   * to this document during creation. Globally unique among other documents.\n   */\n  get uniqueName(): string {\n    return this.syncDocumentImpl.uniqueName;\n  }\n\n  /**\n   * @internal\n   */\n  constructor(syncDocumentImpl: SyncDocumentImpl) {\n    super();\n    this.syncDocumentImpl = syncDocumentImpl;\n    this.syncDocumentImpl.attach(this);\n  }\n\n  /**\n   * Fired when the document is removed, regardless of whether the remover was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has following properties:\n   *     * boolean `isLocal` - is true if document was removed by a local actor, false otherwise\n   *     * object `previousData` - contains a snapshot of the document data before removal\n   * @example\n   * ```typescript\n   * document.on('removed', (args) => {\n   *   console.log(`Document ${document.sid} was removed`);\n   *   console.log('args.isLocal:', args.isLocal);\n   *   console.log('args.previousData:', args.previousData);\n   * });\n   * ```\n   * @event\n   */\n  static readonly removed = 'removed';\n\n  /**\n   * Fired when the document's contents have changed, regardless of whether the updater was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * boolean `isLocal` - is true if document was updated by a local actor, false otherwise\n   *     * object `data` - a snapshot of the document's new contents\n   *     * object `previousData` - contains a snapshot of the document data before the update\n   * @example\n   * ```typescript\n   * document.on('updated', (args) => {\n   *   console.log(`Document ${document.sid} was updated`);\n   *   console.log('args.data:', args.data);\n   *   console.log('args.isLocal:', args.isLocal);\n   *   console.log('args.previousData:', args.previousData);\n   * });\n   * ```\n   * @event\n   */\n  static readonly updated = 'updated';\n\n  /**\n   * Assign new contents to this document. The current data will be overwritten.\n   * @param data The new contents to assign.\n   * @param metadataUpdates New document metadata.\n   * @return A promise resolving to the new data of the document.\n   * @example\n   * ```typescript\n   * // Say, the Document data is `{ name: 'John Smith', age: 34 }`\n   * document.set({ name: 'Barbara Oaks' }, { ttl: 86400 })\n   *   .then((newValue) => {\n   *     // Now the Document data is `{ name: 'Barbara Oaks' }`\n   *     console.log('Document set() successful, new data:', newValue);\n   *   })\n   *   .catch((error) => {\n   *     console.error('Document set() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    pureObject,\n    [\n      'undefined',\n      objectSchema('document metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n  public async set(data: Object, metadataUpdates?: SyncDocumentMetadata): Promise<Object> {\n    this.ensureNotClosed();\n    return this.syncDocumentImpl.set(data, metadataUpdates);\n  }\n\n  /**\n   * Schedules a modification to this document that will apply a mutation function.\n   * @param mutator A function that outputs new data based on the existing data.\n   * May be called multiple times, particularly if this document is modified concurrently by remote code.\n   * If the mutation ultimately succeeds, the document will have made the particular transition described\n   * by this function.\n   * @param metadataUpdates New document metadata.\n   * @return Resolves with the most recent Document state, whether the output of a\n   * successful mutation or a state that prompted graceful cancellation (mutator returned `null`).\n   * @example\n   * ```typescript\n   * const mutatorFunction = (currentValue) => {\n   *     currentValue.viewCount = (currentValue.viewCount ?? 0) + 1;\n   *     return currentValue;\n   * };\n   * document.mutate(mutatorFunction, { ttl: 86400 }))\n   *   .then((newValue) => {\n   *     console.log('Document mutate() successful, new data:', newValue);\n   *   })\n   *   .catch((error) => {\n   *     console.error('Document mutate() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    'function',\n    [\n      'undefined',\n      objectSchema('document metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n  public async mutate(mutator: Mutator, metadataUpdates?: SyncDocumentMetadata): Promise<Object> {\n    this.ensureNotClosed();\n    return this.syncDocumentImpl.mutate(mutator, metadataUpdates);\n  }\n\n  /**\n   * Modify a document by appending new fields (or by overwriting existing ones) with the values from the provided Object.\n   * This is equivalent to:\n   * ```typescript\n   * document.mutate((currentValue) => Object.assign(currentValue, obj));\n   * ```\n   * @param obj Specifies the particular (top-level) attributes that will receive new values.\n   * @param metadataUpdates New document metadata.\n   * @return A promise resolving to the new data of the document.\n   * @example\n   * ```typescript\n   * // Say, the Document data is `{ name: 'John Smith' }`\n   * document.update({ age: 34 }, { ttl: 86400 })\n   *   .then((newValue) => {\n   *     // Now the Document data is `{ name: 'John Smith', age: 34 }`\n   *     console.log('Document update() successful, new data:', newValue);\n   *   })\n   *   .catch((error) => {\n   *     console.error('Document update() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    pureObject,\n    [\n      'undefined',\n      objectSchema('document metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n  public async update(obj: Object, metadataUpdates?: SyncDocumentMetadata): Promise<Object> {\n    this.ensureNotClosed();\n    return this.syncDocumentImpl.update(obj, metadataUpdates);\n  }\n\n  /**\n   * Update the time-to-live of the document.\n   * @param ttl Specifies the time-to-live in seconds after which the document is subject to automatic deletion. The value 0 means infinity.\n   * @return A promise that resolves after the TTL update was successful.\n   * @example\n   * ```typescript\n   * document.setTtl(3600)\n   *   .then(() => {\n   *     console.log('Document setTtl() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('Document setTtl() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger)\n  public async setTtl(ttl: number): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncDocumentImpl.setTtl(ttl);\n  }\n\n  /**\n   * Delete a document.\n   * @return A promise which resolves if (and only if) the document is ultimately deleted.\n   * @example\n   * ```typescript\n   * document.removeDocument()\n   *   .then(() => {\n   *     console.log('Document removeDocument() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('Document removeDocument() failed', error);\n   *   });\n   * ```\n   */\n  public async removeDocument() {\n    this.ensureNotClosed();\n    return this.syncDocumentImpl.removeDocument();\n  }\n\n  /**\n   * Conclude work with the document instance and remove all event listeners attached to it.\n   * Any subsequent operation on this object will be rejected with error.\n   * Other local copies of this document will continue operating and receiving events normally.\n   * @example\n   * ```typescript\n   * document.close();\n   * ```\n   */\n  public close(): void {\n    super.close();\n    this.syncDocumentImpl.detach(this.listenerUuid);\n  }\n\n}\n\nexport { SyncDocumentMetadata, DocumentServices, DocumentDescriptor, Mutator, SyncDocument, SyncDocumentImpl };\nexport default SyncDocument;\n","export interface SyncListItemDescriptor {\n  index: number;\n  uri: string;\n  data: Object;\n  revision: string;\n  lastEventId: number;\n  dateUpdated: Date;\n  dateExpires: string;\n}\n\n/**\n * Represents an individual element in a Sync list.\n */\nclass SyncListItem {\n  private readonly descriptor: SyncListItemDescriptor;\n\n  /**\n   * @param descriptor Item descriptor\n   * @internal\n   */\n  constructor(descriptor: SyncListItemDescriptor) {\n    this.descriptor = descriptor;\n  }\n\n  get uri(): string {\n    return this.descriptor.uri;\n  }\n\n  get revision(): string {\n    return this.descriptor.revision;\n  }\n\n  get lastEventId(): number {\n    return this.descriptor.lastEventId;\n  }\n\n  /**\n   * Date when the list item was last updated.\n   */\n  get dateUpdated(): Date {\n    return this.descriptor.dateUpdated;\n  }\n\n  get dateExpires(): string {\n    return this.descriptor.dateExpires;\n  }\n\n  /**\n   * The index, within the containing list, of this item. This index is stable;\n   * even if lower-indexed items are removed, this index will remain as is.\n   */\n  get index(): number {\n    return this.descriptor.index;\n  }\n\n  /**\n   * The contents of the item.\n   */\n  get data(): Object {\n    return this.descriptor.data;\n  }\n\n  /**\n   * @internal\n   */\n  update(eventId: number, revision: string, data: Object, dateUpdated: Date): SyncListItem {\n    this.descriptor.lastEventId = eventId;\n    this.descriptor.revision = revision;\n    this.descriptor.data = data;\n    this.descriptor.dateUpdated = dateUpdated;\n    return this;\n  }\n\n  /**\n   * @internal\n   */\n  updateDateExpires(dateExpires: string) {\n    this.descriptor.dateExpires = dateExpires;\n  }\n}\n\nexport { SyncListItem };\n","/**\n * Pagination helper class.\n */\nclass Paginator<Item> {\n  private prevToken: string;\n  private nextToken: string;\n  private source: any;\n\n  /**\n   * Array of elements on current page.\n   */\n  public readonly items: Item[];\n\n  /**\n   * @internal\n   */\n  constructor(items: any, source: any, prevToken: string, nextToken: string) {\n    this.prevToken = prevToken;\n    this.nextToken = nextToken;\n\n    this.items = items;\n    this.source = source;\n  }\n\n  /**\n   * Indicates the existence of the next page.\n   */\n  get hasNextPage(): boolean {\n    return !!this.nextToken;\n  }\n\n  /**\n   * Indicates the existence of the previous page.\n   */\n  get hasPrevPage(): boolean {\n    return !!this.prevToken;\n  }\n\n  /**\n   * Request next page.\n   * Does not modify existing object.\n   */\n  async nextPage(): Promise<Paginator<Item>> {\n    if (!this.hasNextPage) {\n      throw new Error('No next page');\n    }\n\n    return this.source(this.nextToken);\n  }\n\n  /**\n   * Request previous page.\n   * Does not modify existing object.\n   */\n  async prevPage(): Promise<Paginator<Item>> {\n    if (!this.hasPrevPage) {\n      throw new Error('No previous page');\n    }\n\n    return this.source(this.prevToken);\n  }\n}\n\nexport { Paginator };\n","interface Map<K, V> {\n  get(key: K): V;\n  set(key: K, value: V): void;\n}\n\ninterface TreeMapInterface<K, V> extends Map<K, V>, Iterable<[K, V]> {\n\n}\n\ninterface HashMap<K, V> extends Map<K, V> {\n\n}\n\nclass Node<K, V> {\n  parent: Node<K, V>;\n  left: Node<K, V>;\n  right: Node<K, V>;\n  balanceFactor: number;\n\n  key: K;\n  value: V;\n\n  constructor(key: K, value: V) {\n    this.balanceFactor = 0;\n    this.key = key;\n    this.value = value;\n    this.parent = null;\n    this.left = null;\n    this.right = null;\n  }\n\n  get isRoot(): boolean { return this.parent === null; }\n  get isLeaf(): boolean { return (this.left === null) && (this.right === null); }\n  get isLeftChild(): boolean { return this.parent.left === this; }\n\n  update(value: V) {\n    this.value = value;\n  }\n\n  replace(target: Node<K, V>, replacement: Node<K, V>) {\n    if (!target) {\n      return;\n    }\n\n    if (this.left === replacement) {\n      this.left = replacement;\n    } else if (this.right === replacement) {\n      this.right = replacement;\n    }\n  }\n}\n\ntype Less<T> = (x: T, y: T) => boolean;\ntype Equal<T> = (x: T, y: T) => boolean;\n\n/**\n * @property length\n */\nclass TreeMap<K, V> implements TreeMapInterface<K, V> {\n  private isLessThan: Less<K>;\n  private isEqual: Equal<K>;\n\n  private root: Node<K, V>;\n  private count: number;\n\n  constructor(less?: Less<K>, equal?: Equal<K>) {\n    this.isLessThan = less || ((x, y) => x < y);\n    this.isEqual = equal || ((x, y) => x === y);\n    this.root = null;\n    this.count = null;\n  }\n\n  get size(): number { return this.count; }\n\n  clear() {\n    this.root = null;\n    this.count = 0;\n  }\n\n  set(key: K, value: V): void {\n    let node = this.getNode(key);\n    if (node) {\n      node.update(value);\n    } else {\n      this.insert(key, value);\n    }\n    // return node;\n  }\n\n  insert(key: K, value: V): void {\n    let node = new Node(key, value);\n    this.count++;\n\n    if (!this.root) {\n      this.root = node;\n      // return node;\n      return;\n    }\n\n    let currNode = this.root;\n    for (;;) {\n      if (this.isLessThan(key, currNode.key)) {\n        if (currNode.left) {\n          currNode = currNode.left;\n        } else {\n          currNode.left = node;\n          break;\n        }\n      } else {\n        if (currNode.right) { // eslint-disable-line no-lonely-if\n          currNode = currNode.right;\n        } else {\n          currNode.right = node;\n          break;\n        }\n      }\n    }\n\n    node.parent = currNode;\n    currNode = node;\n    while (currNode.parent) {\n      let parent = currNode.parent;\n      let prevBalanceFactor = parent.balanceFactor;\n\n      if (currNode.isLeftChild) {\n        parent.balanceFactor++;\n      } else {\n        parent.balanceFactor--;\n      }\n\n      if (Math.abs(parent.balanceFactor) < Math.abs(prevBalanceFactor)) {\n        break;\n      }\n\n      if (parent.balanceFactor < -1 || parent.balanceFactor > 1) {\n        this.rebalance(parent);\n        break;\n      }\n\n      currNode = parent;\n    }\n\n    // return node;\n  }\n\n  get(key: K): V {\n    let currentNode = this.root;\n    while (currentNode) {\n      if (this.isEqual(key, currentNode.key)) {\n        return currentNode.value;\n      }\n\n      if (this.isLessThan(key, currentNode.key)) {\n        currentNode = currentNode.left;\n      } else {\n        currentNode = currentNode.right;\n      }\n    }\n    return null;\n  }\n\n  delete(key: K): void {\n    // update this algorithm and remove any\n    let node = this.getNode(key) as any;\n    if (!node || node.key !== key) {\n      return null;\n    }\n\n    let parent = node.parent;\n    let left = node.left;\n    let right = node.right;\n\n    if (!!left !== !!right) { // one child\n      let child = left || right;\n      if (!parent && !child) {\n        this.root = null;\n      } else if (parent && !child) {\n        this.root = child;\n      } else {\n        parent.replace(node, null);\n        this.rebalance(parent);\n      }\n    } else { // two children\n      let maxLeft = node.left;\n      while (maxLeft.right) {\n        maxLeft = maxLeft.right;\n      }\n\n      if (node.left === maxLeft) {\n        if (node.isRoot) {\n          this.root = maxLeft;\n          maxLeft.parent = null;\n        } else {\n          if (node.isLeftChild) {\n            node.parent.left = maxLeft;\n          } else {\n            node.parent.right = maxLeft;\n          }\n          maxLeft.parent = node.parent;\n        }\n\n        maxLeft.right = node.right;\n        maxLeft.right.parent = maxLeft;\n        maxLeft.balanceFactor = node.balanceFactor;\n        node = {\n          parent: maxLeft, isLeftChild: true\n        };\n      } else {\n        let mlParent = maxLeft.parent;\n        let mlLeft = maxLeft.left;\n\n        mlParent.right = mlLeft;\n        if (mlLeft) {\n          mlLeft.parent = mlParent;\n        }\n\n        if (node.isRoot) {\n          this.root = maxLeft;\n          maxLeft.parent = null;\n        } else {\n          if (node.isLeftChild) {\n            node.parent.left = maxLeft;\n          } else {\n            node.parent.right = maxLeft;\n          }\n          maxLeft.parent = node.parent;\n        }\n\n        maxLeft.right = node.right;\n        maxLeft.right.parent = maxLeft;\n        maxLeft.left = node.left;\n        maxLeft.left.parent = maxLeft;\n        maxLeft.balanceFactor = node.balanceFactor;\n\n        node = {\n          parent: mlParent, isLeftChild: false\n        };\n      }\n    }\n\n    this.count--;\n\n    while (node.parent) {\n      let parent = node.parent;\n      let prevBalanceFactor = parent.balanceFactor;\n\n      if (node.isLeftChild) {\n        parent.balanceFactor -= 1;\n      } else {\n        parent.balanceFactor += 1;\n      }\n\n      if (Math.abs(parent.balanceFactor) > Math.abs(prevBalanceFactor)) {\n        if (parent.balanceFactor < -1 || parent.balanceFactor > 1) {\n          this.rebalance(parent);\n\n          if (parent.parent.balanceFactor === 0) {\n            node = parent.parent;\n          } else {\n            break;\n          }\n        } else {\n          break;\n        }\n      } else {\n        node = parent;\n      }\n    }\n\n    return null;\n  }\n\n  private getNode(key: K): Node<K, V> {\n    let currentNode = this.root;\n    while (currentNode) {\n      if (this.isEqual(key, currentNode.key)) {\n        return currentNode;\n      }\n\n      if (this.isLessThan(key, currentNode.key)) {\n        currentNode = currentNode.left;\n      } else {\n        currentNode = currentNode.right;\n      }\n    }\n    return null;\n  }\n\n  private rebalance(node: Node<K, V>) {\n    if (node.balanceFactor < 0) {\n      if (node.right.balanceFactor > 0) {\n        this.rotateRight(node.right);\n        this.rotateLeft(node);\n      } else {\n        this.rotateLeft(node);\n      }\n    } else if (node.balanceFactor > 0) {\n      if (node.left.balanceFactor < 0) {\n        this.rotateLeft(node.left);\n        this.rotateRight(node);\n      } else {\n        this.rotateRight(node);\n      }\n    }\n  }\n\n  private rotateLeft(pivot: Node<K, V>) {\n    let root = pivot.right;\n    pivot.right = root.left;\n    if (root.left !== null) {\n      root.left.parent = pivot;\n    }\n\n    root.parent = pivot.parent;\n    if (root.parent === null) {\n      this.root = root;\n    } else if (pivot.isLeftChild) {\n      root.parent.left = root;\n    } else {\n      root.parent.right = root;\n    }\n\n    root.left = pivot;\n    pivot.parent = root;\n    pivot.balanceFactor = pivot.balanceFactor + 1 - Math.min(root.balanceFactor, 0);\n    root.balanceFactor = root.balanceFactor + 1 - Math.max(pivot.balanceFactor, 0);\n  }\n\n  private rotateRight(pivot: Node<K, V>) {\n    let root = pivot.left;\n    pivot.left = root.right;\n    if (root.right !== null) {\n      root.right.parent = pivot;\n    }\n\n    root.parent = pivot.parent;\n    if (root.parent === null) {\n      this.root = root;\n    } else if (pivot.isLeftChild) {\n      root.parent.left = root;\n    } else {\n      root.parent.right = root;\n    }\n\n    root.right = pivot;\n    pivot.parent = root;\n    pivot.balanceFactor = pivot.balanceFactor - 1 - Math.min(root.balanceFactor, 0);\n    root.balanceFactor = root.balanceFactor - 1 - Math.max(pivot.balanceFactor, 0);\n  }\n\n  *[Symbol.iterator](): IterableIterator<[K, V]> {\n    for (let iter of this.getIterator()) {\n      yield iter;\n    }\n  }\n\n  *getIterator(key: K = null): IterableIterator<[K, V]> {\n    let currentNode = this.root;\n    while (currentNode) {\n      if (this.isEqual(key, currentNode.key) || ((key === null) && !currentNode.left)) {\n        break;\n      }\n\n      if (this.isLessThan(key, currentNode.key) || (key === null)) {\n        currentNode = currentNode.left;\n      } else {\n        currentNode = currentNode.right;\n      }\n    }\n\n    if (!currentNode) {\n      return null;\n    }\n\n    let fromleft = true;\n    for (;;) {\n      if (fromleft) {\n        yield [currentNode.key, currentNode.value];\n        fromleft = false;\n\n        if (currentNode.right) {\n          currentNode = currentNode.right;\n          while (currentNode.left) {\n            currentNode = currentNode.left;\n          }\n          fromleft = true;\n        } else if (currentNode.parent) {\n          fromleft = (currentNode.parent.left === currentNode);\n          currentNode = currentNode.parent;\n        } else {\n          break;\n        }\n      } else if (currentNode.parent) {\n        fromleft = (currentNode.parent.left === currentNode);\n        currentNode = currentNode.parent;\n      } else {\n        break;\n      }\n    }\n\n    return null;\n  }\n\n  *getReverseIterator(key: K = null): IterableIterator<[K, V]> {\n    let currentNode = this.root;\n    while (currentNode) {\n      if (this.isEqual(key, currentNode.key) || ((key === null) && !currentNode.right)) {\n        break;\n      }\n\n      if (!this.isLessThan(key, currentNode.key) || (key === null)) {\n        currentNode = currentNode.right;\n      } else {\n        currentNode = currentNode.left;\n      }\n    }\n\n    if (!currentNode) {\n      return null;\n    }\n\n    let fromright = true;\n    for (;;) {\n      if (fromright) {\n        yield [currentNode.key, currentNode.value];\n        fromright = false;\n\n        if (currentNode.left) {\n          currentNode = currentNode.left;\n          while (currentNode.right) {\n            currentNode = currentNode.right;\n          }\n          fromright = true;\n        } else if (currentNode.parent) {\n          fromright = (currentNode.parent.right === currentNode);\n          currentNode = currentNode.parent;\n        } else {\n          break;\n        }\n      } else if (currentNode.parent) {\n        fromright = (currentNode.parent.right === currentNode);\n        currentNode = currentNode.parent;\n      } else {\n        break;\n      }\n    }\n\n    return null;\n  }\n}\n\nexport { Map, Less, Equal, TreeMapInterface, TreeMap };\n","import { TreeMap } from './utils/tree';\n\ninterface CacheEntry<T> {\n  value: T;\n  revision: number;\n  isValid: boolean;\n}\n\nclass Entry<T> implements CacheEntry<T> {\n  value: T;\n  revision: number;\n\n  constructor(value: T, revision: number) {\n    this.value = value;\n    this.revision = (revision || 0);\n  }\n\n  get isValid(): boolean {\n    return true;\n  }\n}\n\nclass Tombstone<T> implements CacheEntry<T> {\n  value: T;\n  revision: number;\n\n  constructor(revision: number) {\n    this.revision = revision;\n  }\n\n  get isValid(): boolean {\n    return false;\n  }\n}\n\nclass Cache<K, V> {\n  public readonly items: TreeMap<K, CacheEntry<V>>;\n\n  constructor() {\n    this.items = new TreeMap<K, CacheEntry<V>>();\n  }\n\n  store(key: K, value: V, revision: number): V {\n    let entry = this.items.get(key);\n    if (entry && entry.revision > revision) {\n      if (entry.isValid) {\n        return entry.value;\n      }\n      return null;\n    }\n    this.items.set(key, new Entry<V>(value, revision));\n    return value;\n  }\n\n  delete(key: K, revision: number, force: boolean = false): void {\n    let curr = this.items.get(key);\n    if (!curr || curr.revision < revision ||\n      (curr && force === true) /* forced delete when revision is unknown */) {\n      this.items.set(key, new Tombstone<V>(revision));\n    }\n  }\n\n  isKnown(key: K, revision: number): boolean {\n    let curr = this.items.get(key);\n    return curr && curr.revision >= revision;\n  }\n\n  get(key: K): V {\n    let entry = this.items.get(key);\n    if (entry && entry.isValid) {\n      return entry.value;\n    }\n    return null;\n  }\n\n  has(key: K): boolean {\n    let entry = this.items.get(key);\n    return entry && entry.isValid;\n  }\n\n  forEach(callbackfn: (key: K, value: V) => void): void {\n    if (this.items) {\n      for (let [key, entry] of this.items) {\n        if (entry.isValid) {\n          callbackfn(key, entry.value);\n        }\n      }\n    }\n  }\n}\n\nexport { Cache };\nexport default Cache;\n","import { deepClone, isPositiveInteger, validatePageSize } from './utils/sanitize';\nimport { UriBuilder } from './utils/uri';\nimport { SyncError } from './utils/syncerror';\nimport log from './utils/logger';\n\nimport { SyncEntity, EntityServices, RemovalHandler } from './entity';\nimport { SyncListItem } from './synclistitem';\nimport { Paginator } from './paginator';\nimport { Cache } from './cache';\n\nimport { Mutator } from './interfaces/mutator';\nimport { NamespacedMergingQueue } from './mergingqueue';\nimport Closeable from './closeable';\nimport { custom, nonNegativeInteger, objectSchema, pureObject, validateTypesAsync } from '@twilio/declarative-type-validator';\n\ninterface SyncListServices extends EntityServices {\n}\n\ninterface SyncListDescriptor {\n  sid: string;\n  url: string;\n  revision: string;\n  last_event_id: number;\n  links: any;\n  unique_name: string;\n  date_updated: Date;\n  date_expires: string;\n}\n\n/**\n * List item metadata.\n */\ninterface SyncListItemMetadata {\n  /**\n   * Specifies the time-to-live in seconds after which the list item is subject to automatic deletion.\n   * The value 0 means infinity.\n   */\n  ttl?: number;\n}\n\n/**\n * List item query options.\n */\ninterface SyncListItemQueryOptions {\n  /**\n   * Item index, which should be used as the offset.\n   * If undefined, starts from the beginning or end depending on queryOptions.order.\n   */\n  from?: number;\n\n  /**\n   * Results page size. Default is 50.\n   */\n  pageSize?: number;\n\n  /**\n   * Numeric order of results. Default is \"asc\".\n   */\n  order?: 'asc' | 'desc';\n\n  /**\n   * Query limit.\n   */\n  limit: number;\n}\n\nclass SyncListImpl extends SyncEntity {\n  private descriptor: SyncListDescriptor;\n  private updateMergingQueue: NamespacedMergingQueue<number, SyncListItemMetadata, SyncListItem>;\n  private cache: Cache<number, SyncListItem>;\n  private context: Object;\n  private contextEventId: number;\n\n  /**\n   * @private\n   */\n  constructor(services: SyncListServices, descriptor: SyncListDescriptor, removalHandler: RemovalHandler) {\n    super(services, removalHandler);\n\n    const updateRequestReducer = (acc, input) => (typeof input.ttl === 'number') ? {ttl: input.ttl}\n      : acc;\n    this.updateMergingQueue = new NamespacedMergingQueue<number, SyncListItemMetadata, SyncListItem>(updateRequestReducer);\n    this.cache = new Cache<number, SyncListItem>();\n    this.descriptor = descriptor;\n    this.descriptor.date_updated = new Date(this.descriptor.date_updated);\n  }\n\n  // private props\n  get uri(): string {\n    return this.descriptor.url;\n  }\n\n  get revision(): string {\n    return this.descriptor.revision;\n  }\n\n  get lastEventId(): number {\n    return this.descriptor.last_event_id;\n  }\n\n  get links() {\n    return this.descriptor.links;\n  }\n\n  get dateExpires() {\n    return this.descriptor.date_expires;\n  }\n\n  static get type() {\n    return 'list';\n  }\n\n  get type() {\n    return 'list';\n  }\n\n  // below properties are specific to Insights only\n  get indexName(): string {\n    return undefined;\n  }\n\n  get queryString(): string {\n    return undefined;\n  }\n\n  // public props, documented along with class description\n  get sid(): string {\n    return this.descriptor.sid;\n  }\n\n  get uniqueName(): string {\n    return this.descriptor.unique_name || null;\n  }\n\n  get dateUpdated(): Date {\n    return this.descriptor.date_updated;\n  }\n\n  private async _addOrUpdateItemOnServer(url: string, data: Object, ifMatch: string, ttl: number) {\n    const requestBody: any = {data};\n\n    if (ttl !== undefined) {\n      requestBody.ttl = ttl;\n    }\n\n    const response = await this.services.network.post(url, requestBody, ifMatch);\n    response.body.data = data;\n    response.body.date_updated = new Date(response.body.date_updated);\n\n    return response.body;\n  }\n\n  public async push(value, itemMetadata?: SyncListItemMetadata) {\n    let ttl = (itemMetadata || {}).ttl;\n    let item = await this._addOrUpdateItemOnServer(this.links.items, value, undefined, ttl);\n    let index = Number(item.index);\n    this._handleItemMutated(index, item.url, item.last_event_id, item.revision, value, item.date_updated, item.date_expires, true, false);\n    return this.cache.get(index);\n  }\n\n  public async set(index: number, value: Object, itemMetadataUpdates?: SyncListItemMetadata) {\n    const input: SyncListItemMetadata = itemMetadataUpdates || {};\n    return this.updateMergingQueue.squashAndAdd(index, input, (input) => this._updateItemUnconditionally(index, value, input.ttl));\n  }\n\n  private async _updateItemUnconditionally(index: number, data: Object, ttl?: number): Promise<SyncListItem> {\n    let existingItem = await this.get(index);\n    const itemDescriptor = await this._addOrUpdateItemOnServer(existingItem.uri, data, undefined, ttl);\n    this._handleItemMutated(index, itemDescriptor.url, itemDescriptor.last_event_id, itemDescriptor.revision,\n      itemDescriptor.data, itemDescriptor.date_updated, itemDescriptor.date_expires, false, false);\n    return this.cache.get(index);\n  }\n\n  private async _updateItemWithIfMatch(index: number, mutatorFunction: Mutator, ttl?: number): Promise<SyncListItem> {\n    const existingItem = await this.get(index);\n    const data = mutatorFunction(deepClone(existingItem.data));\n    if (data) {\n      const ifMatch = existingItem.revision;\n      try {\n        const itemDescriptor = await this._addOrUpdateItemOnServer(existingItem.uri, data, ifMatch, ttl);\n        this._handleItemMutated(index, itemDescriptor.url, itemDescriptor.last_event_id, itemDescriptor.revision,\n          itemDescriptor.data, itemDescriptor.date_updated, itemDescriptor.date_expires, false, false);\n        return this.cache.get(index);\n      } catch (error) {\n        if (error.status === 412) {\n          await this._getItemFromServer(index);\n          return this._updateItemWithIfMatch(index, mutatorFunction, ttl);\n        } else {\n          throw error;\n        }\n      }\n    } else {\n      return existingItem;\n    }\n  }\n\n  public async mutate(index: number, mutator: Mutator, itemMetadataUpdates?: SyncListItemMetadata): Promise<SyncListItem> {\n    const input: SyncListItemMetadata = itemMetadataUpdates || {};\n    return this.updateMergingQueue.add(index, input, (input) => this._updateItemWithIfMatch(index, mutator, input.ttl));\n  }\n\n  public async update(index: number, obj: Object, itemMetadataUpdates?: SyncListItemMetadata): Promise<SyncListItem> {\n    return this.mutate(index, remote => Object.assign(remote, obj), itemMetadataUpdates);\n  }\n\n  public async remove(index: number): Promise<void> {\n    const item = await this.get(index);\n    const previousItemData = deepClone(item.data);\n    const response = await this.services.network.delete(item.uri);\n    this._handleItemRemoved(index, response.body.last_event_id, previousItemData, new Date(response.body.date_updated), false);\n  }\n\n  public async get(index: number): Promise<SyncListItem> {\n    let cachedItem = this.cache.get(index);\n    if (cachedItem) {\n      return cachedItem;\n    } else {\n      return this._getItemFromServer(index);\n    }\n  }\n\n  private async _getItemFromServer(index: number): Promise<SyncListItem> {\n    let result = await this.queryItems({index});\n    if (result.items.length < 1) {\n      throw new SyncError(`No item with index ${index} found`, 404, 54151);\n    } else {\n      return result.items[0];\n    }\n  }\n\n  /**\n   * Query items from the List\n   * @private\n   */\n  protected async queryItems(arg): Promise<Paginator<SyncListItem>> {\n    arg = arg || {};\n    const url = new UriBuilder(this.links.items)\n      .queryParam('From', arg.from)\n      .queryParam('PageSize', arg.limit)\n      .queryParam('Index', arg.index)\n      .queryParam('PageToken', arg.pageToken)\n      .queryParam('Order', arg.order)\n      .build();\n\n    let response = await this.services.network.get(url);\n    let items = response.body.items.map(el => {\n      el.date_updated = new Date(el.date_updated);\n      let itemInCache = this.cache.get(el.index);\n      if (itemInCache) {\n        this._handleItemMutated(el.index, el.url, el.last_event_id, el.revision, el.data, el.date_updated, el.date_expires, false, true);\n      } else {\n        this.cache.store(Number(el.index), new SyncListItem({\n          index: Number(el.index),\n          uri: el.url,\n          revision: el.revision,\n          lastEventId: el.last_event_id,\n          dateUpdated: el.date_updated,\n          dateExpires: el.date_expires,\n          data: el.data\n        }), el.last_event_id);\n      }\n      return this.cache.get(el.index);\n    });\n    let meta = response.body.meta;\n    return new Paginator<SyncListItem>(items\n      , pageToken => this.queryItems({pageToken})\n      , meta.previous_token\n      , meta.next_token);\n  }\n\n  async getItems(args): Promise<Paginator<SyncListItem>> {\n    args = args || {};\n    validatePageSize(args.pageSize);\n    args.limit = args.pageSize || args.limit || 50;\n    args.order = args.order || 'asc';\n    return this.queryItems(args);\n  }\n\n  /**\n   * @return {Promise<Object>} Context of List\n   * @private\n   */\n  async getContext(): Promise<Object> {\n    if (!this.context) {\n      let response = await this.services.network.get(this.links.context);\n      // store fetched context if we have't received any newer update\n      this._updateContextIfRequired(response.body.data, response.body.last_event_id);\n    }\n    return this.context;\n  }\n\n  public async setTtl(ttl: number): Promise<void> {\n    try {\n      const requestBody = {ttl};\n      const response = await this.services.network.post(this.uri, requestBody);\n      this.descriptor.date_expires = response.body.date_expires;\n    } catch (error) {\n      if (error.status === 404) {\n        this.onRemoved(false);\n      }\n      throw error;\n    }\n  }\n\n  public async setItemTtl(index: number, ttl: number): Promise<void> {\n    let existingItem = await this.get(index);\n    const requestBody = {ttl};\n    const response = await this.services.network.post(existingItem.uri, requestBody);\n    existingItem.updateDateExpires(response.body.date_expires);\n  }\n\n  async removeList() {\n    await this.services.network.delete(this.uri);\n    this.onRemoved(true);\n  }\n\n  protected onRemoved(locally: boolean) {\n    this._unsubscribe();\n    this.removalHandler(this.type, this.sid, this.uniqueName);\n\n    this.broadcastEventToListeners('removed', {isLocal: locally});\n  }\n\n  private shouldIgnoreEvent(key: number, eventId: number) {\n    return this.cache.isKnown(key, eventId);\n  }\n\n  /**\n   * Handle update, which came from the server.\n   * @private\n   */\n  _update(update, isStrictlyOrdered: boolean): void {\n    const itemIndex = Number(update.item_index);\n    update.date_created = new Date(update.date_created);\n    switch (update.type) {\n      case 'list_item_added':\n      case 'list_item_updated': {\n        this._handleItemMutated(\n          itemIndex,\n          update.item_url,\n          update.id,\n          update.item_revision,\n          update.item_data,\n          update.date_created,\n          undefined, // orchestration does not include date_expires  -- @todo  it does now?\n          update.type === 'list_item_added',\n          true);\n      }\n        break;\n      case 'list_item_removed': {\n        this._handleItemRemoved(itemIndex, update.id, update.item_data, update.date_created, true);\n      }\n        break;\n      case 'list_context_updated': {\n        this._handleContextUpdate(update.context_data, update.id, update.date_created);\n      }\n        break;\n      case 'list_removed': {\n        this.onRemoved(false);\n      }\n        break;\n    }\n\n    if (isStrictlyOrdered) {\n      this._advanceLastEventId(update.id, update.list_revision);\n    }\n  }\n\n  _advanceLastEventId(eventId: number, revision?: string): void {\n    if (this.lastEventId < eventId) {\n      this.descriptor.last_event_id = eventId;\n      if (revision) {\n        this.descriptor.revision = revision;\n      }\n    }\n  }\n\n  private _updateRootDateUpdated(dateUpdated: Date) {\n    if (!this.descriptor.date_updated || dateUpdated.getTime() > this.descriptor.date_updated.getTime()) {\n      this.descriptor.date_updated = dateUpdated;\n      this.services.storage.update(this.type, this.sid, this.uniqueName, {date_updated: dateUpdated});\n    }\n  }\n\n  private _handleItemMutated(\n    index: number,\n    uri: string,\n    lastEventId: number,\n    revision: string,\n    data: Object,\n    dateUpdated: Date,\n    dateExpires: string,\n    added: boolean,\n    remote: boolean\n  ): void {\n    if (this.shouldIgnoreEvent(index, lastEventId)) {\n      log.trace(`Item ${index} update skipped, current: ${this.lastEventId}, remote: ${lastEventId}`);\n      return;\n    }\n\n    this._updateRootDateUpdated(dateUpdated);\n    const item = this.cache.get(index);\n\n    if (!item) {\n      const newItem = new SyncListItem({index, uri, lastEventId, revision, data, dateUpdated, dateExpires});\n\n      this.cache.store(index, newItem, lastEventId);\n      this.emitItemMutationEvent(newItem, remote, added);\n\n      return;\n    }\n\n    const previousItemData = deepClone(item.data);\n    item.update(lastEventId, revision, data, dateUpdated);\n    this.cache.store(index, item, lastEventId);\n\n    if (dateExpires !== undefined) {\n      item.updateDateExpires(dateExpires);\n    }\n\n    this.emitItemMutationEvent(item, remote, false, previousItemData);\n  }\n\n  /**\n   * @private\n   */\n  private emitItemMutationEvent(item: SyncListItem, remote: boolean, added: boolean, previousItemData: null | Object = null): void {\n    const eventName = added ? 'itemAdded' : 'itemUpdated';\n    const args: any = {item, isLocal: !remote};\n\n    if (!added) {\n      args.previousItemData = previousItemData;\n    }\n\n    this.broadcastEventToListeners(eventName, args);\n  }\n\n  /**\n   * @private\n   */\n  private _handleItemRemoved(index: number, eventId: number, oldData: Object, dateUpdated: Date, remote: boolean): void {\n    this._updateRootDateUpdated(dateUpdated);\n    this.cache.delete(index, eventId);\n    this.broadcastEventToListeners('itemRemoved', {index: index, isLocal: !remote, previousItemData: oldData});\n  }\n\n  /**\n   * @private\n   */\n  private _handleContextUpdate(data: Object, eventId: number, dateUpdated: Date): void {\n    this._updateRootDateUpdated(dateUpdated);\n    if (this._updateContextIfRequired(data, eventId)) {\n      this.broadcastEventToListeners('contextUpdated', {context: data, isLocal: false});\n    }\n  }\n\n  /**\n   * @private\n   */\n  private _updateContextIfRequired(data: Object, eventId: number): boolean {\n    if (!this.contextEventId || eventId > this.contextEventId) {\n      this.context = data;\n      this.contextEventId = eventId;\n      return true;\n    } else {\n      log.trace('Context update skipped, current:', this.lastEventId, ', remote:', eventId);\n      return false;\n    }\n  }\n}\n\n/**\n * Represents a Sync list, which stores an ordered list of values.\n * Use the {@link SyncClient.list} method to obtain a reference to a Sync list.\n * Information about rate limits can be found [here](https://www.twilio.com/docs/sync/limits).\n */\nclass SyncList extends Closeable {\n  private readonly syncListImpl: SyncListImpl;\n\n  // private props\n  get uri(): string {\n    return this.syncListImpl.uri;\n  }\n\n  get revision(): string {\n    return this.syncListImpl.revision;\n  }\n\n  get lastEventId(): number {\n    return this.syncListImpl.lastEventId;\n  }\n\n  get links() {\n    return this.syncListImpl.links;\n  }\n\n  get dateExpires() {\n    return this.syncListImpl.dateExpires;\n  }\n\n  static get type() {\n    return SyncListImpl.type;\n  }\n\n  get type() {\n    return SyncListImpl.type;\n  }\n\n  /**\n   * Unique ID of the list, immutable identifier assigned by the system.\n   */\n  get sid(): string {\n    return this.syncListImpl.sid;\n  }\n\n  /**\n   * Unique name of the list, immutable identifier that can be assigned to the list during creation.\n   */\n  get uniqueName(): string {\n    return this.syncListImpl.uniqueName;\n  }\n\n  /**\n   * Date when the list was last updated, given in UTC ISO 8601 format (e.g., '2018-04-26T15:23:19.732Z').\n   */\n  get dateUpdated(): Date {\n    return this.syncListImpl.dateUpdated;\n  }\n\n  /**\n   * @internal\n   */\n  constructor(syncListImpl: SyncListImpl) {\n    super();\n    this.syncListImpl = syncListImpl;\n    this.syncListImpl.attach(this);\n  }\n\n  /**\n   * Fired when a new item appears in the list, regardless of whether its creator was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * {@link SyncListItem} `item` - added item\n   *     * boolean `isLocal` - equals true if the item was added by a local actor, false otherwise\n   * @example\n   * ```typescript\n   * list.on('itemAdded', (args) => {\n   *   console.log(`List item ${args.item.index} was added`);\n   *   console.log('args.item.data:', args.item.data);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemAdded = 'itemAdded';\n\n  /**\n   * Fired when a list item is updated (not added or removed, but changed), regardless of whether the updater was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * {@link SyncListItem} `item` - updated item\n   *     * boolean `isLocal` - equals true if the item was updated by a local actor, false otherwise\n   *     * object `previousItemData` - contains a snapshot of the item data before the update\n   * @example\n   * ```typescript\n   * list.on('itemUpdated', (args) => {\n   *   console.log(`List item ${args.item.index} was updated`);\n   *   console.log('args.item.data:', args.item.data);\n   *   console.log('args.isLocal:', args.isLocal);\n   *   console.log('args.previousItemData:', args.previousItemData);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemUpdated = 'itemUpdated';\n\n  /**\n   * Fired when a list item is removed, regardless of whether the remover was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * number `index` - index of the removed item\n   *     * boolean `isLocal` - equals true if the item was removed by a local actor, false otherwise\n   *     * object `previousItemData` - contains a snapshot of the item data before the removal\n   * @example\n   * ```typescript\n   * list.on('itemRemoved', (args) => {\n   *   console.log(`List item ${args.index} was removed`);\n   *   console.log('args.previousItemData:', args.previousItemData);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemRemoved = 'itemRemoved';\n\n  /**\n   * Fired when a list is deleted entirely, by any actor local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * boolean `isLocal` - equals true if the list was removed by a local actor, false otherwise\n   * @example\n   * ```typescript\n   * list.on('removed', (args) => {\n   *   console.log(`List ${list.sid} was removed`);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly removed = 'removed';\n\n  /**\n   * Add a new item to the list.\n   * @param data Data to be added.\n   * @param itemMetadata Item metadata.\n   * @return The newly added item.\n   * @example\n   * ```typescript\n   * list.push({ name: 'John Smith' }, { ttl: 86400 })\n   *   .then((item) => {\n   *     console.log(`List Item push() successful, item index: ${item.index}, data:`, item.data)\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item push() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    pureObject,\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n\n  public async push(data, itemMetadata?: SyncListItemMetadata): Promise<SyncListItem> {\n    this.ensureNotClosed();\n    return this.syncListImpl.push(data, itemMetadata);\n  }\n\n  /**\n   * Assign new data to an existing item, given its index.\n   * @param index Index of the item to be updated.\n   * @param value New data to be assigned to an item.\n   * @param itemMetadataUpdates New item metadata.\n   * @return A promise with the updated item containing latest known data.\n   * The promise will be rejected if the item does not exist.\n   * @example\n   * ```typescript\n   * list.set(42, { name: 'John Smith' }, { ttl: 86400 })\n   *   .then((item) => {\n   *     console.log('List Item set() successful, item data:', item.data)\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item set() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    nonNegativeInteger,\n    pureObject,\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n\n  public async set(index: number, value: Object, itemMetadataUpdates?: SyncListItemMetadata): Promise<SyncListItem> {\n    this.ensureNotClosed();\n    return this.syncListImpl.set(index, value, itemMetadataUpdates);\n  }\n\n  /**\n   * Modify an existing item by applying a mutation function to it.\n   * @param index Index of the item to be changed.\n   * @param mutator A function that outputs a new data based on the existing data.\n   * @param itemMetadataUpdates New item metadata.\n   * @return Resolves with the most recent item state, the output of a successful\n   * mutation or a state that prompted graceful cancellation (mutator returned `null`). This promise\n   * will be rejected if the indicated item does not already exist.\n   * @example\n   * ```typescript\n   * const mutatorFunction = (currentValue) => {\n   *     currentValue.viewCount = (currentValue.viewCount || 0) + 1;\n   *     return currentValue;\n   * };\n   * list.mutate(42, mutatorFunction, { ttl: 86400 })\n   *   .then((item) => {\n   *     console.log('List Item mutate() successful, new data:', item.data)\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item mutate() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    nonNegativeInteger,\n    'function',\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n\n  public async mutate(index: number, mutator: Mutator, itemMetadataUpdates?: SyncListItemMetadata): Promise<SyncListItem> {\n    this.ensureNotClosed();\n    return this.syncListImpl.mutate(index, mutator, itemMetadataUpdates);\n  }\n\n  /**\n   * Modify an existing item by appending new fields (or overwriting existing ones) with the values from the object.\n   * This is equivalent to\n   * ```typescript\n   * list.mutate(42, (currentValue) => Object.assign(currentValue, obj));\n   * ```\n   * @param index Index of an item to be changed.\n   * @param obj Set of fields to update.\n   * @param itemMetadataUpdates New item metadata.\n   * @return A promise with a modified item containing latest known data.\n   * The promise will be rejected if the item was not found.\n   * @example\n   * ```typescript\n   * // Say, the List Item (index: 42) data is `{ name: 'John Smith' }`\n   * list.update(42, { age: 34 }, { ttl: 86400 })\n   *   .then((item) => {\n   *     // Now the List Item data is `{ name: 'John Smith', age: 34 }`\n   *     console.log('List Item update() successful, new data:', item.data);\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item update() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    nonNegativeInteger,\n    pureObject,\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n  public async update(index: number, obj: Object, itemMetadataUpdates?: SyncListItemMetadata): Promise<SyncListItem> {\n    this.ensureNotClosed();\n    return this.syncListImpl.update(index, obj, itemMetadataUpdates);\n  }\n\n  /**\n   * Delete an item given its index.\n   * @param index Index of the item to be removed.\n   * @return A promise to remove the item.\n   * The promise will be rejected if the item was not found.\n   * @example\n   * ```typescript\n   * list.remove(42)\n   *   .then(() => {\n   *     console.log('List Item remove() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item remove() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger)\n  public async remove(index: number): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncListImpl.remove(index);\n  }\n\n  /**\n   * Retrieve an item by List index.\n   * @param index Item index in the list.\n   * @return A promise with the item containing latest known data.\n   * The promise will be rejected if the item was not found.\n   * @example\n   * ```typescript\n   * list.get(42)\n   *   .then((item) => {\n   *     console.log('List Item get() successful, item data:', item.data)\n   *   })\n   *   .catch((error) => {\n   *     console.error('List Item get() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger)\n  public async get(index: number): Promise<SyncListItem> {\n    this.ensureNotClosed();\n    return this.syncListImpl.get(index);\n  }\n\n  /**\n   * Retrieve a list context\n   * @return A promise with the list's context\n   * @internal\n   */\n  public async getContext(): Promise<Object> {\n    this.ensureNotClosed();\n    return this.syncListImpl.getContext();\n  }\n\n  /**\n   * Query a list of items from collection.\n   * Information about the query limits can be found {@link https://www.twilio.com/docs/sync/limits|here}.\n   * @param queryOptions Query options.\n   * @example\n   * ```typescript\n   * const pageHandler = (paginator) => {\n   *   paginator.items.forEach((item) => {\n   *     console.log(`Item ${item.index}:`, item.data);\n   *   });\n   *   return paginator.hasNextPage\n   *     ? paginator.nextPage().then(pageHandler)\n   *     : null;\n   * };\n   * list.getItems({ from: 0, order: 'asc' })\n   *   .then(pageHandler)\n   *   .catch((error) => {\n   *     console.error('List getItems() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync([\n    'undefined',\n    objectSchema('query options', {\n      from: [nonNegativeInteger, 'undefined'],\n      pageSize: [custom((value) => [isPositiveInteger(value), 'a positive integer']), 'undefined']\n    })\n  ])\n  async getItems(queryOptions: SyncListItemQueryOptions): Promise<Paginator<SyncListItem>> {\n    this.ensureNotClosed();\n    return this.syncListImpl.getItems(queryOptions);\n  }\n\n  /**\n   * Update the time-to-live of the list.\n   * @param ttl Specifies the TTL in seconds after which the list is subject to automatic deletion. The value 0 means infinity.\n   * @return A promise that resolves after the TTL update was successful.\n   * @example\n   * ```typescript\n   * list.setTtl(3600)\n   *   .then(() => {\n   *     console.log('List setTtl() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('List setTtl() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger)\n  public async setTtl(ttl: number): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncListImpl.setTtl(ttl);\n  }\n\n  /**\n   * Update the time-to-live of a list item.\n   * @param index Item index.\n   * @param ttl Specifies the TTL in seconds after which the list item is subject to automatic deletion. The value 0 means infinity.\n   * @return A promise that resolves after the TTL update was successful.\n   * @example\n   * ```typescript\n   * list.setItemTtl(42, 86400)\n   *   .then(() => {\n   *     console.log('List setItemTtl() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('List setItemTtl() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger, nonNegativeInteger)\n  public async setItemTtl(index: number, ttl: number): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncListImpl.setItemTtl(index, ttl);\n  }\n\n  /**\n   * Delete this list. It will be impossible to restore it.\n   * @return A promise that resolves when the list has been deleted.\n   * @example\n   * list.removeList()\n   *   .then(() => {\n   *     console.log('List removeList() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('List removeList() failed', error);\n   *   });\n   */\n  async removeList(): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncListImpl.removeList();\n  }\n\n  /**\n   * Conclude work with the list instance and remove all event listeners attached to it.\n   * Any subsequent operation on this object will be rejected with error.\n   * Other local copies of this list will continue operating and receiving events normally.\n   * @example\n   * ```typescript\n   * list.close();\n   * ```\n   */\n  public close(): void {\n    super.close();\n    this.syncListImpl.detach(this.listenerUuid);\n  }\n\n}\n\nexport { SyncListItemMetadata, SyncListItemQueryOptions, SyncListServices, SyncListDescriptor, Mutator, SyncList, SyncListImpl };\nexport default SyncList;\n","export interface SyncMapItemDescriptor {\n  key: string;\n  url: string;\n  revision: string;\n  last_event_id: number;\n  date_updated: Date;\n  date_expires: string;\n  data: Object;\n}\n\n/**\n * Represents an individual element in a Sync map.\n */\nclass SyncMapItem {\n  private readonly descriptor: SyncMapItemDescriptor;\n\n  /**\n   * @internal\n   */\n  constructor(descriptor: SyncMapItemDescriptor) {\n    this.descriptor = descriptor;\n  }\n\n  get uri(): string {\n    return this.descriptor.url;\n  }\n\n  get revision(): string {\n    return this.descriptor.revision;\n  }\n\n  get lastEventId(): number {\n    return this.descriptor.last_event_id;\n  }\n\n  get dateExpires(): string {\n    return this.descriptor.date_expires;\n  }\n\n  /**\n   * The identifier that maps to this item within the containing Map.\n   */\n  get key(): string {\n    return this.descriptor.key;\n  }\n\n  /**\n   * The contents of the item.\n   */\n  get data(): Object {\n    return this.descriptor.data;\n  }\n\n  /**\n   * Date when the map item was last updated.\n   */\n  get dateUpdated(): Date {\n    return this.descriptor.date_updated;\n  }\n\n  /**\n   * @internal\n   */\n  update(eventId: number, revision: string, value: Object, dateUpdated: Date): SyncMapItem {\n    this.descriptor.last_event_id = eventId;\n    this.descriptor.revision = revision;\n    this.descriptor.data = value;\n    this.descriptor.date_updated = dateUpdated;\n    return this;\n  }\n\n  /**\n   * @internal\n   */\n  updateDateExpires(dateExpires: string) {\n    this.descriptor.date_expires = dateExpires;\n  }\n}\n\nexport { SyncMapItem };\n","import { deepClone, isPositiveInteger, validatePageSize } from './utils/sanitize';\nimport { UriBuilder } from './utils/uri';\nimport { SyncError } from './utils/syncerror';\nimport log from './utils/logger';\n\nimport { SyncEntity, EntityServices, RemovalHandler } from './entity';\nimport { SyncMapItemDescriptor, SyncMapItem } from './syncmapitem';\nimport { Paginator } from './paginator';\nimport { Cache } from './cache';\n\nimport { Mutator } from './interfaces/mutator';\nimport { NamespacedMergingQueue } from './mergingqueue';\nimport { Closeable } from './closeable';\nimport { validateTypesAsync, nonNegativeInteger, pureObject, objectSchema, custom } from '@twilio/declarative-type-validator';\n\nexport interface SyncMapServices extends EntityServices {\n}\n\nexport interface SyncMapDescriptor {\n  sid: string;\n  url: string;\n  revision: string;\n  last_event_id: number;\n  links: any;\n  unique_name: string;\n  date_updated: Date;\n  date_expires: string;\n\n  items?: SyncMapItemDescriptor[];\n}\n\ninterface PutItemResult {\n  item: SyncMapItemDescriptor;\n  added: boolean;\n}\n\n/**\n * Map item metadata.\n */\ninterface SyncMapItemMetadata {\n  /**\n   * Specifies the time-to-live in seconds after which the map item is subject to automatic deletion.\n   * The value 0 means infinity.\n   */\n  ttl?: number;\n}\n\n/**\n * Map item query options.\n */\ninterface SyncMapItemQueryOptions {\n  /**\n   * SyncMapItem key, which should be used as the offset. If undefined, starts from the beginning or end depending\n   * on queryOptions.order.\n   */\n  from?: string;\n\n  /**\n   * Result page size.\n   */\n  pageSize?: number | string;\n\n  /**\n   * Lexicographical order of results.\n   */\n  order?: 'asc' | 'desc';\n\n  key?: string;\n\n  limit?: number;\n}\n\nclass SyncMapImpl extends SyncEntity {\n  private readonly descriptor: SyncMapDescriptor;\n  private readonly updateMergingQueue: NamespacedMergingQueue<string, SyncMapItemMetadata, SyncMapItem>;\n  private readonly cache: Cache<string, SyncMapItem>;\n\n  /**\n   * @private\n   */\n  constructor(services: SyncMapServices, descriptor: SyncMapDescriptor, removalHandler: RemovalHandler) {\n    super(services, removalHandler);\n    const updateRequestReducer = (acc, input) => (typeof input.ttl === 'number') ? {ttl: input.ttl}\n      : acc;\n    this.updateMergingQueue = new NamespacedMergingQueue<string, SyncMapItemMetadata, SyncMapItem>(updateRequestReducer);\n    this.cache = new Cache<string, SyncMapItem>();\n    this.descriptor = descriptor;\n    this.descriptor.date_updated = new Date(this.descriptor.date_updated);\n\n    if (descriptor.items) {\n      descriptor.items.forEach(itemDescriptor => {\n        itemDescriptor.date_updated = new Date(itemDescriptor.date_updated);\n        this.cache.store(itemDescriptor.key, new SyncMapItem(itemDescriptor), itemDescriptor.last_event_id);\n      });\n    }\n  }\n\n  // private props\n  get uri(): string {\n    return this.descriptor.url;\n  }\n\n  get links(): any {\n    return this.descriptor.links;\n  }\n\n  get revision(): string {\n    return this.descriptor.revision;\n  }\n\n  get lastEventId(): number {\n    return this.descriptor.last_event_id;\n  }\n\n  get dateExpires(): string {\n    return this.descriptor.date_expires;\n  }\n\n  static get type() {\n    return 'map';\n  }\n\n  get type() {\n    return 'map';\n  }\n\n  // below properties are specific to Insights only\n  get indexName(): string {\n    return undefined;\n  }\n\n  get queryString(): string {\n    return undefined;\n  }\n\n  // public props, documented along with class description\n  get sid() {\n    return this.descriptor.sid;\n  }\n\n  get uniqueName() {\n    return this.descriptor.unique_name || null;\n  }\n\n  get dateUpdated(): Date {\n    return this.descriptor.date_updated;\n  }\n\n  public async set(key: string, value: Object, itemMetadataUpdates?: SyncMapItemMetadata) {\n    const input: SyncMapItemMetadata = itemMetadataUpdates || {};\n    return this.updateMergingQueue.squashAndAdd(key, input, (input) => this._putItemUnconditionally(key, value, input.ttl));\n  }\n\n  public async get(key: string): Promise<SyncMapItem> {\n    if (key === null || key === undefined) {\n      throw new SyncError('SyncMapItem key may not be empty', 400, 54209);\n    }\n\n    if (this.cache.has(key)) {\n      return this.cache.get(key);\n    } else {\n      return this._getItemFromServer(key);\n    }\n  }\n\n  private async _getItemFromServer(key: string): Promise<SyncMapItem> {\n    let result = await this.queryItems({key: key});\n    if (result.items.length < 1) {\n      throw new SyncError(`The specified Map Item does not exist`, 404, 54201);\n    } else {\n      return result.items[0];\n    }\n  }\n\n  public async mutate(key: string, mutator: Mutator, itemMetadataUpdates?: SyncMapItemMetadata): Promise<SyncMapItem> {\n    const input: SyncMapItemMetadata = itemMetadataUpdates || {};\n    return this.updateMergingQueue.add(key, input, (input) => this._putItemWithIfMatch(key, mutator, input.ttl));\n  }\n\n  public async update(key: string, obj: Object, itemMetadataUpdates?: SyncMapItemMetadata): Promise<SyncMapItem> {\n    return this.mutate(key, remote => Object.assign(remote, obj), itemMetadataUpdates);\n  }\n\n  private async _putItemUnconditionally(key: string, data: Object, ttl: number): Promise<SyncMapItem> {\n    const result: PutItemResult = await this._putItemToServer(key, data, undefined, ttl);\n    const item = result.item;\n    this._handleItemMutated(item.key, item.url, item.last_event_id, item.revision, item.data,\n      item.date_updated, item.date_expires, result.added, false);\n    return this.cache.get(item.key);\n  }\n\n  private async _putItemWithIfMatch(key: string, mutatorFunction: Mutator, ttl: number): Promise<SyncMapItem> {\n    const currentItem = await this.get(key)\n      .catch(error => {\n        if (error.status === 404) {\n          // PUT /Items/myKey with `If-Match: -1` acts as \"put if not exists\"\n          return new SyncMapItem({key: key, data: {}, last_event_id: -1, revision: '-1', url: null, date_updated: null, date_expires: null});\n        } else {\n          throw error;\n        }\n      });\n    let data = mutatorFunction(deepClone(currentItem.data));\n    if (data) {\n      let ifMatch = currentItem.revision;\n      try {\n        const result: PutItemResult = await this._putItemToServer(key, data, ifMatch, ttl);\n        const item = result.item;\n        this._handleItemMutated(item.key, item.url, item.last_event_id, item.revision, item.data,\n          item.date_updated, item.date_expires, result.added, false);\n        return this.cache.get(item.key);\n      } catch (error) {\n        if (error.status === 412) {\n          await this._getItemFromServer(key);\n          return this._putItemWithIfMatch(key, mutatorFunction, ttl);\n        } else {\n          throw error;\n        }\n      }\n    } else {\n      return currentItem;\n    }\n  }\n\n  private async _putItemToServer(key: string, data: Object, ifMatch: string, ttl: number): Promise<PutItemResult> {\n    const url = new UriBuilder(this.links.items).pathSegment(key).build();\n    const requestBody: any = {data};\n\n    if (ttl !== undefined) {\n      requestBody.ttl = ttl;\n    }\n\n    try {\n      const response = await this.services.network.put(url, requestBody, ifMatch);\n      const mapItemDescriptor = response.body;\n      mapItemDescriptor.data = data; // The server does not return the data in the response\n      mapItemDescriptor.date_updated = new Date(mapItemDescriptor.date_updated);\n      const added = response.status.code === 201;\n      return {added, item: mapItemDescriptor};\n    } catch (error) {\n      if (error.status === 404) {\n        this.onRemoved(false);\n      }\n      throw error;\n    }\n  }\n\n  async remove(key: string): Promise<void> {\n    const item = await this.get(key);\n    const previousItemData = deepClone(item.data);\n    const response = await this.services.network.delete(item.uri);\n    this._handleItemRemoved(key, response.body.last_event_id, previousItemData, new Date(response.body.date_updated), false);\n  }\n\n  /**\n   * @private\n   */\n  protected async queryItems(args?): Promise<Paginator<SyncMapItem>> {\n    args = args || {};\n    const uri = new UriBuilder(this.links.items)\n      .queryParam('From', args.from)\n      .queryParam('PageSize', args.limit)\n      .queryParam('Key', args.key)\n      .queryParam('PageToken', args.pageToken)\n      .queryParam('Order', args.order)\n      .build();\n\n    let response = await this.services.network.get(uri);\n    let items = response.body.items.map(el => {\n      el.date_updated = new Date(el.date_updated);\n      let itemInCache = this.cache.get(el.key);\n      if (itemInCache) {\n        this._handleItemMutated(el.key, el.url, el.last_event_id, el.revision, el.data, el.date_updated, el.date_expires, false, true);\n      } else {\n        this.cache.store(el.key, new SyncMapItem(el), el.last_event_id);\n      }\n      return this.cache.get(el.key);\n    });\n    const meta = response.body.meta;\n    return new Paginator<SyncMapItem>(items\n      , pageToken => this.queryItems({pageToken})\n      , meta.previous_token\n      , meta.next_token);\n  }\n\n  async getItems(args?: any): Promise<Paginator<SyncMapItem>> {\n    args = args || {};\n    validatePageSize(args.pageSize);\n    args.limit = args.pageSize || args.limit || 50;\n    args.order = args.order || 'asc';\n    return this.queryItems(args);\n  }\n\n  private shouldIgnoreEvent(key: string, eventId: number) {\n    return this.cache.isKnown(key, eventId);\n  }\n\n  /**\n   * Handle update from the server\n   * @private\n   */\n  _update(update, isStrictlyOrdered: boolean): void {\n    update.date_created = new Date(update.date_created);\n    switch (update.type) {\n      case 'map_item_added':\n      case 'map_item_updated': {\n        this._handleItemMutated(\n          update.item_key,\n          update.item_url,\n          update.id,\n          update.item_revision,\n          update.item_data,\n          update.date_created,\n          undefined, // orchestration events do not include date_expires\n          update.type === 'map_item_added',\n          true);\n      }\n        break;\n      case 'map_item_removed': {\n        this._handleItemRemoved(update.item_key, update.id, update.item_data, update.date_created, true);\n      }\n        break;\n      case 'map_removed': {\n        this.onRemoved(false);\n      }\n        break;\n    }\n\n    if (isStrictlyOrdered) {\n      this._advanceLastEventId(update.id, update.map_revision);\n    }\n  }\n\n  _advanceLastEventId(eventId: number, revision?: string): void {\n    if (this.lastEventId < eventId) {\n      this.descriptor.last_event_id = eventId;\n      if (revision) {\n        this.descriptor.revision = revision;\n      }\n    }\n  }\n\n  private _updateRootDateUpdated(dateUpdated: Date) {\n    if (!this.descriptor.date_updated || dateUpdated.getTime() > this.descriptor.date_updated.getTime()) {\n      this.descriptor.date_updated = dateUpdated;\n      this.services.storage.update(this.type, this.sid, this.uniqueName, {date_updated: dateUpdated});\n    }\n  }\n\n  private _handleItemMutated(\n    key: string,\n    url: string,\n    lastEventId: number,\n    revision: string,\n    data: Object,\n    dateUpdated: Date,\n    dateExpires: string,\n    added: boolean,\n    remote: boolean\n  ): void {\n    if (this.shouldIgnoreEvent(key, lastEventId)) {\n      log.trace('SyncMapItem ', key, ' update skipped, current:', this.lastEventId, ', remote:', lastEventId);\n      return;\n    }\n\n    this._updateRootDateUpdated(dateUpdated);\n    const item = this.cache.get(key);\n\n    if (!item) {\n      const newItem = new SyncMapItem({\n        key: key,\n        url,\n        last_event_id: lastEventId,\n        revision,\n        data,\n        date_updated: dateUpdated,\n        date_expires: dateExpires,\n      });\n\n      this.cache.store(key, newItem, lastEventId);\n      this.emitItemMutationEvent(newItem, remote, added);\n\n      return;\n    }\n\n    const previousItemData = deepClone(item.data);\n    item.update(lastEventId, revision, data, dateUpdated);\n    this.cache.store(key, item, lastEventId);\n\n    if (dateExpires !== undefined) {\n      item.updateDateExpires(dateExpires);\n    }\n\n    this.emitItemMutationEvent(item, remote, false, previousItemData);\n  }\n\n  private emitItemMutationEvent(item: SyncMapItem, remote: boolean, added: boolean, previousItemData: null | Object = null): void {\n    const eventName = added ? 'itemAdded' : 'itemUpdated';\n    const args: any = { item, isLocal: !remote };\n\n    if (!added) {\n      args.previousItemData = previousItemData;\n    }\n\n    this.broadcastEventToListeners(eventName, args);\n  }\n\n  /**\n   * @private\n   */\n  protected _handleItemRemoved(key, eventId, oldData, dateUpdated: Date, remote: boolean) {\n    this._updateRootDateUpdated(dateUpdated);\n    this.cache.delete(key, eventId);\n    this.broadcastEventToListeners('itemRemoved', {key: key, isLocal: !remote, previousItemData: oldData});\n  }\n\n  protected onRemoved(locally: boolean) {\n    this._unsubscribe();\n    this.removalHandler(this.type, this.sid, this.uniqueName);\n    this.broadcastEventToListeners('removed', {isLocal: locally});\n  }\n\n  public async setTtl(ttl: number): Promise<void> {\n    try {\n      const requestBody = {ttl};\n      const response = await this.services.network.post(this.uri, requestBody);\n      this.descriptor.date_expires = response.body.date_expires;\n    } catch (error) {\n      if (error.status === 404) {\n        this.onRemoved(false);\n      }\n      throw error;\n    }\n  }\n\n  public async setItemTtl(key: string, ttl: number): Promise<void> {\n    let existingItem = await this.get(key);\n    const requestBody = {ttl};\n    const response = await this.services.network.post(existingItem.uri, requestBody);\n    existingItem.updateDateExpires(response.body.date_expires);\n  }\n\n  async removeMap() {\n    await this.services.network.delete(this.uri);\n    this.onRemoved(true);\n  }\n}\n\n/**\n * Represents a Sync map, which is a data structure that stores an unordered set of key-value pairs.\n * Use the {@link SyncClient.map} method to obtain a reference to a Sync map.\n * Information about rate limits can be found [here](https://www.twilio.com/docs/sync/limits).\n */\nclass SyncMap extends Closeable {\n  private readonly syncMapImpl: SyncMapImpl;\n\n  // private props\n  get uri(): string {\n    return this.syncMapImpl.uri;\n  }\n\n  get links(): any {\n    return this.syncMapImpl.links;\n  }\n\n  get revision(): string {\n    return this.syncMapImpl.revision;\n  }\n\n  get lastEventId(): number {\n    return this.syncMapImpl.lastEventId;\n  }\n\n  get dateExpires(): string {\n    return this.syncMapImpl.dateExpires;\n  }\n\n  static get type() {\n    return SyncMapImpl.type;\n  }\n\n  get type() {\n    return SyncMapImpl.type;\n  }\n\n  /**\n   * An immutable identifier (a SID) assigned by the system on creation.\n   */\n  get sid() {\n    return this.syncMapImpl.sid;\n  }\n\n  /**\n   * An optional immutable identifier that may be assigned by the\n   * programmer to this map on creation. Unique among other Maps.\n   */\n  get uniqueName() {\n    return this.syncMapImpl.uniqueName;\n  }\n\n  /**\n   * Date when the map was last updated.\n   */\n  get dateUpdated(): Date {\n    return this.syncMapImpl.dateUpdated;\n  }\n\n  /**\n   * @internal\n   */\n  constructor(syncMapImpl: SyncMapImpl) {\n    super();\n    this.syncMapImpl = syncMapImpl;\n    this.syncMapImpl.attach(this);\n  }\n\n  /**\n   * Fired when a new item appears in the map, regardless of whether its creator was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * {@link SyncMapItem} `item` - added item\n   *     * boolean `isLocal` - equals true if the item was added by a local actor, false otherwise\n   * @example\n   * ```typescript\n   * map.on('itemAdded', (args) => {\n   *   console.log(`Map item ${args.item.key} was added`);\n   *   console.log('args.item.data:', args.item.data);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemAdded = 'itemAdded';\n\n  /**\n   * Fired when a map item is updated (not added or removed, but changed), regardless of whether the updater was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * {@link SyncMapItem} `item` - updated item\n   *     * boolean `isLocal` - equals true if the item was updated by a local actor, false otherwise\n   *     * object `previousItemData` - contains a snapshot of the item data before the update\n   * @example\n   * ```typescript\n   * map.on('itemUpdated', (args) => {\n   *   console.log(`Map item ${args.item.key} was updated`);\n   *   console.log('args.item.data:', args.item.data);\n   *   console.log('args.isLocal:', args.isLocal);\n   *   console.log('args.previousItemData:', args.previousItemData);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemUpdated = 'itemUpdated';\n\n  /**\n   * Fired when a map item is removed, regardless of whether the remover was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * string `key` - the key of the removed item\n   *     * boolean `isLocal` - equals true if the item was added by a local actor, false otherwise\n   *     * object `previousItemData` - contains a snapshot of the item data before removal\n   * @example\n   * ```typescript\n   * map.on('itemRemoved', (args) => {\n   *   console.log(`Map item ${args.key} was removed`);\n   *   console.log('args.previousItemData:', args.previousItemData);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemRemoved = 'itemRemoved';\n\n  /**\n   * Fired when a map is deleted entirely, by any actor local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * boolean `isLocal` - equals true if the map was removed by a local actor, false otherwise\n   * @example\n   * ```typescript\n   * map.on('removed', (args) => {\n   *   console.log(`Map ${map.sid} was removed`);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly removed = 'removed';\n\n  /**\n   * Add a new item to the map with the given key-value pair. Overwrites any data that might already exist with that key.\n   * @param key Unique item identifier.\n   * @param data Data to be set.\n   * @param itemMetadataUpdates New item metadata.\n   * @return Newly added item, or modified one if already exists, with the latest known data.\n   * @example\n   * ```typescript\n   * map.set('myKey', { name: 'John Smith' }, { ttl: 86400 })\n   *   .then((item) => {\n   *     console.log('Map SyncMapItem set() successful, item data:', item.data);\n   *   })\n   *   .catch((error) => {\n   *     console.error('Map SyncMapItem set() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    'string',\n    pureObject,\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n  public async set(key: string, data: Object, itemMetadataUpdates?: SyncMapItemMetadata) {\n    this.ensureNotClosed();\n    return this.syncMapImpl.set(key, data, itemMetadataUpdates);\n  }\n\n  /**\n   * Retrieve an item by key.\n   * @param key Identifies the desired item.\n   * @return A promise that resolves when the item has been fetched.\n   * This promise will be rejected if item was not found.\n   * @example\n   * ```typescript\n   * map.get('myKey')\n   *   .then((item) => {\n   *     console.log('Map SyncMapItem get() successful, item data:', item.data)\n   *   })\n   *   .catch((error) => {\n   *     console.error('Map SyncMapItem get() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync('string')\n  public async get(key: string): Promise<SyncMapItem> {\n    this.ensureNotClosed();\n    return this.syncMapImpl.get(key);\n  }\n\n  /**\n   * Schedules a modification to this Map SyncMapItem that will apply a mutation function.\n   * If no SyncMapItem with the given key exists, it will first be created, having the default data (`{}`).\n   * @param key Selects the map item to be mutated.\n   * @param mutator A function that outputs a new data based on the existing data.\n   * May be called multiple times, particularly if this Map SyncMapItem is modified concurrently by remote code.\n   * If the mutation ultimately succeeds, the Map SyncMapItem will have made the particular transition described\n   * by this function.\n   * @param itemMetadataUpdates New item metadata.\n   * @return Resolves with the most recent item state, the output of a successful\n   * mutation or a state that prompted graceful cancellation (mutator returned `null`).\n   * @example\n   * ```typescript\n   * const mutatorFunction = (currentData) => {\n   *     currentData.viewCount = (currentData.viewCount || 0) + 1;\n   *     return currentData;\n   * };\n   * map.mutate('myKey', mutatorFunction, { ttl: 86400 })\n   *   .then((item) => {\n   *     console.log('Map SyncMapItem mutate() successful, new data:', item.data)\n   *   })\n   *   .catch((error) => {\n   *     console.error('Map SyncMapItem mutate() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    'string',\n    'function',\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n  public async mutate(key: string, mutator: Mutator, itemMetadataUpdates?: SyncMapItemMetadata): Promise<SyncMapItem> {\n    this.ensureNotClosed();\n    return this.syncMapImpl.mutate(key, mutator, itemMetadataUpdates);\n  }\n\n  /**\n   * Modify a map item by appending new fields (or by overwriting existing ones) with the values from\n   * the provided Object. Creates a new item if no item by this key exists, copying all given fields and values\n   * into it.\n   * This is equivalent to\n   * ```typescript\n   * map.mutate('myKey', (currentData) => Object.assign(currentData, obj));\n   * ```\n   * @param key Selects the map item to update.\n   * @param obj Specifies the particular (top-level) attributes that will receive new values.\n   * @param itemMetadataUpdates New item metadata.\n   * @return A promise resolving to the modified item in its new state.\n   * @example\n   * ```typescript\n   * // Say, the Map SyncMapItem (key: `'myKey'`) data is `{ name: 'John Smith' }`\n   * map.update('myKey', { age: 34 }, { ttl: 86400 })\n   *   .then((item) => {\n   *     // Now the Map SyncMapItem data is `{ name: 'John Smith', age: 34 }`\n   *     console.log('Map SyncMapItem update() successful, new data:', item.data);\n   *   })\n   *   .catch((error) => {\n   *     console.error('Map SyncMapItem update() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(\n    'string',\n    pureObject,\n    [\n      'undefined',\n      objectSchema('item metadata', {\n        ttl: [nonNegativeInteger, 'undefined']\n      })\n    ]\n  )\n  public async update(key: string, obj: Object, itemMetadataUpdates?: SyncMapItemMetadata): Promise<SyncMapItem> {\n    this.ensureNotClosed();\n    return this.syncMapImpl.update(key, obj, itemMetadataUpdates);\n  }\n\n  /**\n   * Delete an item, given its key.\n   * @param key Selects the item to delete.\n   * @return A promise to remove an item.\n   * The promise will be rejected if 'key' is undefined or an item was not found.\n   * @example\n   * ```typescript\n   * map.remove('myKey')\n   *   .then(() => {\n   *     console.log('Map SyncMapItem remove() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('Map SyncMapItem remove() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync('string')\n  async remove(key: string): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncMapImpl.remove(key);\n  }\n\n  /**\n   * Get a complete list of items from the map.\n   * Information about the query limits can be found [here](https://www.twilio.com/docs/sync/limits).\n   * @param queryOptions Query options.\n   * @example\n   * ```typescript\n   * const pageHandler = (paginator) => {\n   *   paginator.items.forEach((item) => {\n   *     console.log(`SyncMapItem ${item.key}: `, item.data);\n   *   });\n   *   return paginator.hasNextPage\n   *     ? paginator.nextPage().then(pageHandler)\n   *     : null;\n   * };\n   * map.getItems({ from: 'myKey', order: 'asc' })\n   *   .then(pageHandler)\n   *   .catch((error) => {\n   *     console.error('Map getItems() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync([\n    'undefined',\n    objectSchema('query options', {\n      from: ['string', 'undefined'],\n      pageSize: [custom((value) => [isPositiveInteger(value), 'a positive integer']), 'undefined']\n    })\n  ])\n  async getItems(queryOptions?: SyncMapItemQueryOptions): Promise<Paginator<SyncMapItem>> {\n    this.ensureNotClosed();\n    return this.syncMapImpl.getItems(queryOptions);\n  }\n\n  /**\n   * Update the time-to-live of the map.\n   * @param ttl Specifies the TTL in seconds after which the map is subject to automatic deletion. The value 0 means infinity.\n   * @return A promise that resolves after the TTL update was successful.\n   * @example\n   * ```typescript\n   * map.setTtl(3600)\n   *   .then(() => {\n   *     console.log('Map setTtl() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('Map setTtl() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger)\n  public async setTtl(ttl: number): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncMapImpl.setTtl(ttl);\n  }\n\n  /**\n   * Update the time-to-live of a map item.\n   * @param key SyncMapItem key.\n   * @param ttl Specifies the TTL in seconds after which the map item is subject to automatic deletion. The value 0 means infinity.\n   * @return A promise that resolves after the TTL update was successful.\n   * @example\n   * ```typescript\n   * map.setItemTtl('myKey', 86400)\n   *   .then(() => {\n   *     console.log('Map setItemTtl() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('Map setItemTtl() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync('string', nonNegativeInteger)\n  public async setItemTtl(key: string, ttl: number): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncMapImpl.setItemTtl(key, ttl);\n  }\n\n  /**\n   * Delete this map. It will be impossible to restore it.\n   * @return A promise that resolves when the map has been deleted.\n   * @example\n   * ```typescript\n   * map.removeMap()\n   *   .then(() => {\n   *     console.log('Map removeMap() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('Map removeMap() failed', error);\n   *   });\n   * ```\n   */\n  async removeMap() {\n    this.ensureNotClosed();\n    await this.syncMapImpl.removeMap();\n  }\n\n  /**\n   * Conclude work with the map instance and remove all event listeners attached to it.\n   * Any subsequent operation on this object will be rejected with error.\n   * Other local copies of this map will continue operating and receiving events normally.\n   * @example\n   * ```typescript\n   * map.close();\n   * ````\n   */\n  public close(): void {\n    super.close();\n    this.syncMapImpl.detach(this.listenerUuid);\n  }\n\n}\n\nexport { SyncMapItemMetadata, SyncMapItemQueryOptions, SyncMapImpl, SyncMap };\n\nexport default SyncMap;\n","import { EntityServices, RemovalHandler, SyncEntity } from '../entity';\nimport { PublishMessageRequest, PublishMessageResponse, StreamDescriptor } from './serverapi';\nimport Closeable from '../closeable';\nimport { nonNegativeInteger, pureObject, validateTypesAsync } from '@twilio/declarative-type-validator';\n\nexport interface SyncStreamServices extends EntityServices {\n}\n\n/**\n * Stream message descriptor.\n */\nexport interface SyncStreamMessage {\n  /**\n   * Stream message SID.\n   */\n  sid: string;\n\n  /**\n   * Stream message data.\n   */\n  data: object;\n}\n\nclass SyncStreamImpl extends SyncEntity {\n\n  private readonly descriptor: StreamDescriptor;\n\n  /**\n   * @internal\n   */\n  constructor(services: SyncStreamServices, descriptor: StreamDescriptor, removalHandler: RemovalHandler) {\n    super(services, removalHandler);\n    this.descriptor = descriptor;\n  }\n\n  // private props\n  get uri(): string {\n    return this.descriptor.url;\n  }\n\n  get links(): any {\n    return this.descriptor.links;\n  }\n\n  static get type() {\n    return 'stream';\n  }\n\n  get dateExpires(): string {\n    return this.descriptor.date_expires;\n  }\n\n  get type() {\n    return 'stream';\n  }\n\n  get lastEventId() {\n    return null;\n  }\n\n  // below properties are specific to Insights only\n  get indexName(): string {\n    return undefined;\n  }\n\n  get queryString(): string {\n    return undefined;\n  }\n\n  // public props, documented along with class description\n  get sid() {\n    return this.descriptor.sid;\n  }\n\n  get uniqueName() {\n    return this.descriptor.unique_name || null;\n  }\n\n  @validateTypesAsync(pureObject)\n  public async publishMessage(data: object): Promise<SyncStreamMessage> {\n    const requestBody: PublishMessageRequest = {data};\n    const response = await this.services.network.post(this.links.messages, requestBody);\n    const responseBody: PublishMessageResponse = response.body;\n\n    const event = this._handleMessagePublished(responseBody.sid, data, false);\n    return event;\n  }\n\n  @validateTypesAsync(nonNegativeInteger)\n  public async setTtl(ttl: number): Promise<void> {\n    try {\n      const requestBody = {ttl: ttl};\n      const response = await this.services.network.post(this.uri, requestBody);\n      this.descriptor.date_expires = response.body.date_expires;\n    } catch (error) {\n      if (error.status === 404) {\n        this.onRemoved(false);\n      }\n      throw error;\n    }\n  }\n\n  public async removeStream() {\n    await this.services.network.delete(this.uri);\n    this.onRemoved(true);\n  }\n\n  /**\n   * Handle event from the server\n   * @private\n   */\n  _update(update): void {\n    switch (update.type) {\n      case 'stream_message_published': {\n        this._handleMessagePublished(update.message_sid, update.message_data, true);\n        break;\n      }\n      case 'stream_removed': {\n        this.onRemoved(false);\n        break;\n      }\n    }\n  }\n\n  private _handleMessagePublished(sid: string, data: object, remote: boolean): SyncStreamMessage {\n    const event: SyncStreamMessage = {\n      sid: sid,\n      data: data\n    };\n\n    this.broadcastEventToListeners('messagePublished', {message: event, isLocal: !remote});\n    return event;\n  }\n\n  protected onRemoved(isLocal: boolean) {\n    this._unsubscribe();\n    this.removalHandler(this.type, this.sid, this.uniqueName);\n    this.broadcastEventToListeners('removed', {isLocal: isLocal});\n  }\n}\n\n/**\n * A Sync primitive for pub-sub messaging. Stream Messages are not persisted, exist\n * only in transit, and will be dropped if (due to congestion or network anomalies) they\n * cannot be delivered promptly. Use the {@link SyncClient.stream} method to obtain a reference to a Sync Message Stream.\n * Information about rate limits can be found [here](https://www.twilio.com/docs/sync/limits).\n */\nclass SyncStream extends Closeable {\n\n  private readonly syncStreamImpl: SyncStreamImpl;\n\n  // private props\n  get uri(): string {\n    return this.syncStreamImpl.uri;\n  }\n\n  get links(): any {\n    return this.syncStreamImpl.links;\n  }\n\n  static get type() {\n    return SyncStreamImpl.type;\n  }\n\n  get dateExpires(): string {\n    return this.syncStreamImpl.dateExpires;\n  }\n\n  get type() {\n    return SyncStreamImpl.type;\n  }\n\n  get lastEventId() {\n    return null;\n  }\n\n  /**\n   * The immutable system-assigned identifier of this stream. Never null.\n   */\n  get sid() {\n    return this.syncStreamImpl.sid;\n  }\n\n  /**\n   * A unique identifier optionally assigned to the stream on creation.\n   */\n  get uniqueName() {\n    return this.syncStreamImpl.uniqueName;\n  }\n\n  /**\n   * @internal\n   */\n  constructor(syncStreamImpl: SyncStreamImpl) {\n    super();\n    this.syncStreamImpl = syncStreamImpl;\n    this.syncStreamImpl.attach(this);\n  }\n\n  /**\n   * Fired when a message is published to the stream either locally or by a remote actor.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * {@link SyncStreamMessage} `message` -  Published message\n   *     * boolean `isLocal` - equals true if the message was published by a local actor, false otherwise\n   * @example\n   * ```typescript\n   * stream.on('messagePublished', (args) => {\n   *   console.log('Stream message published');\n   *   console.log('Message SID:', args.message.sid);\n   *   console.log('Message data: ', args.message.data);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly messagePublished = 'messagePublished';\n\n  /**\n   * Fired when a stream is removed entirely, regardless of whether the remover was local or remote.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * boolean `isLocal` - equals true if the stream was removed by a local actor, false otherwise\n   * @example\n   * ```typescript\n   * stream.on('removed', (args) => {\n   *   console.log(`Stream ${stream.sid} was removed`);\n   *   console.log('args.isLocal:', args.isLocal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly removed = 'removed';\n\n  /**\n   * Publish a message to the stream. The system will attempt delivery to all online subscribers.\n   * @param data The body of the dispatched message. Maximum size in serialized JSON: 4KB.\n   * A rate limit applies to this operation, refer to the [Sync API documentation](https://www.twilio.com/docs/api/sync) for details.\n   * @return A promise which resolves after the message is successfully published\n   * to the Sync service. Resolves irrespective of ultimate delivery to any subscribers.\n   * @example\n   * ```typescript\n   * stream.publishMessage({ x: 42, y: 123 })\n   *   .then((message) => {\n   *     console.log('Stream publishMessage() successful, message SID:', message.sid);\n   *   })\n   *   .catch((error) => {\n   *     console.error('Stream publishMessage() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(pureObject)\n  public async publishMessage(data: object): Promise<SyncStreamMessage> {\n    this.ensureNotClosed();\n    return this.syncStreamImpl.publishMessage(data);\n  }\n\n  /**\n   * Update the time-to-live of the stream.\n   * @param ttl Specifies the TTL in seconds after which the stream is subject to automatic deletion. The value 0 means infinity.\n   * @return A promise that resolves after the TTL update was successful.\n   * @example\n   * ```typescript\n   * stream.setTtl(3600)\n   *   .then(() => {\n   *     console.log('Stream setTtl() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('Stream setTtl() failed', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonNegativeInteger)\n  public async setTtl(ttl: number): Promise<void> {\n    this.ensureNotClosed();\n    return this.syncStreamImpl.setTtl(ttl);\n  }\n\n  /**\n   * Permanently delete this Stream.\n   * @return A promise which resolves after the Stream is successfully deleted.\n   * @example\n   * ```typescript\n   * stream.removeStream()\n   *   .then(() => {\n   *     console.log('Stream removeStream() successful');\n   *   })\n   *   .catch((error) => {\n   *     console.error('Stream removeStream() failed', error);\n   *   });\n   * ```\n   */\n  public async removeStream() {\n    this.ensureNotClosed();\n    return this.syncStreamImpl.removeStream();\n  }\n\n  /**\n   * Conclude work with the stream instance and remove all event listeners attached to it.\n   * Any subsequent operation on this object will be rejected with error.\n   * Other local copies of this stream will continue operating and receiving events normally.\n   * @example\n   * ```typescript\n   * stream.close();\n   * ```\n   */\n  public close(): void {\n    super.close();\n    this.syncStreamImpl.detach(this.listenerUuid);\n  }\n\n}\n\nexport { SyncStream, SyncStreamImpl };\nexport default SyncStream;\n","import * as platform from 'platform';\n\nclass ClientInfo {\n  sdk: string;\n  sdkVer: string;\n  os: string;\n  osVer: string;\n  pl: string;\n  plVer: string;\n\n  constructor(version: string) {\n    this.sdk = 'js';\n    this.sdkVer = version;\n    this.os = platform.os.family;\n    this.osVer = platform.os.version;\n    this.pl = platform.name;\n    this.plVer = platform.version;\n  }\n}\n\nexport default ClientInfo;\nexport { ClientInfo };","import { SyncEntity } from './entity';\n\n/**\n * Container for entities which are known by the client\n * It's needed for deduplication when client obtain the same object several times\n */\nexport class EntitiesCache {\n  private readonly names: Map<string, string>;\n  private readonly entities: Map<string, SyncEntity>;\n\n  constructor() {\n    this.names = new Map<string, string>();\n    this.entities = new Map<string, SyncEntity>();\n  }\n\n  store<T extends SyncEntity>(entity: T): T {\n    let stored = this.entities.get(entity.sid);\n    if (stored) {\n      return stored as T;\n    }\n\n    this.entities.set(entity.sid, entity);\n    if (entity.uniqueName) {\n      this.names.set(entity.type + '::' + entity.uniqueName, entity.sid);\n    }\n    return entity;\n  }\n\n  protected getResolved(id: string, type: string): SyncEntity {\n    let resolvedSid = this.names.get(type + '::' + id);\n    return resolvedSid ? this.entities.get(resolvedSid) : null;\n  }\n\n  get(id: string, type: string): SyncEntity {\n    return this.entities.get(id) || this.getResolved(id, type) || null;\n  }\n\n  remove(sid: string): void {\n    let cached = this.entities.get(sid);\n    if (cached) {\n      this.entities.delete(sid);\n      if (cached.uniqueName) {\n        this.names.delete(cached.type + '::' + cached.uniqueName);\n      }\n    }\n  }\n}\n","import { UriBuilder } from './utils/uri';\nimport { SyncError } from './utils/syncerror';\nimport log from './utils/logger';\n\nimport { EventEmitter } from 'events';\nimport { SyncEntity, EntityServices, RemovalHandler } from './entity';\nimport { Network } from './interfaces/services';\nimport { Closeable } from './closeable';\nimport { Cache } from './cache';\nimport { nonEmptyString, validateTypes, validateTypesAsync } from '@twilio/declarative-type-validator';\n\nexport interface InsightsServices extends EntityServices {\n}\n\n/**\n * An individual result from a LiveQuery or InstantQuery result set.\n */\nexport class InsightsItem {\n  /**\n   * @internal\n   */\n  constructor() {}\n\n  /**\n   * The identifier that maps to this item within the search result.\n   */\n  key: string;\n\n  /**\n   * The contents of the item.\n   */\n  value: object;\n}\n\n/**\n * A result set, i.e. a collection of items that matched a LiveQuery or InstantQuery expression.\n * Each result is a key-value pair, where each key identifies its object uniquely. These\n * results are equivalent to a set of InsightsItem-s.\n */\nexport interface ItemsSnapshot {\n  [key: string]: object;\n}\n\nexport interface InsightsQueryResponse {\n  query_id: string;\n  last_event_id: number;\n  items?: [{\n    key: string;\n    data: object;\n    revision: number;\n  }];\n}\n\nexport interface LiveQueryDescriptor {\n  indexName: string;\n  sid: string;\n  queryExpression: string;\n  queryUri: string;\n  last_event_id: number;\n}\n\nexport type LiveQueryCreator = (indexName: string, queryExpression: string) => Promise<LiveQuery>;\n\nexport class LiveQueryImpl extends SyncEntity {\n\n  private readonly descriptor: LiveQueryDescriptor;\n  private readonly cache: Cache<string, InsightsItem>;\n\n  constructor(descriptor: LiveQueryDescriptor, services: InsightsServices, removalHandler: RemovalHandler, items?: any) {\n    super(services, removalHandler);\n    this.descriptor = descriptor;\n    this.cache = new Cache<string, InsightsItem>();\n\n    if (items) {\n      items.forEach(item => {\n        this.cache.store(item.key, { key: item.key, value: item.data} as InsightsItem, item.revision);\n      });\n    }\n  }\n\n  // public\n  get sid() {\n    return this.descriptor.sid;\n  }\n\n  // private extension of SyncEntity\n  get uniqueName() {\n    return null;\n  }\n\n  get type() {\n    return LiveQueryImpl.type;\n  }\n\n  static get type() {\n    return 'live_query';\n  }\n\n  get lastEventId() {\n    return this.descriptor.last_event_id;\n  }\n\n  get indexName() {\n    return this.descriptor.indexName;\n  }\n\n  get queryString() {\n    return this.descriptor.queryExpression;\n  }\n\n  // custom private props\n  get queryUri() {\n    return this.descriptor.queryUri;\n  }\n\n  get liveQueryDescriptor() {\n    return this.descriptor;\n  }\n\n  // dummy stub from iface\n  protected onRemoved() {\n  }\n\n  public getItems(): ItemsSnapshot {\n    const dataByKey = {};\n    this.cache.forEach((key, item) => {\n      dataByKey[key] = item.value;\n    });\n    return dataByKey;\n  }\n\n  /**\n   * @internal\n   */\n  _update(message: any, isStrictlyOrdered: boolean): void {\n    switch (message.type) {\n      case 'live_query_item_updated':\n        this.handleItemMutated(message.item_key, message.item_data, message.item_revision);\n        break;\n      case 'live_query_item_removed':\n        this.handleItemRemoved(message.item_key, message.item_revision);\n        break;\n      case 'live_query_updated':\n        this.handleBatchUpdate(message.items);\n        break;\n    }\n\n    if (isStrictlyOrdered) {\n      this._advanceLastEventId(message.last_event_id);\n    }\n  }\n\n  private handleItemMutated(key: string, value: object, revision: number) {\n    if (this.shouldIgnoreEvent(key, revision)) {\n      log.trace(`Item ${key} update skipped, revision: ${revision}`);\n    } else {\n      const newItem: InsightsItem = {key, value};\n      this.cache.store(key, newItem, revision);\n      this.broadcastEventToListeners('itemUpdated', newItem);\n    }\n  }\n\n  private handleItemRemoved(key: string, revision: number) {\n    const force = (revision === null);\n    if (this.shouldIgnoreEvent(key, revision)) {\n      log.trace(`Item ${key} delete skipped, revision: ${revision}`);\n    } else {\n      this.cache.delete(key, revision, force);\n      this.broadcastEventToListeners('itemRemoved', {key});\n    }\n  }\n\n  private handleBatchUpdate(items) {\n    // preprocess item set for easy key-based access (it's a one-time constant time operation)\n    let newItems = {};\n    if (items != null) {\n      items.forEach(item => {\n        newItems[item.key] = {\n          data: item.data,\n          revision: item.revision\n        };\n      });\n    }\n\n    // go through existing items and generate update/remove events for them\n    this.cache.forEach((key, item) => {\n      const newItem = newItems[key];\n      if (newItem != null) {\n        this.handleItemMutated(key, newItem.data, newItem.revision);\n      } else {\n        this.handleItemRemoved(key, null); // force deletion w/o revision\n      }\n      // once item is handled, remove it from incoming array\n      delete newItems[key];\n    });\n\n    // once we handled all the known items, handle remaining pack\n    for (let key in newItems) {\n      this.handleItemMutated(key, newItems[key].data, newItems[key].revision);\n    }\n  }\n\n  private shouldIgnoreEvent(key: string, eventId: number) {\n    return key != null && eventId != null && this.cache.isKnown(key, eventId);\n  }\n\n  /**\n   * @internal\n   */\n  _advanceLastEventId(eventId: number, revision?: string): void {\n    // LiveQuery is not revisioned in any way, so simply ignore second param and act upon lastEventId only\n    if (this.lastEventId < eventId) {\n      this.descriptor.last_event_id = eventId;\n    }\n  }\n}\n\nexport async function queryItems(params: any): Promise<InsightsQueryResponse>  {\n  let { network, queryString, uri, type } = params;\n  if (queryString == null) { // should not be null or undefined\n    throw new SyncError(`Invalid query`, 400, 54507);\n  }\n  const liveQueryRequestBody: any = {\n    query_string: queryString // raw query string (like `key == \"value\" AND key2 != \"value2\"`)\n  };\n\n  if (type === LiveQuery.type) {\n    liveQueryRequestBody.type = type;\n  }\n\n  let response = await network.post(uri, liveQueryRequestBody, undefined, true);\n  return response.body;\n}\n\n/**\n * Represents a long-running query against Flex data wherein the returned result set\n * subsequently receives pushed updates whenever new (or updated) records would match the\n * given expression. Updated results are presented row-by-row until this query is explicitly\n * closed.\n *\n * Use the {@link SyncClient.liveQuery} method to create a live query.\n */\nexport class LiveQuery extends Closeable {\n  private readonly liveQueryImpl: LiveQueryImpl;\n\n  // private props\n  static get type() {\n    return LiveQueryImpl.type;\n  }\n\n  get type() {\n    return LiveQueryImpl.type;\n  }\n\n  get lastEventId(): number {\n    return this.liveQueryImpl.lastEventId;\n  }\n\n  /**\n   * The immutable identifier of this query object, assigned by the system.\n   */\n  get sid(): string {\n    return this.liveQueryImpl.sid;\n  }\n\n  /**\n   * @internal\n   */\n  constructor(liveQueryImpl: LiveQueryImpl) {\n    super();\n    this.liveQueryImpl = liveQueryImpl;\n    this.liveQueryImpl.attach(this);\n  }\n\n  /**\n   * Fired when an item has been added or updated.\n   *\n   * Parameters:\n   * 1. {@link InsightsItem} `item` - updated item\n   * @example\n   * ```typescript\n   * liveQuery.on('itemUpdated', (item) => {\n   *   console.log(`Item ${item.key} was updated`'`);\n   *   console.log('Item value:', item.value);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemUpdated = 'itemUpdated';\n\n  /**\n   * Fired when an existing item has been removed.\n   *\n   * Parameters:\n   * 1. object `args` - info object provided with the event. It has the following properties:\n   *     * object `key` - the key of the removed item\n   * @example\n   * ```typescript\n   * liveQuery.on('itemRemoved', (args) => {\n   *   console.log(`Item ${args.key} was removed`);\n   * });\n   * ```\n   * @event\n   */\n  static readonly itemRemoved = 'itemRemoved';\n\n  /**\n   * Closes this query instance and unsubscribes from further service events.\n   * This will eventually stop the physical inflow of updates over the network, when all other instances of this query are closed as well.\n   */\n  public close(): void {\n    super.close();\n    this.liveQueryImpl.detach(this.listenerUuid);\n  }\n\n  /**\n   * @return A snapshot of items matching the current query expression.\n   */\n  public getItems(): ItemsSnapshot {\n    this.ensureNotClosed();\n    return this.liveQueryImpl.getItems();\n  }\n}\n\n/**\n * Allows repetitive quick searches against a specific Flex data. Unlike a\n * LiveQuery, this result set does not subscribe to any updates and therefore receives no events\n * beyond the initial result set.\n *\n * Use the {@link SyncClient.instantQuery} method to create an Instant Query.\n */\nexport class InstantQuery extends EventEmitter {\n  private indexName: string;\n  private queryUri: string;\n  private readonly insightsUri: string;\n  private readonly liveQueryCreator: LiveQueryCreator;\n  private readonly network: Network;\n  private queryExpression: string = null;\n  private items = {};\n\n  // private props\n  static get type() {\n    return 'instant_query';\n  }\n\n  get type() {\n    return InstantQuery.type;\n  }\n\n  /**\n   * @internal\n   */\n  constructor(params: any) {\n    super();\n    Object.assign(this, params);\n    this.updateIndexName(params.indexName);\n  }\n\n  /**\n   * Fired when a search result is ready.\n   *\n   * Parameters:\n   * 1. {@link ItemsSnapshot} `items` - a snapshot of items matching current query expression.\n   * @example\n   * ```typescript\n   * instantQuery.on('searchResult', (items) => {\n   *    Object.entries(items).forEach(([key, value]) => {\n   *      console.log('Search result item key:', key);\n   *      console.log('Search result item value:', value);\n   *    });\n   * });\n   * ```\n   * @event\n   */\n  static readonly searchResult = 'searchResult';\n\n  /**\n   * Spawns a new search request. The result will be provided asynchronously via the {@link InstantQuery.searchResult}\n   * event.\n   * @param queryExpression A query expression to be executed against the given data index. For more information\n   * on the syntax read {@link SyncClient.liveQuery}.\n   * @return A promise that resolves when query result has been received.\n   */\n  @validateTypesAsync('string')\n  public async search(queryExpression: string): Promise<void> {\n    this.items = {};\n    return queryItems({\n      network: this.network,\n      uri: this.queryUri,\n      queryString: queryExpression,\n    })\n      .then((response) => {\n        this.queryExpression = queryExpression;\n        if (response.items) {\n          response.items.forEach((item) => {\n            this.items[item.key] = item.data;\n          });\n        }\n        this.emit('searchResult', this.getItems());\n      })\n      .catch((err) => {\n        log.error(\n            `Error '${err.message}' while executing query '${queryExpression}'`\n        );\n        this.queryExpression = null;\n        throw err;\n      });\n  }\n\n  /**\n   * Instantiates a LiveQuery object based on the last known query expression that was passed to the\n   * {@link InstantQuery.search} method. This LiveQuery will start receiving updates with new results,\n   * while current object can be still used to execute repetitive searches.\n   * @return A promise which resolves when the LiveQuery object is ready.\n   */\n  public async subscribe(): Promise<LiveQuery> {\n    if (this.queryExpression == null) { // should not be null or undefined\n      return Promise.reject(new SyncError(`Invalid query`, 400, 54507));\n    }\n\n    return this.liveQueryCreator(this.indexName, this.queryExpression);\n  }\n\n  /**\n   * @return A snapshot of items matching current query expression.\n   */\n  public getItems(): ItemsSnapshot {\n    return this.items;\n  }\n\n  /**\n   * Set new index name\n   * @param indexName New index name to set\n   */\n  @validateTypes(nonEmptyString)\n  public updateIndexName(indexName: string): void {\n    this.indexName = indexName;\n    this.queryUri = this.generateQueryUri(this.indexName);\n  }\n\n  private generateQueryUri(indexName: string) {\n    return new UriBuilder(this.insightsUri)\n      .pathSegment(indexName)\n      .pathSegment('Items')\n      .build();\n  }\n}\n\nexport default LiveQuery;\n","import { EventEmitter } from 'events';\n\nimport { literal, nonEmptyString, nonNegativeInteger, objectSchema, pureObject, validateTypesAsync } from '@twilio/declarative-type-validator';\nimport { Twilsock, InitRegistration, ConnectionState as TwilsockConnectionState } from 'twilsock';\n\nimport { UriBuilder } from './utils/uri';\nimport { SyncError } from './utils/syncerror';\nimport { deepClone } from './utils/sanitize';\nimport log from './utils/logger';\n\nimport { Configuration } from './configuration';\nimport { Subscriptions } from './subscriptions';\n\nimport { Services } from './interfaces/services';\nimport { NetworkService } from './services/network';\nimport { SessionStorage } from './services/storage';\n\nimport { RemovalHandler, SyncEntity } from './entity';\nimport { DocumentDescriptor, SyncDocument, SyncDocumentImpl } from './syncdocument';\nimport { SyncListDescriptor, SyncList, SyncListImpl } from './synclist';\nimport { SyncMapDescriptor, SyncMap, SyncMapImpl } from './syncmap';\nimport { SyncStream, SyncStreamImpl } from './streams/syncstream';\nimport { StreamDescriptor } from './streams/serverapi';\nimport { ClientInfo } from './clientInfo';\nimport { EntitiesCache } from './entitiesCache';\nimport { LiveQuery, InstantQuery, LiveQueryImpl, LiveQueryDescriptor } from './livequery';\nimport { LiveQueryCreator, queryItems } from './livequery';\nimport { version } from '../package.json';\n\nconst SYNC_PRODUCT_ID = 'data_sync';\nconst SDK_VERSION = version;\n\ntype json = { [key: string]: any };\n\n/**\n * Mode for opening the Sync object:\n * * `'open_or_create'` - reads a Sync object or creates one if it does not exist.\n * * `'open_existing'` - reads an existing Sync object. The promise is rejected if the object does not exist.\n * * `'create_new'` - creates a new Sync object. If the *id* property is specified, it will be used as the unique name.\n */\ntype OpenMode = 'open_or_create'\n  | 'open_existing'\n  | 'create_new';\n\n/**\n * Client connection state.\n * Directly reflects connection state of the underlying websocket transport.\n * Possible values are as follows:\n * * 'connecting' - client is offline and connection attempt is in process.\n * * 'connected' - client is online and ready.\n * * 'disconnecting' - client is going offline as disconnection is in process.\n * * 'disconnected' - client is offline and no connection attempt is in process.\n * * 'denied' - client connection is denied because of invalid JWT access token. User must refresh token in order to proceed.\n * * 'error' - client connection is in a permanent erroneous state. Client re-initialization is required.\n */\ntype ConnectionState = TwilsockConnectionState;\n\n/**\n * Client options.\n */\ninterface SyncClientOptions {\n  /**\n   * The level of logging to enable.\n   */\n  logLevel?: 'silent' | 'error' | 'warn' | 'info' | 'debug' | 'trace';\n\n  [key: string]: any;\n}\n\n/**\n * Options for opening a Sync object.\n *\n * @example The following example is applicable to all Sync objects\n * (i.e., `syncClient.document()`, `syncClient.list()`,` syncClient.map()`, `syncClient.stream()`)\n * ```typescript\n * // Attempts to open an existing document with a unique name of 'MyDocument'\n * // If no such document exists, the promise is rejected\n * syncClient.document({\n *   id: 'MyDocument',\n *   mode: 'open_existing'\n * })\n *   .then(...)\n *   .catch(...);\n *\n * // Attempts to create a new document with a unique name of 'MyDocument', TTL of 24 hours and initial data `{ name: 'John Smith' }`\n * // If such a document already exists, the promise is rejected\n * syncClient.document({\n *   id: 'MyDocument',\n *   mode: 'create_new',\n *   ttl: 86400\n *   data: { name: 'John Smith' } // the `data` property is only applicable for Documents\n * })\n *   .then(...)\n *   .catch(...);\n * ```\n */\ninterface OpenOptions {\n  /**\n   * Sync object SID or unique name.\n   */\n  id?: string;\n\n  /**\n   * Mode for opening the Sync object.\n   */\n  mode?: OpenMode;\n\n  /**\n   * The time-to-live of the Sync object in seconds. This is applied only if the object is created.\n   */\n  ttl?: number;\n}\n\n/**\n * Options for opening a document.\n */\ninterface OpenDocumentOptions extends OpenOptions {\n  /**\n   * The initial data of the Sync document.\n   */\n  data?: json;\n}\n\n/**\n * List options.\n */\ninterface OpenListOptions extends OpenOptions {\n  purpose?: string;\n  context?: json;\n  includeItems?: boolean;\n}\n\n/**\n * Map options.\n */\ninterface OpenMapOptions extends OpenOptions {\n  includeItems?: boolean;\n}\n\n/**\n * Stream options.\n */\ninterface OpenStreamOptions extends OpenOptions {\n}\n\nfunction decompose(arg?: string | OpenOptions): OpenOptions {\n  if (!arg) {\n    return {mode: 'create_new'};\n  } else if (typeof arg === 'string') {\n    return {id: arg, mode: 'open_or_create'};\n  } else {\n    let mode = arg.mode || (arg.id ? 'open_or_create' : 'create_new');\n    return {...arg, mode: mode};\n  }\n}\n\nconst SYNC_DOCUMENT_NOTIFICATION_TYPE = 'com.twilio.rtd.cds.document';\nconst SYNC_LIST_NOTIFICATION_TYPE = 'com.twilio.rtd.cds.list';\nconst SYNC_MAP_NOTIFICATION_TYPE = 'com.twilio.rtd.cds.map';\nconst SYNC_NOTIFICATION_TYPE = 'twilio.sync.event';\n\n/**\n * Client for the Twilio Sync service.\n *\n * @example\n * ```typescript\n * // Using NPM resolution\n * const SyncClient = require('twilio-sync');\n * const syncClient = new SyncClient(token, { loglevel: 'debug' });\n *\n * // Using CDN\n * const syncClient = new Twilio.Sync.Client(token, { logLevel: 'debug' });\n * ```\n */\nclass Client extends EventEmitter {\n  private readonly services: Services;\n  private readonly entities: EntitiesCache;\n\n  /**\n   * @param fpaToken Twilio access token.\n   * @param options Options to customize the client.\n   */\n  constructor(fpaToken: string, options: SyncClientOptions = {}) {\n    super();\n\n    if (!fpaToken) {\n      throw new Error('Sync library needs a valid Twilio token to be passed');\n    }\n\n    if (options.hasOwnProperty('logLevel')) {\n      log.setLevel(options.logLevel);\n    } else {\n      log.setLevel('silent');\n    }\n\n    const productId = options.productId = options.productId || SYNC_PRODUCT_ID;\n\n    // Fill ClientMetadata\n    options.clientMetadata = options.clientMetadata || {};\n    if (!options.clientMetadata.hasOwnProperty('type')) {\n      options.clientMetadata.type = 'sync';\n    }\n    if (!options.clientMetadata.hasOwnProperty('sdk')) {\n      options.clientMetadata.sdk = 'JS';\n      options.clientMetadata.sdkv = SDK_VERSION;\n    }\n\n    const startTwilsock = !options.twilsockClient;\n\n    // Create default init registrations if none were provided.\n    // Otherwise, the outside party have to list all the init registrations they need, including Sync ones.\n    if (!options.initRegistrations) {\n      let initRegistration = new InitRegistration(productId);\n      Client.populateInitRegistrations(initRegistration);\n      options.initRegistrations = [initRegistration];\n    }\n\n    let twilsock = options.twilsockClient = options.twilsockClient || new Twilsock(fpaToken, productId, options);\n    twilsock.on('tokenAboutToExpire', ttl => this.emit('tokenAboutToExpire', ttl));\n    twilsock.on('tokenExpired', () => this.emit('tokenExpired'));\n    twilsock.on('connectionError', err => this.emit('connectionError', err));\n    twilsock.on('stateChanged', (state) => {\n      this.emit('connectionStateChanged', state);\n      /**\n       * Handle transport establishing event\n       * If we have any subscriptions - we should check object for modifications\n       */\n      this.services.subscriptions.onConnectionStateChanged(state === 'connected');\n    });\n    twilsock.on('message', (messageType, payload) => this._routeMessage(messageType, payload));\n\n    let config = new Configuration(options);\n    let network = new NetworkService(new ClientInfo(SDK_VERSION), config, twilsock);\n    let storage = new SessionStorage(config);\n\n    this.services = {\n      config,\n      twilsock,\n      network,\n      storage,\n      router: this,\n      subscriptions: null\n    };\n\n    this.services.subscriptions = new Subscriptions(this.services);\n\n    this.entities = new EntitiesCache();\n\n    // Start only if we created twilsock locally,\n    // otherwise it's the responsibility of whoever created the Twilsock client.\n    if (startTwilsock) {\n      twilsock.connect();\n    }\n  }\n\n  /**\n   * Fired when connection state has been changed.\n   *\n   * Parameters:\n   * 1. {@link ConnectionState} `connectionState` - contains current service connection state.\n   * @example\n   * ```typescript\n   * syncClient.on('connectionStateChanged', (newState) => {\n   *   console.log('Received a new connection state:', newState);\n   * });\n   * ```\n   * @event\n   */\n  static readonly connectionStateChanged = 'connectionStateChanged';\n\n  /**\n   * Fired when connection is interrupted by unexpected reason.\n   *\n   * Parameters:\n   * 1. object `connectionError` - connection error details. It has following properties:\n   *     * boolean `terminal` - twilsock will stop connection attempts\n   *     * string `message` - root cause\n   *     * number? `httpStatusCode` - HTTP status code if available\n   *     * number? `errorCode` - Twilio public error code if available\n   * @example\n   * ```typescript\n   * syncClient.on('connectionError', (connectionError) => {\n   *   console.error('Connection was interrupted:', connectionError.message);\n   *   console.error('Is terminal:', connectionError.terminal);\n   * });\n   * ```\n   * @event\n   */\n  static readonly connectionError = 'connectionError';\n\n  /**\n   * Fired when the access token is about to expire and needs to be updated.\n   * The trigger takes place three minutes before the JWT access token expiry.\n   * For long living applications, you should refresh the token when either\n   * {@link SyncClient.tokenAboutToExpire | tokenAboutToExpire} or\n   * {@link SyncClient.tokenExpired | tokenExpire} events occur; handling just\n   * one of them is sufficient.\n   * @example\n   * The following example illustrates access token refresh.\n   * ```typescript\n   * syncClient.on('tokenAboutToExpire', () => {\n   *   // Obtain a JWT access token: https://www.twilio.com/docs/sync/identity-and-access-tokens\n   *   const token = '<your-access-token-here>';\n   *   syncClient.updateToken(token);\n   * });\n   * ```\n   * @event\n   */\n  static readonly tokenAboutToExpire = 'tokenAboutToExpire';\n\n  /**\n   * Fired when the access token is expired.\n   * In case the token is not refreshed, all subsequent Sync operations will fail and the client will disconnect.\n   * For long living applications, you should refresh the token when either\n   * {@link SyncClient.tokenAboutToExpire | tokenAboutToExpire} or\n   * {@link SyncClient.tokenExpired | tokenExpire} events occur; handling just\n   * one of them is sufficient.\n   * @event\n   */\n  static readonly tokenExpired = 'tokenExpired';\n\n  static populateInitRegistrations(reg: InitRegistration) {\n    reg.populateInitRegistrations([SYNC_NOTIFICATION_TYPE, SYNC_DOCUMENT_NOTIFICATION_TYPE,\n      SYNC_LIST_NOTIFICATION_TYPE, SYNC_MAP_NOTIFICATION_TYPE]);\n  }\n\n  /**\n   * Entry point for all the incoming messages (Router).\n   *\n   * @param type Type of the incoming message\n   * @param message Message to route\n   * @internal\n   */\n  _routeMessage(type: string, message: any) {\n    log.trace('Notification type:', type, 'content:', message);\n    switch (type) {\n      case SYNC_DOCUMENT_NOTIFICATION_TYPE:\n      case SYNC_LIST_NOTIFICATION_TYPE:\n      case SYNC_MAP_NOTIFICATION_TYPE:\n        this.services.subscriptions.acceptMessage(message, false);\n        break;\n      case SYNC_NOTIFICATION_TYPE:\n        this.services.subscriptions.acceptMessage(message, true);\n        break;\n    }\n  }\n\n  /**\n   * Subscribe for events (Router)\n   *\n   * @internal\n   */\n  _subscribe(sid: string, entity: any) {\n    this.services.subscriptions.add(sid, entity);\n  }\n\n  /**\n   * Unsubscribe from events (Router)\n   *\n   * @internal\n   */\n  _unsubscribe(sid: string) {\n    this.services.subscriptions.remove(sid);\n  }\n\n  /**\n   * Current version of the Sync client.\n   */\n  static get version(): string {\n    return SDK_VERSION;\n  }\n\n  /**\n   * Current service connection state.\n   */\n  get connectionState(): ConnectionState {\n    return this.services.twilsock.state;\n  }\n\n  /**\n   * Returns a promise which resolves when library is correctly initialized\n   * Or throws if initialization is impossible\n   *\n   * @internal\n   */\n  private async ensureReady() {\n    if (!this.services.config.sessionStorageEnabled) {\n      return;\n    }\n\n    try {\n      let storageSettings = await this.services.twilsock.storageId();\n      this.services.storage.updateStorageId(storageSettings.id);\n    } catch (e) {\n      log.warn('Failed to initialize storage', e);\n    }\n  }\n\n  private storeRootInSessionCache(type: string, id: string, value: Object) {\n    // can't store without id\n    if (!this.services.config.sessionStorageEnabled || !id) {\n      return;\n    }\n\n    let valueToStore = deepClone(value);\n    if (type === SyncList.type || type === SyncMap.type) {\n      valueToStore['last_event_id'] = null;\n      delete valueToStore['items'];\n    }\n    this.services.storage.store(type, id, valueToStore);\n  }\n\n  private readRootFromSessionCache(type: string, id: string): Object {\n    if (!this.services.config.sessionStorageEnabled || !id) {\n      return null;\n    }\n    return this.services.storage.read(type, id);\n  }\n\n  private async _get(baseUri: string, id: string, optimistic: boolean = false) {\n    if (!id) {\n      throw new SyncError(`Cannot get entity without id`, 404);\n    }\n    const uri = new UriBuilder(baseUri).pathSegment(id)\n      .queryParam('Include', optimistic ? 'items' : undefined).build();\n    let response = await this.services.network.get(uri);\n    return response.body;\n  }\n\n  private _createDocument(id: string, data?: Object, ttl?: number) {\n    const requestBody: any = {\n      unique_name: id,\n      data: data || {}\n    };\n\n    if (ttl !== undefined) {\n      requestBody.ttl = ttl;\n    }\n\n    return this.services.network.post(this.services.config.documentsUri, requestBody)\n      .then(response => {\n        response.body.data = requestBody.data;\n        return response.body;\n      });\n  }\n\n  private async _getDocument(id: string): Promise<DocumentDescriptor> {\n    return (this.readRootFromSessionCache(SyncDocument.type, id) || this._get(this.services.config.documentsUri, id)) as Promise<DocumentDescriptor>;\n  }\n\n  private _createList(id: string, purpose?: string, context?: json, ttl?: number) {\n    const requestBody: any = {\n      unique_name: id,\n      purpose: purpose,\n      context: context\n    };\n\n    if (ttl !== undefined) {\n      requestBody.ttl = ttl;\n    }\n\n    return this.services.network.post(this.services.config.listsUri, requestBody).then(response => response.body);\n  }\n\n  private async _getList(id: string): Promise<SyncListDescriptor> {\n    return (this.readRootFromSessionCache(SyncList.type, id) || this._get(this.services.config.listsUri, id)) as Promise<SyncListDescriptor>;\n  }\n\n  private _createMap(id, ttl?: number) {\n    const requestBody: any = {\n      unique_name: id\n    };\n\n    if (ttl !== undefined) {\n      requestBody.ttl = ttl;\n    }\n\n    return this.services.network.post(this.services.config.mapsUri, requestBody).then(response => response.body);\n  }\n\n  private async _getMap(id: string, optimistic: boolean = false): Promise<SyncMapDescriptor> {\n    return (this.readRootFromSessionCache(SyncMap.type, id) || this._get(this.services.config.mapsUri, id, optimistic)) as Promise<SyncMapDescriptor>;\n  }\n\n  private async _getStream(id: string): Promise<StreamDescriptor> {\n    return (this.readRootFromSessionCache(SyncStream.type, id) || this._get(this.services.config.streamsUri, id, false)) as Promise<StreamDescriptor>;\n  }\n\n  private async _createStream(id, ttl?: number): Promise<StreamDescriptor> {\n    const requestBody: any = {\n      unique_name: id\n    };\n\n    if (ttl !== undefined) {\n      requestBody.ttl = ttl;\n    }\n\n    const response = await this.services.network.post(this.services.config.streamsUri, requestBody);\n\n    return response.body;\n  }\n\n  private _getLiveQuery(sid: string): LiveQueryDescriptor {\n    return this.readRootFromSessionCache(LiveQuery.type, sid) as LiveQueryDescriptor;\n  }\n\n  private getCached<T extends SyncEntity>(id: string, type: string): T {\n    if (id) {\n      return this.entities.get(id, type) as T || null;\n    }\n    return null;\n  }\n\n  private removeFromCacheAndSession(type: string, sid: string, uniqueName: string) {\n    this.entities.remove(sid);\n    if (this.services.config.sessionStorageEnabled) {\n      this.services.storage.remove(type, sid, uniqueName);\n    }\n  }\n\n  /**\n   * Read or create a Sync document.\n   * @param arg Could be any of the following:\n   * * Unique name or SID identifying the Sync document - opens the document with the given identifier or creates one if it does not exist.\n   * * none - creates a new document with a randomly assigned SID and no unique name.\n   * * {@link OpenDocumentOptions} object for more granular control.\n   * @return A promise which resolves after the document is successfully read (or created).\n   * This promise may reject if the document could not be created or if this endpoint lacks the necessary permissions to access it.\n   * @example\n   * ```typescript\n   * syncClient.document('MyDocument')\n   *   .then((document) => {\n   *     console.log('Successfully opened a document. SID:', document.sid);\n   *     document.on('updated', (event) => {\n   *       console.log('Received an \"updated\" event: ', event);\n   *     });\n   *   })\n   *   .catch((error) => {\n   *     console.error('Unexpected error', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync([\n    'undefined',\n    'string',\n    objectSchema('open document options', {\n      id: ['string', 'undefined'],\n      mode: [literal('open_or_create', 'open_existing', 'create_new'), 'undefined'],\n      ttl: [nonNegativeInteger, 'undefined'],\n      data: [pureObject, 'undefined', literal(null)]\n    })\n  ])\n  public async document(arg?: string | OpenDocumentOptions): Promise<SyncDocument> {\n    await this.ensureReady();\n    let opts: OpenDocumentOptions = decompose(arg);\n\n    let docDescriptor: DocumentDescriptor;\n    if (opts.mode === 'create_new') {\n      docDescriptor = await this._createDocument(opts.id, opts.data, opts.ttl);\n    } else {\n      let docFromInMemoryCache = this.getCached<SyncDocumentImpl>(opts.id, SyncDocument.type);\n      if (docFromInMemoryCache) {\n        return new SyncDocument(docFromInMemoryCache);\n      } else {\n        try {\n          docDescriptor = await this._getDocument(opts.id);\n        } catch (err) {\n          if (err.status !== 404 || opts.mode === 'open_existing') {\n            throw err;\n          } else {\n            try {\n              docDescriptor = await this._createDocument(opts.id, opts.data, opts.ttl);\n            } catch (err) {\n              if (err.status === 409) {\n                return this.document(arg);\n              } else {\n                throw err;\n              }\n            }\n          }\n        }\n      }\n    }\n    this.storeRootInSessionCache(SyncDocument.type, opts.id, docDescriptor);\n    let syncDocumentImpl = new SyncDocumentImpl(this.services, docDescriptor,\n      (type, sid, uniqueName) => this.removeFromCacheAndSession(type, sid, uniqueName));\n    syncDocumentImpl = this.entities.store(syncDocumentImpl);\n    return new SyncDocument(syncDocumentImpl);\n  }\n\n  /**\n   * Read or create a Sync map.\n   * @param arg Could be any of the following:\n   * * Unique name or SID identifying the Sync map - opens the map with the given identifier or creates one if it does not exist.\n   * * none - creates a new map with a randomly assigned SID and no unique name.\n   * * {@link OpenMapOptions} object for more granular control.\n   * @return A promise which resolves after the map is successfully read (or created).\n   * This promise may reject if the map could not be created or if this endpoint lacks the necessary permissions to access it.\n   * @example\n   * ```typescript\n   * syncClient.map('MyMap')\n   *   .then((map) => {\n   *     console.log('Successfully opened a map. SID:', map.sid);\n   *     map.on('itemUpdated', (event) => {\n   *       console.log('Received an \"itemUpdated\" event:', event);\n   *     });\n   *   })\n   *   .catch((error) => {\n   *     console.error('Unexpected error', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync([\n    'undefined',\n    'string',\n    objectSchema('open map options', {\n      id: ['string', 'undefined'],\n      mode: [literal('open_or_create', 'open_existing', 'create_new'), 'undefined'],\n      ttl: [nonNegativeInteger, 'undefined'],\n      data: [pureObject, 'undefined', literal(null)],\n      includeItems: ['boolean', 'undefined']\n    })\n  ])\n  public async map(arg?: string | OpenMapOptions): Promise<SyncMap> {\n    await this.ensureReady();\n    let opts: OpenMapOptions = decompose(arg);\n\n    let mapDescriptor: SyncMapDescriptor;\n    if (opts.mode === 'create_new') {\n      mapDescriptor = await this._createMap(opts.id, opts.ttl);\n    } else {\n      let mapFromInMemoryCache = this.getCached<SyncMapImpl>(opts.id, SyncMap.type);\n      if (mapFromInMemoryCache) {\n        return new SyncMap(mapFromInMemoryCache);\n      } else {\n        try {\n          mapDescriptor = await this._getMap(opts.id, opts.includeItems);\n        } catch (err) {\n          if (err.status !== 404 || opts.mode === 'open_existing') {\n            throw err;\n          } else {\n            try {\n              mapDescriptor = await this._createMap(opts.id, opts.ttl);\n            } catch (err) {\n              if (err.status === 409) {\n                return this.map(arg);\n              } else {\n                throw err;\n              }\n            }\n          }\n        }\n      }\n    }\n    this.storeRootInSessionCache(SyncMap.type, opts.id, mapDescriptor);\n    let syncMapImpl = new SyncMapImpl(this.services, mapDescriptor,\n      (type, sid, uniqueName) => this.removeFromCacheAndSession(type, sid, uniqueName));\n    syncMapImpl = this.entities.store(syncMapImpl);\n    return new SyncMap(syncMapImpl);\n  }\n\n  /**\n   * Read or create a Sync list.\n   * @param arg Could be any of the following:\n   * * Unique name or SID identifying a Sync list - opens the list with the given identifier or creates one if it does not exist.\n   * * none - creates a new list with a randomly assigned SID and no unique name.\n   * * {@link OpenListOptions} object for more granular control.\n   * @return A promise which resolves after the list is successfully read (or created).\n   * This promise may reject if the list could not be created or if this endpoint lacks the necessary permissions to access it.\n   * @example\n   * ```typescript\n   * syncClient.list('MyList')\n   *   .then((list) => {\n   *     console.log('Successfully opened a List. SID:', list.sid);\n   *     list.on('itemAdded', (event) => {\n   *       console.log('Received an \"itemAdded\" event:', event);\n   *     });\n   *   })\n   *   .catch((error) => {\n   *     console.error('Unexpected error', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync([\n    'undefined',\n    'string',\n    objectSchema('open list options', {\n      id: ['string', 'undefined'],\n      mode: [literal('open_or_create', 'open_existing', 'create_new'), 'undefined'],\n      ttl: [nonNegativeInteger, 'undefined'],\n      data: [pureObject, 'undefined', literal(null)],\n      purpose: ['string', 'undefined'],\n      context: [pureObject, 'undefined'],\n      includeItems: ['boolean', 'undefined']\n    })\n  ])\n  public async list(arg?: string | OpenListOptions): Promise<SyncList> {\n    await this.ensureReady();\n    let opts: OpenListOptions = decompose(arg);\n\n    let listDescriptor: SyncListDescriptor;\n    if (opts.mode === 'create_new') {\n      listDescriptor = await this._createList(opts.id, opts.purpose, opts.context, opts.ttl);\n    } else {\n      let listFromInMemoryCache = this.getCached<SyncListImpl>(opts.id, SyncList.type);\n      if (listFromInMemoryCache) {\n        return new SyncList(listFromInMemoryCache);\n      } else {\n        try {\n          listDescriptor = await this._getList(opts.id);\n        } catch (err) {\n          if (err.status !== 404 || opts.mode === 'open_existing') {\n            throw err;\n          } else {\n            try {\n              listDescriptor = await this._createList(opts.id, opts.purpose, opts.context, opts.ttl);\n            } catch (err) {\n              if (err.status === 409) {\n                return this.list(arg);\n              } else {\n                throw err;\n              }\n            }\n          }\n        }\n      }\n    }\n    this.storeRootInSessionCache(SyncList.type, opts.id, listDescriptor);\n    let syncListImpl = new SyncListImpl(this.services, listDescriptor,\n      (type, sid, uniqueName) => this.removeFromCacheAndSession(type, sid, uniqueName));\n    syncListImpl = this.entities.store(syncListImpl);\n    return new SyncList(syncListImpl);\n  }\n\n  /**\n   * Read or create a Sync message stream.\n   * @param arg Could be any of the following:\n   * * Unique name or SID identifying a stream - opens the stream with the given identifier or creates one if it does not exist.\n   * * none - creates a new stream with a randomly assigned SID and no unique name.\n   * * {@link OpenStreamOptions} object for more granular control.\n   * @return A promise which resolves after the stream is successfully read (or created).\n   * The flow of messages will begin imminently (but not necessarily immediately) upon resolution.\n   * This promise may reject if the stream could not be created or if this endpoint lacks the necessary permissions to access it.\n   * @example\n   * ```typescript\n   * syncClient.stream('MyStream')\n   *   .then((stream) => {\n   *     console.log('Successfully opened a message stream. SID:', stream.sid);\n   *     stream.on('messagePublished', (event) => {\n   *       console.log('Received a \"messagePublished\" event:', event);\n   *     });\n   *   })\n   *   .catch((error) => {\n   *     console.error('Unexpected error', error);\n   *   });\n   * ```\n   */\n  @validateTypesAsync([\n    'undefined',\n    'string',\n    objectSchema('open stream options', {\n      id: ['string', 'undefined'],\n      mode: [literal('open_or_create', 'open_existing', 'create_new'), 'undefined'],\n      ttl: [nonNegativeInteger, 'undefined'],\n      data: [pureObject, 'undefined', literal(null)]\n    })\n  ])\n  public async stream(arg?: string | OpenStreamOptions): Promise<SyncStream> {\n    await this.ensureReady();\n    let opts: OpenStreamOptions = decompose(arg);\n\n    let streamDescriptor: StreamDescriptor;\n    if (opts.mode === 'create_new') {\n      streamDescriptor = await this._createStream(opts.id, opts.ttl);\n    } else {\n      let streamFromInMemoryCache = this.getCached<SyncStreamImpl>(opts.id, SyncStream.type);\n      if (streamFromInMemoryCache) {\n        return new SyncStream(streamFromInMemoryCache);\n      } else {\n        try {\n          streamDescriptor = await this._getStream(opts.id);\n        } catch (err) {\n          if (err.status !== 404 || opts.mode === 'open_existing') {\n            throw err;\n          } else {\n            try {\n              streamDescriptor = await this._createStream(opts.id, opts.ttl);\n            } catch (err) {\n              if (err.status === 409) {\n                return this.stream(arg);\n              } else {\n                throw err;\n              }\n            }\n          }\n        }\n      }\n    }\n    this.storeRootInSessionCache(SyncStream.type, opts.id, streamDescriptor);\n    const streamRemovalHandler: RemovalHandler = (type, sid, uniqueName) => this.removeFromCacheAndSession(type, sid, uniqueName);\n    let syncStreamImpl = new SyncStreamImpl(this.services, streamDescriptor, streamRemovalHandler);\n    syncStreamImpl = this.entities.store(syncStreamImpl);\n    return new SyncStream(syncStreamImpl);\n  }\n\n  /**\n   * Gracefully shuts the Sync client down.\n   */\n  public async shutdown() {\n    await this.services.subscriptions.shutdown();\n    await this.services.twilsock.disconnect();\n  }\n\n  /**\n   * Set the authentication token.\n   * @param token New token to set.\n   */\n  @validateTypesAsync(nonEmptyString)\n  public async updateToken(token: string): Promise<void> {\n    return this.services.twilsock.updateToken(token)\n      .catch((error) => {\n        const status = error?.reply?.status;\n\n        if (status?.code === 401 && status?.status === 'UNAUTHORIZED') {\n          throw new SyncError('Updated token was rejected by server', 400, 51130);\n        }\n\n        throw error;\n      });\n  }\n\n  /**\n   * For Flex customers only. Establishes a long-running query against Flex data wherein the returned\n   * result set is updated whenever new (or updated) records match the given expression. Updated results\n   * are presented row-by-row according to the lifetime of the returned LiveQuery object.\n   *\n   * @param indexName Must specify one of the Flex data classes for which Live Queries are available.\n   * @param queryExpression A query expression to be executed against the given data index.\n   * Please review the [Live Query Language](https://www.twilio.com/docs/sync/live-query)\n   * page for Sync client limits and a full list of operators currently supported in query expressions.\n   *\n   * @return A promise that resolves when the query has been successfully executed.\n   * @example\n   * ```typescript\n   * syncClient.liveQuery('tr-worker', 'data.attributes.worker_name == \"Bob\"')\n   *   .then((args) => {\n   *      console.log('Subscribed to live data updates for worker Bob');\n   *      const items = args.getItems();\n   *      Object.entries(items).forEach(([key, value]) => {\n   *        console.log('Search result item key:', key);\n   *        console.log('Search result item value:', value);\n   *      });\n   *   })\n   *   .catch((err) => {\n   *      console.error('Error when subscribing to live updates for worker Bob', err);\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonEmptyString, 'string')\n  public async liveQuery(indexName: string, queryExpression: string): Promise<LiveQuery> {\n    await this.ensureReady();\n    const queryUri = new UriBuilder(this.services.config.insightsUri)\n      .pathSegment(indexName)\n      .pathSegment('Items')\n      .build();\n\n    // send query to CDS to get server-generated sid and item list\n    const response = await queryItems({\n      network: this.services.network,\n      uri: queryUri,\n      queryString: queryExpression,\n      type: LiveQuery.type\n    });\n\n    let liveQueryImpl: LiveQueryImpl = this.getCached<LiveQueryImpl>(response.query_id, LiveQuery.type);\n    if (!liveQueryImpl) {\n      let descriptor: LiveQueryDescriptor = this._getLiveQuery(response.query_id);\n\n      if (!descriptor) {\n        descriptor = {\n          indexName,\n          queryExpression,\n          sid: response.query_id,\n          queryUri,\n          last_event_id: response.last_event_id\n        } as LiveQueryDescriptor;\n      }\n\n      const liveQueryRemovalHandler: RemovalHandler = (type, sid, uniqueName) => this.removeFromCacheAndSession(type, sid, uniqueName);\n      liveQueryImpl = new LiveQueryImpl(descriptor, this.services, liveQueryRemovalHandler, response.items);\n    }\n\n    this.storeRootInSessionCache(LiveQuery.type, response.query_id, liveQueryImpl.liveQueryDescriptor);\n    liveQueryImpl = this.entities.store(liveQueryImpl);\n    return new LiveQuery(liveQueryImpl);\n  }\n\n  /**\n   * For Flex customers only. Creates a query object that can be used to issue one-time queries repeatedly\n   * against the target index.\n   *\n   * @param indexName Must specify one of the Flex data classes for which live queries are available.\n   * @return A promise which resolves after the instance of InstantQuery is successfully created.\n   * @example\n   * ```typescript\n   * syncClient.instantQuery('tr-worker')\n   *   .then((q) => {\n   *     q.on('searchResult', (items) => {\n   *       Object.entries(items).forEach(([key, value]) => {\n   *         console.log('Search result item key:', key);\n   *         console.log('Search result item value:', value);\n   *       });\n   *     });\n   *   });\n   * ```\n   */\n  @validateTypesAsync(nonEmptyString)\n  public async instantQuery(indexName: string): Promise<InstantQuery> {\n    await this.ensureReady();\n\n    const liveQueryCreator: LiveQueryCreator = (indexName, queryExpression) => {\n      return this.liveQuery(indexName, queryExpression);\n    };\n\n    return new InstantQuery({\n      indexName,\n      network: this.services.network,\n      insightsUri: this.services.config.insightsUri,\n      liveQueryCreator\n    });\n  }\n}\n\nexport {\n  Client,\n  SyncClientOptions,\n  ConnectionState,\n  OpenMode,\n  json,\n  OpenOptions,\n  OpenDocumentOptions,\n  OpenMapOptions,\n  OpenListOptions,\n  OpenStreamOptions\n};\n"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__metadata","metadataKey","metadataValue","metadata","loglevelLog","Backoff","log","TransportUnavailableError","uuid","Retrier","uuidv4","validateTypesAsync","pureObject","objectSchema","nonNegativeInteger","custom","platform","validateTypes","nonEmptyString","InitRegistration","twilsock","Twilsock","literal"],"mappings":"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"}