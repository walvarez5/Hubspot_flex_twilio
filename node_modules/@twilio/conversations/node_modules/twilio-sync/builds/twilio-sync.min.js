/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2016, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes Backoff library under the following license

    Copyright (C) 2012 Mathieu Turcotte

    Permission is hereby granted, free of charge, to any person obtaining a copy of
    this software and associated documentation files (the "Software"), to deal in
    the Software without restriction, including without limitation the rights to
    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
    of the Software, and to permit persons to whom the Software is furnished to do
    so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

This software includes Event-to-Promise library under the following license

    Copyright (c) 2014, Julien Fontanet <julien.fontanet@isonoe.net>.

    Permission to use, copy, modify, and/or distribute this software for any purpose
    with or without fee is hereby granted, provided that the above copyright notice
    and this permission notice appear in all copies.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
    FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
    OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
    TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
    THIS SOFTWARE.

*/
this.Twilio=this.Twilio||{},this.Twilio.Sync=function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var r=function(e){return e&&e.Math==Math&&e},i=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")(),o={},a=function(e){try{return!!e()}catch(e){return!0}},s=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),u={},c={}.propertyIsEnumerable,l=Object.getOwnPropertyDescriptor,f=l&&!c.call({1:2},1);u.f=f?function(e){var t=l(this,e);return!!t&&t.enumerable}:c;var d,p,h=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},v={}.toString,y=function(e){return v.call(e).slice(8,-1)},m=y,g="".split,b=a((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==m(e)?g.call(e,""):Object(e)}:Object,k=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},w=b,x=k,_=function(e){return w(x(e))},S=function(e){return"object"==typeof e?null!==e:"function"==typeof e},E=i,T=function(e){return"function"==typeof e?e:void 0},I=function(e,t){return arguments.length<2?T(E[e]):E[e]&&E[e][t]},R=I("navigator","userAgent")||"",O=i,A=R,C=O.process,P=O.Deno,M=C&&C.versions||P&&P.version,j=M&&M.v8;j?p=(d=j.split("."))[0]<4?1:d[0]+d[1]:A&&(!(d=A.match(/Edge\/(\d+)/))||d[1]>=74)&&(d=A.match(/Chrome\/(\d+)/))&&(p=d[1]);var L=p&&+p,N=L,F=a,D=!!Object.getOwnPropertySymbols&&!F((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&N&&N<41})),U=D&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,B=I,q=U?function(e){return"symbol"==typeof e}:function(e){var t=B("Symbol");return"function"==typeof t&&Object(e)instanceof t},W=S,z={exports:{}},G=i,K=function(e,t){try{Object.defineProperty(G,e,{value:t,configurable:!0,writable:!0})}catch(n){G[e]=t}return t},$=K,V="__core-js_shared__",Q=i[V]||$(V,{}),Y=Q;(z.exports=function(e,t){return Y[e]||(Y[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.17.3",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var H=k,J=function(e){return Object(H(e))},X=J,Z={}.hasOwnProperty,ee=Object.hasOwn||function(e,t){return Z.call(X(e),t)},te=0,ne=Math.random(),re=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++te+ne).toString(36)},ie=i,oe=z.exports,ae=ee,se=re,ue=D,ce=U,le=oe("wks"),fe=ie.Symbol,de=ce?fe:fe&&fe.withoutSetter||se,pe=function(e){return ae(le,e)&&(ue||"string"==typeof le[e])||(ue&&ae(fe,e)?le[e]=fe[e]:le[e]=de("Symbol."+e)),le[e]},he=S,ve=q,ye=function(e,t){var n,r;if("string"===t&&"function"==typeof(n=e.toString)&&!W(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!W(r=n.call(e)))return r;if("string"!==t&&"function"==typeof(n=e.toString)&&!W(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},me=pe("toPrimitive"),ge=function(e,t){if(!he(e)||ve(e))return e;var n,r=e[me];if(void 0!==r){if(void 0===t&&(t="default"),n=r.call(e,t),!he(n)||ve(n))return n;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),ye(e,t)},be=ge,ke=q,we=function(e){var t=be(e,"string");return ke(t)?t:String(t)},xe=S,_e=i.document,Se=xe(_e)&&xe(_e.createElement),Ee=function(e){return Se?_e.createElement(e):{}},Te=Ee,Ie=!s&&!a((function(){return 7!=Object.defineProperty(Te("div"),"a",{get:function(){return 7}}).a})),Re=s,Oe=u,Ae=h,Ce=_,Pe=we,Me=ee,je=Ie,Le=Object.getOwnPropertyDescriptor;o.f=Re?Le:function(e,t){if(e=Ce(e),t=Pe(t),je)try{return Le(e,t)}catch(e){}if(Me(e,t))return Ae(!Oe.f.call(e,t),e[t])};var Ne={},Fe=S,De=function(e){if(!Fe(e))throw TypeError(String(e)+" is not an object");return e},Ue=s,Be=Ie,qe=De,We=we,ze=Object.defineProperty;Ne.f=Ue?ze:function(e,t,n){if(qe(e),t=We(t),qe(n),Be)try{return ze(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Ge=Ne,Ke=h,$e=s?function(e,t,n){return Ge.f(e,t,Ke(1,n))}:function(e,t,n){return e[t]=n,e},Ve={exports:{}},Qe=Q,Ye=Function.toString;"function"!=typeof Qe.inspectSource&&(Qe.inspectSource=function(e){return Ye.call(e)});var He,Je,Xe,Ze=Qe.inspectSource,et=Ze,tt=i.WeakMap,nt="function"==typeof tt&&/native code/.test(et(tt)),rt=z.exports,it=re,ot=rt("keys"),at=function(e){return ot[e]||(ot[e]=it(e))},st={},ut=nt,ct=S,lt=$e,ft=ee,dt=Q,pt=at,ht=st,vt="Object already initialized",yt=i.WeakMap;if(ut||dt.state){var mt=dt.state||(dt.state=new yt),gt=mt.get,bt=mt.has,kt=mt.set;He=function(e,t){if(bt.call(mt,e))throw new TypeError(vt);return t.facade=e,kt.call(mt,e,t),t},Je=function(e){return gt.call(mt,e)||{}},Xe=function(e){return bt.call(mt,e)}}else{var wt=pt("state");ht[wt]=!0,He=function(e,t){if(ft(e,wt))throw new TypeError(vt);return t.facade=e,lt(e,wt,t),t},Je=function(e){return ft(e,wt)?e[wt]:{}},Xe=function(e){return ft(e,wt)}}var xt={set:He,get:Je,has:Xe,enforce:function(e){return Xe(e)?Je(e):He(e,{})},getterFor:function(e){return function(t){var n;if(!ct(t)||(n=Je(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},_t=i,St=$e,Et=ee,Tt=K,It=Ze,Rt=xt.get,Ot=xt.enforce,At=String(String).split("String");(Ve.exports=function(e,t,n,r){var i,o=!!r&&!!r.unsafe,a=!!r&&!!r.enumerable,s=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||Et(n,"name")||St(n,"name",t),(i=Ot(n)).source||(i.source=At.join("string"==typeof t?t:""))),e!==_t?(o?!s&&e[t]&&(a=!0):delete e[t],a?e[t]=n:St(e,t,n)):a?e[t]=n:Tt(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&Rt(this).source||It(this)}));var Ct={},Pt=Math.ceil,Mt=Math.floor,jt=function(e){return isNaN(e=+e)?0:(e>0?Mt:Pt)(e)},Lt=jt,Nt=Math.min,Ft=function(e){return e>0?Nt(Lt(e),9007199254740991):0},Dt=jt,Ut=Math.max,Bt=Math.min,qt=function(e,t){var n=Dt(e);return n<0?Ut(n+t,0):Bt(n,t)},Wt=_,zt=Ft,Gt=qt,Kt=function(e){return function(t,n,r){var i,o=Wt(t),a=zt(o.length),s=Gt(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},$t={includes:Kt(!0),indexOf:Kt(!1)},Vt=ee,Qt=_,Yt=$t.indexOf,Ht=st,Jt=function(e,t){var n,r=Qt(e),i=0,o=[];for(n in r)!Vt(Ht,n)&&Vt(r,n)&&o.push(n);for(;t.length>i;)Vt(r,n=t[i++])&&(~Yt(o,n)||o.push(n));return o},Xt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Zt=Jt,en=Xt.concat("length","prototype");Ct.f=Object.getOwnPropertyNames||function(e){return Zt(e,en)};var tn={};tn.f=Object.getOwnPropertySymbols;var nn=Ct,rn=tn,on=De,an=I("Reflect","ownKeys")||function(e){var t=nn.f(on(e)),n=rn.f;return n?t.concat(n(e)):t},sn=ee,un=an,cn=o,ln=Ne,fn=function(e,t){for(var n=un(t),r=ln.f,i=cn.f,o=0;o<n.length;o++){var a=n[o];sn(e,a)||r(e,a,i(t,a))}},dn=a,pn=/#|\.prototype\./,hn=function(e,t){var n=yn[vn(e)];return n==gn||n!=mn&&("function"==typeof t?dn(t):!!t)},vn=hn.normalize=function(e){return String(e).replace(pn,".").toLowerCase()},yn=hn.data={},mn=hn.NATIVE="N",gn=hn.POLYFILL="P",bn=hn,kn=i,wn=o.f,xn=$e,_n=Ve.exports,Sn=K,En=fn,Tn=bn,In=function(e,t){var n,r,i,o,a,s=e.target,u=e.global,c=e.stat;if(n=u?kn:c?kn[s]||Sn(s,{}):(kn[s]||{}).prototype)for(r in t){if(o=t[r],i=e.noTargetGet?(a=wn(n,r))&&a.value:n[r],!Tn(u?r:s+(c?".":"#")+r,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;En(o,i)}(e.sham||i&&i.sham)&&xn(o,"sham",!0),_n(n,r,o,e)}},Rn=Jt,On=Xt,An=Object.keys||function(e){return Rn(e,On)},Cn=J,Pn=An;In({target:"Object",stat:!0,forced:a((function(){Pn(1)}))},{keys:function(e){return Pn(Cn(e))}});var Mn,jn=y,Ln=Array.isArray||function(e){return"Array"==jn(e)},Nn=q,Fn=function(e){if(Nn(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)},Dn=Ne,Un=De,Bn=An,qn=s?Object.defineProperties:function(e,t){Un(e);for(var n,r=Bn(t),i=r.length,o=0;i>o;)Dn.f(e,n=r[o++],t[n]);return e},Wn=I("document","documentElement"),zn=De,Gn=qn,Kn=Xt,$n=st,Vn=Wn,Qn=Ee,Yn=at("IE_PROTO"),Hn=function(){},Jn=function(e){return"<script>"+e+"</"+"script>"},Xn=function(e){e.write(Jn("")),e.close();var t=e.parentWindow.Object;return e=null,t},Zn=function(){try{Mn=new ActiveXObject("htmlfile")}catch(e){}var e,t;Zn="undefined"!=typeof document?document.domain&&Mn?Xn(Mn):((t=Qn("iframe")).style.display="none",Vn.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Jn("document.F=Object")),e.close(),e.F):Xn(Mn);for(var n=Kn.length;n--;)delete Zn.prototype[Kn[n]];return Zn()};$n[Yn]=!0;var er=Object.create||function(e,t){var n;return null!==e?(Hn.prototype=zn(e),n=new Hn,Hn.prototype=null,n[Yn]=e):n=Zn(),void 0===t?n:Gn(n,t)},tr={},nr=_,rr=Ct.f,ir={}.toString,or="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];tr.f=function(e){return or&&"[object Window]"==ir.call(e)?function(e){try{return rr(e)}catch(e){return or.slice()}}(e):rr(nr(e))};var ar={},sr=pe;ar.f=sr;var ur=i,cr=ee,lr=ar,fr=Ne.f,dr=function(e){var t=ur.Symbol||(ur.Symbol={});cr(t,e)||fr(t,e,{value:lr.f(e)})},pr=Ne.f,hr=ee,vr=pe("toStringTag"),yr=function(e,t,n){e&&!hr(e=n?e:e.prototype,vr)&&pr(e,vr,{configurable:!0,value:t})},mr=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},gr=mr,br=function(e,t,n){if(gr(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},kr=S,wr=Ln,xr=pe("species"),_r=function(e){var t;return wr(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!wr(t.prototype)?kr(t)&&null===(t=t[xr])&&(t=void 0):t=void 0),void 0===t?Array:t},Sr=function(e,t){return new(_r(e))(0===t?0:t)},Er=br,Tr=b,Ir=J,Rr=Ft,Or=Sr,Ar=[].push,Cr=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(u,c,l,f){for(var d,p,h=Ir(u),v=Tr(h),y=Er(c,l,3),m=Rr(v.length),g=0,b=f||Or,k=t?b(u,m):n||a?b(u,0):void 0;m>g;g++)if((s||g in v)&&(p=y(d=v[g],g,h),e))if(t)k[g]=p;else if(p)switch(e){case 3:return!0;case 5:return d;case 6:return g;case 2:Ar.call(k,d)}else switch(e){case 4:return!1;case 7:Ar.call(k,d)}return o?-1:r||i?i:k}},Pr={forEach:Cr(0),map:Cr(1),filter:Cr(2),some:Cr(3),every:Cr(4),find:Cr(5),findIndex:Cr(6),filterReject:Cr(7)},Mr=In,jr=i,Lr=I,Nr=s,Fr=D,Dr=a,Ur=ee,Br=Ln,qr=S,Wr=q,zr=De,Gr=J,Kr=_,$r=we,Vr=Fn,Qr=h,Yr=er,Hr=An,Jr=Ct,Xr=tr,Zr=tn,ei=o,ti=Ne,ni=u,ri=$e,ii=Ve.exports,oi=z.exports,ai=st,si=re,ui=pe,ci=ar,li=dr,fi=yr,di=xt,pi=Pr.forEach,hi=at("hidden"),vi="Symbol",yi=ui("toPrimitive"),mi=di.set,gi=di.getterFor(vi),bi=Object.prototype,ki=jr.Symbol,wi=Lr("JSON","stringify"),xi=ei.f,_i=ti.f,Si=Xr.f,Ei=ni.f,Ti=oi("symbols"),Ii=oi("op-symbols"),Ri=oi("string-to-symbol-registry"),Oi=oi("symbol-to-string-registry"),Ai=oi("wks"),Ci=jr.QObject,Pi=!Ci||!Ci.prototype||!Ci.prototype.findChild,Mi=Nr&&Dr((function(){return 7!=Yr(_i({},"a",{get:function(){return _i(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=xi(bi,t);r&&delete bi[t],_i(e,t,n),r&&e!==bi&&_i(bi,t,r)}:_i,ji=function(e,t){var n=Ti[e]=Yr(ki.prototype);return mi(n,{type:vi,tag:e,description:t}),Nr||(n.description=t),n},Li=function(e,t,n){e===bi&&Li(Ii,t,n),zr(e);var r=$r(t);return zr(n),Ur(Ti,r)?(n.enumerable?(Ur(e,hi)&&e[hi][r]&&(e[hi][r]=!1),n=Yr(n,{enumerable:Qr(0,!1)})):(Ur(e,hi)||_i(e,hi,Qr(1,{})),e[hi][r]=!0),Mi(e,r,n)):_i(e,r,n)},Ni=function(e,t){zr(e);var n=Kr(t),r=Hr(n).concat(Bi(n));return pi(r,(function(t){Nr&&!Fi.call(n,t)||Li(e,t,n[t])})),e},Fi=function(e){var t=$r(e),n=Ei.call(this,t);return!(this===bi&&Ur(Ti,t)&&!Ur(Ii,t))&&(!(n||!Ur(this,t)||!Ur(Ti,t)||Ur(this,hi)&&this[hi][t])||n)},Di=function(e,t){var n=Kr(e),r=$r(t);if(n!==bi||!Ur(Ti,r)||Ur(Ii,r)){var i=xi(n,r);return!i||!Ur(Ti,r)||Ur(n,hi)&&n[hi][r]||(i.enumerable=!0),i}},Ui=function(e){var t=Si(Kr(e)),n=[];return pi(t,(function(e){Ur(Ti,e)||Ur(ai,e)||n.push(e)})),n},Bi=function(e){var t=e===bi,n=Si(t?Ii:Kr(e)),r=[];return pi(n,(function(e){!Ur(Ti,e)||t&&!Ur(bi,e)||r.push(Ti[e])})),r};(Fr||(ii((ki=function(){if(this instanceof ki)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Vr(arguments[0]):void 0,t=si(e),n=function(e){this===bi&&n.call(Ii,e),Ur(this,hi)&&Ur(this[hi],t)&&(this[hi][t]=!1),Mi(this,t,Qr(1,e))};return Nr&&Pi&&Mi(bi,t,{configurable:!0,set:n}),ji(t,e)}).prototype,"toString",(function(){return gi(this).tag})),ii(ki,"withoutSetter",(function(e){return ji(si(e),e)})),ni.f=Fi,ti.f=Li,ei.f=Di,Jr.f=Xr.f=Ui,Zr.f=Bi,ci.f=function(e){return ji(ui(e),e)},Nr&&(_i(ki.prototype,"description",{configurable:!0,get:function(){return gi(this).description}}),ii(bi,"propertyIsEnumerable",Fi,{unsafe:!0}))),Mr({global:!0,wrap:!0,forced:!Fr,sham:!Fr},{Symbol:ki}),pi(Hr(Ai),(function(e){li(e)})),Mr({target:vi,stat:!0,forced:!Fr},{for:function(e){var t=Vr(e);if(Ur(Ri,t))return Ri[t];var n=ki(t);return Ri[t]=n,Oi[n]=t,n},keyFor:function(e){if(!Wr(e))throw TypeError(e+" is not a symbol");if(Ur(Oi,e))return Oi[e]},useSetter:function(){Pi=!0},useSimple:function(){Pi=!1}}),Mr({target:"Object",stat:!0,forced:!Fr,sham:!Nr},{create:function(e,t){return void 0===t?Yr(e):Ni(Yr(e),t)},defineProperty:Li,defineProperties:Ni,getOwnPropertyDescriptor:Di}),Mr({target:"Object",stat:!0,forced:!Fr},{getOwnPropertyNames:Ui,getOwnPropertySymbols:Bi}),Mr({target:"Object",stat:!0,forced:Dr((function(){Zr.f(1)}))},{getOwnPropertySymbols:function(e){return Zr.f(Gr(e))}}),wi)&&Mr({target:"JSON",stat:!0,forced:!Fr||Dr((function(){var e=ki();return"[null]"!=wi([e])||"{}"!=wi({a:e})||"{}"!=wi(Object(e))}))},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(qr(t)||void 0!==e)&&!Wr(e))return Br(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Wr(t))return t}),i[1]=t,wi.apply(null,i)}});ki.prototype[yi]||ri(ki.prototype,yi,ki.prototype.valueOf),fi(ki,vi),ai[hi]=!0;var qi=a,Wi=L,zi=pe("species"),Gi=function(e){return Wi>=51||!qi((function(){var t=[];return(t.constructor={})[zi]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Ki=Pr.filter;In({target:"Array",proto:!0,forced:!Gi("filter")},{filter:function(e){return Ki(this,e,arguments.length>1?arguments[1]:void 0)}});var $i=In,Vi=a,Qi=_,Yi=o.f,Hi=s,Ji=Vi((function(){Yi(1)}));$i({target:"Object",stat:!0,forced:!Hi||Ji,sham:!Hi},{getOwnPropertyDescriptor:function(e,t){return Yi(Qi(e),t)}});var Xi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Zi=Ee("span").classList,eo=Zi&&Zi.constructor&&Zi.constructor.prototype,to=eo===Object.prototype?void 0:eo,no=a,ro=function(e,t){var n=[][e];return!!n&&no((function(){n.call(null,t||function(){throw 1},1)}))},io=Pr.forEach,oo=i,ao=Xi,so=to,uo=ro("forEach")?[].forEach:function(e){return io(this,e,arguments.length>1?arguments[1]:void 0)},co=$e,lo=function(e){if(e&&e.forEach!==uo)try{co(e,"forEach",uo)}catch(t){e.forEach=uo}};for(var fo in ao)lo(oo[fo]&&oo[fo].prototype);lo(so);var po=we,ho=Ne,vo=h,yo=function(e,t,n){var r=po(t);r in e?ho.f(e,r,vo(0,n)):e[r]=n},mo=an,go=_,bo=o,ko=yo;In({target:"Object",stat:!0,sham:!s},{getOwnPropertyDescriptors:function(e){for(var t,n,r=go(e),i=bo.f,o=mo(r),a={},s=0;o.length>s;)void 0!==(n=i(r,t=o[s++]))&&ko(a,t,n);return a}});var wo=mr,xo=S,_o=[].slice,So={},Eo=function(e,t,n){if(!(t in So)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";So[t]=Function("C,a","return new C("+r.join(",")+")")}return So[t](e,n)},To=Function.bind||function(e){var t=wo(this),n=_o.call(arguments,1),r=function(){var i=n.concat(_o.call(arguments));return this instanceof r?Eo(t,i.length,i):t.apply(e,i)};return xo(t.prototype)&&(r.prototype=t.prototype),r},Io=In,Ro=mr,Oo=De,Ao=S,Co=er,Po=To,Mo=a,jo=I("Reflect","construct"),Lo=Mo((function(){function e(){}return!(jo((function(){}),[],e)instanceof e)})),No=!Mo((function(){jo((function(){}))})),Fo=Lo||No;function Do(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Uo(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Do(o,r,i,a,s,"next",e)}function s(e){Do(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Bo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wo(e,t,n){return t&&qo(e.prototype,t),n&&qo(e,n),e}function zo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Go(e,t){return(Go=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ko(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Go(e,t)}function $o(e){return($o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vo(e,t){return!t||"object"!==$o(t)&&"function"!=typeof t?zo(e):t}function Qo(e){return(Qo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Io({target:"Reflect",stat:!0,forced:Fo,sham:Fo},{construct:function(e,t){Ro(e),Oo(t);var n=arguments.length<3?e:Ro(arguments[2]);if(No&&!Lo)return jo(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(Po.apply(e,r))}var i=n.prototype,o=Co(Ao(i)?i:Object.prototype),a=Function.apply.call(e,o,t);return Ao(a)?a:o}});var Ho=Pr.map;In({target:"Array",proto:!0,forced:!Gi("map")},{map:function(e){return Ho(this,e,arguments.length>1?arguments[1]:void 0)}});var Jo={};Jo[pe("toStringTag")]="z";var Xo="[object z]"===String(Jo),Zo=Xo,ea=y,ta=pe("toStringTag"),na="Arguments"==ea(function(){return arguments}()),ra=Zo?ea:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),ta))?n:na?ea(t):"Object"==(r=ea(t))&&"function"==typeof t.callee?"Arguments":r},ia=ra,oa=Xo?{}.toString:function(){return"[object "+ia(this)+"]"},aa=Xo,sa=Ve.exports,ua=oa;aa||sa(Object.prototype,"toString",ua,{unsafe:!0});var ca=i.Promise,la=Ve.exports,fa=function(e,t,n){for(var r in t)la(e,r,t[r],n);return e},da=S,pa=De,ha=function(e){if(!da(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e},va=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return pa(n),ha(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),ya=I,ma=Ne,ga=s,ba=pe("species"),ka=function(e){var t=ya(e),n=ma.f;ga&&t&&!t[ba]&&n(t,ba,{configurable:!0,get:function(){return this}})},wa=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},xa={},_a=xa,Sa=pe("iterator"),Ea=Array.prototype,Ta=function(e){return void 0!==e&&(_a.Array===e||Ea[Sa]===e)},Ia=ra,Ra=xa,Oa=pe("iterator"),Aa=function(e){if(null!=e)return e[Oa]||e["@@iterator"]||Ra[Ia(e)]},Ca=De,Pa=Aa,Ma=function(e,t){var n=arguments.length<2?Pa(e):t;if("function"!=typeof n)throw TypeError(String(e)+" is not iterable");return Ca(n.call(e))},ja=De,La=function(e,t,n){var r,i;ja(e);try{if(void 0===(r=e.return)){if("throw"===t)throw n;return n}r=r.call(e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return ja(r),n},Na=De,Fa=Ta,Da=Ft,Ua=br,Ba=Ma,qa=Aa,Wa=La,za=function(e,t){this.stopped=e,this.result=t},Ga=function(e,t,n){var r,i,o,a,s,u,c,l=n&&n.that,f=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),h=Ua(t,l,1+f+p),v=function(e){return r&&Wa(r,"normal",e),new za(!0,e)},y=function(e){return f?(Na(e),p?h(e[0],e[1],v):h(e[0],e[1])):p?h(e,v):h(e)};if(d)r=e;else{if("function"!=typeof(i=qa(e)))throw TypeError("Target is not iterable");if(Fa(i)){for(o=0,a=Da(e.length);a>o;o++)if((s=y(e[o]))&&s instanceof za)return s;return new za(!1)}r=Ba(e,i)}for(u=r.next;!(c=u.call(r)).done;){try{s=y(c.value)}catch(e){Wa(r,"throw",e)}if("object"==typeof s&&s&&s instanceof za)return s}return new za(!1)},Ka=pe("iterator"),$a=!1;try{var Va=0,Qa={next:function(){return{done:!!Va++}},return:function(){$a=!0}};Qa[Ka]=function(){return this},Array.from(Qa,(function(){throw 2}))}catch(e){}var Ya,Ha,Ja,Xa,Za=function(e,t){if(!t&&!$a)return!1;var n=!1;try{var r={};r[Ka]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},es=De,ts=mr,ns=pe("species"),rs=function(e,t){var n,r=es(e).constructor;return void 0===r||null==(n=es(r)[ns])?t:ts(n)},is=/(?:ipad|iphone|ipod).*applewebkit/i.test(R),os="process"==y(i.process),as=i,ss=a,us=br,cs=Wn,ls=Ee,fs=is,ds=os,ps=as.setImmediate,hs=as.clearImmediate,vs=as.process,ys=as.MessageChannel,ms=as.Dispatch,gs=0,bs={},ks="onreadystatechange";try{Ya=as.location}catch(e){}var ws=function(e){if(bs.hasOwnProperty(e)){var t=bs[e];delete bs[e],t()}},xs=function(e){return function(){ws(e)}},_s=function(e){ws(e.data)},Ss=function(e){as.postMessage(String(e),Ya.protocol+"//"+Ya.host)};ps&&hs||(ps=function(e){for(var t=[],n=arguments.length,r=1;n>r;)t.push(arguments[r++]);return bs[++gs]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Ha(gs),gs},hs=function(e){delete bs[e]},ds?Ha=function(e){vs.nextTick(xs(e))}:ms&&ms.now?Ha=function(e){ms.now(xs(e))}:ys&&!fs?(Xa=(Ja=new ys).port2,Ja.port1.onmessage=_s,Ha=us(Xa.postMessage,Xa,1)):as.addEventListener&&"function"==typeof postMessage&&!as.importScripts&&Ya&&"file:"!==Ya.protocol&&!ss(Ss)?(Ha=Ss,as.addEventListener("message",_s,!1)):Ha=ks in ls("script")?function(e){cs.appendChild(ls("script")).onreadystatechange=function(){cs.removeChild(this),ws(e)}}:function(e){setTimeout(xs(e),0)});var Es,Ts,Is,Rs,Os,As,Cs,Ps,Ms={set:ps,clear:hs},js=i,Ls=/ipad|iphone|ipod/i.test(R)&&void 0!==js.Pebble,Ns=/web0s(?!.*chrome)/i.test(R),Fs=i,Ds=o.f,Us=Ms.set,Bs=is,qs=Ls,Ws=Ns,zs=os,Gs=Fs.MutationObserver||Fs.WebKitMutationObserver,Ks=Fs.document,$s=Fs.process,Vs=Fs.Promise,Qs=Ds(Fs,"queueMicrotask"),Ys=Qs&&Qs.value;Ys||(Es=function(){var e,t;for(zs&&(e=$s.domain)&&e.exit();Ts;){t=Ts.fn,Ts=Ts.next;try{t()}catch(e){throw Ts?Rs():Is=void 0,e}}Is=void 0,e&&e.enter()},Bs||zs||Ws||!Gs||!Ks?!qs&&Vs&&Vs.resolve?((Cs=Vs.resolve(void 0)).constructor=Vs,Ps=Cs.then,Rs=function(){Ps.call(Cs,Es)}):Rs=zs?function(){$s.nextTick(Es)}:function(){Us.call(Fs,Es)}:(Os=!0,As=Ks.createTextNode(""),new Gs(Es).observe(As,{characterData:!0}),Rs=function(){As.data=Os=!Os}));var Hs=Ys||function(e){var t={fn:e,next:void 0};Is&&(Is.next=t),Ts||(Ts=t,Rs()),Is=t},Js={},Xs=mr,Zs=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=Xs(t),this.reject=Xs(n)};Js.f=function(e){return new Zs(e)};var eu,tu,nu,ru,iu=De,ou=S,au=Js,su=i,uu="object"==typeof window,cu=In,lu=i,fu=I,du=ca,pu=Ve.exports,hu=fa,vu=va,yu=yr,mu=ka,gu=S,bu=mr,ku=wa,wu=Ze,xu=Ga,_u=Za,Su=rs,Eu=Ms.set,Tu=Hs,Iu=function(e,t){if(iu(e),ou(t)&&t.constructor===e)return t;var n=au.f(e);return(0,n.resolve)(t),n.promise},Ru=function(e,t){var n=su.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},Ou=Js,Au=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Cu=xt,Pu=bn,Mu=uu,ju=os,Lu=L,Nu=pe("species"),Fu="Promise",Du=Cu.get,Uu=Cu.set,Bu=Cu.getterFor(Fu),qu=du&&du.prototype,Wu=du,zu=qu,Gu=lu.TypeError,Ku=lu.document,$u=lu.process,Vu=Ou.f,Qu=Vu,Yu=!!(Ku&&Ku.createEvent&&lu.dispatchEvent),Hu="function"==typeof PromiseRejectionEvent,Ju="unhandledrejection",Xu=!1,Zu=Pu(Fu,(function(){var e=wu(Wu),t=e!==String(Wu);if(!t&&66===Lu)return!0;if(Lu>=51&&/native code/.test(e))return!1;var n=new Wu((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[Nu]=r,!(Xu=n.then((function(){}))instanceof r)||!t&&Mu&&!Hu})),ec=Zu||!_u((function(e){Wu.all(e).catch((function(){}))})),tc=function(e){var t;return!(!gu(e)||"function"!=typeof(t=e.then))&&t},nc=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;Tu((function(){for(var r=e.value,i=1==e.state,o=0;n.length>o;){var a,s,u,c=n[o++],l=i?c.ok:c.fail,f=c.resolve,d=c.reject,p=c.domain;try{l?(i||(2===e.rejection&&ac(e),e.rejection=1),!0===l?a=r:(p&&p.enter(),a=l(r),p&&(p.exit(),u=!0)),a===c.promise?d(Gu("Promise-chain cycle")):(s=tc(a))?s.call(a,f,d):f(a)):d(r)}catch(e){p&&!u&&p.exit(),d(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&ic(e)}))}},rc=function(e,t,n){var r,i;Yu?((r=Ku.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),lu.dispatchEvent(r)):r={promise:t,reason:n},!Hu&&(i=lu["on"+e])?i(r):e===Ju&&Ru("Unhandled promise rejection",n)},ic=function(e){Eu.call(lu,(function(){var t,n=e.facade,r=e.value;if(oc(e)&&(t=Au((function(){ju?$u.emit("unhandledRejection",r,n):rc(Ju,n,r)})),e.rejection=ju||oc(e)?2:1,t.error))throw t.value}))},oc=function(e){return 1!==e.rejection&&!e.parent},ac=function(e){Eu.call(lu,(function(){var t=e.facade;ju?$u.emit("rejectionHandled",t):rc("rejectionhandled",t,e.value)}))},sc=function(e,t,n){return function(r){e(t,r,n)}},uc=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,nc(e,!0))},cc=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Gu("Promise can't be resolved itself");var r=tc(t);r?Tu((function(){var n={done:!1};try{r.call(t,sc(cc,n,e),sc(uc,n,e))}catch(t){uc(n,t,e)}})):(e.value=t,e.state=1,nc(e,!1))}catch(t){uc({done:!1},t,e)}}};if(Zu&&(zu=(Wu=function(e){ku(this,Wu,Fu),bu(e),eu.call(this);var t=Du(this);try{e(sc(cc,t),sc(uc,t))}catch(e){uc(t,e)}}).prototype,(eu=function(e){Uu(this,{type:Fu,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=hu(zu,{then:function(e,t){var n=Bu(this),r=Vu(Su(this,Wu));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=ju?$u.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&nc(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),tu=function(){var e=new eu,t=Du(e);this.promise=e,this.resolve=sc(cc,t),this.reject=sc(uc,t)},Ou.f=Vu=function(e){return e===Wu||e===nu?new tu(e):Qu(e)},"function"==typeof du&&qu!==Object.prototype)){ru=qu.then,Xu||(pu(qu,"then",(function(e,t){var n=this;return new Wu((function(e,t){ru.call(n,e,t)})).then(e,t)}),{unsafe:!0}),pu(qu,"catch",zu.catch,{unsafe:!0}));try{delete qu.constructor}catch(e){}vu&&vu(qu,zu)}cu({global:!0,wrap:!0,forced:Zu},{Promise:Wu}),yu(Wu,Fu,!1),mu(Fu),nu=fu(Fu),cu({target:Fu,stat:!0,forced:Zu},{reject:function(e){var t=Vu(this);return t.reject.call(void 0,e),t.promise}}),cu({target:Fu,stat:!0,forced:Zu},{resolve:function(e){return Iu(this,e)}}),cu({target:Fu,stat:!0,forced:ec},{all:function(e){var t=this,n=Vu(t),r=n.resolve,i=n.reject,o=Au((function(){var n=bu(t.resolve),o=[],a=0,s=1;xu(e,(function(e){var u=a++,c=!1;o.push(void 0),s++,n.call(t,e).then((function(e){c||(c=!0,o[u]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=Vu(t),r=n.reject,i=Au((function(){var i=bu(t.resolve);xu(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var lc,fc=Object.prototype,dc=fc.hasOwnProperty,pc="function"==typeof Symbol?Symbol:{},hc=pc.iterator||"@@iterator",vc=pc.asyncIterator||"@@asyncIterator",yc=pc.toStringTag||"@@toStringTag";function mc(e,t,n,r){var i=t&&t.prototype instanceof Sc?t:Sc,o=Object.create(i.prototype),a=new Fc(r||[]);return o._invoke=function(e,t,n){var r=bc;return function(i,o){if(r===wc)throw new Error("Generator is already running");if(r===xc){if("throw"===i)throw o;return Uc()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=jc(a,n);if(s){if(s===_c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===bc)throw r=xc,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=wc;var u=gc(e,t,n);if("normal"===u.type){if(r=n.done?xc:kc,u.arg===_c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=xc,n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function gc(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}var bc="suspendedStart",kc="suspendedYield",wc="executing",xc="completed",_c={};function Sc(){}function Ec(){}function Tc(){}var Ic={};Ic[hc]=function(){return this};var Rc=Object.getPrototypeOf,Oc=Rc&&Rc(Rc(Dc([])));Oc&&Oc!==fc&&dc.call(Oc,hc)&&(Ic=Oc);var Ac=Tc.prototype=Sc.prototype=Object.create(Ic);function Cc(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function Pc(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===Ec||"GeneratorFunction"===(t.displayName||t.name))}function Mc(e,t){function n(r,i,o,a){var s=gc(e[r],e,i);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"===$o(c)&&dc.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):t.resolve(c).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,a)}))}a(s.arg)}var r;this._invoke=function(e,i){function o(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(o,o):o()}}function jc(e,t){var n=e.iterator[t.method];if(n===lc){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=lc,jc(e,t),"throw"===t.method))return _c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return _c}var r=gc(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,_c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=lc),t.delegate=null,_c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,_c)}function Lc(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function Nc(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Fc(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(Lc,this),this.reset(!0)}function Dc(e){if(e){var t=e[hc];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(dc.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=lc,t.done=!0,t};return r.next=r}}return{next:Uc}}function Uc(){return{value:lc,done:!0}}Ec.prototype=Ac.constructor=Tc,Tc.constructor=Ec,Tc[yc]=Ec.displayName="GeneratorFunction",Cc(Mc.prototype),Mc.prototype[vc]=function(){return this},Cc(Ac),Ac[yc]="Generator",Ac[hc]=function(){return this},Ac.toString=function(){return"[object Generator]"},Fc.prototype={constructor:Fc,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=lc,this.done=!1,this.delegate=null,this.method="next",this.arg=lc,this.tryEntries.forEach(Nc),!e)for(var t in this)"t"===t.charAt(0)&&dc.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=lc)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=lc),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var a=dc.call(i,"catchLoc"),s=dc.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&dc.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,_c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),Nc(n),_c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;Nc(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:Dc(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=lc),_c}};var Bc={wrap:mc,isGeneratorFunction:Pc,AsyncIterator:Mc,mark:function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,Tc):(e.__proto__=Tc,yc in e||(e[yc]="GeneratorFunction")),e.prototype=Object.create(Ac),e},awrap:function(e){return{__await:e}},async:function(e,t,n,r,i){void 0===i&&(i=Promise);var o=new Mc(mc(e,t,n,r),i);return Pc(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},keys:function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},values:Dc},qc=Object.freeze({__proto__:null,default:Bc});function Wc(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":$o(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function zc(e,t){if("object"===("undefined"==typeof Reflect?"undefined":$o(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function Gc(){}function Kc(){Kc.init.call(this)}function $c(e){return void 0===e._maxListeners?Kc.defaultMaxListeners:e._maxListeners}function Vc(e,t,n){if(t)e.call(n);else for(var r=e.length,i=tl(e,r),o=0;o<r;++o)i[o].call(n)}function Qc(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=tl(e,i),a=0;a<i;++a)o[a].call(n,r)}function Yc(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=tl(e,o),s=0;s<o;++s)a[s].call(n,r,i)}function Hc(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=tl(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}function Jc(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=tl(e,i),a=0;a<i;++a)o[a].apply(n,r)}function Xc(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new Gc,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=$c(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[t]=n,++e._eventsCount;return e}function Zc(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function el(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function tl(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}Gc.prototype=Object.create(null),Kc.EventEmitter=Kc,Kc.usingDomains=!1,Kc.prototype.domain=void 0,Kc.prototype._events=void 0,Kc.prototype._maxListeners=void 0,Kc.defaultMaxListeners=10,Kc.init=function(){this.domain=null,Kc.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Gc,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Kc.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Kc.prototype.getMaxListeners=function(){return $c(this)},Kc.prototype.emit=function(e){var t,n,r,i,o,a,s,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:Vc(n,l,this);break;case 2:Qc(n,l,this,arguments[1]);break;case 3:Yc(n,l,this,arguments[1],arguments[2]);break;case 4:Hc(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];Jc(n,l,this,i)}return!0},Kc.prototype.addListener=function(e,t){return Xc(this,e,t,!1)},Kc.prototype.on=Kc.prototype.addListener,Kc.prototype.prependListener=function(e,t){return Xc(this,e,t,!0)},Kc.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Zc(this,e,t)),this},Kc.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Zc(this,e,t)),this},Kc.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new Gc:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Gc,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},Kc.prototype.off=function(e,t){return this.removeListener(e,t)},Kc.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Gc,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new Gc:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new Gc,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Kc.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},Kc.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):el.call(e,t)},Kc.prototype.listenerCount=el,Kc.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var nl={},rl=In,il=S,ol=Ln,al=qt,sl=Ft,ul=_,cl=yo,ll=pe,fl=Gi("slice"),dl=ll("species"),pl=[].slice,hl=Math.max;rl({target:"Array",proto:!0,forced:!fl},{slice:function(e,t){var n,r,i,o=ul(this),a=sl(o.length),s=al(e,a),u=al(void 0===t?a:t,a);if(ol(o)&&("function"!=typeof(n=o.constructor)||n!==Array&&!ol(n.prototype)?il(n)&&null===(n=n[dl])&&(n=void 0):n=void 0,n===Array||void 0===n))return pl.call(o,s,u);for(r=new(void 0===n?Array:n)(hl(u-s,0)),i=0;s<u;s++,i++)s in o&&cl(r,i,o[s]);return r.length=i,r}});var vl=De,yl=La,ml=br,gl=J,bl=function(e,t,n,r){try{return r?t(vl(n)[0],n[1]):t(n)}catch(t){yl(e,"throw",t)}},kl=Ta,wl=Ft,xl=yo,_l=Ma,Sl=Aa,El=function(e){var t,n,r,i,o,a,s=gl(e),u="function"==typeof this?this:Array,c=arguments.length,l=c>1?arguments[1]:void 0,f=void 0!==l,d=Sl(s),p=0;if(f&&(l=ml(l,c>2?arguments[2]:void 0,2)),null==d||u==Array&&kl(d))for(n=new u(t=wl(s.length));t>p;p++)a=f?l(s[p],p):s[p],xl(n,p,a);else for(o=(i=_l(s,d)).next,n=new u;!(r=o.call(i)).done;p++)a=f?bl(i,l,[r.value,p],!0):r.value,xl(n,p,a);return n.length=p,n};In({target:"Array",stat:!0,forced:!Za((function(e){Array.from(e)}))},{from:El});var Tl,Il,Rl,Ol=jt,Al=Fn,Cl=k,Pl=function(e){return function(t,n){var r,i,o=Al(Cl(t)),a=Ol(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?e?o.charAt(a):r:e?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}},Ml={codeAt:Pl(!1),charAt:Pl(!0)},jl=!a((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Ll=ee,Nl=J,Fl=jl,Dl=at("IE_PROTO"),Ul=Object.prototype,Bl=Fl?Object.getPrototypeOf:function(e){return e=Nl(e),Ll(e,Dl)?e[Dl]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Ul:null},ql=a,Wl=Bl,zl=$e,Gl=pe("iterator"),Kl=!1;[].keys&&("next"in(Rl=[].keys())?(Il=Wl(Wl(Rl)))!==Object.prototype&&(Tl=Il):Kl=!0),(null==Tl||ql((function(){var e={};return Tl[Gl].call(e)!==e})))&&(Tl={}),"function"!=typeof Tl[Gl]&&zl(Tl,Gl,(function(){return this}));var $l={IteratorPrototype:Tl,BUGGY_SAFARI_ITERATORS:Kl},Vl=$l.IteratorPrototype,Ql=er,Yl=h,Hl=yr,Jl=xa,Xl=function(){return this},Zl=In,ef=function(e,t,n){var r=t+" Iterator";return e.prototype=Ql(Vl,{next:Yl(1,n)}),Hl(e,r,!1),Jl[r]=Xl,e},tf=Bl,nf=va,rf=yr,of=$e,af=Ve.exports,sf=xa,uf=$l.IteratorPrototype,cf=$l.BUGGY_SAFARI_ITERATORS,lf=pe("iterator"),ff="keys",df="values",pf="entries",hf=function(){return this},vf=function(e,t,n,r,i,o,a){ef(n,t,r);var s,u,c,l=function(e){if(e===i&&v)return v;if(!cf&&e in p)return p[e];switch(e){case ff:case df:case pf:return function(){return new n(this,e)}}return function(){return new n(this)}},f=t+" Iterator",d=!1,p=e.prototype,h=p[lf]||p["@@iterator"]||i&&p[i],v=!cf&&h||l(i),y="Array"==t&&p.entries||h;if(y&&(s=tf(y.call(new e)))!==Object.prototype&&s.next&&(tf(s)!==uf&&(nf?nf(s,uf):"function"!=typeof s[lf]&&of(s,lf,hf)),rf(s,f,!0)),i==df&&h&&h.name!==df&&(d=!0,v=function(){return h.call(this)}),p[lf]!==v&&of(p,lf,v),sf[t]=v,i)if(u={values:l(df),keys:o?v:l(ff),entries:l(pf)},a)for(c in u)(cf||d||!(c in p))&&af(p,c,u[c]);else Zl({target:t,proto:!0,forced:cf||d},u);return u},yf=Ml.charAt,mf=Fn,gf=xt,bf=vf,kf="String Iterator",wf=gf.set,xf=gf.getterFor(kf);bf(String,"String",(function(e){wf(this,{type:kf,string:mf(e),index:0})}),(function(){var e,t=xf(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=yf(n,r),t.index+=e.length,{value:e,done:!1})}));var _f=In,Sf=s,Ef=i,Tf=ee,If=S,Rf=Ne.f,Of=fn,Af=Ef.Symbol;if(Sf&&"function"==typeof Af&&(!("description"in Af.prototype)||void 0!==Af().description)){var Cf={},Pf=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Pf?new Af(e):void 0===e?Af():Af(e);return""===e&&(Cf[t]=!0),t};Of(Pf,Af);var Mf=Pf.prototype=Af.prototype;Mf.constructor=Pf;var jf=Mf.toString,Lf="Symbol(test)"==String(Af("test")),Nf=/^Symbol\((.*)\)[^)]+$/;Rf(Mf,"description",{configurable:!0,get:function(){var e=If(this)?this.valueOf():this,t=jf.call(e);if(Tf(Cf,e))return"";var n=Lf?t.slice(7,-1):t.replace(Nf,"$1");return""===n?void 0:n}}),_f({global:!0,forced:!0},{Symbol:Pf})}dr("iterator");var Ff=er,Df=Ne,Uf=pe("unscopables"),Bf=Array.prototype;null==Bf[Uf]&&Df.f(Bf,Uf,{configurable:!0,value:Ff(null)});var qf=function(e){Bf[Uf][e]=!0},Wf=_,zf=qf,Gf=xa,Kf=xt,$f=vf,Vf="Array Iterator",Qf=Kf.set,Yf=Kf.getterFor(Vf),Hf=$f(Array,"Array",(function(e,t){Qf(this,{type:Vf,target:Wf(e),index:0,kind:t})}),(function(){var e=Yf(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");Gf.Arguments=Gf.Array,zf("keys"),zf("values"),zf("entries");var Jf=i,Xf=Xi,Zf=to,ed=Hf,td=$e,nd=pe,rd=nd("iterator"),id=nd("toStringTag"),od=ed.values,ad=function(e,t){if(e){if(e[rd]!==od)try{td(e,rd,od)}catch(t){e[rd]=od}if(e[id]||td(e,id,t),Xf[t])for(var n in ed)if(e[n]!==ed[n])try{td(e,n,ed[n])}catch(t){e[n]=ed[n]}}};for(var sd in Xf)ad(Jf[sd]&&Jf[sd].prototype,sd);ad(Zf,"DOMTokenList");var ud={exports:{}};!function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(ud);var cd=s,ld=Ne.f,fd=Function.prototype,dd=fd.toString,pd=/^\s*function ([^ (]*)/,hd="name";cd&&!(hd in fd)&&ld(fd,hd,{configurable:!0,get:function(){try{return dd.call(this).match(pd)[1]}catch(e){return""}}});var vd=S,yd=Math.floor,md=function(e){return!vd(e)&&isFinite(e)&&yd(e)===e};In({target:"Number",stat:!0},{isInteger:md});var gd=S,bd=va,kd=function(e,t,n){var r,i;return bd&&"function"==typeof(r=t.constructor)&&r!==n&&gd(i=r.prototype)&&i!==n.prototype&&bd(e,i),e},wd=k,xd=Fn,_d="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",Sd=RegExp("^"+_d+_d+"*"),Ed=RegExp(_d+_d+"*$"),Td=function(e){return function(t){var n=xd(wd(t));return 1&e&&(n=n.replace(Sd,"")),2&e&&(n=n.replace(Ed,"")),n}},Id={start:Td(1),end:Td(2),trim:Td(3)},Rd=s,Od=i,Ad=bn,Cd=Ve.exports,Pd=ee,Md=y,jd=kd,Ld=q,Nd=ge,Fd=a,Dd=er,Ud=Ct.f,Bd=o.f,qd=Ne.f,Wd=Id.trim,zd="Number",Gd=Od.Number,Kd=Gd.prototype,$d=Md(Dd(Kd))==zd,Vd=function(e){if(Ld(e))throw TypeError("Cannot convert a Symbol value to a number");var t,n,r,i,o,a,s,u,c=Nd(e,"number");if("string"==typeof c&&c.length>2)if(43===(t=(c=Wd(c)).charCodeAt(0))||45===t){if(88===(n=c.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(a=(o=c.slice(2)).length,s=0;s<a;s++)if((u=o.charCodeAt(s))<48||u>i)return NaN;return parseInt(o,r)}return+c};if(Ad(zd,!Gd(" 0o1")||!Gd("0b1")||Gd("+0x1"))){for(var Qd,Yd=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof Yd&&($d?Fd((function(){Kd.valueOf.call(n)})):Md(n)!=zd)?jd(new Gd(Vd(t)),n,Yd):Vd(t)},Hd=Rd?Ud(Gd):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),Jd=0;Hd.length>Jd;Jd++)Pd(Gd,Qd=Hd[Jd])&&!Pd(Yd,Qd)&&qd(Yd,Qd,Bd(Gd,Qd));Yd.prototype=Kd,Kd.constructor=Yd,Cd(Od,zd,Yd)}var Xd,Zd={exports:{}},ep={exports:{}};(Xd=ep).exports=function(e){if(Array.isArray(e))return e},Xd.exports.default=Xd.exports,Xd.exports.__esModule=!0;var tp={exports:{}};!function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}},e.exports.default=e.exports,e.exports.__esModule=!0}(tp);var np={exports:{}},rp={exports:{}};!function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.default=e.exports,e.exports.__esModule=!0}(rp),function(e){var t=rp.exports;e.exports=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0}(np);var ip={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}(ip),function(e){var t=ep.exports,n=tp.exports,r=np.exports,i=ip.exports;e.exports=function(e,o){return t(e)||n(e,o)||r(e,o)||i()},e.exports.default=e.exports,e.exports.__esModule=!0}(Zd);var op=s,ap=An,sp=_,up=u.f,cp=function(e){return function(t){for(var n,r=sp(t),i=ap(r),o=i.length,a=0,s=[];o>a;)n=i[a++],op&&!up.call(r,n)||s.push(e?[n,r[n]]:r[n]);return s}},lp={entries:cp(!0),values:cp(!1)}.entries;In({target:"Object",stat:!0},{entries:function(e){return lp(e)}});var fp=In,dp=a,pp=Ln,hp=S,vp=J,yp=Ft,mp=yo,gp=Sr,bp=Gi,kp=L,wp=pe("isConcatSpreadable"),xp=9007199254740991,_p="Maximum allowed index exceeded",Sp=kp>=51||!dp((function(){var e=[];return e[wp]=!1,e.concat()[0]!==e})),Ep=bp("concat"),Tp=function(e){if(!hp(e))return!1;var t=e[wp];return void 0!==t?!!t:pp(e)};fp({target:"Array",proto:!0,forced:!Sp||!Ep},{concat:function(e){var t,n,r,i,o,a=vp(this),s=gp(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(Tp(o=-1===t?a:arguments[t])){if(u+(i=yp(o.length))>xp)throw TypeError(_p);for(n=0;n<i;n++,u++)n in o&&mp(s,u,o[n])}else{if(u>=xp)throw TypeError(_p);mp(s,u++,o)}return s.length=u,s}});var Ip={exports:{}},Rp={exports:{}};!function(e){var t=rp.exports;e.exports=function(e){if(Array.isArray(e))return t(e)},e.exports.default=e.exports,e.exports.__esModule=!0}(Rp);var Op={exports:{}};!function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0}(Op);var Ap={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}(Ap),function(e){var t=Rp.exports,n=Op.exports,r=np.exports,i=Ap.exports;e.exports=function(e){return t(e)||n(e)||r(e)||i()},e.exports.default=e.exports,e.exports.__esModule=!0}(Ip);var Cp={exports:{}};!function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0}(Cp);var Pp={exports:{}},Mp={exports:{}};!function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,t(n,r)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(Mp),function(e){var t=Mp.exports;e.exports=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&t(e,n)},e.exports.default=e.exports,e.exports.__esModule=!0}(Pp);var jp={exports:{}},Lp={exports:{}};!function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.default=e.exports,e.exports.__esModule=!0}(Lp),function(e){var t=ud.exports.default,n=Lp.exports;e.exports=function(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?n(e):r},e.exports.default=e.exports,e.exports.__esModule=!0}(jp);var Np={exports:{}};!function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.default=e.exports,e.exports.__esModule=!0,t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(Np);var Fp=$t.includes,Dp=qf;In({target:"Array",proto:!0},{includes:function(e){return Fp(this,e,arguments.length>1?arguments[1]:void 0)}}),Dp("includes");var Up=In,Bp=_,qp=[].join,Wp=b!=Object,zp=ro("join",",");Up({target:"Array",proto:!0,forced:Wp||!zp},{join:function(e){return qp.call(Bp(this),void 0===e?",":e)}}),Object.defineProperty(nl,"__esModule",{value:!0});var Gp=Zd.exports,Kp=Ip.exports,$p=Cp.exports,Vp=Pp.exports,Qp=jp.exports,Yp=Np.exports;function Hp(e){return e&&"object"===$o(e)&&"default"in e?e:{default:e}}var Jp=Hp(ud.exports),Xp=Hp(Gp),Zp=Hp(Kp),eh=Hp($p),th=Hp(Vp),nh=Hp(Qp),rh=Hp(Yp),ih=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{checks:t}};function oh(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ah(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ah(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ah(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var sh=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return ih((function(e){var n,r=!1,i=[],o=oh(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;"string"!=typeof a?(r=r||e instanceof a,i.push("an instance of ".concat(a.name))):(r=r||Jp.default(e)===a,i.push("of type ".concat(a)))}}catch(e){o.e(e)}finally{o.f()}return[r,i]}))};function uh(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ch(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ch(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ch(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var lh=ih((function(e){return["string"==typeof e&&e.length>0,"a non-empty string"]})),fh=ih((function(e){return["number"==typeof e&&Number.isInteger(e)&&e>=0,"a non-negative integer"]})),dh=ih((function(e){return["object"===Jp.default(e)&&null!==e&&!Array.isArray(e),"a pure object (non-null and non-array)"]}));function ph(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=rh.default(e);if(t){var i=rh.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return nh.default(this,n)}}function hh(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return vh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vh(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function vh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var yh=function(e,t){if(t.length>e.length)throw new Error("Expected at most ".concat(e.length," argument(s), but got ").concat(t.length));for(;t.length<e.length;)t.push(void 0);var n,r=hh(t.entries());try{for(r.s();!(n=r.n()).done;){var i=Xp.default(n.value,2),o=i[0],a=i[1],s=kh(e[o],a),u=Xp.default(s,4),c=u[0],l=u[1],f=u[2],d=u[3];if(!c)throw new Error("Argument ".concat(o+1," is expected to be ").concat(f).concat(d," but got ").concat(l))}}catch(e){r.e(e)}finally{r.f()}},mh=function(e){var t,n,r;(["undefined","boolean","number","bigint","string"].includes(Jp.default(e))&&(n="string"==typeof e?'"'.concat(e,'"'):"".concat(e)),"object"===Jp.default(e)&&"Object"!==(null==e||null===(t=e.constructor)||void 0===t?void 0:t.name))&&(n=null===e?"null":"instance of ".concat(null==e||null===(r=e.constructor)||void 0===r?void 0:r.name));return n||(n=Jp.default(e)),n},gh=function(e){var t,n=[],r=hh(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(bh(i))}}catch(e){r.e(e)}finally{r.f()}return n},bh=function(e){var t,n=[],r=hh(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var i=t.value;"string"!=typeof i&&"function"!=typeof i?n.push(i):n.push(sh(i))}}catch(e){r.e(e)}finally{r.f()}return n},kh=function(e,t){var n,r,i=[],o=!1,a=hh(e);try{for(a.s();!(r=a.n()).done;){var s,u=hh(r.value.checks);try{for(u.s();!(s=u.n()).done;){var c=(0,s.value)(t),l=Xp.default(c,3),f=l[0],d=l[1],p=l[2];o=o||f,!n&&p&&(n=p),d&&(i=[].concat(Zp.default(i),"string"==typeof d?[d]:Zp.default(d)))}}catch(e){u.e(e)}finally{u.f()}}}catch(e){a.e(e)}finally{a.f()}if(o)return[!0];var h=n||mh(t),v=i.length-1;return[!1,h,v>0?"".concat(i.slice(0,v).join(", ")," or ").concat(i[v]):i.join(", "),v>1?";":","]};function wh(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return xh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xh(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function xh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}nl.array=function(e,t){return ih((function(n){if(!Array.isArray(n))return[!1,"an array of ".concat(e)];var r,i=wh(n.entries());try{for(i.s();!(r=i.n()).done;){var o=Xp.default(r.value,2),a=o[0],s=o[1],u=kh(bh(t),s),c=Xp.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"a valid array of ".concat(e," (index ").concat(a," should be ").concat(d,")"),"malformed array of ".concat(e," (index ").concat(a," is ").concat(f,")")]}}catch(e){i.e(e)}finally{i.f()}return[!0]}))};var _h=nl.custom=ih,Sh=nl.literal=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return ih((function(e){var n,r=!1,i=[],o=uh(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;r=r||e===a,i.push("string"==typeof a?'"'.concat(a,'"'):"".concat(a))}}catch(e){o.e(e)}finally{o.f()}return[r,i]}))},Eh=nl.nonEmptyString=lh,Th=nl.nonNegativeInteger=fh,Ih=nl.objectSchema=function(e,t){return ih((function(n){if("object"!==Jp.default(n)||null===n||Array.isArray(n))return[!1,"valid ".concat(e," (should be a pure object)")];for(var r=0,i=Object.entries(t);r<i.length;r++){var o=Xp.default(i[r],2),a=o[0],s=o[1],u=kh(bh(s),n[a]),c=Xp.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"valid ".concat(e,' (key "').concat(a,'" should be ').concat(d,")"),"malformed ".concat(e,' (key "').concat(a,'" is ').concat(f,")")]}return[!0]}))},Rh=nl.pureObject=dh;nl.runtimeTypeValidation=yh,nl.stringifyReceivedType=mh,nl.type=sh,nl.validateConstructorTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=gh(t);return function(e){return function(e){th.default(n,e);var t=ph(n);function n(){eh.default(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return yh(r,i),t.call.apply(t,[this].concat(i))}return n}(e)}};var Oh=nl.validateTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=gh(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypes decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return yh(r,t),i.apply(this,t)}}},Ah=nl.validateTypesAsync=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=gh(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypesAsync decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];try{yh(r,t)}catch(e){return Promise.reject(e)}return i.apply(this,t)}}},Ch={},Ph={exports:{}};!function(e){function t(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=e.apply(n,r);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0}(Ph);var Mh={exports:{}};!function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0}(Mh);var jh={exports:{}},Lh={exports:{}};!function(e){var t=Np.exports;e.exports=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=t(e)););return e},e.exports.default=e.exports,e.exports.__esModule=!0}(Lh),function(e){var t=Lh.exports;function n(r,i,o){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=n=Reflect.get,e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e,n,r){var i=t(e,n);if(i){var o=Object.getOwnPropertyDescriptor(i,n);return o.get?o.get.call(r):o.value}},e.exports.default=e.exports,e.exports.__esModule=!0),n(r,i,o||r)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0}(jh);var Nh={exports:{}};!function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0}(Nh);var Fh=n(qc),Dh=De,Uh=function(){var e=Dh(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},Bh=Ve.exports,qh=De,Wh=Fn,zh=a,Gh=Uh,Kh="toString",$h=RegExp.prototype,Vh=$h.toString,Qh=zh((function(){return"/a/b"!=Vh.call({source:"a",flags:"b"})})),Yh=Vh.name!=Kh;(Qh||Yh)&&Bh(RegExp.prototype,Kh,(function(){var e=qh(this),t=Wh(e.source),n=e.flags;return"/"+t+"/"+Wh(void 0===n&&e instanceof RegExp&&!("flags"in $h)?Gh.call(e):n)}),{unsafe:!0});var Hh={exports:{}};!function(e){var n,r;n=t,r=function(){var e=function(){},t="undefined",n=("undefined"==typeof window?"undefined":$o(window))!==t&&$o(window.navigator)!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(r){return"debug"===r&&(r="log"),("undefined"==typeof console?"undefined":$o(console))!==t&&("trace"===r&&n?o:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}function s(t,n){for(var i=0;i<r.length;i++){var o=r[i];this[o]=i<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function u(e,n,r){return function(){("undefined"==typeof console?"undefined":$o(console))!==t&&(s.call(this,n,r),this[e].apply(this,arguments))}}function c(e,t,n){return a(e)||u.apply(this,arguments)}function l(e,n,i){var o,a=this,u="loglevel";function l(){var e;if(("undefined"==typeof window?"undefined":$o(window))!==t&&u){try{e=window.localStorage[u]}catch(e){}if($o(e)===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"===$o(e)&&(u=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=i||c,a.getLevel=function(){return o},a.setLevel=function(n,i){if("string"==typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(o=n,!1!==i&&function(e){var n=(r[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":$o(window))!==t&&u){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(n),s.call(a,n,e),("undefined"==typeof console?"undefined":$o(console))===t&&n<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){l()||a.setLevel(e,!1)},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var f=l();null==f&&(f=null==n?"WARN":n),a.setLevel(f,!1)}var f=new l,d={};f.getLogger=function(e){if("symbol"!==$o(e)&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new l(e,f.getLevel(),f.methodFactory)),t};var p=("undefined"==typeof window?"undefined":$o(window))!==t?window.log:void 0;return f.noConflict=function(){return("undefined"==typeof window?"undefined":$o(window))!==t&&window.log===f&&(window.log=p),f},f.getLoggers=function(){return d},f.default=f,f},e.exports?e.exports=r():n.log=r()}(Hh);var Jh={exports:{}},Xh=!a((function(){return Object.isExtensible(Object.preventExtensions({}))})),Zh=In,ev=st,tv=S,nv=ee,rv=Ne.f,iv=Ct,ov=tr,av=Xh,sv=!1,uv=re("meta"),cv=0,lv=Object.isExtensible||function(){return!0},fv=function(e){rv(e,uv,{value:{objectID:"O"+cv++,weakData:{}}})},dv=Jh.exports={enable:function(){dv.enable=function(){},sv=!0;var e=iv.f,t=[].splice,n={};n[uv]=1,e(n).length&&(iv.f=function(n){for(var r=e(n),i=0,o=r.length;i<o;i++)if(r[i]===uv){t.call(r,i,1);break}return r},Zh({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:ov.f}))},fastKey:function(e,t){if(!tv(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!nv(e,uv)){if(!lv(e))return"F";if(!t)return"E";fv(e)}return e[uv].objectID},getWeakData:function(e,t){if(!nv(e,uv)){if(!lv(e))return!0;if(!t)return!1;fv(e)}return e[uv].weakData},onFreeze:function(e){return av&&sv&&lv(e)&&!nv(e,uv)&&fv(e),e}};ev[uv]=!0;var pv=In,hv=i,vv=bn,yv=Ve.exports,mv=Jh.exports,gv=Ga,bv=wa,kv=S,wv=a,xv=Za,_v=yr,Sv=kd,Ev=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=hv[e],s=a&&a.prototype,u=a,c={},l=function(e){var t=s[e];yv(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!kv(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!kv(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!kv(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(vv(e,"function"!=typeof a||!(i||s.forEach&&!wv((function(){(new a).entries().next()})))))u=n.getConstructor(t,e,r,o),mv.enable();else if(vv(e,!0)){var f=new u,d=f[o](i?{}:-0,1)!=f,p=wv((function(){f.has(1)})),h=xv((function(e){new a(e)})),v=!i&&wv((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));h||((u=t((function(t,n){bv(t,u,e);var i=Sv(new a,t,u);return null!=n&&gv(n,i[o],{that:i,AS_ENTRIES:r}),i}))).prototype=s,s.constructor=u),(p||v)&&(l("delete"),l("has"),r&&l("get")),(v||d)&&l(o),i&&s.clear&&delete s.clear}return c[e]=u,pv({global:!0,forced:u!=a},c),_v(u,e),i||n.setStrong(u,e,r),u},Tv=Ne.f,Iv=er,Rv=fa,Ov=br,Av=wa,Cv=Ga,Pv=vf,Mv=ka,jv=s,Lv=Jh.exports.fastKey,Nv=xt.set,Fv=xt.getterFor,Dv={getConstructor:function(e,t,n,r){var i=e((function(e,o){Av(e,i,t),Nv(e,{type:t,index:Iv(null),first:void 0,last:void 0,size:0}),jv||(e.size=0),null!=o&&Cv(o,e[r],{that:e,AS_ENTRIES:n})})),o=Fv(t),a=function(e,t,n){var r,i,a=o(e),u=s(e,t);return u?u.value=n:(a.last=u={index:i=Lv(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=u),r&&(r.next=u),jv?a.size++:e.size++,"F"!==i&&(a.index[i]=u)),e},s=function(e,t){var n,r=o(e),i=Lv(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return Rv(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,jv?e.size=0:this.size=0},delete:function(e){var t=this,n=o(t),r=s(t,e);if(r){var i=r.next,a=r.previous;delete n.index[r.index],r.removed=!0,a&&(a.next=i),i&&(i.previous=a),n.first==r&&(n.first=i),n.last==r&&(n.last=a),jv?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=o(this),r=Ov(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),Rv(i.prototype,n?{get:function(e){var t=s(this,e);return t&&t.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),jv&&Tv(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=Fv(t),o=Fv(r);Pv(e,t,(function(e,t){Nv(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),Mv(t)}};Ev("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Dv);var Uv={exports:{}};!function(e,t){var n;n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){e.exports=function(e,t){var n,r,i;for(n=1;n<arguments.length;n++)for(i in r=arguments[n])r.hasOwnProperty(i)&&(e[i]=r[i]);return e}},function(e,t,n){var r=n(0);e.exports={build:function(e,t){var n,i,o,a=t.plugins;for(n=0,i=a.length;n<i;n++)(o=a[n]).methods&&r(e,o.methods),o.properties&&Object.defineProperties(e,o.properties)},hook:function(e,t,n){var r,i,o,a,s=e.config.plugins,u=[e.context];for(n&&(u=u.concat(n)),r=0,i=s.length;r<i;r++)a=s[r],(o=s[r][t])&&o.apply(a,u)}}},function(e,t,n){function r(e){if(0===e.length)return e;var t,n,r=e.split(/[_-]/);if(1===r.length&&r[0][0].toLowerCase()===r[0][0])return e;for(n=r[0].toLowerCase(),t=1;t<r.length;t++)n=n+r[t].charAt(0).toUpperCase()+r[t].substring(1).toLowerCase();return n}r.prepended=function(e,t){return e+(t=r(t))[0].toUpperCase()+t.substring(1)},e.exports=r},function(e,t,n){var r=n(0),i=n(2);function o(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}r(o.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=i.prepended("onEnter",e),this.lifecycle.onLeave[e]=i.prepended("onLeave",e),this.lifecycle.on[e]=i.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=i.prepended("onBefore",e),this.lifecycle.onAfter[e]=i.prepended("onAfter",e),this.lifecycle.on[e]=i.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,r=e.to;return this.addState(n),"function"!=typeof r&&this.addState(r),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(r({},this.defaults.init,{to:e,active:!0})):"object"===$o(e)?this.mapTransition(r({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"===$o(e)?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var n,r,i;for(n=0,r=(e=e||[]).length;n<r;n++)"function"==typeof(i=e[n])&&(e[n]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,n,r,i,o,a=this.defaults.wildcard;for(n=0;n<e.length;n++)for(r=e[n],i=Array.isArray(r.from)?r.from:[r.from||a],o=r.to||a,t=0;t<i.length;t++)this.mapTransition({name:r.name,from:i[t],to:o})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=o},function(e,t,n){var r=n(0),i=n(6),o=n(1),a=[null,[]];function s(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}r(s.prototype,{init:function(e){if(r(this.context,this.config.data.apply(this.context,e)),o.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,r=this.config.transitionFor(this.state,e),i=r&&r.to;return"function"==typeof i?i.apply(this.context,t):i===n?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,r){var i=this.config.lifecycle,o=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),r.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),o?this.observersForEvent(i.onLeave.state):a,o?this.observersForEvent(i.onLeave[t]):a,this.observersForEvent(i.on.transition),o?["doTransit",[this]]:a,o?this.observersForEvent(i.onEnter.state):a,o?this.observersForEvent(i.onEnter[n]):a,o?this.observersForEvent(i.on[n]):a,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],r)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,r=this.observers.length,i=[];n<r;n++)(t=this.observers[n])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,n,r){if(0===e.length)return this.endTransit(void 0===r||r);var i=e[0][0],a=e[0][1],s=e[0][2];if(t[0].event=i,i&&s&&i!==n&&o.hook(this,"lifecycle",t),0===a.length)return e.shift(),this.observeEvents(e,t,i,r);var u=a.shift(),c=u[i].apply(u,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,i,c)},onInvalidTransition:function(e,t,n){throw new i("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new i("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=s},function(e,t,n){var r=n(0),i=n(2),o=n(1),a=n(3),s=n(4),u={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},c={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function l(e){return f(this||{},e)}function f(e,t){return d(e,new a(t,l)),e._fsm(),e}function d(e,t){if("object"!==$o(e)||Array.isArray(e))throw Error("StateMachine can only be applied to objects");o.build(e,t),Object.defineProperties(e,c),r(e,u),r(e,t.methods),t.allTransitions().forEach((function(t){e[i(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}})),e._fsm=function(){this._fsm=new s(this,t),this._fsm.init(arguments)}}l.version="3.0.1",l.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new a(t,l);return d(e.prototype,n),e.prototype._fsm.config=n,e},l.apply=f,l.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=l},function(e,t,n){e.exports=function(e,t,n,r,i){this.message=e,this.transition=t,this.from=n,this.to=r,this.current=i}}])},e.exports=n()}(Uv);var Bv={exports:{}},qv="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(qv){var Wv=new Uint8Array(16);Bv.exports=function(){return qv(Wv),Wv}}else{var zv=new Array(16);Bv.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),zv[t]=e>>>((3&t)<<3)&255;return zv}}for(var Gv=[],Kv=0;Kv<256;++Kv)Gv[Kv]=(Kv+256).toString(16).substr(1);var $v,Vv,Qv=function(e,t){var n=t||0,r=Gv;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")},Yv=Bv.exports,Hv=Qv,Jv=0,Xv=0;var Zv=function(e,t,n){var r=t&&n||0,i=t||[],o=(e=e||{}).node||$v,a=void 0!==e.clockseq?e.clockseq:Vv;if(null==o||null==a){var s=Yv();null==o&&(o=$v=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==a&&(a=Vv=16383&(s[6]<<8|s[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:Xv+1,l=u-Jv+(c-Xv)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),(l<0||u>Jv)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Jv=u,Xv=c,Vv=a;var f=(1e4*(268435455&(u+=122192928e5))+c)%4294967296;i[r++]=f>>>24&255,i[r++]=f>>>16&255,i[r++]=f>>>8&255,i[r++]=255&f;var d=u/4294967296*1e4&268435455;i[r++]=d>>>8&255,i[r++]=255&d,i[r++]=d>>>24&15|16,i[r++]=d>>>16&255,i[r++]=a>>>8|128,i[r++]=255&a;for(var p=0;p<6;++p)i[r+p]=o[p];return t||Hv(i)},ey=Bv.exports,ty=Qv;var ny=Zv,ry=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||ey)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[r+o]=i[o];return t||ty(i)},iy=ry;iy.v1=ny,iy.v4=ry;var oy=iy,ay={},sy=a,uy=i.RegExp;ay.UNSUPPORTED_Y=sy((function(){var e=uy("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),ay.BROKEN_CARET=sy((function(){var e=uy("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));var cy,ly,fy=a,dy=i.RegExp,py=fy((function(){var e=dy(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),hy=a,vy=i.RegExp,yy=hy((function(){var e=vy("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),my=Fn,gy=Uh,by=ay,ky=z.exports,wy=er,xy=xt.get,_y=py,Sy=yy,Ey=RegExp.prototype.exec,Ty=ky("native-string-replace",String.prototype.replace),Iy=Ey,Ry=(cy=/a/,ly=/b*/g,Ey.call(cy,"a"),Ey.call(ly,"a"),0!==cy.lastIndex||0!==ly.lastIndex),Oy=by.UNSUPPORTED_Y||by.BROKEN_CARET,Ay=void 0!==/()??/.exec("")[1];(Ry||Ay||Oy||_y||Sy)&&(Iy=function(e){var t,n,r,i,o,a,s,u=this,c=xy(u),l=my(e),f=c.raw;if(f)return f.lastIndex=u.lastIndex,t=Iy.call(f,l),u.lastIndex=f.lastIndex,t;var d=c.groups,p=Oy&&u.sticky,h=gy.call(u),v=u.source,y=0,m=l;if(p&&(-1===(h=h.replace("y","")).indexOf("g")&&(h+="g"),m=l.slice(u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==l.charAt(u.lastIndex-1))&&(v="(?: "+v+")",m=" "+m,y++),n=new RegExp("^(?:"+v+")",h)),Ay&&(n=new RegExp("^"+v+"$(?!\\s)",h)),Ry&&(r=u.lastIndex),i=Ey.call(p?n:u,m),p?i?(i.input=i.input.slice(y),i[0]=i[0].slice(y),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:Ry&&i&&(u.lastIndex=u.global?i.index+i[0].length:r),Ay&&i&&i.length>1&&Ty.call(i[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&d)for(i.groups=a=wy(null),o=0;o<d.length;o++)a[(s=d[o])[0]]=i[s[1]];return i});var Cy=Iy;In({target:"RegExp",proto:!0,forced:/./.exec!==Cy},{exec:Cy});var Py=Ve.exports,My=Cy,jy=a,Ly=pe,Ny=$e,Fy=Ly("species"),Dy=RegExp.prototype,Uy=function(e,t,n,r){var i=Ly(e),o=!jy((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=o&&!jy((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Fy]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!a||n){var s=/./[i],u=t(i,""[e],(function(e,t,n,r,i){var a=t.exec;return a===My||a===Dy.exec?o&&!i?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}));Py(String.prototype,e,u[0]),Py(Dy,i,u[1])}r&&Ny(Dy[i],"sham",!0)},By=Ml.charAt,qy=function(e,t,n){return t+(n?By(e,t).length:1)},Wy=J,zy=Math.floor,Gy="".replace,Ky=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,$y=/\$([$&'`]|\d{1,2})/g,Vy=y,Qy=Cy,Yy=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==Vy(e))throw TypeError("RegExp#exec called on incompatible receiver");return Qy.call(e,t)},Hy=Uy,Jy=a,Xy=De,Zy=jt,em=Ft,tm=Fn,nm=k,rm=qy,im=function(e,t,n,r,i,o){var a=n+e.length,s=r.length,u=$y;return void 0!==i&&(i=Wy(i),u=Ky),Gy.call(o,u,(function(o,u){var c;switch(u.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(a);case"<":c=i[u.slice(1,-1)];break;default:var l=+u;if(0===l)return o;if(l>s){var f=zy(l/10);return 0===f?o:f<=s?void 0===r[f-1]?u.charAt(1):r[f-1]+u.charAt(1):o}c=r[l-1]}return void 0===c?"":c}))},om=Yy,am=pe("replace"),sm=Math.max,um=Math.min,cm="$0"==="a".replace(/./,"$0"),lm=!!/./[am]&&""===/./[am]("a","$0");Hy("replace",(function(e,t,n){var r=lm?"$":"$0";return[function(e,n){var r=nm(this),i=null==e?void 0:e[am];return void 0!==i?i.call(e,r,n):t.call(tm(r),e,n)},function(e,i){var o=Xy(this),a=tm(e);if("string"==typeof i&&-1===i.indexOf(r)&&-1===i.indexOf("$<")){var s=n(t,o,a,i);if(s.done)return s.value}var u="function"==typeof i;u||(i=tm(i));var c=o.global;if(c){var l=o.unicode;o.lastIndex=0}for(var f=[];;){var d=om(o,a);if(null===d)break;if(f.push(d),!c)break;""===tm(d[0])&&(o.lastIndex=rm(a,em(o.lastIndex),l))}for(var p,h="",v=0,y=0;y<f.length;y++){d=f[y];for(var m=tm(d[0]),g=sm(um(Zy(d.index),a.length),0),b=[],k=1;k<d.length;k++)b.push(void 0===(p=d[k])?p:String(p));var w=d.groups;if(u){var x=[m].concat(b,g,a);void 0!==w&&x.push(w);var _=tm(i.apply(void 0,x))}else _=im(m,a,g,b,w,i);g>=v&&(h+=a.slice(v,g)+_,v=g+m.length)}return h+a.slice(v)}]}),!!Jy((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!cm||lm);var fm,dm,pm,hm={exports:{}},vm="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,ym=vm,mm=s,gm=i,bm=S,km=ee,wm=ra,xm=$e,_m=Ve.exports,Sm=Ne.f,Em=Bl,Tm=va,Im=pe,Rm=re,Om=gm.Int8Array,Am=Om&&Om.prototype,Cm=gm.Uint8ClampedArray,Pm=Cm&&Cm.prototype,Mm=Om&&Em(Om),jm=Am&&Em(Am),Lm=Object.prototype,Nm=Lm.isPrototypeOf,Fm=Im("toStringTag"),Dm=Rm("TYPED_ARRAY_TAG"),Um=Rm("TYPED_ARRAY_CONSTRUCTOR"),Bm=ym&&!!Tm&&"Opera"!==wm(gm.opera),qm=!1,Wm={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},zm={BigInt64Array:8,BigUint64Array:8},Gm=function(e){if(!bm(e))return!1;var t=wm(e);return km(Wm,t)||km(zm,t)};for(fm in Wm)(pm=(dm=gm[fm])&&dm.prototype)?xm(pm,Um,dm):Bm=!1;for(fm in zm)(pm=(dm=gm[fm])&&dm.prototype)&&xm(pm,Um,dm);if((!Bm||"function"!=typeof Mm||Mm===Function.prototype)&&(Mm=function(){throw TypeError("Incorrect invocation")},Bm))for(fm in Wm)gm[fm]&&Tm(gm[fm],Mm);if((!Bm||!jm||jm===Lm)&&(jm=Mm.prototype,Bm))for(fm in Wm)gm[fm]&&Tm(gm[fm].prototype,jm);if(Bm&&Em(Pm)!==jm&&Tm(Pm,jm),mm&&!km(jm,Fm))for(fm in qm=!0,Sm(jm,Fm,{get:function(){return bm(this)?this[Dm]:void 0}}),Wm)gm[fm]&&xm(gm[fm],Dm,fm);var Km={NATIVE_ARRAY_BUFFER_VIEWS:Bm,TYPED_ARRAY_CONSTRUCTOR:Um,TYPED_ARRAY_TAG:qm&&Dm,aTypedArray:function(e){if(Gm(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Tm&&!Nm.call(Mm,e))throw TypeError("Target is not a typed array constructor");return e},exportTypedArrayMethod:function(e,t,n){if(mm){if(n)for(var r in Wm){var i=gm[r];if(i&&km(i.prototype,e))try{delete i.prototype[e]}catch(e){}}jm[e]&&!n||_m(jm,e,n?t:Bm&&Am[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(mm){if(Tm){if(n)for(r in Wm)if((i=gm[r])&&km(i,e))try{delete i[e]}catch(e){}if(Mm[e]&&!n)return;try{return _m(Mm,e,n?t:Bm&&Mm[e]||t)}catch(e){}}for(r in Wm)!(i=gm[r])||i[e]&&!n||_m(i,e,t)}},isView:function(e){if(!bm(e))return!1;var t=wm(e);return"DataView"===t||km(Wm,t)||km(zm,t)},isTypedArray:Gm,TypedArray:Mm,TypedArrayPrototype:jm},$m=i,Vm=a,Qm=Za,Ym=Km.NATIVE_ARRAY_BUFFER_VIEWS,Hm=$m.ArrayBuffer,Jm=$m.Int8Array,Xm=!Ym||!Vm((function(){Jm(1)}))||!Vm((function(){new Jm(-1)}))||!Qm((function(e){new Jm,new Jm(null),new Jm(1.5),new Jm(e)}),!0)||Vm((function(){return 1!==new Jm(new Hm(2),1,void 0).length})),Zm=jt,eg=Ft,tg=function(e){if(void 0===e)return 0;var t=Zm(e),n=eg(t);if(t!==n)throw RangeError("Wrong length or index");return n},ng=Math.abs,rg=Math.pow,ig=Math.floor,og=Math.log,ag=Math.LN2,sg=J,ug=qt,cg=Ft,lg=function(e){for(var t=sg(this),n=cg(t.length),r=arguments.length,i=ug(r>1?arguments[1]:void 0,n),o=r>2?arguments[2]:void 0,a=void 0===o?n:ug(o,n);a>i;)t[i++]=e;return t},fg=i,dg=s,pg=vm,hg=$e,vg=fa,yg=a,mg=wa,gg=jt,bg=Ft,kg=tg,wg={pack:function(e,t,n){var r,i,o,a=new Array(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?rg(2,-24)-rg(2,-77):0,f=e<0||0===e&&1/e<0?1:0,d=0;for((e=ng(e))!=e||e===1/0?(i=e!=e?1:0,r=u):(r=ig(og(e)/ag),e*(o=rg(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?l/o:l*rg(2,1-c))*o>=2&&(r++,o/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*o-1)*rg(2,t),r+=c):(i=e*rg(2,c-1)*rg(2,t),r=0));t>=8;a[d++]=255&i,i/=256,t-=8);for(r=r<<t|i,s+=t;s>0;a[d++]=255&r,r/=256,s-=8);return a[--d]|=128*f,a},unpack:function(e,t){var n,r=e.length,i=8*r-t-1,o=(1<<i)-1,a=o>>1,s=i-7,u=r-1,c=e[u--],l=127&c;for(c>>=7;s>0;l=256*l+e[u],u--,s-=8);for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;n=256*n+e[u],u--,s-=8);if(0===l)l=1-a;else{if(l===o)return n?NaN:c?-1/0:1/0;n+=rg(2,t),l-=a}return(c?-1:1)*n*rg(2,l-t)}},xg=Bl,_g=va,Sg=Ct.f,Eg=Ne.f,Tg=lg,Ig=yr,Rg=xt.get,Og=xt.set,Ag="ArrayBuffer",Cg="DataView",Pg="Wrong index",Mg=fg.ArrayBuffer,jg=Mg,Lg=fg.DataView,Ng=Lg&&Lg.prototype,Fg=Object.prototype,Dg=fg.RangeError,Ug=wg.pack,Bg=wg.unpack,qg=function(e){return[255&e]},Wg=function(e){return[255&e,e>>8&255]},zg=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Gg=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Kg=function(e){return Ug(e,23,4)},$g=function(e){return Ug(e,52,8)},Vg=function(e,t){Eg(e.prototype,t,{get:function(){return Rg(this)[t]}})},Qg=function(e,t,n,r){var i=kg(n),o=Rg(e);if(i+t>o.byteLength)throw Dg(Pg);var a=Rg(o.buffer).bytes,s=i+o.byteOffset,u=a.slice(s,s+t);return r?u:u.reverse()},Yg=function(e,t,n,r,i,o){var a=kg(n),s=Rg(e);if(a+t>s.byteLength)throw Dg(Pg);for(var u=Rg(s.buffer).bytes,c=a+s.byteOffset,l=r(+i),f=0;f<t;f++)u[c+f]=l[o?f:t-f-1]};if(pg){if(!yg((function(){Mg(1)}))||!yg((function(){new Mg(-1)}))||yg((function(){return new Mg,new Mg(1.5),new Mg(NaN),Mg.name!=Ag}))){for(var Hg,Jg=(jg=function(e){return mg(this,jg),new Mg(kg(e))}).prototype=Mg.prototype,Xg=Sg(Mg),Zg=0;Xg.length>Zg;)(Hg=Xg[Zg++])in jg||hg(jg,Hg,Mg[Hg]);Jg.constructor=jg}_g&&xg(Ng)!==Fg&&_g(Ng,Fg);var eb=new Lg(new jg(2)),tb=Ng.setInt8;eb.setInt8(0,2147483648),eb.setInt8(1,2147483649),!eb.getInt8(0)&&eb.getInt8(1)||vg(Ng,{setInt8:function(e,t){tb.call(this,e,t<<24>>24)},setUint8:function(e,t){tb.call(this,e,t<<24>>24)}},{unsafe:!0})}else jg=function(e){mg(this,jg,Ag);var t=kg(e);Og(this,{bytes:Tg.call(new Array(t),0),byteLength:t}),dg||(this.byteLength=t)},Lg=function(e,t,n){mg(this,Lg,Cg),mg(e,jg,Cg);var r=Rg(e).byteLength,i=gg(t);if(i<0||i>r)throw Dg("Wrong offset");if(i+(n=void 0===n?r-i:bg(n))>r)throw Dg("Wrong length");Og(this,{buffer:e,byteLength:n,byteOffset:i}),dg||(this.buffer=e,this.byteLength=n,this.byteOffset=i)},dg&&(Vg(jg,"byteLength"),Vg(Lg,"buffer"),Vg(Lg,"byteLength"),Vg(Lg,"byteOffset")),vg(Lg.prototype,{getInt8:function(e){return Qg(this,1,e)[0]<<24>>24},getUint8:function(e){return Qg(this,1,e)[0]},getInt16:function(e){var t=Qg(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Qg(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Gg(Qg(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return Gg(Qg(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return Bg(Qg(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return Bg(Qg(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Yg(this,1,e,qg,t)},setUint8:function(e,t){Yg(this,1,e,qg,t)},setInt16:function(e,t){Yg(this,2,e,Wg,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Yg(this,2,e,Wg,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Yg(this,4,e,zg,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Yg(this,4,e,zg,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Yg(this,4,e,Kg,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Yg(this,8,e,$g,t,arguments.length>2?arguments[2]:void 0)}});Ig(jg,Ag),Ig(Lg,Cg);var nb=jt,rb=function(e){var t=nb(e);if(t<0)throw RangeError("The argument can't be less than 0");return t},ib=function(e,t){var n=rb(e);if(n%t)throw RangeError("Wrong offset");return n},ob=J,ab=Ft,sb=Ma,ub=Aa,cb=Ta,lb=br,fb=Km.aTypedArrayConstructor,db=In,pb=i,hb=s,vb=Xm,yb=Km,mb={ArrayBuffer:jg,DataView:Lg},gb=wa,bb=h,kb=$e,wb=md,xb=Ft,_b=tg,Sb=ib,Eb=we,Tb=ee,Ib=ra,Rb=S,Ob=q,Ab=er,Cb=va,Pb=Ct.f,Mb=function(e){var t,n,r,i,o,a,s=ob(e),u=arguments.length,c=u>1?arguments[1]:void 0,l=void 0!==c,f=ub(s);if(null!=f&&!cb(f))for(a=(o=sb(s,f)).next,s=[];!(i=a.call(o)).done;)s.push(i.value);for(l&&u>2&&(c=lb(c,arguments[2],2)),n=ab(s.length),r=new(fb(this))(n),t=0;n>t;t++)r[t]=l?c(s[t],t):s[t];return r},jb=Pr.forEach,Lb=ka,Nb=Ne,Fb=o,Db=kd,Ub=xt.get,Bb=xt.set,qb=Nb.f,Wb=Fb.f,zb=Math.round,Gb=pb.RangeError,Kb=mb.ArrayBuffer,$b=mb.DataView,Vb=yb.NATIVE_ARRAY_BUFFER_VIEWS,Qb=yb.TYPED_ARRAY_CONSTRUCTOR,Yb=yb.TYPED_ARRAY_TAG,Hb=yb.TypedArray,Jb=yb.TypedArrayPrototype,Xb=yb.aTypedArrayConstructor,Zb=yb.isTypedArray,ek="BYTES_PER_ELEMENT",tk="Wrong length",nk=function(e,t){for(var n=0,r=t.length,i=new(Xb(e))(r);r>n;)i[n]=t[n++];return i},rk=function(e,t){qb(e,t,{get:function(){return Ub(this)[t]}})},ik=function(e){var t;return e instanceof Kb||"ArrayBuffer"==(t=Ib(e))||"SharedArrayBuffer"==t},ok=function(e,t){return Zb(e)&&!Ob(t)&&t in e&&wb(+t)&&t>=0},ak=function(e,t){return t=Eb(t),ok(e,t)?bb(2,e[t]):Wb(e,t)},sk=function(e,t,n){return t=Eb(t),!(ok(e,t)&&Rb(n)&&Tb(n,"value"))||Tb(n,"get")||Tb(n,"set")||n.configurable||Tb(n,"writable")&&!n.writable||Tb(n,"enumerable")&&!n.enumerable?qb(e,t,n):(e[t]=n.value,e)};hb?(Vb||(Fb.f=ak,Nb.f=sk,rk(Jb,"buffer"),rk(Jb,"byteOffset"),rk(Jb,"byteLength"),rk(Jb,"length")),db({target:"Object",stat:!0,forced:!Vb},{getOwnPropertyDescriptor:ak,defineProperty:sk}),hm.exports=function(e,t,n){var r=e.match(/\d+$/)[0]/8,i=e+(n?"Clamped":"")+"Array",o="get"+e,a="set"+e,s=pb[i],u=s,c=u&&u.prototype,l={},f=function(e,t){qb(e,t,{get:function(){return function(e,t){var n=Ub(e);return n.view[o](t*r+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var o=Ub(e);n&&(i=(i=zb(i))<0?0:i>255?255:255&i),o.view[a](t*r+o.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};Vb?vb&&(u=t((function(e,t,n,o){return gb(e,u,i),Db(Rb(t)?ik(t)?void 0!==o?new s(t,Sb(n,r),o):void 0!==n?new s(t,Sb(n,r)):new s(t):Zb(t)?nk(u,t):Mb.call(u,t):new s(_b(t)),e,u)})),Cb&&Cb(u,Hb),jb(Pb(s),(function(e){e in u||kb(u,e,s[e])})),u.prototype=c):(u=t((function(e,t,n,o){gb(e,u,i);var a,s,c,l=0,d=0;if(Rb(t)){if(!ik(t))return Zb(t)?nk(u,t):Mb.call(u,t);a=t,d=Sb(n,r);var p=t.byteLength;if(void 0===o){if(p%r)throw Gb(tk);if((s=p-d)<0)throw Gb(tk)}else if((s=xb(o)*r)+d>p)throw Gb(tk);c=s/r}else c=_b(t),a=new Kb(s=c*r);for(Bb(e,{buffer:a,byteOffset:d,byteLength:s,length:c,view:new $b(a)});l<c;)f(e,l++)})),Cb&&Cb(u,Hb),c=u.prototype=Ab(Jb)),c.constructor!==u&&kb(c,"constructor",u),kb(c,Qb,u),Yb&&kb(c,Yb,i),l[i]=u,db({global:!0,forced:u!=s,sham:!Vb},l),ek in u||kb(u,ek,r),ek in c||kb(c,ek,r),Lb(i)}):hm.exports=function(){},(0,hm.exports)("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var uk=J,ck=qt,lk=Ft,fk=Math.min,dk=[].copyWithin||function(e,t){var n=uk(this),r=lk(n.length),i=ck(e,r),o=ck(t,r),a=arguments.length>2?arguments[2]:void 0,s=fk((void 0===a?r:ck(a,r))-o,r-i),u=1;for(o<i&&i<o+s&&(u=-1,o+=s-1,i+=s-1);s-- >0;)o in n?n[i]=n[o]:delete n[i],i+=u,o+=u;return n},pk=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("copyWithin",(function(e,t){return dk.call(pk(this),e,t,arguments.length>2?arguments[2]:void 0)}));var hk=Pr.every,vk=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("every",(function(e){return hk(vk(this),e,arguments.length>1?arguments[1]:void 0)}));var yk=lg,mk=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("fill",(function(e){return yk.apply(mk(this),arguments)}));var gk=rs,bk=Km.TYPED_ARRAY_CONSTRUCTOR,kk=Km.aTypedArrayConstructor,wk=function(e){return kk(gk(e,e[bk]))},xk=function(e,t){for(var n=0,r=t.length,i=new e(r);r>n;)i[n]=t[n++];return i},_k=wk,Sk=Pr.filter,Ek=function(e,t){return xk(_k(e),t)},Tk=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("filter",(function(e){var t=Sk(Tk(this),e,arguments.length>1?arguments[1]:void 0);return Ek(this,t)}));var Ik=Pr.find,Rk=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("find",(function(e){return Ik(Rk(this),e,arguments.length>1?arguments[1]:void 0)}));var Ok=Pr.findIndex,Ak=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("findIndex",(function(e){return Ok(Ak(this),e,arguments.length>1?arguments[1]:void 0)}));var Ck=Pr.forEach,Pk=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("forEach",(function(e){Ck(Pk(this),e,arguments.length>1?arguments[1]:void 0)}));var Mk=$t.includes,jk=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("includes",(function(e){return Mk(jk(this),e,arguments.length>1?arguments[1]:void 0)}));var Lk=$t.indexOf,Nk=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("indexOf",(function(e){return Lk(Nk(this),e,arguments.length>1?arguments[1]:void 0)}));var Fk=i,Dk=Km,Uk=Hf,Bk=pe("iterator"),qk=Fk.Uint8Array,Wk=Uk.values,zk=Uk.keys,Gk=Uk.entries,Kk=Dk.aTypedArray,$k=Dk.exportTypedArrayMethod,Vk=qk&&qk.prototype[Bk],Qk=!!Vk&&("values"==Vk.name||null==Vk.name),Yk=function(){return Wk.call(Kk(this))};$k("entries",(function(){return Gk.call(Kk(this))})),$k("keys",(function(){return zk.call(Kk(this))})),$k("values",Yk,!Qk),$k(Bk,Yk,!Qk);var Hk=Km.aTypedArray,Jk=[].join;(0,Km.exportTypedArrayMethod)("join",(function(e){return Jk.apply(Hk(this),arguments)}));var Xk=_,Zk=jt,ew=Ft,tw=ro,nw=Math.min,rw=[].lastIndexOf,iw=!!rw&&1/[1].lastIndexOf(1,-0)<0,ow=tw("lastIndexOf"),aw=iw||!ow?function(e){if(iw)return rw.apply(this,arguments)||0;var t=Xk(this),n=ew(t.length),r=n-1;for(arguments.length>1&&(r=nw(r,Zk(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:rw,sw=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("lastIndexOf",(function(e){return aw.apply(sw(this),arguments)}));var uw=Pr.map,cw=wk,lw=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("map",(function(e){return uw(lw(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(cw(e))(t)}))}));var fw=mr,dw=J,pw=b,hw=Ft,vw=function(e){return function(t,n,r,i){fw(n);var o=dw(t),a=pw(o),s=hw(o.length),u=e?s-1:0,c=e?-1:1;if(r<2)for(;;){if(u in a){i=a[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw TypeError("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=c)u in a&&(i=n(i,a[u],u,o));return i}},yw={left:vw(!1),right:vw(!0)},mw=yw.left,gw=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("reduce",(function(e){return mw(gw(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var bw=yw.right,kw=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("reduceRight",(function(e){return bw(kw(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var ww=Km.aTypedArray,xw=Km.exportTypedArrayMethod,_w=Math.floor;xw("reverse",(function(){for(var e,t=this,n=ww(t).length,r=_w(n/2),i=0;i<r;)e=t[i],t[i++]=t[--n],t[n]=e;return t}));var Sw=Ft,Ew=ib,Tw=J,Iw=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("set",(function(e){Iw(this);var t=Ew(arguments.length>1?arguments[1]:void 0,1),n=this.length,r=Tw(e),i=Sw(r.length),o=0;if(i+t>n)throw RangeError("Wrong length");for(;o<i;)this[t+o]=r[o++]}),a((function(){new Int8Array(1).set({})})));var Rw=wk,Ow=Km.aTypedArray,Aw=[].slice;(0,Km.exportTypedArrayMethod)("slice",(function(e,t){for(var n=Aw.call(Ow(this),e,t),r=Rw(this),i=0,o=n.length,a=new r(o);o>i;)a[i]=n[i++];return a}),a((function(){new Int8Array(1).slice()})));var Cw=Pr.some,Pw=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("some",(function(e){return Cw(Pw(this),e,arguments.length>1?arguments[1]:void 0)}));var Mw=Math.floor,jw=function(e,t){var n=e.length,r=Mw(n/2);return n<8?Lw(e,t):Nw(jw(e.slice(0,r),t),jw(e.slice(r),t),t)},Lw=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},Nw=function(e,t,n){for(var r=e.length,i=t.length,o=0,a=0,s=[];o<r||a<i;)o<r&&a<i?s.push(n(e[o],t[a])<=0?e[o++]:t[a++]):s.push(o<r?e[o++]:t[a++]);return s},Fw=jw,Dw=R.match(/firefox\/(\d+)/i),Uw=!!Dw&&+Dw[1],Bw=/MSIE|Trident/.test(R),qw=R.match(/AppleWebKit\/(\d+)\./),Ww=!!qw&&+qw[1],zw=a,Gw=mr,Kw=Ft,$w=Fw,Vw=Uw,Qw=Bw,Yw=L,Hw=Ww,Jw=Km.aTypedArray,Xw=Km.exportTypedArrayMethod,Zw=i.Uint16Array,ex=Zw&&Zw.prototype.sort,tx=!!ex&&!zw((function(){var e=new Zw(2);e.sort(null),e.sort({})})),nx=!!ex&&!zw((function(){if(Yw)return Yw<74;if(Vw)return Vw<67;if(Qw)return!0;if(Hw)return Hw<602;var e,t,n=new Zw(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(n.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));Xw("sort",(function(e){var t=this;if(void 0!==e&&Gw(e),nx)return ex.call(t,e);Jw(t);var n,r=Kw(t.length),i=Array(r);for(n=0;n<r;n++)i[n]=t[n];for(i=$w(t,function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e)),n=0;n<r;n++)t[n]=i[n];return t}),!nx||tx);var rx=Ft,ix=qt,ox=wk,ax=Km.aTypedArray;(0,Km.exportTypedArrayMethod)("subarray",(function(e,t){var n=ax(this),r=n.length,i=ix(e,r);return new(ox(n))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,rx((void 0===t?r:ix(t,r))-i))}));var sx=Km,ux=a,cx=i.Int8Array,lx=sx.aTypedArray,fx=sx.exportTypedArrayMethod,dx=[].toLocaleString,px=[].slice,hx=!!cx&&ux((function(){dx.call(new cx(1))}));fx("toLocaleString",(function(){return dx.apply(hx?px.call(lx(this)):lx(this),arguments)}),ux((function(){return[1,2].toLocaleString()!=new cx([1,2]).toLocaleString()}))||!ux((function(){cx.prototype.toLocaleString.call([1,2])})));var vx=Km.exportTypedArrayMethod,yx=a,mx=i.Uint8Array,gx=mx&&mx.prototype||{},bx=[].toString,kx=[].join;yx((function(){bx.call({})}))&&(bx=function(){return kx.call(this)});var wx=gx.toString!=bx;vx("toString",bx,wx);var xx=S,_x=y,Sx=pe("match"),Ex=Uy,Tx=function(e){var t;return xx(e)&&(void 0!==(t=e[Sx])?!!t:"RegExp"==_x(e))},Ix=De,Rx=k,Ox=rs,Ax=qy,Cx=Ft,Px=Fn,Mx=Yy,jx=Cy,Lx=a,Nx=ay.UNSUPPORTED_Y,Fx=[].push,Dx=Math.min,Ux=4294967295;Ex("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=Px(Rx(this)),i=void 0===n?Ux:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!Tx(e))return t.call(r,e,i);for(var o,a,s,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,f=new RegExp(e.source,c+"g");(o=jx.call(f,r))&&!((a=f.lastIndex)>l&&(u.push(r.slice(l,o.index)),o.length>1&&o.index<r.length&&Fx.apply(u,o.slice(1)),s=o[0].length,l=a,u.length>=i));)f.lastIndex===o.index&&f.lastIndex++;return l===r.length?!s&&f.test("")||u.push(""):u.push(r.slice(l)),u.length>i?u.slice(0,i):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=Rx(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(Px(i),t,n)},function(e,i){var o=Ix(this),a=Px(e),s=n(r,o,a,i,r!==t);if(s.done)return s.value;var u=Ox(o,RegExp),c=o.unicode,l=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(Nx?"g":"y"),f=new u(Nx?"^(?:"+o.source+")":o,l),d=void 0===i?Ux:i>>>0;if(0===d)return[];if(0===a.length)return null===Mx(f,a)?[a]:[];for(var p=0,h=0,v=[];h<a.length;){f.lastIndex=Nx?0:h;var y,m=Mx(f,Nx?a.slice(h):a);if(null===m||(y=Dx(Cx(f.lastIndex+(Nx?h:0)),a.length))===p)h=Ax(a,h,c);else{if(v.push(a.slice(p,h)),v.length===d)return v;for(var g=1;g<=m.length-1;g++)if(v.push(m[g]),v.length===d)return v;h=p=y}}return v.push(a.slice(p)),v}]}),!!Lx((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),Nx);var Bx={exports:{}},qx={exports:{}};!function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.default=e.exports,e.exports.__esModule=!0}(qx);var Wx={exports:{}},zx={exports:{}};!function(e){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.default=e.exports,e.exports.__esModule=!0}(zx),function(e){var t=Mp.exports,n=zx.exports;function r(i,o,a){return n()?(e.exports=r=Reflect.construct,e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=r=function(e,n,r){var i=[null];i.push.apply(i,n);var o=new(Function.bind.apply(e,i));return r&&t(o,r.prototype),o},e.exports.default=e.exports,e.exports.__esModule=!0),r.apply(null,arguments)}e.exports=r,e.exports.default=e.exports,e.exports.__esModule=!0}(Wx),function(e){var t=Np.exports,n=Mp.exports,r=qx.exports,i=Wx.exports;function o(a){var s="function"==typeof Map?new Map:void 0;return e.exports=o=function(e){if(null===e||!r(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==s){if(s.has(e))return s.get(e);s.set(e,o)}function o(){return i(e,arguments,t(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),n(o,e)},e.exports.default=e.exports,e.exports.__esModule=!0,o(a)}e.exports=o,e.exports.default=e.exports,e.exports.__esModule=!0}(Bx);var Gx={};Object.defineProperty(Gx,"__esModule",{value:!0});var Kx=Mh.exports,$x=Lp.exports,Vx=Pp.exports,Qx=jp.exports,Yx=Np.exports,Hx=Nh.exports;function Jx(e){return e&&"object"===$o(e)&&"default"in e?e:{default:e}}var Xx=Jx(Cp.exports),Zx=Jx(Kx),e_=Jx($x),t_=Jx(Vx),n_=Jx(Qx),r_=Jx(Yx),i_=Jx(Hx);function o_(){}function a_(){a_.init.call(this)}function s_(e){return void 0===e._maxListeners?a_.defaultMaxListeners:e._maxListeners}function u_(e,t,n){if(t)e.call(n);else for(var r=e.length,i=y_(e,r),o=0;o<r;++o)i[o].call(n)}function c_(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=y_(e,i),a=0;a<i;++a)o[a].call(n,r)}function l_(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=y_(e,o),s=0;s<o;++s)a[s].call(n,r,i)}function f_(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=y_(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}function d_(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=y_(e,i),a=0;a<i;++a)o[a].apply(n,r)}function p_(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new o_,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=s_(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[t]=n,++e._eventsCount;return e}function h_(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function v_(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function y_(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function m_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=r_.default(e);if(t){var i=r_.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return n_.default(this,n)}}o_.prototype=Object.create(null),a_.EventEmitter=a_,a_.usingDomains=!1,a_.prototype.domain=void 0,a_.prototype._events=void 0,a_.prototype._maxListeners=void 0,a_.defaultMaxListeners=10,a_.init=function(){this.domain=null,a_.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new o_,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a_.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},a_.prototype.getMaxListeners=function(){return s_(this)},a_.prototype.emit=function(e){var t,n,r,i,o,a,s,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:u_(n,l,this);break;case 2:c_(n,l,this,arguments[1]);break;case 3:l_(n,l,this,arguments[1],arguments[2]);break;case 4:f_(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];d_(n,l,this,i)}return!0},a_.prototype.addListener=function(e,t){return p_(this,e,t,!1)},a_.prototype.on=a_.prototype.addListener,a_.prototype.prependListener=function(e,t){return p_(this,e,t,!0)},a_.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,h_(this,e,t)),this},a_.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,h_(this,e,t)),this},a_.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new o_:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new o_,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},a_.prototype.off=function(e,t){return this.removeListener(e,t)},a_.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new o_,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new o_:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new o_,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},a_.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},a_.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v_.call(e,t)},a_.prototype.listenerCount=v_,a_.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var g_=function(e){t_.default(n,e);var t=m_(n);function n(e){var r;return Xx.default(this,n),r=t.call(this),i_.default(e_.default(r),"timeout",null),i_.default(e_.default(r),"startTimestamp",-1),r.minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return Zx.default(n,[{key:"attempt",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.attemptNum++,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt count limit reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((function(){return t.attempt()}),n)}},{key:"cleanup",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){if(this.inProgress)throw new Error("Retrier is already in progress");this.inProgress=!0,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"))}},{key:"succeeded",value:function(e){this.emit("succeeded",e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}}]),n}(a_),b_=function(e){t_.default(n,e);var t=m_(n);function n(e){var r;return Xx.default(this,n),r=t.call(this),i_.default(e_.default(r),"resolve",(function(){})),i_.default(e_.default(r),"reject",(function(){})),r.retrier=new g_(e),r}return Zx.default(n,[{key:"run",value:function(e){var t=this;return this.retrier.on("attempt",(function(){e().then((function(e){return t.retrier.succeeded(e)})).catch((function(e){return t.retrier.failed(e)}))})),this.retrier.on("succeeded",(function(e){return t.resolve(e)})),this.retrier.on("cancelled",(function(){return t.reject(new Error("Cancelled"))})),this.retrier.on("failed",(function(e){return t.reject(e)})),new Promise((function(e,n){t.resolve=e,t.reject=n,t.retrier.start()}))}},{key:"cancel",value:function(){this.retrier.cancel()}}]),n}(a_);function k_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=r_.default(e);if(t){var i=r_.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return n_.default(this,n)}}function w_(e){return null!=e}var x_=function(e){t_.default(n,e);var t=k_(n);function n(e){var r;Xx.default(this,n),r=t.call(this),i_.default(e_.default(r),"backoffDelay",0),i_.default(e_.default(r),"nextBackoffDelay",0),i_.default(e_.default(r),"backoffNumber",0),i_.default(e_.default(r),"timeoutID",null),i_.default(e_.default(r),"maxNumberOfRetry",-1);var i=e=e||{},o=i.initialDelay,a=i.maxDelay,s=i.randomisationFactor,u=i.factor;if(w_(o)&&o<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(w_(a)&&a<=1)throw new Error("The maximal timeout must be greater than 1.");if(w_(s)&&(s<0||s>1))throw new Error("The randomisation factor must be between 0 and 1.");if(w_(u)&&u<=1)throw new Error("Exponential factor should be greater than 1.");if(r.initialDelay=o||100,r.maxDelay=a||1e4,r.maxDelay<=r.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return r.randomisationFactor=s||0,r.factor=u||2,r.reset(),r}return Zx.default(n,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new n(e)}}]),n}(a_);Gx.AsyncRetrier=b_;var __=Gx.Backoff=x_,S_=Gx.Retrier=g_;Ev("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Dv);var E_={exports:{}};!function(e,n){(function(){var r={function:!0,object:!0}["undefined"==typeof window?"undefined":$o(window)]&&window||this,i=n,o=e&&!e.nodeType&&e,a=i&&o&&"object"==$o(t)&&t;!a||a.global!==a&&a.window!==a&&a.self!==a||(r=a);var s=Math.pow(2,53)-1,u=/\bOpera/,c=Object.prototype,l=c.hasOwnProperty,f=c.toString;function d(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function p(e){return e=g(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:d(e)}function h(e,t){for(var n in e)l.call(e,n)&&t(e[n],n,e)}function v(e){return null==e?d(e):f.call(e).slice(8,-1)}function y(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function m(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=s)for(;++n<r;)t(e[n],n,e);else h(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function g(e){return String(e).replace(/^ +| +$/g,"")}var b=function e(t){var n=r,i=t&&"object"==$o(t)&&"String"!=v(t);i&&(n=t,t=null);var o=n.navigator||{},a=o.userAgent||"";t||(t=a);var s,c,l=i?!!o.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(f.toString()),d="Object",b=i?d:"ScriptBridgingProxyObject",k=i?d:"Environment",w=i&&n.java?"JavaPackage":v(n.java),x=i?d:"RuntimeObject",_=/\bJava/.test(w)&&n.java,S=_&&v(n.environment)==k,E=_?"a":"Î±",T=_?"b":"Î²",I=n.document||{},R=n.operamini||n.opera,O=u.test(O=i&&R?R["[[Class]]"]:v(R))?O:R=null,A=t,C=[],P=null,M=t==a,j=M&&R&&"function"==typeof R.version&&R.version(),L=m([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||y(n))+"\\b","i").exec(t)&&(n.label||n)})),N=function(e){return m(e,(function(e,n){return e||RegExp("\\b"+(n.pattern||y(n))+"\\b","i").exec(t)&&(n.label||n)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),F=B([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(e){return m(e,(function(e,n,r){return e||(n[F]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(F)]||RegExp("\\b"+y(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),U=function(e){return m(e,(function(e,n){var r=n.pattern||y(n);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),p(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,n.label||n)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function B(e){return m(e,(function(e,n){var r=n.pattern||y(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=p(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function q(e){return m(e,(function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(L&&(L=[L]),/\bAndroid\b/.test(U)&&!F&&(s=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(F=g(s[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),D&&!F?F=B([D]):D&&F&&(F=F.replace(RegExp("^("+y(D)+")[-_.\\s]","i"),D+" ").replace(RegExp("^("+y(D)+")[-_.]?(\\w)","i"),D+" $2")),(s=/\bGoogle TV\b/.exec(F))&&(F=s[0]),/\bSimulator\b/i.test(t)&&(F=(F?F+" ":"")+"Simulator"),"Opera Mini"==N&&/\bOPiOS\b/.test(t)&&C.push("running in Turbo/Uncompressed mode"),"IE"==N&&/\blike iPhone OS\b/.test(t)?(D=(s=e(t.replace(/like iPhone OS/,""))).manufacturer,F=s.product):/^iP/.test(F)?(N||(N="Safari"),U="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"==N&&/^Linux\b/i.test(U)?U="Kubuntu":D&&"Google"!=D&&(/Chrome/.test(N)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(F))||/\bAndroid\b/.test(U)&&/^Chrome/.test(N)&&/\bVersion\//i.test(t)?(N="Android Browser",U=/\bAndroid\b/.test(U)?U:"Android"):"Silk"==N?(/\bMobi/i.test(t)||(U="Android",C.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&C.unshift("accelerated")):"UC Browser"==N&&/\bUCWEB\b/.test(t)?C.push("speed mode"):"PaleMoon"==N&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?C.push("identifying as Firefox "+s[1]):"Firefox"==N&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(U||(U="Firefox OS"),F||(F=s[1])):!N||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(N))?(N&&!F&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(N=null),(s=F||D||U)&&(F||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U))&&(N=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U)?U:s)+" Browser")):"Electron"==N&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&C.push("Chromium "+s),j||(j=q(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",y(N),"(?:Firefox|Minefield|NetFront)"])),(s=("iCab"==L&&parseFloat(j)>3?"WebKit":/\bOpera\b/.test(N)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(t)&&("Mac OS"==U?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(N)&&"NetFront")&&(L=[s]),"IE"==N&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(N+=" Mobile",U="Windows Phone "+(/\+$/.test(s)?s:s+".x"),C.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(N="IE Mobile",U="Windows Phone 8.x",C.unshift("desktop mode"),j||(j=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=N&&"Trident"==L&&(s=/\brv:([\d.]+)/.exec(t))&&(N&&C.push("identifying as "+N+(j?" "+j:"")),N="IE",j=s[1]),M){if(function(e,t){var n=null!=e?$o(e[t]):"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}(n,"global"))if(_&&(A=(s=_.lang.System).getProperty("os.arch"),U=U||s.getProperty("os.name")+" "+s.getProperty("os.version")),S){try{j=n.require("ringo/engine").version.join("."),N="RingoJS"}catch(e){(s=n.system)&&s.global.system==n.system&&(N="Narwhal",U||(U=s[0].os||null))}N||(N="Rhino")}else"object"==$o(n.process)&&!n.process.browser&&(s=n.process)&&("object"==$o(s.versions)&&("string"==typeof s.versions.electron?(C.push("Node "+s.versions.node),N="Electron",j=s.versions.electron):"string"==typeof s.versions.nw&&(C.push("Chromium "+j,"Node "+s.versions.node),N="NW.js",j=s.versions.nw)),N||(N="Node.js",A=s.arch,U=s.platform,j=(j=/[\d.]+/.exec(s.version))?j[0]:null));else v(s=n.runtime)==b?(N="Adobe AIR",U=s.flash.system.Capabilities.os):v(s=n.phantom)==x?(N="PhantomJS",j=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof I.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(j=[j,I.documentMode],(s=+s[1]+4)!=j[1]&&(C.push("IE "+j[1]+" mode"),L&&(L[1]=""),j[1]=s),j="IE"==N?String(j[1].toFixed(1)):j[0]):"number"==typeof I.documentMode&&/^(?:Chrome|Firefox)\b/.test(N)&&(C.push("masking as "+N+" "+j),N="IE",j="11.0",L=["Trident"],U="Windows");U=U&&p(U)}if(j&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(j)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(M&&o.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(P=/b/i.test(s)?"beta":"alpha",j=j.replace(RegExp(s+"\\+?$"),"")+("beta"==P?T:E)+(/\d+\+?/.exec(s)||"")),"Fennec"==N||"Firefox"==N&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(U))N="Firefox Mobile";else if("Maxthon"==N&&j)j=j.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(F))"Xbox 360"==F&&(U=null),"Xbox 360"==F&&/\bIEMobile\b/.test(t)&&C.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(N)&&(!N||F||/Browser|Mobi/.test(N))||"Windows CE"!=U&&!/Mobi/i.test(t))if("IE"==N&&M)try{null===n.external&&C.unshift("platform preview")}catch(e){C.unshift("embedded")}else(/\bBlackBerry\b/.test(F)||/\bBB10\b/.test(t))&&(s=(RegExp(F.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||j)?(U=((s=[s,/BB10/.test(t)])[1]?(F=null,D="BlackBerry"):"Device Software")+" "+s[0],j=null):this!=h&&"Wii"!=F&&(M&&R||/Opera/.test(N)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==N&&/\bOS X (?:\d+\.){2,}/.test(U)||"IE"==N&&(U&&!/^Win/.test(U)&&j>5.5||/\bWindows XP\b/.test(U)&&j>8||8==j&&!/\bTrident\b/.test(t)))&&!u.test(s=e.call(h,t.replace(u,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),u.test(N)?(/\bIE\b/.test(s)&&"Mac OS"==U&&(U=null),s="identify"+s):(s="mask"+s,N=O?p(O.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(U=null),M||(j=null)),L=["Presto"],C.push(s));else N+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==N&&"+"==s[1].slice(-1)?(N="WebKit Nightly",P="alpha",j=s[1].slice(0,-1)):j!=s[1]&&j!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(j=null),s[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==L&&(L=["Blink"]),M&&(l||s[1])?(L&&(L[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:s<602?9:s<604?10:s<606?11:s<608?12:"12"),L&&(L[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==N&&(!j||parseInt(j)>45)?j=s:"Chrome"==N&&/\bHeadlessChrome/i.test(t)&&C.unshift("headless")),"Opera"==N&&(s=/\bzbov|zvav$/.exec(U))?(N+=" ",C.unshift("desktop mode"),"zvav"==s?(N+="Mini",j=null):N+="Mobile",U=U.replace(RegExp(" *"+s+"$"),"")):"Safari"==N&&/\bChrome\b/.exec(L&&L[1])?(C.unshift("desktop mode"),N="Chrome Mobile",j=null,/\bOS X\b/.test(U)?(D="Apple",U="iOS 4.3+"):U=null):/\bSRWare Iron\b/.test(N)&&!j&&(j=q("Chrome")),j&&0==j.indexOf(s=/[\d.]+$/.exec(U))&&t.indexOf("/"+s+"-")>-1&&(U=g(U.replace(s,""))),U&&-1!=U.indexOf(N)&&!RegExp(N+" OS").test(U)&&(U=U.replace(RegExp(" *"+y(N)+" *"),"")),L&&!/\b(?:Avant|Nook)\b/.test(N)&&(/Browser|Lunascape|Maxthon/.test(N)||"Safari"!=N&&/^iOS/.test(U)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(N)&&L[1])&&(s=L[L.length-1])&&C.push(s),C.length&&(C=["("+C.join("; ")+")"]),D&&F&&F.indexOf(D)<0&&C.push("on "+D),F&&C.push((/^on /.test(C[C.length-1])?"":"on ")+F),U&&(s=/ ([\d.+]+)$/.exec(U),c=s&&"/"==U.charAt(U.length-s[0].length-1),U={architecture:32,family:s&&!c?U.replace(s[0],""):U,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(A))&&!/\bi686\b/i.test(A)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(" *"+s),"")),N&&(/\bWOW64\b/i.test(t)||M&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(t))&&C.unshift("32-bit")):U&&/^OS X/.test(U.family)&&"Chrome"==N&&parseFloat(j)>=39&&(U.architecture=64),t||(t=null);var W={};return W.description=t,W.layout=L&&L[0],W.manufacturer=D,W.name=N,W.prerelease=P,W.product=F,W.ua=t,W.version=N&&j,W.os=U||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=e,W.toString=function(){return this.description||""},W.version&&C.unshift(j),W.name&&C.unshift(N),U&&N&&(U!=String(U).split(" ")[0]||U!=N.split(" ")[0]&&!F)&&C.push(F?"("+U+")":"on "+U),C.length&&(W.description=C.join(" ")),W}();i&&o?h(b,(function(e,t){i[t]=e})):r.platform=b}).call(t)}(E_,E_.exports);var T_=De,I_=Ft,R_=Fn,O_=k,A_=qy,C_=Yy;Uy("match",(function(e,t,n){return[function(t){var n=O_(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](R_(n))},function(e){var r=T_(this),i=R_(e),o=n(t,r,i);if(o.done)return o.value;if(!r.global)return C_(r,i);var a=r.unicode;r.lastIndex=0;for(var s,u=[],c=0;null!==(s=C_(r,i));){var l=R_(s[0]);u[c]=l,""===l&&(r.lastIndex=A_(i,I_(r.lastIndex),a)),c++}return 0===c?null:u}]}));var P_=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},M_=De,j_=k,L_=P_,N_=Fn,F_=Yy;Uy("search",(function(e,t,n){return[function(t){var n=j_(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](N_(n))},function(e){var r=M_(this),i=N_(e),o=n(t,r,i);if(o.done)return o.value;var a=r.lastIndex;L_(a,0)||(r.lastIndex=0);var s=F_(r,i);return L_(r.lastIndex,a)||(r.lastIndex=a),null===s?-1:s.index}]}));var D_=In,U_=qt,B_=jt,q_=Ft,W_=J,z_=Sr,G_=yo,K_=Gi("splice"),$_=Math.max,V_=Math.min,Q_=9007199254740991,Y_="Maximum allowed length exceeded";D_({target:"Array",proto:!0,forced:!K_},{splice:function(e,t){var n,r,i,o,a,s,u=W_(this),c=q_(u.length),l=U_(e,c),f=arguments.length;if(0===f?n=r=0:1===f?(n=0,r=c-l):(n=f-2,r=V_($_(B_(t),0),c-l)),c+n-r>Q_)throw TypeError(Y_);for(i=z_(u,r),o=0;o<r;o++)(a=l+o)in u&&G_(i,o,u[a]);if(i.length=r,n<r){for(o=l;o<c-r;o++)s=o+n,(a=o+r)in u?u[s]=u[a]:delete u[s];for(o=c;o>c-r+n;o--)delete u[o-1]}else if(n>r)for(o=c-r;o>l;o--)s=o+n-1,(a=o+r-1)in u?u[s]=u[a]:delete u[s];for(o=0;o<n;o++)u[o+l]=arguments[o+2];return u.length=c-r+n,i}}),function(e){var t=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};Object.defineProperty(e,"__esModule",{value:!0});var n=Ph.exports,r=Mh.exports,i=Lp.exports,o=jh.exports,a=Pp.exports,s=jp.exports,u=Np.exports,c=Cp.exports,l=Nh.exports,f=Fh,d=ud.exports,p=nl,h=Hh.exports,v=Uv.exports,y=oy,m=Bx.exports,g=Gx,b=E_.exports;function k(e){return e&&"object"===$o(e)&&"default"in e?e:{default:e}}function w(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var x=k(n),_=k(r),S=k(i),E=k(o),T=k(a),I=k(s),R=k(u),O=k(c),A=k(l),C=k(f),P=k(d),M=w(h),j=w(v),L=k(m),N=w(b);function F(){}function D(){D.init.call(this)}function U(e){return void 0===e._maxListeners?D.defaultMaxListeners:e._maxListeners}function B(e,t,n){if(t)e.call(n);else for(var r=e.length,i=Q(e,r),o=0;o<r;++o)i[o].call(n)}function q(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=Q(e,i),a=0;a<i;++a)o[a].call(n,r)}function W(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=Q(e,o),s=0;s<o;++s)a[s].call(n,r,i)}function z(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=Q(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}function G(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=Q(e,i),a=0;a<i;++a)o[a].apply(n,r)}function K(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new F,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=U(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[t]=n,++e._eventsCount;return e}function $(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function V(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Q(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}F.prototype=Object.create(null),D.EventEmitter=D,D.usingDomains=!1,D.prototype.domain=void 0,D.prototype._events=void 0,D.prototype._maxListeners=void 0,D.defaultMaxListeners=10,D.init=function(){this.domain=null,D.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new F,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},D.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},D.prototype.getMaxListeners=function(){return U(this)},D.prototype.emit=function(e){var t,n,r,i,o,a,s,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:B(n,l,this);break;case 2:q(n,l,this,arguments[1]);break;case 3:W(n,l,this,arguments[1],arguments[2]);break;case 4:z(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];G(n,l,this,i)}return!0},D.prototype.addListener=function(e,t){return K(this,e,t,!1)},D.prototype.on=D.prototype.addListener,D.prototype.prependListener=function(e,t){return K(this,e,t,!0)},D.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,$(this,e,t)),this},D.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,$(this,e,t)),this},D.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new F:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new F,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},D.prototype.off=function(e,t){return this.removeListener(e,t)},D.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new F,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new F:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new F,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},D.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},D.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):V.call(e,t)},D.prototype.listenerCount=V,D.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Y=M.getLogger("twilsock");function H(e,t){return["".concat((new Date).toISOString()," Twilsock ").concat(e,":")].concat(Array.from(t))}var J=new(function(){function e(t){O.default(this,e),A.default(this,"prefix",""),this.prefix=null!=t&&t.length>0?" "+t+":":""}return _.default(e,[{key:"setLevel",value:function(e){Y.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Y.trace.apply(null,H("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Y.debug.apply(null,H("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Y.info.apply(null,H("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Y.warn.apply(null,H("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Y.error.apply(null,H("E",t))}}],[{key:"setLevel",value:function(e){Y.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Y.trace.apply(null,H("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Y.debug.apply(null,H("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Y.info.apply(null,H("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Y.warn.apply(null,H("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Y.error.apply(null,H("E",t))}}]),e}())(""),X="0.12.2",Z=function(){function e(t,n,r){O.default(this,e),A.default(this,"confirmedCapabilities",new Set),this.activeGrant=n,this._token=t;var i=r.region||"us1",o="wss://tsock.".concat(i,".twilio.com/v3/wsconnect"),a=r.twilsock||r.Twilsock||{};this.url=a.uri||o,this._continuationToken=r.continuationToken?r.continuationToken:null,this.logLevel=r.logLevel?r.logLevel:"error",this.retryPolicy=r.retryPolicy?r.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=r.clientMetadata?r.clientMetadata:{},this.clientMetadata.ver=X,this.initRegistrations=r.initRegistrations?r.initRegistrations:null,this.tweaks=r.tweaks?r.tweaks:null}return _.default(e,[{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}},{key:"updateToken",value:function(e){this._token=e}},{key:"updateContinuationToken",value:function(e){this._continuationToken=e}}]),e}(),ee=function e(t){O.default(this,e),this.id=t||"TM".concat(y.v4())};function te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var ne=function(e){T.default(n,e);var t=te(n);function n(e,r,i,o,a){var s;return O.default(this,n),s=t.call(this),A.default(S.default(s),"method","init"),s.token=e,s.continuation_token=r,s.metadata=i,s.registrations=o,s.tweaks=a,s.capabilities=["client_update","offline_storage","telemetry.v1"],s}return n}(ee);function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var ie=function(e){T.default(n,e);var t=re(n);function n(e,r,i,o,a,s,u){var c;return O.default(this,n),(c=t.call(this,e)).continuationToken=r,c.continuationTokenStatus=o,c.offlineStorage=a,c.initRegistrations=s,c.debugInfo=u,c.confirmedCapabilities=i,c}return n}(ee);function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var ae=function(e){T.default(n,e);var t=oe(n);function n(e){var r;return O.default(this,n),r=t.call(this),A.default(S.default(r),"method","update"),r.token=e,r}return n}(ee);function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var ue=function(e){T.default(n,e);var t=se(n);function n(e,r,i){var o;return O.default(this,n),o=t.call(this),A.default(S.default(o),"method","message"),o.active_grant=e,o.payload_type=r,o.http_request=i,o}return n}(ee);function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var le=function(e){T.default(n,e);var t=ce(n);function n(e){var r;return O.default(this,n),r=t.call(this,e),A.default(S.default(r),"method","reply"),A.default(S.default(r),"payload_type","application/json"),A.default(S.default(r),"status",{code:200,status:"OK"}),r}return n}(ee);function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var de=function(e){T.default(n,e);var t=fe(n);function n(){var e;return O.default(this,n),e=t.call(this),A.default(S.default(e),"method","close"),e}return n}(ee);function pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var he=function e(t,n,r,i,o,a){O.default(this,e),this.start=t,this.end=n,this.title=r,this.details=i,this.id=o,this.type=a},ve=function(e){T.default(n,e);var t=pe(n);function n(e){var r;return O.default(this,n),r=t.call(this),A.default(S.default(r),"method","telemetry.v1"),r.events=e,r}return n}(ee);function ye(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})).length}function me(e){var t=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,(function(e,t){n[t]=e.charCodeAt(0)})),n}function ge(e){var t=Array.prototype.map.call(e,(function(e){return String.fromCharCode(e)})).join("").replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}));return decodeURIComponent(t)}function be(e){return JSON.parse(ge(e))}var ke=function(){function e(){O.default(this,e)}return _.default(e,null,[{key:"parse",value:function(e){var t,n,r=new Uint8Array(e),i=function(e){for(var t="",n=0;n<e.length;++n){var r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}var i=t.split(" ");return{size:n,protocol:i[0],version:i[1],headerSize:Number(i[2])}}(r);if("TWILSOCK"!==i.protocol||"V3.0"!==i.version)return J.error("unsupported protocol: ".concat(i.protocol," ver ").concat(i.version)),null;try{t=be(r.subarray(i.size,i.size+i.headerSize))}catch(t){return J.error("failed to parse message header",t,e),null}if(J.debug("message received: ",t.method),J.trace("message received: ",t),t.payload_size>0){var o=2+i.size+i.headerSize,a=t.payload_size;if(t.hasOwnProperty("payload_type")&&0!==t.payload_type.indexOf("application/json"))0===t.payload_type.indexOf("text/plain")&&(n=ge(r.subarray(o,o+a)));else try{n=be(r.subarray(o,o+a))}catch(t){return J.error("failed to parse message body",t,e),null}}return{method:t.method,header:t,payload:n}}},{key:"createPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=ye(t);var n=JSON.stringify(e),r="TWILSOCK V3.0 "+ye(n);J.debug("send request:",r+n+t);var i=me(r+"\r\n"+n+"\r\n"+t);return i.buffer}}]),e}();function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var xe=function(e){T.default(n,e);var t=we(n);function n(e){return O.default(this,n),t.call(this,e)}return n}(L.default(Error));function _e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Se=function(e){T.default(n,e);var t=_e(n);function n(e,r){var i;return O.default(this,n),(i=t.call(this,e)).reply=r,i}return n}(xe);function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach((function(t){A.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Re=function(e){T.default(n,e);var t=Ie(n);function n(e){var r;return O.default(this,n),r=t.call(this),A.default(S.default(r),"newBackoff",null),A.default(S.default(r),"usedBackoff",null),A.default(S.default(r),"retrier",null),r.options=e?Te({},e):{},r}return _.default(n,[{key:"inProgress",get:function(){return!!this.retrier}},{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(e){this.newBackoff=e}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");var e,t;this.newBackoff?!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():null===(e=this.retrier)||void 0===e||e.failed(new Error):null===(t=this.retrier)||void 0===t||t.failed(new Error)}},{key:"cancel",value:function(){var e;null===(e=this.retrier)||void 0===e||e.cancel()}},{key:"cleanRetrier",value:function(){var e,t;null===(e=this.retrier)||void 0===e||e.removeAllListeners(),null===(t=this.retrier)||void 0===t||t.cancel(),this.retrier=null}},{key:"getRetryPolicy",value:function(){var e=Te({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}},{key:"createRetrier",value:function(){var e=this;this.cleanRetrier();var t=this.getRetryPolicy();this.retrier=new g.Retrier(t),this.retrier.once("attempt",(function(){var t,n;null===(t=e.retrier)||void 0===t||t.on("attempt",(function(){return e.emit("attempt")})),null===(n=e.retrier)||void 0===n||n.failed(new Error("Skipping first attempt"))})),this.retrier.on("failed",(function(t){return e.emit("failed",t)})),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start()}}]),n}(D);function Oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Ae=function(e){T.default(i,e);var t,n,r=Oe(i);function i(e,t,n){var o;O.default(this,i),o=r.call(this),A.default(S.default(o),"disconnectingTimer",null),A.default(S.default(o),"disconnectedPromiseResolve",null),A.default(S.default(o),"terminalStates",["disconnected","rejected"]),A.default(S.default(o),"tokenExpiredSasCode",20104),A.default(S.default(o),"terminationReason","Connection is not initialized"),o.websocket=e,o.websocket.on("connected",(function(){return o.fsm.socketConnected()})),o.websocket.on("disconnected",(function(){return o.fsm.socketClosed()})),o.websocket.on("message",(function(e){return o.onIncomingMessage(e)})),o.websocket.on("socketError",(function(e){return o.emit("connectionError",{terminal:!1,message:"Socket error: ".concat(e.message),httpStatusCode:null,errorCode:null})})),o.transport=t,o.config=n,o.retrier=new Re(n.retryPolicy),o.retrier.on("attempt",(function(){return o.retry()})),o.retrier.on("failed",(function(e){J.warn("Retrying failed: ".concat(e.message)),o.disconnect()})),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",(function(){J.debug("Browser reported connectivity state: online"),o.resetBackoff(),o.fsm.systemOnline()})),window.addEventListener("offline",(function(){J.debug("Browser reported connectivity state: offline"),o.websocket.close(),o.fsm.socketClosed()})));var a=j.factory({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){o.setupSocket(),o.emit("connecting")},onEnterInitialising:function(){o.sendInit()},onLeaveInitialising:function(){o.cancelInit()},onEnterUpdating:function(){o.sendUpdate()},onLeaveUpdating:function(){o.cancelUpdate()},onEnterRetrying:function(){o.initRetry(),o.emit("connecting")},onEnterConnected:function(){o.resetBackoff(),o.onConnected()},onUserUpdateToken:function(){o.resetBackoff()},onTokenRejected:function(){o.resetBackoff(),o.closeSocket(!0),o.finalizeSocket()},onUserDisconnect:function(){o.closeSocket(!0)},onEnterDisconnecting:function(){o.startDisconnectTimer()},onLeaveDisconnecting:function(){o.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){o.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){o.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){o.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){o.cancelDisconnectTimer()},onDisconnected:function(){o.resetBackoff(),o.finalizeSocket()},onReceiveClose:function(){o.onCloseReceived()},onReceiveOffload:function(e,t){J.debug("onreceiveoffload: ",t),o.modifyBackoff(t.body),o.onCloseReceived()},onUnsupported:function(){o.closeSocket(!0),o.finalizeSocket()},onError:function(e,t){o.closeSocket(t),o.finalizeSocket()},onEnterState:function(e){"none"!==e.from&&o.changeState(e)},onInvalidTransition:function(e,t,n){J.warn("FSM: unexpected transition",t,n)}}});return o.fsm=new a,o}return _.default(i,[{key:"changeState",value:function(e){J.debug("FSM: ".concat(e.transition,": ").concat(e.from," --\x3e ").concat(e.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){J.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(e){J.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}},{key:"startDisconnectTimer",value:function(){var e=this;J.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout((function(){J.debug("disconnecting is timed out"),e.closeSocket(!0)}),3e3)}},{key:"cancelDisconnectTimer",value:function(){J.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"isConnected",get:function(){return"connected"===this.state&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"denied";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{key:"initRetry",value:function(){J.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{key:"retry",value:function(){"connecting"!=this.fsm.state?(J.trace("retry"),this.websocket.close(),this.fsm.userRetry()):J.trace("can\t retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){J.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){J.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}},{key:"onIncomingMessage",value:function(e){var t=ke.parse(e);if(t){var n=t.method,r=t.header,i=t.payload;if("reply"!==n&&this.confirmReceiving(r),"notification"===n)this.emit("message",r.message_type,i);else if("reply"===r.method)this.transport.processReply({id:r.id,status:r.status,header:r,body:i});else if("client_update"===r.method)"token_about_to_expire"===r.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===r.method)if(308===r.status.code)J.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:r.status.status,body:i});else if(406===r.status.code){var o="Server closed connection because can't parse protocol: ".concat(JSON.stringify(r.status));this.emitReplyConnectionError(o,r,!0),J.error(o),this.fsm.receiveFatalClose()}else 417===r.status.code?(J.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify(r.status))),this.fsm.receiveFatalClose(r.status.status)):410===r.status.code?(J.warn("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status),this.emit("tokenExpired")):401===r.status.code?(J.error("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status)):(J.warn("unexpected message: ",r.status),this.fsm.receiveOffload({status:r.status.status,body:null}))}}},{key:"sendInit",value:(n=x.default(C.default.mark((function e(){var t,n;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return J.trace("sendInit"),e.prev=1,this.emit("beforeSendInit"),e.next=5,this.transport.sendInit();case 5:t=e.sent,this.config.updateContinuationToken(t.continuationToken),this.config.confirmedCapabilities=t.confirmedCapabilities,this.fsm.initSuccess(t),this.emit("initialized",t),this.emit("tokenUpdated"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),e.t0 instanceof Se?(n=!1,J.warn("Init rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),this.emit("sendInitFailed"),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(n=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.initError(!0)):500===e.t0.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(e.t0.message,e.t0.reply,n)):(this.terminationReason=e.t0.message,this.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: ".concat(e.t0.message,"\n").concat(JSON.stringify(e.t0,null,2)),httpStatusCode:null,errorCode:null}),this.fsm.initError(!0)),this.emit("tokenUpdated",e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(){return n.apply(this,arguments)})},{key:"sendUpdate",value:(t=x.default(C.default.mark((function e(){var t,n,r;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return J.trace("sendUpdate"),t=new ae(this.config.token),e.prev=2,e.next=5,this.transport.sendWithReply(t);case 5:n=e.sent,this.fsm.updateSuccess(n.body),this.emit("tokenUpdated"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0 instanceof Se?(r=!1,J.warn("Token update rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(r=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0.reply.status),this.emitReplyConnectionError(e.t0.message,e.t0.reply,r)):(this.emit("error",!1,e.t0.message,null,null),this.fsm.updateError(e.t0)),this.emit("tokenUpdated",e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(){return t.apply(this,arguments)})},{key:"emitReplyConnectionError",value:function(e,t,n){var r=t.status&&t.status.description?t.status.description:e,i=t.status.code,o=t.status&&t.status.errorCode?t.status.errorCode:null;n&&(this.terminationReason=r),this.emit("connectionError",{terminal:n,message:"Connection error: ".concat(r),httpStatusCode:i,errorCode:o})}},{key:"cancelInit",value:function(){J.trace("cancelInit")}},{key:"cancelUpdate",value:function(){J.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(e){J.trace("confirmReceiving");try{this.transport.send(new le(e.id))}catch(e){J.debug("failed to confirm packet receiving",e)}}},{key:"closeSocket",value:function(e){var t=this;J.trace("closeSocket (graceful: ".concat(e,")")),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout((function(){return t.fsm.socketClosed()}),0)}},{key:"connect",value:function(){J.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return J.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise((function(t){e.disconnectedPromiseResolve=t,e.fsm.userDisconnect()}))}},{key:"updateToken",value:function(e){var t=this;return J.trace("updateToken:",e),new Promise((function(e,n){t.once("tokenUpdated",(function(t){t?n(t):e()})),t.fsm.userUpdateToken()}))}},{key:"isTerminalState",get:function(){return-1!==this.terminalStates.indexOf(this.fsm.state)}},{key:"getTerminationReason",get:function(){return this.terminationReason}},{key:"onCloseReceived",value:function(){this.websocket.close()}}]),i}(D),Ce=function(){function e(){O.default(this,e)}return _.default(e,null,[{key:"getMetadata",value:function(e){var t,n,r,i,o,a,s,u,c=e&&e.clientMetadata?e.clientMetadata:{},l={env:null!==(t=N.name)&&void 0!==t?t:"unknown",envv:null!==(n=N.version)&&void 0!==n?n:"unknown",os:null!==(r=null===(i=N.os)||void 0===i?void 0:i.family)&&void 0!==r?r:"unknown",osv:null!==(o=null===(a=N.os)||void 0===a?void 0:a.version)&&void 0!==o?o:"unknown",osa:null!==(s=null===(u=N.os)||void 0===u?void 0:u.architecture)&&void 0!==s?s:"unknown",sdk:"js-default"},f={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter((function(e){return e in c||e in l})).forEach((function(e){return f[e]=e in c?c[e]:l[e]})),f}}]),e}();var Pe=function(){function e(t,n){var r=this;O.default(this,e),this.config=n,this.activeRequests=new Map,this.channel=t,this.channel.on("reply",(function(e){return r.processReply(e)})),this.channel.on("disconnected",(function(){r.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new xe("disconnected"))})),r.activeRequests.clear()}))}var t;return _.default(e,[{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"processReply",value:function(e){var t,n=this.activeRequests.get(e.id);n&&(clearTimeout(n.timeout),this.activeRequests.delete(e.id),(t=e.status.code)>=200&&t<300?n.resolve(e):(n.reject(new Se("Transport failure: "+e.status.status,e)),J.trace("message rejected")))}},{key:"storeRequest",value:function(e,t,n){var r={resolve:t,reject:n,timeout:setTimeout((function(){J.trace("request",e,"is timed out"),n(new xe("Twilsock: request timeout: "+e))}),3e4)};this.activeRequests.set(e,r)}},{key:"shutdown",value:function(){this.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new xe("Twilsock: request cancelled by user"))})),this.activeRequests.clear()}},{key:"sendInit",value:(t=x.default(C.default.mark((function e(){var t,n,r;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return J.trace("sendInit"),t=Ce.getMetadata(this.config),n=new ne(this.config.token,this.config.continuationToken,t,this.config.initRegistrations,this.config.tweaks),e.next=5,this.sendWithReply(n);case 5:return r=e.sent,e.abrupt("return",new ie(r.id,r.header.continuation_token,new Set(r.header.capabilities),r.header.continuation_token_status,r.header.offline_storage,r.header.init_registrations,r.header.debug_info));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"sendClose",value:function(){var e=new de;this.send(e)}},{key:"sendWithReply",value:function(e,t){var n=this;return new Promise((function(r,i){var o=n.send(e,t);n.storeRequest(o,r,i)}))}},{key:"send",value:function(e,t){e.id=e.id||"TM".concat(y.v4());var n=ke.createPacket(e,function(e){switch(P.default(e)){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(t){throw J.debug("failed to send ",e,t),J.trace(t.stack),t}}}]),e}();function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var je=function(e){T.default(r,e);var n=Me(r);function r(e){var i;return O.default(this,r),i=n.call(this),A.default(S.default(i),"socket",null),i.url=e,i.url=e,i.WebSocket=t.WebSocket||t.MozWebSocket||{},i}return _.default(r,[{key:"isConnected",get:function(){return!!this.socket&&1===this.socket.readyState}},{key:"connect",value:function(){var e,t=this;J.trace("connecting to socket");try{e=new this.WebSocket(this.url)}catch(e){return J.debug("Socket error: ".concat(this.url)),void this.emit("socketError",e)}e.binaryType="arraybuffer",e.onopen=function(){J.debug("socket opened ".concat(t.url)),t.emit("connected")},e.onclose=function(e){J.debug("socket closed",e),t.emit("disconnected",e)},e.onerror=function(e){J.debug("Socket error:",e),t.emit("socketError",e)},e.onmessage=function(e){t.emit("message",e.data)},this.socket=e}},{key:"send",value:function(e){return this.socket&&this.socket.send(e)}},{key:"close",value:function(){if(J.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}]),r}(D);function Le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Ne=function(e){T.default(u,e);var t,n,r,i,o,a,s=Le(u);function u(e){var t;return O.default(this,u),(t=s.call(this)).transport=e,t.registrations=new Map,t.registrationsInProgress=new Map,t}return _.default(u,[{key:"putNotificationContext",value:(a=x.default(C.default.mark((function e(t,n){var r;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"put_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(r,n);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"deleteNotificationContext",value:(o=x.default(C.default.mark((function e(t){var n;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"delete_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"updateRegistration",value:(i=x.default(C.default.mark((function e(t,n){var r,i;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return J.debug("update registration for context",t),(r=this.registrationsInProgress.get(t))||(r=new Set,this.registrationsInProgress.set(t,r)),i=y.v4(),r.add(i),e.prev=5,e.next=8,this.putNotificationContext(t,n);case 8:J.debug("registration attempt succeeded for context",n),r.delete(i),0===r.size&&(this.registrationsInProgress.delete(t),this.emit("registered",t)),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(5),J.warn("registration attempt failed for context",n),J.debug(e.t0),r.delete(i),0===r.size&&(this.registrationsInProgress.delete(t),this.emit("registrationFailed",t,e.t0));case 19:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(e,t){return i.apply(this,arguments)})},{key:"updateRegistrations",value:(r=x.default(C.default.mark((function e(){var t,n=this;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return J.trace("refreshing ".concat(this.registrations.size," registrations")),t=[],this.registrations.forEach((function(e,r){t.push(n.updateRegistration(r,e))})),e.next=5,Promise.all(t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setNotificationsContext",value:(n=x.default(C.default.mark((function e(t,n){return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}throw new xe("Invalid arguments provided");case 2:return this.registrations.set(t,n),e.next=5,this.updateRegistration(t,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeNotificationsContext",value:(t=x.default(C.default.mark((function e(t){return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrations.has(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.deleteNotificationContext(t);case 4:this.transport.isConnected&&this.registrations.delete(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),u}(D);function Fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var De=function(e){T.default(n,e);var t=Fe(n);function n(e,r,i){var o;return O.default(this,n),(o=t.call(this,r)).status=e,o.description=r,o.body=i,o}return n}(xe);function Ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Be=function(e){T.default(n,e);var t=Ue(n);function n(e){return O.default(this,n),t.call(this,e)}return n}(xe);function qe(e,t){var n=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:{}};if(n.search.length>0){var r=n.search.substring(1);n.params=r.split("&").map((function(e){return e.split("=")})).reduce((function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e}),{})}return n}throw new xe("Incorrect URI: "+e)}(t),r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}function We(e,t,n,r,i){return{to:qe(e,t),headers:n,body:r,grant:i}}var ze=function(){function e(t,n,r){O.default(this,e),this.config=r,this.transport=t,this.pendingMessages=[],this.twilsock=n}var t;return _.default(e,[{key:"saveMessage",value:function(e){var t=this;return new Promise((function(n,r){var i={message:e,resolve:n,reject:r,alreadyRejected:!1,timeout:setTimeout((function(){J.debug("request is timed out"),r(new xe("request '".concat(e.to.method,"' to '").concat(e.to.host,"' timed out"))),i.alreadyRejected=!0}),2e4)};t.pendingMessages.push(i)}))}},{key:"sendPendingMessages",value:function(){for(var e=this,t=function(){var t=e.pendingMessages[0];if(!t.alreadyRejected)try{var n=t.message;e.actualSend(n).then((function(e){return t.resolve(e)})).catch((function(e){return t.reject(e)})),clearTimeout(t.timeout)}catch(e){return J.debug("Failed to send pending message",e),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length>0;){if("break"===t())break}}},{key:"rejectPendingMessages",value:function(){var e=this;this.pendingMessages.forEach((function(t){t.reject(new Be("Unable to connect: "+e.twilsock.getTerminationReason)),t.alreadyRejected=!0,clearTimeout(t.timeout)})),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:(t=x.default(C.default.mark((function e(t){var n,r,i,o,a,s,u,c;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.to,i=t.headers,o=t.body,a=null!==(n=t.grant)&&void 0!==n?n:this.config.activeGrant,s={host:r.host,path:r.path,method:r.method,params:r.params,headers:i},u=new ue(a,i["Content-Type"]||"application/json",s),J.trace("Sending upstream message",u),e.next=9,this.transport.sendWithReply(u,o);case 9:if(c=e.sent,J.trace("Received upstream message response",c),!((f=c)&&f.header&&f.header.http_status)||(l=c.header.http_status.code)>=200&&l<300){e.next=13;break}throw new De(c.header.http_status.code,c.header.http_status.status,c.body);case 13:return e.abrupt("return",{status:c.header.http_status,headers:c.header.http_headers,body:c.body});case 14:case"end":return e.stop()}var l,f}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new Be("Unable to connect: "+this.twilsock.getTerminationReason));var o=We(e,t,n,r,i);return this.twilsock.isConnected?this.actualSend(o):this.saveMessage(o)}}]),e}(),Ge=function(){function e(){var t=this;O.default(this,e),this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return _.default(e,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}}]),e}(),Ke=function(){function e(t){O.default(this,e),this.id=t}return _.default(e,null,[{key:"create",value:function(t){if(t instanceof Object&&"storage_id"in t)return new e(t.storage_id);throw new xe('Field "storage_id" is missing')}}]),e}(),$e=function(){function e(){return O.default(this,e),A.default(this,"initializedFlag","twilio_twilsock_token_storage"),A.default(this,"tokenStoragePrefix","twilio_continuation_token_"),e._instance||(this.initialize(),e._instance=this),e._instance}return _.default(e,[{key:"sessionStorage",value:function(){try{return t.sessionStorage}catch(e){return null}}},{key:"window",value:function(){try{return t.window}catch(e){return null}}},{key:"storeToken",value:function(e,t){this.canStore()&&this.sessionStorage.setItem(this.getKeyName(t),e)}},{key:"getStoredToken",value:function(e){return this.canStore()?this.sessionStorage.getItem(this.getKeyName(e)):null}},{key:"initialize",value:function(){var e=this;if(this.canStore()){this.sessionStorage.getItem(this.initializedFlag)&&this.clear(),this.sessionStorage.setItem(this.initializedFlag,"true");var t=this.sessionStorage.removeItem;this.window.addEventListener("unload",(function(){t(e.initializedFlag)}))}}},{key:"clear",value:function(){if(this.canStore()){for(var e=[],t=0;t<this.sessionStorage.length;t++){var n=this.sessionStorage.key(t);n&&0===n.indexOf(this.tokenStoragePrefix)&&e.push(n)}var r=this.sessionStorage.removeItem;e.forEach((function(e){return r(e)})),r(this.initializedFlag)}}},{key:"getKeyName",value:function(e){return"".concat(this.tokenStoragePrefix).concat(e)}},{key:"canStore",value:function(){return!!(this.sessionStorage&&this.sessionStorage.length&&this.window)}}]),e}();A.default($e,"_instance",null);var Ve,Qe,Ye=new $e,He=function(){function e(t,n,r,i,o,a){O.default(this,e),this.title=t,this.details=n,this.start=r,this.type=o,this.id=a,this.end=i}return _.default(e,[{key:"toTelemetryEvent",value:function(){var e=new Date,t=this.start,n=this.end?this.end:e;if(n<t){var r=n;n=t,t=r}var i=t.getTime()-e.getTime(),o=n.getTime()-e.getTime();return new he(i,o,this.title,this.details,this.id,this.type)}}]),e}();e.TelemetryPoint=void 0,(Ve=e.TelemetryPoint||(e.TelemetryPoint={}))[Ve.Start=0]="Start",Ve[Ve.End=1]="End",e.EventSendingLimitation=void 0,(Qe=e.EventSendingLimitation||(e.EventSendingLimitation={}))[Qe.MinEventsPortion=0]="MinEventsPortion",Qe[Qe.AnyEvents=1]="AnyEvents",Qe[Qe.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished";var Je=function(){function t(e,n){O.default(this,t),A.default(this,"minEventsPortionToSend",50),A.default(this,"maxEventsPortionToSend",100),A.default(this,"pendingEvents",new Map),A.default(this,"readyEvents",[]),A.default(this,"hasInitializationFinished",!1),A.default(this,"_canSendTelemetry",!1),this.config=e,this.packetInterface=n}return _.default(t,[{key:"isTelemetryEnabled",get:function(){return this.config.confirmedCapabilities.has("telemetry.v1")}},{key:"canSendTelemetry",get:function(){return this._canSendTelemetry&&this.isTelemetryEnabled},set:function(t){J.debug("TelemetryTracker.canSendTelemetry: ".concat(t," TelemetryTracker.isTelemetryEnabled: ").concat(this.isTelemetryEnabled)),this._canSendTelemetry&&!t&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=t,t&&this.sendTelemetry(e.EventSendingLimitation.AnyEvents),t&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}},{key:"addTelemetryEvent",value:function(e){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(e)}},{key:"addPartialEvent",value:function(t,n,r){J.debug("Adding ".concat(r===e.TelemetryPoint.Start?"starting":"ending"," timepoint for '").concat(n,"' event"));var i=this.pendingEvents.has(n);if(r===e.TelemetryPoint.Start)i&&J.debug("Overwriting starting point for '".concat(n,"' event")),this.pendingEvents.set(n,t);else{if(!i)return void J.info("Could not find started event for '".concat(n,"' event"));this.addTelemetryEvent(this.merge(this.pendingEvents.get(n),t)),this.pendingEvents.delete(n)}}},{key:"getTelemetryToSend",value:function(t){return this.canSendTelemetry&&0!=this.readyEvents.length?t==e.EventSendingLimitation.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(t==e.EventSendingLimitation.AnyEventsIncludingUnfinished):[]}},{key:"getTelemetryPortion",value:function(e){var t=this,n=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),r=this.readyEvents.splice(0,n);return e&&r.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach((function(e,n){if(!(r.length>=t.maxEventsPortionToSend)){var i=t.pendingEvents.get(n);t.pendingEvents.delete(n),r.push(new He("[UNFINISHED] ".concat(i.title),i.details,i.start,null,i.type,i.id))}})),r}},{key:"merge",value:function(e,t){return new He(t.title?t.title:e.title,t.details?t.details:e.details,e.start,t.end,t.type?t.type:e.type,t.id?t.id:e.id)}},{key:"sendTelemetryIfMinimalPortionCollected",value:function(){this.sendTelemetry(e.EventSendingLimitation.MinEventsPortion)}},{key:"sendTelemetry",value:function(e){var t=this.getTelemetryToSend(e);if(0!==t.length)try{this.packetInterface.send(new ve(t.map((function(e){return e.toTelemetryEvent()}))))}catch(e){J.debug("Error while sending ".concat(t.length," telemetry events due to ").concat(e,"; they will be resubmitted")),this.readyEvents=this.readyEvents.concat(t)}}}]),t}();function Xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Ze=function e(){O.default(this,e)};A.default(Ze,"TWILSOCK_CONNECT","twilsock.sdk.connect"),A.default(Ze,"TWILSOCK_INIT","twilsock.sdk.init"),e.TwilsockClient=function(t){T.default(f,t);var n,r,i,o,a,s,u,c,l=Xe(f);function f(t,n,r){var i;O.default(this,f),i=l.call(this),A.default(S.default(i),"version",X),A.default(S.default(i),"offlineStorageDeferred",new Ge),r.continuationToken=r.continuationToken?r.continuationToken:Ye.getStoredToken(n);var o=i.config=new Z(t,n,r);J.setLevel(o.logLevel);var a=new je(o.url),s=new Pe(a,o);return i.channel=new Ae(a,s,o),i.registrations=new Ne(s),i.upstream=new ze(s,i.channel,o),i.telemetryTracker=new Je(o,s),i.channel.on("initialized",(function(){return i.telemetryTracker.canSendTelemetry=!0})),a.on("disconnected",(function(){return i.telemetryTracker.canSendTelemetry=!1})),i.registrations.on("registered",(function(e){return i.emit("registered",e)})),i.channel.on("message",(function(e,t){return setTimeout((function(){return i.emit("message",e,t)}),0)})),i.channel.on("stateChanged",(function(e){return setTimeout((function(){return i.emit("stateChanged",e)}),0)})),i.channel.on("connectionError",(function(e){return setTimeout((function(){return i.emit("connectionError",e)}),0)})),i.channel.on("tokenAboutToExpire",(function(){return setTimeout((function(){return i.emit("tokenAboutToExpire")}),0)})),i.channel.on("tokenExpired",(function(){return setTimeout((function(){return i.emit("tokenExpired")}),0)})),i.channel.on("connected",(function(){return i.registrations.updateRegistrations()})),i.channel.on("connected",(function(){return i.upstream.sendPendingMessages()})),i.channel.on("connected",(function(){return setTimeout((function(){return i.emit("connected")}),0)})),i.channel.on("beforeConnect",(function(){return i.telemetryTracker.addPartialEvent(new He("Establish WebSocket connection","",new Date),Ze.TWILSOCK_CONNECT,e.TelemetryPoint.Start)})),i.channel.on("connected",(function(){return i.telemetryTracker.addPartialEvent(new He("Establish WebSocket connection","",new Date,new Date),Ze.TWILSOCK_CONNECT,e.TelemetryPoint.End)})),i.channel.on("beforeSendInit",(function(){return i.telemetryTracker.addPartialEvent(new He("Send Twilsock init","",new Date),Ze.TWILSOCK_INIT,e.TelemetryPoint.Start)})),i.channel.on("initialized",(function(){return i.telemetryTracker.addPartialEvent(new He("Send Twilsock init","Succeeded",new Date,new Date),Ze.TWILSOCK_INIT,e.TelemetryPoint.End)})),i.channel.on("sendInitFailed",(function(){return i.telemetryTracker.addPartialEvent(new He("Send Twilsock init","Failed",new Date,new Date),Ze.TWILSOCK_INIT,e.TelemetryPoint.End)})),i.channel.on("initialized",(function(e){i.handleStorageId(n,e),Ye.storeToken(e.continuationToken,n),setTimeout((function(){return i.emit("initialized",e)}),0)})),i.channel.on("disconnected",(function(){return setTimeout((function(){return i.emit("disconnected")}),0)})),i.channel.on("disconnected",(function(){return i.upstream.rejectPendingMessages()})),i.channel.on("disconnected",(function(){return i.offlineStorageDeferred.fail(new xe("Client disconnected"))})),i.offlineStorageDeferred.promise.catch((function(){})),i}return _.default(f,[{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return J.debug("Emitting ".concat(e.toString(),"(").concat(r.map((function(e){return JSON.stringify(e)})).join(", "),")")),(t=E.default(R.default(f.prototype),"emit",this)).call.apply(t,[this,e].concat(r))}},{key:"handleStorageId",value:function(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(Ke.create(t.offlineStorage[e])),J.debug("Offline storage for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage[e]),"."))}catch(n){this.offlineStorageDeferred.fail(new xe("Failed to parse offline storage for ".concat(e," ").concat(JSON.stringify(t.offlineStorage[e]),". ").concat(n,".")))}else this.offlineStorageDeferred.fail(new xe("No offline storage id for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage))));else this.offlineStorageDeferred.fail(new xe("No offline storage id"))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}},{key:"updateToken",value:(c=x.default(C.default.mark((function e(t){return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(J.trace("updating token '".concat(t,"'")),this.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return this.config.updateToken(t),e.next=6,this.channel.updateToken(t);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"setNotificationsContext",value:(u=x.default(C.default.mark((function e(t,n){return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.registrations.setNotificationsContext(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"removeNotificationsContext",value:(s=x.default(C.default.mark((function e(t){return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.registrations.removeNotificationsContext(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:(a=x.default(C.default.mark((function t(){return C.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEventsIncludingUnfinished),t.next=3,this.channel.disconnect();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"get",value:(o=x.default(C.default.mark((function t(n,r,i){return C.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("GET",n,r,void 0,i);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"post",value:(i=x.default(C.default.mark((function t(n,r,i,o){return C.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("POST",n,r,i,o);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"put",value:(r=x.default(C.default.mark((function t(n,r,i,o){return C.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("PUT",n,r,i,o);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"delete",value:(n=x.default(C.default.mark((function t(n,r,i,o){return C.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("DELETE",n,r,i,o);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"addTelemetryEvent",value:function(e){this.telemetryTracker.addTelemetryEvent(e),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"addPartialTelemetryEvent",value:function(t,n,r){this.telemetryTracker.addPartialEvent(t,n,r),r===e.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}}]),f}(D),e.TwilsockClient=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":P.default(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([p.validateConstructorTypes(p.nonEmptyString,p.nonEmptyString,[p.pureObject,"undefined",p.literal(null)]),function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":P.default(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[String,String,Object])],e.TwilsockClient);var et=function(){function e(t){O.default(this,e),this.product=t,this.type="ers",this.notification_protocol_version=0,this.message_types=[]}return _.default(e,[{key:"populateInitRegistrations",value:function(e){var t=new Set(this.message_types);for(var n in e)t.add(e[n]);this.message_types=Array.from(t)}}]),e}();e.InitRegistration=et,e.TelemetryEventDescription=He,e.TelemetryTracker=Je,e.TransportUnavailableError=Be,e.Twilsock=e.TwilsockClient,e.TwilsockError=xe}(Ch);var H_=function(){function e(t){Bo(this,e),this.base=t,this.args=new Array,this.paths=new Array}return Wo(e,[{key:"pathSegment",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"queryParam",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();function J_(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function X_(e,t,n){return(X_=J_()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Go(i,n.prototype),i}).apply(null,arguments)}function Z_(e){var t="function"==typeof Map?new Map:void 0;return(Z_=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return X_(e,arguments,Qo(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Go(r,e)})(e)}function eS(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qo(e);if(t){var i=Qo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vo(this,n)}}var tS=function(e){Ko(n,e);var t=eS(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Bo(this,n),(r=t.call(this)).name=r.constructor.name,r.message="".concat(e," (status: ").concat(i,", code: ").concat(o,")"),r.status=i,r.code=o,r}return n}(Z_(Error)),nS=function(e){Ko(n,e);var t=eS(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;return Bo(this,n),(r=t.call(this,e,i,o)).body=a,r}return n}(tS);function rS(e){return JSON.parse(JSON.stringify(e))}function iS(e){if(!(void 0===e||oS(e)))throw new tS("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,20007)}function oS(e){return function(e){return!isNaN(parseInt(e))&&isFinite(e)}(e)&&e>0}var aS=Hh.exports.getLogger("twilio-sync");function sS(e,t){return["".concat((new Date).toISOString()," Sync ").concat(e,":")].concat(Array.from(t))}var uS=function(e){aS.setLevel(e)},cS=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];aS.trace.apply(null,sS("T",t))},lS=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];aS.debug.apply(null,sS("D",t))},fS=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];aS.warn.apply(null,sS("W",t))},dS=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];aS.error.apply(null,sS("E",t))},pS="/v4/Subscriptions",hS="/v3/Maps",vS="/v3/Lists",yS="/v3/Documents",mS="/v3/Streams",gS="/v3/Insights";function bS(e,t,n){return e&&void 0!==e[t]?e[t]:n}var kS=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Bo(this,e);var n=t.region||"us1",r="https://cds.".concat(n,".twilio.com"),i=t.cdsUri||r;this.settings={subscriptionsUri:i+pS,documentsUri:i+yS,listsUri:i+vS,mapsUri:i+hS,streamsUri:i+mS,insightsUri:i+gS,sessionStorageEnabled:bS(t.Sync,"enableSessionStorage",!0),productId:t.productId}}return Wo(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"insightsUri",get:function(){return this.settings.insightsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}},{key:"productId",get:function(){return this.settings.productId}}]),e}();function wS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return wS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wS(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var _S=s,SS=a,ES=An,TS=tn,IS=u,RS=J,OS=b,AS=Object.assign,CS=Object.defineProperty,PS=!AS||SS((function(){if(_S&&1!==AS({b:1},AS(CS({},"a",{enumerable:!0,get:function(){CS(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=AS({},e)[n]||ES(AS({},t)).join("")!=r}))?function(e,t){for(var n=RS(e),r=arguments.length,i=1,o=TS.f,a=IS.f;r>i;)for(var s,u=OS(arguments[i++]),c=o?ES(u).concat(o(u)):ES(u),l=c.length,f=0;l>f;)s=c[f++],_S&&!a.call(u,s)||(n[s]=u[s]);return n}:AS;function MS(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return jS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jS(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function jS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}In({target:"Object",stat:!0,forced:Object.assign!==PS},{assign:PS});var LS=function(){function e(t){Bo(this,e),this.localObject=t,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return Wo(e,[{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"indexName",get:function(){return this.localObject.indexName}},{key:"queryString",get:function(){return this.localObject.queryString}},{key:"isEstablished",get:function(){return this.established}},{key:"update",value:function(e,t){this.localObject._update(e,t)}},{key:"updatePending",value:function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{key:"markAsFailed",value:function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new tS("Failed to subscribe on service events: ".concat(e.error.message),e.error.status,e.error.code))}},{key:"complete",value:function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{key:"setSubscriptionState",value:function(e){this.localObject._setSubscriptionState(e)}}]),e}(),NS=function(){function e(t){var n=this;Bo(this,e),Yo(this,"isConnected",!1),Yo(this,"maxBatchSize",100),Yo(this,"subscriptionTtlTimer",null),Yo(this,"pendingPokeReason",null),this.services=t,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;this.backoff=__.exponential(Object.assign({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",(function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,r):(n.backoff.reset(),lS("All subscriptions resolved."))}))}var t;return Wo(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,n,r){var i,o=[],a=MS(e);try{for(a.s();!(i=a.n()).done;){var s=xS(i.value,2),u=s[0],c=s[1];if(!t.get(u)&&n!==c.pendingAction&&!c.rejectedWithError&&(o.push(c),r&&o.length>=r))break}}catch(e){a.e(e)}finally{a.f()}return o}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var n=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}},{key:"persist",value:function(){this.backoff.backoff()}},{key:"applyNewSubscriptionUpdateBatch",value:(t=Uo(Bc.mark((function e(t,n){var r,i,o,a,s,u,c,l,f,d,p,h,v=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=4;break}return lS("Twilsock connection (required for subscription) not ready; waitingâ¦"),this.backoff.reset(),e.abrupt("return");case 4:n=this.processLocalActions(t,n),r=(new Date).getTime(),i=MS(n);try{for(i.s();!(o=i.n()).done;)a=o.value,this.recordActionAttemptOn(a,t,r)}catch(e){i.e(e)}finally{i.f()}return s=this.pendingPokeReason,this.pendingPokeReason=null,e.prev=10,e.next=13,this.request(t,r,s,n);case 13:u=e.sent,c=u.body.max_batch_size,!isNaN(parseInt(c))&&isFinite(c)&&c>0&&(this.maxBatchSize=c),this.subscriptionTtlTimer||(l=u.body.ttl_in_s,!isNaN(parseFloat(l))&&isFinite(l)&&l>0&&(this.subscriptionTtlTimer=setTimeout((function(){return v.onSubscriptionTtlElapsed()}),1e3*l))),"establish"===t&&(f=u.body.estimated_delivery_in_ms,!isNaN(parseFloat(f))&&isFinite(f)&&f>0?setTimeout((function(){return v.verifyPokeDelivery(r,f,n)}),f):dS("Invalid timeout: ".concat(f)),n.filter((function(e){return e.pendingCorrelationId===r})).forEach((function(e){return e.setSubscriptionState("response_in_flight")}))),this.backoff.reset(),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(10),d=MS(n);try{for(d.s();!(p=d.n()).done;)h=p.value,this.recordActionFailureOn(h,t)}catch(e){d.e(e)}finally{d.f()}e.t0 instanceof Ch.TransportUnavailableError?(lS("Twilsock connection (required for subscription) not ready (c:".concat(r,"); waitingâ¦")),this.backoff.reset()):(lS("Failed an attempt to ".concat(t," subscriptions (c:").concat(r,"); retrying"),e.t0),this.persist());case 26:case"end":return e.stop()}}),e,this,[[10,21]])}))),function(e,n){return t.apply(this,arguments)})},{key:"verifyPokeDelivery",value:function(e,t,n){var r=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),o=i?(new Date).getTime()-i:t;o>=t?(n.filter((function(t){return t.pendingCorrelationId===e})).forEach((function(e){e.updatePending(null,null),e.retryCount++,r.persisted.delete(e.sid)})),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e)):setTimeout((function(){return r.verifyPokeDelivery(e,t,n)}),t-o)}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter((function(e){return!e.rejectedWithError})):t}},{key:"recordActionAttemptOn",value:function(e,t,n){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,n);else{var r=this.persisted.get(e.sid);r&&r.updatePending(t,n)}}},{key:"recordActionFailureOn",value:function(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,n,r){var i=r.map((function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0,index_name:"establish"===e?t.indexName:void 0,query_string:"establish"===e?t.queryString:void 0}})),o=r.filter((function(e){return e.retryCount>0})).length;lS("Attempting '".concat(e,"' request (c:").concat(t,"):"),i);var a={event_protocol_version:4,action:e,correlation_id:t,retried_requests:o,ttl_in_s:-1,requests:i};return"ttl"===n&&(a.reason=n),this.services.network.post(this.services.config.subscriptionsUri,a)}},{key:"add",value:function(e,t){lS("Establishing intent to subscribe to ".concat(e));var n=this.subscriptions.get(e);n&&t&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new LS(t)),this.persist())}},{key:"remove",value:function(e){lS("Establishing intent to unsubscribe from ".concat(e)),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e,t){cS("Subscriptions received",e);var n=e.event_type,r=void 0!==e.events?e.events:[e.event],i=e.correlation_id;i&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(i,(new Date).getTime());var o,a=MS(r);try{for(a.s();!(o=a.n()).done;){var s=o.value,u=void 0;switch(e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(s,i);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(s,i);break;case"subscription_failed":this.applySubscriptionFailedMessage(s,i);break;case(u=n.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:var c=void 0;switch(u[0]){case"map_":c=s.map_sid;break;case"list_":c=s.list_sid;break;case"document_":c=s.document_sid;break;case"stream_":c=s.stream_sid;break;case"live_query_":c=s.query_id,t=!1,!0===e.strictly_ordered&&(t=!0);break;default:c=void 0}this.applyEventToSubscribedEntity(c,s,n,t);break;default:lS("Dropping unknown message type ".concat(n))}}}catch(e){a.e(e)}finally{a.f()}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var n=e.object_sid,r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?"interrupted"===e.replay_status?(lS("Event Replay for subscription to ".concat(n," (c:").concat(t,") interrupted; continuing eagerly.")),r.updatePending(null,null),this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(lS("Event Replay for subscription to ".concat(n," (c:").concat(t,") completed. Subscription is ready.")),r.complete(e.last_event_id),this.persisted.set(e.object_sid,r),r.setSubscriptionState("established"),this.backoff.reset()):lS("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?(n.updatePending(null,null),n.setSubscriptionState("none"),this.persisted.delete(e.object_sid)):lS("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var n=e.object_sid,r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.pendingCorrelationId===t&&(dS("Failed to subscribe on ".concat(i.sid),e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!r&&i&&(this.persisted.delete(n),i.setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t,n,r){if(e){var i;r=r||(i=this.persisted.get(e))&&i.isEstablished;var o=this.subscriptions.get(e);o?(t.type=n,o.update(t,r)):lS("Message dropped for SID '".concat(e,"', for which there is no subscription."))}}},{key:"onConnectionStateChanged",value:function(e){this.isConnected=e,e&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(e){lS("Triggering event replay for all subscriptions, reason=".concat(e)),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t,n=[],r=MS(this.persisted.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;i.reset(),i.rejectedWithError&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}this.persisted.clear();for(var o=0,a=n;o<a.length;o++){var s=a[o];this.persisted.set(s.sid,s)}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();function FS(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function DS(e){return e.body?e.body.code:0}function US(e){return 409===e.status?new nS(FS(e),e.status,DS(e),e.body):e.status?new tS(FS(e),e.status,DS(e)):e instanceof Ch.TransportUnavailableError?e:new tS(e.message,0,0)}var BS=function(){function e(t,n,r){Bo(this,e),this.clientInfo=t,this.config=n,this.transport=r}return Wo(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+oy.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return Object.assign({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(r,i){var o=[502,503,504];n&&o.push(429);var a=new S_(t.backoffConfig());a.on("attempt",(function(){e().then((function(e){return a.succeeded(e)})).catch((function(e){if(o.includes(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);a.failed(US(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?a.failed(US(e)):(a.removeAllListeners(),a.cancel(),i(US(e)))}))})),a.on("succeeded",(function(e){r(e)})),a.on("cancelled",(function(e){return i(US(e))})),a.on("failed",(function(e){return i(US(e))})),a.start()}))}},{key:"get",value:function(e){var t=this,n=this.createHeaders();return lS("GET",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.get(e,n,t.config.productId)}),!0)}},{key:"post",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.createHeaders();return null!=n&&(o["If-Match"]=n),lS("POST",e,"ID:",o["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.post(e,o,t,r.config.productId)}),i)}},{key:"put",value:function(e,t,n){var r=this,i=this.createHeaders();return null!=n&&(i["If-Match"]=n),lS("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.put(e,i,t,r.config.productId)}),!1)}},{key:"delete",value:function(e){var t=this,n=this.createHeaders();return lS("DELETE",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.delete(e,n,t.config.productId)}),!1)}}]),e}(),qS=function(){function e(t,n){Bo(this,e),this.config=t,this.storageId=null;try{this.storage=n||sessionStorage}catch(e){}}return Wo(e,[{key:"storageKey",value:function(e,t){return"".concat(this.storageId,"::").concat(e,"::").concat(t)}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(e){}}},{key:"update",value:function(e,t,n,r){if(!this.isReady)return null;this._apply(this.storageKey(e,t),r),n&&this._apply(this.storageKey(e,n),r)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,JSON.stringify(t))}catch(e){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}},{key:"_apply",value:function(e,t){var n=this._read(e);if(!n)return!1;this._store(e,Object.assign(n,t))}}]),e}();function WS(e,t,n){return(WS="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Qo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function zS(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return GS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return GS(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function GS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var KS=function(){function e(t,n){Bo(this,e),this.services=t,this.removalHandler=n,this.subscriptionState="none",this._attachedListeners=new Map}return Wo(e,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.broadcastEventToListeners("failure",e)}},{key:"_subscribe",value:function(){this.services.router._subscribe(this.sid,this)}},{key:"_unsubscribe",value:function(){this.services.router._unsubscribe(this.sid)}},{key:"_setSubscriptionState",value:function(e){this.subscriptionState=e,this.broadcastEventToListeners("_subscriptionStateChanged",e)}},{key:"close",value:function(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}},{key:"attach",value:function(e){var t=e.listenerUuid;this._attachedListeners.get(t)||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,e))}},{key:"detach",value:function(e){this._attachedListeners.delete(e),this._attachedListeners.size||this.close()}},{key:"broadcastEventToListeners",value:function(e,t){var n,r=zS(this._attachedListeners.values());try{for(r.s();!(n=r.n()).done;){n.value.emit(e,t)}}catch(e){r.e(e)}finally{r.f()}}}]),e}(),$S=function(){function e(t){Bo(this,e),Yo(this,"queuedRequests",[]),Yo(this,"isRequestInFlight",!1),this.inputMergingFunction=t}return Wo(e,[{key:"add",value:function(e,t){var n=this,r=new Promise((function(r,i){return n.queuedRequests.push({input:e,requestFunction:t,resolve:r,reject:i})}));return this.wakeupQueue(),r}},{key:"squashAndAdd",value:function(e,t){var n,r=this.queuedRequests;this.queuedRequests=[],r.length>0?(n=r.map((function(e){return e.input})).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;var i=this.add(n,t);return r.forEach((function(e){return i.then(e.resolve,e.reject)})),i}},{key:"isEmpty",value:function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var e=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then((function(t){e.isRequestInFlight=!1,e.wakeupQueue()}))}}}]),e}(),VS=function(){function e(t){Bo(this,e),Yo(this,"queueByNamespaceKey",new Map),this.inputReducer=t}var t,n,r;return Wo(e,[{key:"add",value:(r=Uo(Bc.mark((function e(t,n,r){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.add(n,r)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"squashAndAdd",value:(n=Uo(Bc.mark((function e(t,n,r){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.squashAndAdd(n,r)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"invokeQueueMethod",value:(t=Uo(Bc.mark((function e(t,n){var r,i;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.queueByNamespaceKey.has(t)||this.queueByNamespaceKey.set(t,new $S(this.inputReducer)),r=this.queueByNamespaceKey.get(t),i=n(r),this.queueByNamespaceKey.get(t).isEmpty()&&this.queueByNamespaceKey.delete(t),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();function QS(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qo(e);if(t){var i=Qo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vo(this,n)}}var YS=function(e){Ko(n,e);var t=QS(n);function n(){var e;return Bo(this,n),(e=t.call(this)).closed=!1,e.uuid=oy.v4(),e}return Wo(n,[{key:"listenerUuid",get:function(){return this.uuid}},{key:"close",value:function(){this.removeAllListeners(),this.closed=!0}},{key:"ensureNotClosed",value:function(){if(this.closed)throw new Error("Invalid operation on closed object")}}]),n}(Kc);function HS(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qo(e);if(t){var i=Qo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vo(this,n)}}var JS=function(e){Ko(f,e);var t,n,r,i,o,a,s,u,c,l=HS(f);function f(e,t,n){var r;Bo(this,f),Yo(zo(r=l.call(this,e,n)),"isDeleted",!1);return r.updateMergingQueue=new $S((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.descriptor=t,r.descriptor.data=r.descriptor.data||{},r.descriptor.date_updated=new Date(r.descriptor.date_updated),r}return Wo(f,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"_update",value:function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":if(e.id<=this.lastEventId){cS("Document update skipped, current:",this.lastEventId,", remote:",e.id);break}var t=void 0!==this.descriptor.data?rS(this.descriptor.data):null;this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.broadcastEventToListeners("updated",{data:e.document_data,isLocal:!1,previousData:t}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data});break;case"document_removed":this.onRemoved(!1)}}},{key:"set",value:(c=Uo(Bc.mark((function e(t,n){var r,i=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(r,(function(e){return i._setUnconditionally(t,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"mutate",value:(u=Uo(Bc.mark((function e(t,n){var r,i=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},e.abrupt("return",this.updateMergingQueue.add(r,(function(e){return i._setWithIfMatch(t,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"update",value:(s=Uo(Bc.mark((function e(t,n){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate((function(e){return Object.assign(e,t)}),n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"setTtl",value:(a=Uo(Bc.mark((function e(t){var n;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({ttl:t});case 2:n=e.sent,this.descriptor.date_expires=n.date_expires;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_setUnconditionally",value:(o=Uo(Bc.mark((function e(t,n){var r;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({data:t,revision:void 0,ttl:n});case 2:return r=e.sent,this._handleSuccessfulUpdateResult(r),e.abrupt("return",this.descriptor.data);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"_setWithIfMatch",value:(i=Uo(Bc.mark((function e(t,n){var r,i,o;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t(rS(this.descriptor.data)))){e.next=22;break}return i=this.revision,e.prev=3,e.next=6,this._postUpdateToServer({data:r,revision:i,ttl:n});case 6:return o=e.sent,this._handleSuccessfulUpdateResult(o),e.abrupt("return",this.descriptor.data);case 11:if(e.prev=11,e.t0=e.catch(3),412!==e.t0.status){e.next=19;break}return e.next=16,this._softSync();case 16:return e.abrupt("return",this._setWithIfMatch(t));case 19:throw e.t0;case 20:e.next=23;break;case 22:return e.abrupt("return",this.descriptor.data);case 23:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(e,t){return i.apply(this,arguments)})},{key:"_handleSuccessfulUpdateResult",value:function(e){if(!(e.last_event_id<=this.descriptor.last_event_id)){var t=void 0!==this.descriptor.data?rS(this.descriptor.data):null;this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.broadcastEventToListeners("updated",{data:this.descriptor.data,isLocal:!0,previousData:t})}}},{key:"_postUpdateToServer",value:(r=Uo(Bc.mark((function e(t){var n,r,i;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=17;break}return n={data:t.data},void 0!==t.ttl&&(n.ttl=t.ttl),r=t.revision,e.prev=4,e.next=7,this.services.network.post(this.uri,n,r);case 7:return i=e.sent,e.abrupt("return",{revision:i.body.revision,data:t.data,last_event_id:i.body.last_event_id,date_updated:i.body.date_updated,date_expires:i.body.date_expires});case 11:throw e.prev=11,e.t0=e.catch(4),404===e.t0.status&&this.onRemoved(!1),e.t0;case 15:e.next=18;break;case 17:return e.abrupt("return",Promise.reject(new tS("The Document has been removed",404,54100)));case 18:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e){return r.apply(this,arguments)})},{key:"_softSync",value:(n=Uo(Bc.mark((function e(){var t=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.network.get(this.uri).then((function(e){var n={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return t._update(n),t})).catch((function(e){404===e.status?t.onRemoved(!1):dS("Can't get updates for ".concat(t.sid,":"),e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onRemoved",value:function(e){if(!this.isDeleted){var t=void 0!==this.descriptor.data?rS(this.descriptor.data):null;this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e,previousData:t})}}},{key:"removeDocument",value:(t=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",Promise.reject(new tS("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"type",get:function(){return"document"}}]),f}(KS),XS=function(e){Ko(s,e);var t,n,r,i,o,a=HS(s);function s(e){var t;return Bo(this,s),(t=a.call(this)).syncDocumentImpl=e,t.syncDocumentImpl.attach(zo(t)),t}return Wo(s,[{key:"uri",get:function(){return this.syncDocumentImpl.uri}},{key:"revision",get:function(){return this.syncDocumentImpl.revision}},{key:"lastEventId",get:function(){return this.syncDocumentImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncDocumentImpl.dateExpires}},{key:"type",get:function(){return JS.type}},{key:"sid",get:function(){return this.syncDocumentImpl.sid}},{key:"data",get:function(){return this.syncDocumentImpl.data}},{key:"dateUpdated",get:function(){return this.syncDocumentImpl.dateUpdated}},{key:"uniqueName",get:function(){return this.syncDocumentImpl.uniqueName}},{key:"set",value:(o=Uo(Bc.mark((function e(t,n){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.set(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"mutate",value:(i=Uo(Bc.mark((function e(t,n){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.mutate(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"update",value:(r=Uo(Bc.mark((function e(t,n){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.update(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"setTtl",value:(n=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeDocument",value:(t=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.removeDocument());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){WS(Qo(s.prototype),"close",this).call(this),this.syncDocumentImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return JS.type}}]),s}(YS);Yo(XS,"removed","removed"),Yo(XS,"updated","updated"),Wc([Ah(Rh,["undefined",Ih("document metadata",{ttl:[Th,"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Object,Object]),zc("design:returntype",Promise)],XS.prototype,"set",null),Wc([Ah("function",["undefined",Ih("document metadata",{ttl:[Th,"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Function,Object]),zc("design:returntype",Promise)],XS.prototype,"mutate",null),Wc([Ah(Rh,["undefined",Ih("document metadata",{ttl:[Th,"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Object,Object]),zc("design:returntype",Promise)],XS.prototype,"update",null),Wc([Ah(Th),zc("design:type",Function),zc("design:paramtypes",[Number]),zc("design:returntype",Promise)],XS.prototype,"setTtl",null);var ZS=function(){function e(t){Bo(this,e),this.descriptor=t}return Wo(e,[{key:"uri",get:function(){return this.descriptor.uri}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.lastEventId}},{key:"dateUpdated",get:function(){return this.descriptor.dateUpdated}},{key:"dateExpires",get:function(){return this.descriptor.dateExpires}},{key:"index",get:function(){return this.descriptor.index}},{key:"data",get:function(){return this.descriptor.data}},{key:"update",value:function(e,t,n,r){return this.descriptor.lastEventId=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.dateUpdated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.dateExpires=e}}]),e}(),eE=function(){function e(t,n,r,i){Bo(this,e),this.prevToken=r,this.nextToken=i,this.items=t,this.source=n}var t,n;return Wo(e,[{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}},{key:"nextPage",value:(n=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"prevPage",value:(t=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function tE(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return nE(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nE(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function nE(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var rE=function(){function e(t,n){Bo(this,e),this.balanceFactor=0,this.key=t,this.value=n,this.parent=null,this.left=null,this.right=null}return Wo(e,[{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}},{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}}]),e}(),iE=function(){function e(t,n){Bo(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=n||function(e,t){return e===t},this.root=null,this.count=null}return Wo(e,[{key:"size",get:function(){return this.count}},{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var n=this.getNode(e);n?n.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var n=new rE(e,t);if(this.count++,this.root){for(var r=this.root;;)if(this.isLessThan(e,r.key)){if(!r.left){r.left=n;break}r=r.left}else{if(!r.right){r.right=n;break}r=r.right}for(n.parent=r,r=n;r.parent;){var i=r.parent,o=i.balanceFactor;if(r.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(o))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}r=i}}else this.root=n}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var n=t.parent,r=t.left,i=t.right;if(!!r!=!!i){var o=r||i;n||o?n&&!o?this.root=o:(n.replace(t,null),this.rebalance(n)):this.root=null}else{for(var a=t.left;a.right;)a=a.right;if(t.left===a)t.isRoot?(this.root=a,a.parent=null):(t.isLeftChild?t.parent.left=a:t.parent.right=a,a.parent=t.parent),a.right=t.right,a.right.parent=a,a.balanceFactor=t.balanceFactor,t={parent:a,isLeftChild:!0};else{var s=a.parent,u=a.left;s.right=u,u&&(u.parent=s),t.isRoot?(this.root=a,a.parent=null):(t.isLeftChild?t.parent.left=a:t.parent.right=a,a.parent=t.parent),a.right=t.right,a.right.parent=a,a.left=t.left,a.left.parent=a,a.balanceFactor=t.balanceFactor,t={parent:s,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:Symbol.iterator,value:Bc.mark((function e(){var t,n,r;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=tE(this.getIterator()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"getIterator",value:Bc.mark((function e(){var t,n,r,i=arguments;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.left)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)||null===t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:r=!0;case 11:if(!r){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(r=!1,!n.right){e.next=21;break}for(n=n.right;n.left;)n=n.left;r=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}r=n.parent.left===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}r=n.parent.left===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))},{key:"getReverseIterator",value:Bc.mark((function e(){var t,n,r,i=arguments;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.right)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)&&null!==t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:r=!0;case 11:if(!r){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(r=!1,!n.left){e.next=21;break}for(n=n.left;n.right;)n=n.right;r=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}r=n.parent.right===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}r=n.parent.right===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))}]),e}();function oE(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return aE(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return aE(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function aE(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var sE=function(){function e(t,n){Bo(this,e),this.value=t,this.revision=n||0}return Wo(e,[{key:"isValid",get:function(){return!0}}]),e}(),uE=function(){function e(t){Bo(this,e),this.revision=t}return Wo(e,[{key:"isValid",get:function(){return!1}}]),e}(),cE=function(){function e(){Bo(this,e),this.items=new iE}return Wo(e,[{key:"store",value:function(e,t,n){var r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new sE(t,n)),t)}},{key:"delete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.items.get(e);(!r||r.revision<t||r&&!0===n)&&this.items.set(e,new uE(t))}},{key:"isKnown",value:function(e,t){var n=this.items.get(e);return n&&n.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}},{key:"forEach",value:function(e){if(this.items){var t,n=oE(this.items);try{for(n.s();!(t=n.n()).done;){var r=xS(t.value,2),i=r[0],o=r[1];o.isValid&&e(i,o.value)}}catch(e){n.e(e)}finally{n.f()}}}}]),e}();function lE(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qo(e);if(t){var i=Qo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vo(this,n)}}var fE=function(e){Ko(y,e);var t,n,r,i,o,a,s,u,c,l,f,d,p,h,v=lE(y);function y(e,t,n){var r;Bo(this,y);return(r=v.call(this,e,n)).updateMergingQueue=new VS((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.cache=new cE,r.descriptor=t,r.descriptor.date_updated=new Date(r.descriptor.date_updated),r}return Wo(y,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"_addOrUpdateItemOnServer",value:(h=Uo(Bc.mark((function e(t,n,r,i){var o,a;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={data:n},void 0!==i&&(o.ttl=i),e.next=4,this.services.network.post(t,o,r);case 4:return(a=e.sent).body.data=n,a.body.date_updated=new Date(a.body.date_updated),e.abrupt("return",a.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return h.apply(this,arguments)})},{key:"push",value:(p=Uo(Bc.mark((function e(t,n){var r,i,o;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n||{}).ttl,e.next=3,this._addOrUpdateItemOnServer(this.links.items,t,void 0,r);case 3:return i=e.sent,o=Number(i.index),this._handleItemMutated(o,i.url,i.last_event_id,i.revision,t,i.date_updated,i.date_expires,!0,!1),e.abrupt("return",this.cache.get(o));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"set",value:(d=Uo(Bc.mark((function e(t,n,r){var i,o=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return o._updateItemUnconditionally(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"_updateItemUnconditionally",value:(f=Uo(Bc.mark((function e(t,n,r){var i,o;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return i=e.sent,e.next=5,this._addOrUpdateItemOnServer(i.uri,n,void 0,r);case 5:return o=e.sent,this._handleItemMutated(t,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"_updateItemWithIfMatch",value:(l=Uo(Bc.mark((function e(t,n,r){var i,o,a,s;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:if(i=e.sent,!(o=n(rS(i.data)))){e.next=25;break}return a=i.revision,e.prev=6,e.next=9,this._addOrUpdateItemOnServer(i.uri,o,a,r);case 9:return s=e.sent,this._handleItemMutated(t,s.url,s.last_event_id,s.revision,s.data,s.date_updated,s.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 14:if(e.prev=14,e.t0=e.catch(6),412!==e.t0.status){e.next=22;break}return e.next=19,this._getItemFromServer(t);case 19:return e.abrupt("return",this._updateItemWithIfMatch(t,n,r));case 22:throw e.t0;case 23:e.next=26;break;case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(e,t,n){return l.apply(this,arguments)})},{key:"mutate",value:(c=Uo(Bc.mark((function e(t,n,r){var i,o=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return o._updateItemWithIfMatch(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"update",value:(u=Uo(Bc.mark((function e(t,n,r){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(s=Uo(Bc.mark((function e(t){var n,r,i;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,r=rS(n.data),e.next=6,this.services.network.delete(n.uri);case 6:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,r,new Date(i.body.date_updated),!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"get",value:function(){var e=Uo(Bc.mark((function e(t){var n;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))){e.next=5;break}return e.abrupt("return",n);case 5:return e.abrupt("return",this._getItemFromServer(t));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:(a=Uo(Bc.mark((function e(t){var n;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({index:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new tS("No item with index ".concat(t," found"),404,54151);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"queryItems",value:function(){var e=Uo(Bc.mark((function e(t){var n,r,i,o,a=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new H_(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Index",t.index).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),a.cache.get(e.index)?a._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):a.cache.store(Number(e.index),new ZS({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,data:e.data}),e.last_event_id),a.cache.get(e.index)})),o=r.body.meta,e.abrupt("return",new eE(i,(function(e){return a.queryItems({pageToken:e})}),o.previous_token,o.next_token));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:(o=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return iS((t=t||{}).pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getContext",value:(i=Uo(Bc.mark((function e(){var t;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=5;break}return e.next=3,this.services.network.get(this.links.context);case 3:t=e.sent,this._updateContextIfRequired(t.body.data,t.body.last_event_id);case 5:return e.abrupt("return",this.context);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setTtl",value:(r=Uo(Bc.mark((function e(t){var n,r;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=Uo(Bc.mark((function e(t,n){var r,i,o;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return r=e.sent,i={ttl:n},e.next=6,this.services.network.post(r.uri,i);case 6:o=e.sent,r.updateDateExpires(o.body.date_expires);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeList",value:(t=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){var n=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(n,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(n,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,o,a,s,u){if(this.shouldIgnoreEvent(e,n))cS("Item ".concat(e," update skipped, current: ").concat(this.lastEventId,", remote: ").concat(n));else{this._updateRootDateUpdated(o);var c=this.cache.get(e);if(!c){var l=new ZS({index:e,uri:t,lastEventId:n,revision:r,data:i,dateUpdated:o,dateExpires:a});return this.cache.store(e,l,n),void this.emitItemMutationEvent(l,u,s)}var f=rS(c.data);c.update(n,r,i,o),this.cache.store(e,c,n),void 0!==a&&c.updateDateExpires(a),this.emitItemMutationEvent(c,u,!1,f)}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n?"itemAdded":"itemUpdated",o={item:e,isLocal:!t};n||(o.previousItemData=r),this.broadcastEventToListeners(i,o)}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{index:e,isLocal:!i,previousItemData:n})}},{key:"_handleContextUpdate",value:function(e,t,n){this._updateRootDateUpdated(n),this._updateContextIfRequired(e,t)&&this.broadcastEventToListeners("contextUpdated",{context:e,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(cS("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}}],[{key:"type",get:function(){return"list"}}]),y}(KS),dE=function(e){Ko(p,e);var t,n,r,i,o,a,s,u,c,l,f,d=lE(p);function p(e){var t;return Bo(this,p),(t=d.call(this)).syncListImpl=e,t.syncListImpl.attach(zo(t)),t}return Wo(p,[{key:"uri",get:function(){return this.syncListImpl.uri}},{key:"revision",get:function(){return this.syncListImpl.revision}},{key:"lastEventId",get:function(){return this.syncListImpl.lastEventId}},{key:"links",get:function(){return this.syncListImpl.links}},{key:"dateExpires",get:function(){return this.syncListImpl.dateExpires}},{key:"type",get:function(){return fE.type}},{key:"sid",get:function(){return this.syncListImpl.sid}},{key:"uniqueName",get:function(){return this.syncListImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncListImpl.dateUpdated}},{key:"push",value:(f=Uo(Bc.mark((function e(t,n){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.push(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"set",value:(l=Uo(Bc.mark((function e(t,n,r){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"mutate",value:(c=Uo(Bc.mark((function e(t,n,r){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"update",value:(u=Uo(Bc.mark((function e(t,n,r){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(s=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"get",value:(a=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getContext",value:(o=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getContext());case 2:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"getItems",value:(i=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=Uo(Bc.mark((function e(t,n){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeList",value:(t=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.removeList());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){WS(Qo(p.prototype),"close",this).call(this),this.syncListImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return fE.type}}]),p}(YS);Yo(dE,"itemAdded","itemAdded"),Yo(dE,"itemUpdated","itemUpdated"),Yo(dE,"itemRemoved","itemRemoved"),Yo(dE,"removed","removed"),Wc([Ah(Rh,["undefined",Ih("item metadata",{ttl:[Th,"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Object,Object]),zc("design:returntype",Promise)],dE.prototype,"push",null),Wc([Ah(Th,Rh,["undefined",Ih("item metadata",{ttl:[Th,"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Number,Object,Object]),zc("design:returntype",Promise)],dE.prototype,"set",null),Wc([Ah(Th,"function",["undefined",Ih("item metadata",{ttl:[Th,"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Number,Function,Object]),zc("design:returntype",Promise)],dE.prototype,"mutate",null),Wc([Ah(Th,Rh,["undefined",Ih("item metadata",{ttl:[Th,"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Number,Object,Object]),zc("design:returntype",Promise)],dE.prototype,"update",null),Wc([Ah(Th),zc("design:type",Function),zc("design:paramtypes",[Number]),zc("design:returntype",Promise)],dE.prototype,"remove",null),Wc([Ah(Th),zc("design:type",Function),zc("design:paramtypes",[Number]),zc("design:returntype",Promise)],dE.prototype,"get",null),Wc([Ah(["undefined",Ih("query options",{from:[Th,"undefined"],pageSize:[_h((function(e){return[oS(e),"a positive integer"]})),"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Object]),zc("design:returntype",Promise)],dE.prototype,"getItems",null),Wc([Ah(Th),zc("design:type",Function),zc("design:paramtypes",[Number]),zc("design:returntype",Promise)],dE.prototype,"setTtl",null),Wc([Ah(Th,Th),zc("design:type",Function),zc("design:paramtypes",[Number,Number]),zc("design:returntype",Promise)],dE.prototype,"setItemTtl",null);var pE=function(){function e(t){Bo(this,e),this.descriptor=t}return Wo(e,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"update",value:function(e,t,n,r){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.date_updated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.date_expires=e}}]),e}();function hE(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qo(e);if(t){var i=Qo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vo(this,n)}}var vE=function(e){Ko(h,e);var t,n,r,i,o,a,s,u,c,l,f,d,p=hE(h);function h(e,t,n){var r;Bo(this,h);return(r=p.call(this,e,n)).updateMergingQueue=new VS((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.cache=new cE,r.descriptor=t,r.descriptor.date_updated=new Date(r.descriptor.date_updated),t.items&&t.items.forEach((function(e){e.date_updated=new Date(e.date_updated),r.cache.store(e.key,new pE(e),e.last_event_id)})),r}return Wo(h,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"set",value:(d=Uo(Bc.mark((function e(t,n,r){var i,o=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return o._putItemUnconditionally(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"get",value:function(){var e=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new tS("SyncMapItem key may not be empty",400,54209);case 2:if(!this.cache.has(t)){e.next=6;break}return e.abrupt("return",this.cache.get(t));case 6:return e.abrupt("return",this._getItemFromServer(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:(f=Uo(Bc.mark((function e(t){var n;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({key:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new tS("The specified Map Item does not exist",404,54201);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"mutate",value:(l=Uo(Bc.mark((function e(t,n,r){var i,o=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return o._putItemWithIfMatch(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"update",value:(c=Uo(Bc.mark((function e(t,n,r){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"_putItemUnconditionally",value:(u=Uo(Bc.mark((function e(t,n,r){var i,o;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._putItemToServer(t,n,void 0,r);case 2:return i=e.sent,o=i.item,this._handleItemMutated(o.key,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,i.added,!1),e.abrupt("return",this.cache.get(o.key));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"_putItemWithIfMatch",value:(s=Uo(Bc.mark((function e(t,n,r){var i,o,a,s,u;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t).catch((function(e){if(404===e.status)return new pE({key:t,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw e}));case 2:if(i=e.sent,!(o=n(rS(i.data)))){e.next=26;break}return a=i.revision,e.prev=6,e.next=9,this._putItemToServer(t,o,a,r);case 9:return s=e.sent,u=s.item,this._handleItemMutated(u.key,u.url,u.last_event_id,u.revision,u.data,u.date_updated,u.date_expires,s.added,!1),e.abrupt("return",this.cache.get(u.key));case 15:if(e.prev=15,e.t0=e.catch(6),412!==e.t0.status){e.next=23;break}return e.next=20,this._getItemFromServer(t);case 20:return e.abrupt("return",this._putItemWithIfMatch(t,n,r));case 23:throw e.t0;case 24:e.next=27;break;case 26:return e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(e,t,n){return s.apply(this,arguments)})},{key:"_putItemToServer",value:(a=Uo(Bc.mark((function e(t,n,r,i){var o,a,s,u,c;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new H_(this.links.items).pathSegment(t).build(),a={data:n},void 0!==i&&(a.ttl=i),e.prev=3,e.next=6,this.services.network.put(o,a,r);case 6:return s=e.sent,(u=s.body).data=n,u.date_updated=new Date(u.date_updated),c=201===s.status.code,e.abrupt("return",{added:c,item:u});case 14:throw e.prev=14,e.t0=e.catch(3),404===e.t0.status&&this.onRemoved(!1),e.t0;case 18:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"remove",value:(o=Uo(Bc.mark((function e(t){var n,r,i;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,r=rS(n.data),e.next=6,this.services.network.delete(n.uri);case 6:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,r,new Date(i.body.date_updated),!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"queryItems",value:function(){var e=Uo(Bc.mark((function e(t){var n,r,i,o,a=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new H_(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Key",t.key).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),a.cache.get(e.key)?a._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):a.cache.store(e.key,new pE(e),e.last_event_id),a.cache.get(e.key)})),o=r.body.meta,e.abrupt("return",new eE(i,(function(e){return a.queryItems({pageToken:e})}),o.previous_token,o.next_token));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:(i=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return iS((t=t||{}).pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,o,a,s,u){if(this.shouldIgnoreEvent(e,n))cS("SyncMapItem ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(o);var c=this.cache.get(e);if(!c){var l=new pE({key:e,url:t,last_event_id:n,revision:r,data:i,date_updated:o,date_expires:a});return this.cache.store(e,l,n),void this.emitItemMutationEvent(l,u,s)}var f=rS(c.data);c.update(n,r,i,o),this.cache.store(e,c,n),void 0!==a&&c.updateDateExpires(a),this.emitItemMutationEvent(c,u,!1,f)}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n?"itemAdded":"itemUpdated",o={item:e,isLocal:!t};n||(o.previousItemData=r),this.broadcastEventToListeners(i,o)}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{key:e,isLocal:!i,previousItemData:n})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"setTtl",value:(r=Uo(Bc.mark((function e(t){var n,r;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=Uo(Bc.mark((function e(t,n){var r,i,o;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return r=e.sent,i={ttl:n},e.next=6,this.services.network.post(r.uri,i);case 6:o=e.sent,r.updateDateExpires(o.body.date_expires);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeMap",value:(t=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"type",get:function(){return"map"}}]),h}(KS),yE=function(e){Ko(f,e);var t,n,r,i,o,a,s,u,c,l=hE(f);function f(e){var t;return Bo(this,f),(t=l.call(this)).syncMapImpl=e,t.syncMapImpl.attach(zo(t)),t}return Wo(f,[{key:"uri",get:function(){return this.syncMapImpl.uri}},{key:"links",get:function(){return this.syncMapImpl.links}},{key:"revision",get:function(){return this.syncMapImpl.revision}},{key:"lastEventId",get:function(){return this.syncMapImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncMapImpl.dateExpires}},{key:"type",get:function(){return vE.type}},{key:"sid",get:function(){return this.syncMapImpl.sid}},{key:"uniqueName",get:function(){return this.syncMapImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncMapImpl.dateUpdated}},{key:"set",value:(c=Uo(Bc.mark((function e(t,n,r){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"get",value:(u=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"mutate",value:(s=Uo(Bc.mark((function e(t,n,r){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"update",value:(a=Uo(Bc.mark((function e(t,n,r){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"remove",value:(o=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getItems",value:(i=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=Uo(Bc.mark((function e(t,n){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeMap",value:(t=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.next=3,this.syncMapImpl.removeMap();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){WS(Qo(f.prototype),"close",this).call(this),this.syncMapImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return vE.type}}]),f}(YS);function mE(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qo(e);if(t){var i=Qo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vo(this,n)}}Yo(yE,"itemAdded","itemAdded"),Yo(yE,"itemUpdated","itemUpdated"),Yo(yE,"itemRemoved","itemRemoved"),Yo(yE,"removed","removed"),Wc([Ah("string",Rh,["undefined",Ih("item metadata",{ttl:[Th,"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[String,Object,Object]),zc("design:returntype",Promise)],yE.prototype,"set",null),Wc([Ah("string"),zc("design:type",Function),zc("design:paramtypes",[String]),zc("design:returntype",Promise)],yE.prototype,"get",null),Wc([Ah("string","function",["undefined",Ih("item metadata",{ttl:[Th,"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[String,Function,Object]),zc("design:returntype",Promise)],yE.prototype,"mutate",null),Wc([Ah("string",Rh,["undefined",Ih("item metadata",{ttl:[Th,"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[String,Object,Object]),zc("design:returntype",Promise)],yE.prototype,"update",null),Wc([Ah("string"),zc("design:type",Function),zc("design:paramtypes",[String]),zc("design:returntype",Promise)],yE.prototype,"remove",null),Wc([Ah(["undefined",Ih("query options",{from:["string","undefined"],pageSize:[_h((function(e){return[oS(e),"a positive integer"]})),"undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Object]),zc("design:returntype",Promise)],yE.prototype,"getItems",null),Wc([Ah(Th),zc("design:type",Function),zc("design:paramtypes",[Number]),zc("design:returntype",Promise)],yE.prototype,"setTtl",null),Wc([Ah("string",Th),zc("design:type",Function),zc("design:paramtypes",[String,Number]),zc("design:returntype",Promise)],yE.prototype,"setItemTtl",null);var gE=function(e){Ko(o,e);var t,n,r,i=mE(o);function o(e,t,n){var r;return Bo(this,o),(r=i.call(this,e,n)).descriptor=t,r}return Wo(o,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"publishMessage",value:(r=Uo(Bc.mark((function e(t){var n,r,i,o;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={data:t},e.next=3,this.services.network.post(this.links.messages,n);case 3:return r=e.sent,i=r.body,o=this._handleMessagePublished(i.sid,t,!1),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setTtl",value:(n=Uo(Bc.mark((function e(t){var n,r;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return n.apply(this,arguments)})},{key:"removeStream",value:(t=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_update",value:function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{key:"_handleMessagePublished",value:function(e,t,n){var r={sid:e,data:t};return this.broadcastEventToListeners("messagePublished",{message:r,isLocal:!n}),r}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}}],[{key:"type",get:function(){return"stream"}}]),o}(KS);Wc([Ah(Rh),zc("design:type",Function),zc("design:paramtypes",[Object]),zc("design:returntype",Promise)],gE.prototype,"publishMessage",null),Wc([Ah(Th),zc("design:type",Function),zc("design:paramtypes",[Number]),zc("design:returntype",Promise)],gE.prototype,"setTtl",null);var bE=function(e){Ko(o,e);var t,n,r,i=mE(o);function o(e){var t;return Bo(this,o),(t=i.call(this)).syncStreamImpl=e,t.syncStreamImpl.attach(zo(t)),t}return Wo(o,[{key:"uri",get:function(){return this.syncStreamImpl.uri}},{key:"links",get:function(){return this.syncStreamImpl.links}},{key:"dateExpires",get:function(){return this.syncStreamImpl.dateExpires}},{key:"type",get:function(){return gE.type}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.syncStreamImpl.sid}},{key:"uniqueName",get:function(){return this.syncStreamImpl.uniqueName}},{key:"publishMessage",value:(r=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.publishMessage(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setTtl",value:(n=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeStream",value:(t=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.removeStream());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){WS(Qo(o.prototype),"close",this).call(this),this.syncStreamImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return gE.type}}]),o}(YS);Yo(bE,"messagePublished","messagePublished"),Yo(bE,"removed","removed"),Wc([Ah(Rh),zc("design:type",Function),zc("design:paramtypes",[Object]),zc("design:returntype",Promise)],bE.prototype,"publishMessage",null),Wc([Ah(Th),zc("design:type",Function),zc("design:paramtypes",[Number]),zc("design:returntype",Promise)],bE.prototype,"setTtl",null);var kE=function e(t){Bo(this,e),this.sdk="js",this.sdkVer=t,this.os=E_.exports.os.family,this.osVer=E_.exports.os.version,this.pl=E_.exports.name,this.plVer=E_.exports.version},wE=function(){function e(){Bo(this,e),this.names=new Map,this.entities=new Map}return Wo(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();function xE(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qo(e);if(t){var i=Qo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vo(this,n)}}var _E=function(e){Ko(n,e);var t=xE(n);function n(e,r,i,o){var a;return Bo(this,n),(a=t.call(this,r,i)).descriptor=e,a.cache=new cE,o&&o.forEach((function(e){a.cache.store(e.key,{key:e.key,value:e.data},e.revision)})),a}return Wo(n,[{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return null}},{key:"type",get:function(){return n.type}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"indexName",get:function(){return this.descriptor.indexName}},{key:"queryString",get:function(){return this.descriptor.queryExpression}},{key:"queryUri",get:function(){return this.descriptor.queryUri}},{key:"liveQueryDescriptor",get:function(){return this.descriptor}},{key:"onRemoved",value:function(){}},{key:"getItems",value:function(){var e={};return this.cache.forEach((function(t,n){e[t]=n.value})),e}},{key:"_update",value:function(e,t){switch(e.type){case"live_query_item_updated":this.handleItemMutated(e.item_key,e.item_data,e.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(e.item_key,e.item_revision);break;case"live_query_updated":this.handleBatchUpdate(e.items)}t&&this._advanceLastEventId(e.last_event_id)}},{key:"handleItemMutated",value:function(e,t,n){if(this.shouldIgnoreEvent(e,n))cS("Item ".concat(e," update skipped, revision: ").concat(n));else{var r={key:e,value:t};this.cache.store(e,r,n),this.broadcastEventToListeners("itemUpdated",r)}}},{key:"handleItemRemoved",value:function(e,t){var n=null===t;this.shouldIgnoreEvent(e,t)?cS("Item ".concat(e," delete skipped, revision: ").concat(t)):(this.cache.delete(e,t,n),this.broadcastEventToListeners("itemRemoved",{key:e}))}},{key:"handleBatchUpdate",value:function(e){var t=this,n={};for(var r in null!=e&&e.forEach((function(e){n[e.key]={data:e.data,revision:e.revision}})),this.cache.forEach((function(e,r){var i=n[e];null!=i?t.handleItemMutated(e,i.data,i.revision):t.handleItemRemoved(e,null),delete n[e]})),n)this.handleItemMutated(r,n[r].data,n[r].revision)}},{key:"shouldIgnoreEvent",value:function(e,t){return null!=e&&null!=t&&this.cache.isKnown(e,t)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e)}}],[{key:"type",get:function(){return"live_query"}}]),n}(KS);function SE(e){return EE.apply(this,arguments)}function EE(){return(EE=Uo(Bc.mark((function e(t){var n,r,i,o,a,s;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.network,r=t.queryString,i=t.uri,o=t.type,null!=r){e.next=3;break}throw new tS("Invalid query",400,54507);case 3:return a={query_string:r},o===TE.type&&(a.type=o),e.next=7,n.post(i,a,void 0,!0);case 7:return s=e.sent,e.abrupt("return",s.body);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var TE=function(e){Ko(n,e);var t=xE(n);function n(e){var r;return Bo(this,n),(r=t.call(this)).liveQueryImpl=e,r.liveQueryImpl.attach(zo(r)),r}return Wo(n,[{key:"type",get:function(){return _E.type}},{key:"lastEventId",get:function(){return this.liveQueryImpl.lastEventId}},{key:"sid",get:function(){return this.liveQueryImpl.sid}},{key:"close",value:function(){WS(Qo(n.prototype),"close",this).call(this),this.liveQueryImpl.detach(this.listenerUuid)}},{key:"getItems",value:function(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}],[{key:"type",get:function(){return _E.type}}]),n}(YS);Yo(TE,"itemUpdated","itemUpdated"),Yo(TE,"itemRemoved","itemRemoved");var IE=function(e){Ko(i,e);var t,n,r=xE(i);function i(e){var t;return Bo(this,i),Yo(zo(t=r.call(this)),"queryExpression",null),Yo(zo(t),"items",{}),Object.assign(zo(t),e),t.updateIndexName(e.indexName),t}return Wo(i,[{key:"type",get:function(){return i.type}},{key:"search",value:(n=Uo(Bc.mark((function e(t){var n=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.items={},e.abrupt("return",SE({network:this.network,uri:this.queryUri,queryString:t}).then((function(e){n.queryExpression=t,e.items&&e.items.forEach((function(e){n.items[e.key]=e.data})),n.emit("searchResult",n.getItems())})).catch((function(e){throw dS("Error '".concat(e.message,"' while executing query '").concat(t,"'")),n.queryExpression=null,e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"subscribe",value:(t=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.queryExpression){e.next=2;break}return e.abrupt("return",Promise.reject(new tS("Invalid query",400,54507)));case 2:return e.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getItems",value:function(){return this.items}},{key:"updateIndexName",value:function(e){this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}},{key:"generateQueryUri",value:function(e){return new H_(this.insightsUri).pathSegment(e).pathSegment("Items").build()}}],[{key:"type",get:function(){return"instant_query"}}]),i}(Kc);Yo(IE,"searchResult","searchResult"),Wc([Ah("string"),zc("design:type",Function),zc("design:paramtypes",[String]),zc("design:returntype",Promise)],IE.prototype,"search",null),Wc([Oh(Eh),zc("design:type",Function),zc("design:paramtypes",[String]),zc("design:returntype",void 0)],IE.prototype,"updateIndexName",null);function RE(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qo(e);if(t){var i=Qo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vo(this,n)}}function OE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function AE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OE(Object(n),!0).forEach((function(t){Yo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OE(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var CE="data_sync",PE="3.1.0";function ME(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};var t=e.mode||(e.id?"open_or_create":"create_new");return AE(AE({},e),{},{mode:t})}return{mode:"create_new"}}var jE="com.twilio.rtd.cds.document",LE="com.twilio.rtd.cds.list",NE="com.twilio.rtd.cds.map",FE="twilio.sync.event",Client=function(e){Ko(Client,e);var t,n,r,i,o,a,s,u,c,l,f,d,p,h,v,y=RE(Client);function Client(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Bo(this,Client),t=y.call(this),!e)throw new Error("Sync library needs a valid Twilio token to be passed");n.hasOwnProperty("logLevel")?uS(n.logLevel):uS("silent");var r=n.productId=n.productId||CE;n.clientMetadata=n.clientMetadata||{},n.clientMetadata.hasOwnProperty("type")||(n.clientMetadata.type="sync"),n.clientMetadata.hasOwnProperty("sdk")||(n.clientMetadata.sdk="JS",n.clientMetadata.sdkv=PE);var i=!n.twilsockClient;if(!n.initRegistrations){var o=new Ch.InitRegistration(r);Client.populateInitRegistrations(o),n.initRegistrations=[o]}var a=n.twilsockClient=n.twilsockClient||new Ch.Twilsock(e,r,n);a.on("tokenAboutToExpire",(function(e){return t.emit("tokenAboutToExpire",e)})),a.on("tokenExpired",(function(){return t.emit("tokenExpired")})),a.on("connectionError",(function(e){return t.emit("connectionError",e)})),a.on("stateChanged",(function(e){t.emit("connectionStateChanged",e),t.services.subscriptions.onConnectionStateChanged("connected"===e)})),a.on("message",(function(e,n){return t._routeMessage(e,n)}));var s=new kS(n),u=new BS(new kE(PE),s,a),c=new qS(s);return t.services={config:s,twilsock:a,network:u,storage:c,router:zo(t),subscriptions:null},t.services.subscriptions=new NS(t.services),t.entities=new wE,i&&a.connect(),t}return Wo(Client,[{key:"_routeMessage",value:function(e,t){switch(cS("Notification type:",e,"content:",t),e){case jE:case LE:case NE:this.services.subscriptions.acceptMessage(t,!1);break;case FE:this.services.subscriptions.acceptMessage(t,!0)}}},{key:"_subscribe",value:function(e,t){this.services.subscriptions.add(e,t)}},{key:"_unsubscribe",value:function(e){this.services.subscriptions.remove(e)}},{key:"connectionState",get:function(){return this.services.twilsock.state}},{key:"ensureReady",value:(v=Uo(Bc.mark((function e(){var t;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.services.config.sessionStorageEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.services.twilsock.storageId();case 5:t=e.sent,this.services.storage.updateStorageId(t.id),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),fS("Failed to initialize storage",e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(){return v.apply(this,arguments)})},{key:"storeRootInSessionCache",value:function(e,t,n){if(this.services.config.sessionStorageEnabled&&t){var r=rS(n);e!==dE.type&&e!==yE.type||(r.last_event_id=null,delete r.items),this.services.storage.store(e,t,r)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:(h=Uo(Bc.mark((function e(t,n){var r,i,o,a=arguments;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]&&a[2],n){e.next=3;break}throw new tS("Cannot get entity without id",404);case 3:return i=new H_(t).pathSegment(n).queryParam("Include",r?"items":void 0).build(),e.next=6,this.services.network.get(i);case 6:return o=e.sent,e.abrupt("return",o.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"_createDocument",value:function(e,t,n){var r={unique_name:e,data:t||{}};return void 0!==n&&(r.ttl=n),this.services.network.post(this.services.config.documentsUri,r).then((function(e){return e.body.data=r.data,e.body}))}},{key:"_getDocument",value:(p=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(XS.type,t)||this._get(this.services.config.documentsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"_createList",value:function(e,t,n,r){var i={unique_name:e,purpose:t,context:n};return void 0!==r&&(i.ttl=r),this.services.network.post(this.services.config.listsUri,i).then((function(e){return e.body}))}},{key:"_getList",value:(d=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(dE.type,t)||this._get(this.services.config.listsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"_createMap",value:function(e,t){var n={unique_name:e};return void 0!==t&&(n.ttl=t),this.services.network.post(this.services.config.mapsUri,n).then((function(e){return e.body}))}},{key:"_getMap",value:(f=Uo(Bc.mark((function e(t){var n,r=arguments;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],e.abrupt("return",this.readRootFromSessionCache(yE.type,t)||this._get(this.services.config.mapsUri,t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"_getStream",value:(l=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(bE.type,t)||this._get(this.services.config.streamsUri,t,!1));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"_createStream",value:(c=Uo(Bc.mark((function e(t,n){var r,i;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={unique_name:t},void 0!==n&&(r.ttl=n),e.next=4,this.services.network.post(this.services.config.streamsUri,r);case 4:return i=e.sent,e.abrupt("return",i.body);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"_getLiveQuery",value:function(e){return this.readRootFromSessionCache(TE.type,e)}},{key:"getCached",value:function(e,t){return e&&this.entities.get(e,t)||null}},{key:"removeFromCacheAndSession",value:function(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}},{key:"document",value:(u=Uo(Bc.mark((function e(t){var n,r,i,o,a=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=ME(t)).mode){e.next=9;break}return e.next=6,this._createDocument(n.id,n.data,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,XS.type))){e.next=14;break}return e.abrupt("return",new XS(i));case 14:return e.prev=14,e.next=17,this._getDocument(n.id);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createDocument(n.id,n.data,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.document(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(XS.type,n.id,r),o=new JS(this.services,r,(function(e,t,n){return a.removeFromCacheAndSession(e,t,n)})),o=this.entities.store(o),e.abrupt("return",new XS(o));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return u.apply(this,arguments)})},{key:"map",value:(s=Uo(Bc.mark((function e(t){var n,r,i,o,a=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=ME(t)).mode){e.next=9;break}return e.next=6,this._createMap(n.id,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,yE.type))){e.next=14;break}return e.abrupt("return",new yE(i));case 14:return e.prev=14,e.next=17,this._getMap(n.id,n.includeItems);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createMap(n.id,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.map(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(yE.type,n.id,r),o=new vE(this.services,r,(function(e,t,n){return a.removeFromCacheAndSession(e,t,n)})),o=this.entities.store(o),e.abrupt("return",new yE(o));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return s.apply(this,arguments)})},{key:"list",value:(a=Uo(Bc.mark((function e(t){var n,r,i,o,a=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=ME(t)).mode){e.next=9;break}return e.next=6,this._createList(n.id,n.purpose,n.context,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,dE.type))){e.next=14;break}return e.abrupt("return",new dE(i));case 14:return e.prev=14,e.next=17,this._getList(n.id);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createList(n.id,n.purpose,n.context,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.list(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(dE.type,n.id,r),o=new fE(this.services,r,(function(e,t,n){return a.removeFromCacheAndSession(e,t,n)})),o=this.entities.store(o),e.abrupt("return",new dE(o));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return a.apply(this,arguments)})},{key:"stream",value:(o=Uo(Bc.mark((function e(t){var n,r,i,o,a,s=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=ME(t)).mode){e.next=9;break}return e.next=6,this._createStream(n.id,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,bE.type))){e.next=14;break}return e.abrupt("return",new bE(i));case 14:return e.prev=14,e.next=17,this._getStream(n.id);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createStream(n.id,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.stream(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(bE.type,n.id,r),o=function(e,t,n){return s.removeFromCacheAndSession(e,t,n)},a=new gE(this.services,r,o),a=this.entities.store(a),e.abrupt("return",new bE(a));case 44:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return o.apply(this,arguments)})},{key:"shutdown",value:(i=Uo(Bc.mark((function e(){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateToken",value:(r=Uo(Bc.mark((function e(t){return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.twilsock.updateToken(t).catch((function(e){var t,n=null==e||null===(t=e.reply)||void 0===t?void 0:t.status;if(401===(null==n?void 0:n.code)&&"UNAUTHORIZED"===(null==n?void 0:n.status))throw new tS("Updated token was rejected by server",400,51130);throw e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"liveQuery",value:(n=Uo(Bc.mark((function e(t,n){var r,i,o,a,s,u=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return r=new H_(this.services.config.insightsUri).pathSegment(t).pathSegment("Items").build(),e.next=5,SE({network:this.services.network,uri:r,queryString:n,type:TE.type});case 5:return i=e.sent,(o=this.getCached(i.query_id,TE.type))||((a=this._getLiveQuery(i.query_id))||(a={indexName:t,queryExpression:n,sid:i.query_id,queryUri:r,last_event_id:i.last_event_id}),s=function(e,t,n){return u.removeFromCacheAndSession(e,t,n)},o=new _E(a,this.services,s,i.items)),this.storeRootInSessionCache(TE.type,i.query_id,o.liveQueryDescriptor),o=this.entities.store(o),e.abrupt("return",new TE(o));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"instantQuery",value:(t=Uo(Bc.mark((function e(t){var n,r=this;return Bc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return n=function(e,t){return r.liveQuery(e,t)},e.abrupt("return",new IE({indexName:t,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:n}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"populateInitRegistrations",value:function(e){e.populateInitRegistrations([FE,jE,LE,NE])}},{key:"version",get:function(){return PE}}]),Client}(Kc);return Yo(Client,"connectionStateChanged","connectionStateChanged"),Yo(Client,"connectionError","connectionError"),Yo(Client,"tokenAboutToExpire","tokenAboutToExpire"),Yo(Client,"tokenExpired","tokenExpired"),Wc([Ah(["undefined","string",Ih("open document options",{id:["string","undefined"],mode:[Sh("open_or_create","open_existing","create_new"),"undefined"],ttl:[Th,"undefined"],data:[Rh,"undefined",Sh(null)]})]),zc("design:type",Function),zc("design:paramtypes",[Object]),zc("design:returntype",Promise)],Client.prototype,"document",null),Wc([Ah(["undefined","string",Ih("open map options",{id:["string","undefined"],mode:[Sh("open_or_create","open_existing","create_new"),"undefined"],ttl:[Th,"undefined"],data:[Rh,"undefined",Sh(null)],includeItems:["boolean","undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Object]),zc("design:returntype",Promise)],Client.prototype,"map",null),Wc([Ah(["undefined","string",Ih("open list options",{id:["string","undefined"],mode:[Sh("open_or_create","open_existing","create_new"),"undefined"],ttl:[Th,"undefined"],data:[Rh,"undefined",Sh(null)],purpose:["string","undefined"],context:[Rh,"undefined"],includeItems:["boolean","undefined"]})]),zc("design:type",Function),zc("design:paramtypes",[Object]),zc("design:returntype",Promise)],Client.prototype,"list",null),Wc([Ah(["undefined","string",Ih("open stream options",{id:["string","undefined"],mode:[Sh("open_or_create","open_existing","create_new"),"undefined"],ttl:[Th,"undefined"],data:[Rh,"undefined",Sh(null)]})]),zc("design:type",Function),zc("design:paramtypes",[Object]),zc("design:returntype",Promise)],Client.prototype,"stream",null),Wc([Ah(Eh),zc("design:type",Function),zc("design:paramtypes",[String]),zc("design:returntype",Promise)],Client.prototype,"updateToken",null),Wc([Ah(Eh,"string"),zc("design:type",Function),zc("design:paramtypes",[String,String]),zc("design:returntype",Promise)],Client.prototype,"liveQuery",null),Wc([Ah(Eh),zc("design:type",Function),zc("design:paramtypes",[String]),zc("design:returntype",Promise)],Client.prototype,"instantQuery",null),e.Client=Client,e.InsightsItem=function e(){Bo(this,e)},e.InstantQuery=IE,e.LiveQuery=TE,e.Paginator=eE,e.SyncClient=Client,e.SyncDocument=XS,e.SyncList=dE,e.SyncListItem=ZS,e.SyncMap=yE,e.SyncMapItem=pE,e.SyncStream=bE,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
