{"version":3,"file":"storage.js","sources":["../../src/services/storage.ts"],"sourcesContent":["import { Configuration, Storage } from '../interfaces/services';\n\ninterface StorageBackend {\n  setItem(key: string, value: string): void;\n\n  getItem(key: string): string;\n\n  removeItem(key: string): void;\n}\n\nclass SessionStorage implements Storage {\n  private readonly config: Configuration;\n  private readonly storage: StorageBackend;\n  private storageId: string;\n\n  constructor(config: Configuration, storage?: StorageBackend) {\n    this.config = config;\n    this.storageId = null;\n    try {\n      this.storage = storage || sessionStorage;\n    } catch (e) {\n    }\n  }\n\n  private storageKey(type: string, key: string) {\n    return `${this.storageId}::${type}::${key}`;\n  }\n\n  private get isReady(): boolean {\n    return this.config.sessionStorageEnabled && !!this.storageId;\n  }\n\n  updateStorageId(storageId: string) {\n    this.storageId = storageId;\n  }\n\n  store(type: string, id: string, value: Object) {\n    if (!this.isReady) {\n      return null;\n    }\n    return this._store(this.storageKey(type, id), value);\n  }\n\n  read(type: string, id: string): Object {\n    if (!this.isReady) {\n      return null;\n    }\n    return this._read(this.storageKey(type, id));\n  }\n\n  remove(type: string, sid: string, uniqueName: string): void {\n    if (!this.isReady) {\n      return null;\n    }\n    try {\n      this.storage.removeItem(this.storageKey(type, sid));\n      if (uniqueName) {\n        this.storage.removeItem(this.storageKey(type, uniqueName));\n      }\n    } catch (e) {\n    }\n  }\n\n  update(type: string, sid: string, uniqueName: string, patch: Object): void {\n    if (!this.isReady) {\n      return null;\n    }\n    // Currently cache may have root stored twice - by sid and by uniqueName\n    // Maybe need to create some index if needed\n    this._apply(this.storageKey(type, sid), patch);\n    if (uniqueName) {\n      this._apply(this.storageKey(type, uniqueName), patch);\n    }\n  }\n\n  private _store(key: string, value: Object) {\n    try {\n      this.storage.setItem(key, JSON.stringify(value));\n    } catch (e) {\n    }\n  }\n\n  private _read(key: string): Object {\n    try {\n      let storedData = this.storage.getItem(key);\n      if (storedData) {\n        return JSON.parse(storedData);\n      }\n    } catch (e) {\n    }\n    return null;\n  }\n\n  private _apply(key: string, patch: any): boolean {\n    let value = this._read(key);\n    if (!value) {\n      return false;\n    }\n    this._store(key, Object.assign(value, patch));\n  }\n}\n\nexport { StorageBackend, SessionStorage };\n"],"names":[],"mappings":"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"}