{"version":3,"file":"media.js","sources":["../src/media.ts"],"sourcesContent":["import {\n  McsClient,\n  McsMedia,\n  McsMediaCategory,\n  McsMediaState,\n  CancellablePromise,\n} from \"@twilio/mcs-client\";\n\n/**\n * Category of media. Possible values are as follows:\n * * `'media'`\n * * `'body'`\n * * `'history'`\n */\ntype MediaCategory = McsMediaCategory;\n\ninterface MediaServices {\n  mcsClient: McsClient;\n}\n\n/**\n * Represents a media information for a message in a conversation.\n */\nclass Media {\n  private state: McsMediaState;\n  private services: MediaServices;\n  private mcsMedia: McsMedia | null = null;\n\n  /**\n   * @internal\n   */\n  constructor(data: McsMediaState | McsMedia, services: MediaServices) {\n    this.services = services;\n\n    if (data instanceof McsMedia) {\n      this.mcsMedia = data as McsMedia;\n    }\n\n    this.state = {\n      sid: data.sid,\n      category: data.category,\n      filename: data.filename ?? null,\n      contentType: data.contentType,\n      size: data.size,\n    };\n  }\n\n  /**\n   * Server-assigned unique identifier for the media.\n   */\n  public get sid(): string {\n    return this.state.sid;\n  }\n\n  /**\n   * File name. Null if absent.\n   */\n  public get filename(): string | null {\n    return this.state.filename;\n  }\n\n  /**\n   * Content type of the media.\n   */\n  public get contentType(): string {\n    return this.state.contentType;\n  }\n\n  /**\n   * Size of the media in bytes.\n   */\n  public get size(): number {\n    return this.state.size;\n  }\n\n  /**\n   * Media category, can be one of the {@link MediaCategory} values.\n   */\n  public get category(): MediaCategory {\n    return this.state.category;\n  }\n\n  /**\n   * Returns the direct content URL for the media.\n   *\n   * This URL is impermanent, it will expire in several minutes and cannot be cached.\n   * If the URL becomes expired, you need to request a new one.\n   * Each call to this function produces a new temporary URL.\n   */\n  public getContentTemporaryUrl(): CancellablePromise<string | null> {\n    return new CancellablePromise(async (resolve, reject, onCancel) => {\n      const fetchMediaRequest = this.mcsMedia\n        ? undefined\n        : this._fetchMcsMedia();\n      let contentUrlRequest = this.mcsMedia?.getContentUrl();\n\n      onCancel(() => {\n        if (fetchMediaRequest) {\n          fetchMediaRequest.cancel();\n        }\n        if (contentUrlRequest) {\n          contentUrlRequest.cancel();\n        }\n      });\n\n      try {\n        if (!contentUrlRequest) {\n          const mcsMedia = await fetchMediaRequest;\n          contentUrlRequest = mcsMedia?.getContentUrl();\n        }\n        resolve(contentUrlRequest ? await contentUrlRequest : null);\n      } catch (e) {\n        reject(e);\n      }\n    });\n  }\n\n  private _fetchMcsMedia(): CancellablePromise<McsMedia> {\n    return new CancellablePromise(async (resolve, reject, onCancel) => {\n      if (this.services.mcsClient === null) {\n        reject(new Error(\"Media Content Service is unavailable\"));\n      }\n\n      const request = this.services.mcsClient.get(this.state.sid);\n      onCancel(() => request.cancel());\n\n      try {\n        this.mcsMedia = await request;\n        this.state = this.mcsMedia._state();\n        resolve(this.mcsMedia);\n      } catch (e) {\n        reject(e);\n      }\n    });\n  }\n\n  /**\n   * @internal\n   */\n  _state(): McsMediaState {\n    return this.state;\n  }\n}\n\nexport { Media, MediaServices, MediaCategory };\n"],"names":["McsMedia","CancellablePromise"],"mappings":"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"}